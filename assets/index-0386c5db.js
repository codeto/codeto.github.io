import{j as e,a as M,b as et,F as ve,u as tt,c as Re}from"./@emotion-63839449.js";import{r as n}from"./react-4fd50329.js";import{B as ye}from"./index-881eef42.js";import"./lodash-88fe09e6.js";import{h as A}from"./moment-a468e1f9.js";import{a9 as X,s as ie,a1 as at,K as se,b0 as it,aG as ot,al as st,bv as nt,at as rt,eV as lt,ag as ct,fI as dt,l as t,fS as pt,co as mt,a3 as ut,dq as yt,a5 as De,I as K,bG as ft,Y as Be,c6 as ne,a as ge,fT as fe,dk as ht,E as Le,S as bt,fU as he,fV as Me,eE as Pt,fW as vt}from"./index-c2ded735.js";import"./file-saver-40cf32a9.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{P as Z}from"./prop-types-1172f4d5.js";import{F as _,u as oe}from"./index-687ba9e6.js";import{u as It}from"./react-router-a4308f7b.js";import{I as q,S as D}from"./index-43183512.js";import{r as Ye,j as Se,l as Ee,D as Ie,P as $e,u as gt,T as St,d as _t,n as Ne,k as Tt,a as _e}from"./index-b17d22e5.js";import{a as Ae,b as Ft,e as wt,c as xt,g as Ct,u as Ot,d as Dt}from"./paySlip-ee1c95d4.js";import{d as Lt}from"./downloadFileFromUrl-79614833.js";import{B as ke,w as be,a as re,R as Mt,b as E,k as Ue,S as Et,z as Ge,O as H}from"./antd-f9eae174.js";import{b as je}from"./buildLabelTree-54b4bf58.js";import{e as Pe}from"./rules-c1d56c23.js";import{M as Nt}from"./currency-cb786ed8.js";import{M as At}from"./index-6a3b7dc6.js";import{p as kt}from"./printHtml-6274ec45.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./account-86ffff50.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./index-f7aef2cc.js";const Q={time:[A().startOf("months"),A().endOf("months")],code:void 0,unitName:void 0,cashier:void 0,paymentMethod:"",fund:"",label:"",status:""},R=n.createContext({paymentVoucherPermissionExport:!1,paymentVoucherPermissionWrite:!1,paymentVoucherPermissionDelete:!1,fundPermissionRead:!1,idBuilding:0,formFilter:void 0,getListPayslipStatus:{isFetching:!1},setGetListPayslipStatus:()=>{},filter:{},setFilter:()=>{},tableData:{records:[],totalRecord:0},setTableData:()=>{},tableDataTotal:0,setTableDataTotal:()=>{},tablePagination:{current:X,limit:ie},setTablePagination:()=>{},formCreatePayslip:void 0,showFormCreatePayslip:()=>{},hideFormCreatePayslip:()=>{},formPrintPayslip:void 0,showFormPrintPayslip:()=>{},hideFormPrintPayslip:()=>{},formUpdatePayslip:void 0,showFormUpdatePayslip:()=>{},hideFormUpdatePayslip:()=>{},formCancelPayslip:void 0,showFormCancelPayslip:()=>{},hideFormCancelPayslip:()=>{}}),Te=({children:p})=>{const{idBuilding:v}=It(),{isUserCs:m}=at(),[g,h]=n.useState({isFetching:!1}),[c,y]=n.useState({...Q}),[I,a]=n.useState({records:[],totalRecord:0}),[i,f]=n.useState(0),[F,S]=n.useState({current:X,limit:ie}),[C,b,T]=se(),[w,o,P]=se(),[k,O,ee]=se(),[W,J,r]=se(),[l]=_.useForm(),{getPermissionByModuleCode:Y}=it(),U=Y(ot),te=Y(st),le=(U==null?void 0:U[nt])??!1,ce=(U==null?void 0:U[rt])??!1,de=(U==null?void 0:U[lt])??!1,pe=(te==null?void 0:te[ct])??!1,me={paymentVoucherPermissionExport:le,paymentVoucherPermissionWrite:ce,paymentVoucherPermissionDelete:de,fundPermissionRead:pe,idBuilding:v,formFilter:l,getListPayslipStatus:g,setGetListPayslipStatus:h,filter:c,setFilter:y,tableData:I,setTableData:({records:s,totalRecord:u})=>{const d=s.map(({id:B=0,code:L="",cashier:$="",payer:G="",content:x="",note:j="",fund:z,label:N,labelId:ze,voucherDay:qe,createdAt:We,deletedAt:He,deletedByName:Xe="",totalPayment:Je=0,paymentMethod:Ke,address:Ce="",unit:ue,receiptId:Qe=null,unitAccountId:Ze=null,updatedAt:Ve})=>{var Oe;return{id:B,key:B,code:L,cashier:$,payer:m?"***":G,content:x,note:j,fundName:(z==null?void 0:z.name)??"",label:N,labelId:ze,voucherDay:qe,createdAt:We,deletedAt:He,deletedByName:Xe,totalPayment:Je,paymentMethod:((Oe=dt[Ke])==null?void 0:Oe.name)??"",address:Ce,unitName:(ue==null?void 0:ue.name)??Ce,receiptId:Qe,unitAccountId:Ze,updatedAt:Ve}});a({records:d,totalRecord:u})},tableDataTotal:i,setTableDataTotal:f,tablePagination:F,setTablePagination:S,formCreatePayslip:C,showFormCreatePayslip:b,hideFormCreatePayslip:T,formPrintPayslip:w,showFormPrintPayslip:o,hideFormPrintPayslip:P,formUpdatePayslip:k,showFormUpdatePayslip:O,hideFormUpdatePayslip:ee,formCancelPayslip:W,showFormCancelPayslip:J,hideFormCancelPayslip:r};return e(R.Provider,{value:me,children:p})};Te.propTypes={children:Z.node};Te.defaultProps={children:e("div",{})};const Ut=Te,V=()=>{const{idBuilding:p,setTablePagination:v,setTableData:m,setTableDataTotal:g,setGetListPayslipStatus:h}=n.useContext(R);return[async({filter:y,tablePaginationInp:I,isChangeTableDataTotal:a})=>{const{time:i,code:f,fund:F,label:S,paymentMethod:C,status:b,unit:T,cashier:w,unitName:o}=y;if(h({isFetching:!0}),v({current:I.current,limit:I.limit}),!a){const P=await Ae({filter:{code:f||void 0,fundId:F||void 0,labelId:S||void 0,paymentMethod:C||void 0,unitId:T||void 0,status:b||void 0,from:i==null?void 0:i[0].startOf("day").toISOString(),to:i==null?void 0:i[1].endOf("day").toISOString(),cashier:w||void 0,unitName:o||void 0},idBuilding:p,limit:I.limit,page:I.current});m({records:P.data,totalRecord:P.totalRecord})}if(a){const[P,k]=await Promise.all([Ae({filter:{code:f||void 0,fundId:F||void 0,labelId:S||void 0,paymentMethod:C||void 0,unitId:T||void 0,status:b||void 0,from:i==null?void 0:i[0].startOf("day").toISOString(),to:i==null?void 0:i[1].endOf("day").toISOString(),cashier:w||void 0,unitName:o||void 0},idBuilding:p,limit:I.limit,page:I.current}),Ft(p,{code:f||void 0,fundId:F||void 0,labelId:S||void 0,paymentMethod:C||void 0,unitId:T||void 0,status:b||void 0,from:i==null?void 0:i[0].startOf("day").toISOString(),to:i==null?void 0:i[1].endOf("day").toISOString(),cashier:w||void 0,unitName:o||void 0})]);m({records:P.data,totalRecord:P.totalRecord}),g(k.data)}h({isFetching:!1})}]},Rt=()=>{const{setFilter:p,formFilter:v,fundPermissionRead:m}=n.useContext(R),{fundData:g}=Ye(),{labelsAccountingData:h}=Se(),[c]=V(),y=async a=>{p(a),await c({filter:a,isChangeTableDataTotal:!0,tablePaginationInp:{current:X,limit:ie}})},I=n.useMemo(()=>[{label:t.unit,key:"unitName",component:e(q,{placeholder:t.unit}),visible:!0},{label:t.payment_voucher_code,key:"code",component:e(q,{placeholder:t.payment_voucher_code}),visible:!0},{label:t.date_of_create_voucher,key:"time",component:e(Ie.RangePicker,{placeholder:[t.label.from_date,t.label.to_date],fluid:"true",format:[Ee,Ee],getPopupContainer:a=>a.parentNode}),visible:!0,fixed:!0},{label:t.status1,key:"status",component:M(D,{fluid:"true",getPopupContainer:a=>a.parentNode,children:[e(D.Option,{value:"",children:t.all_status},"status_0"),pt.map(({id:a,name:i})=>e(D.Option,{value:a,children:i},a))]}),visible:!0},{label:t.label.fund,key:"fund",component:M(D,{fluid:"true",getPopupContainer:a=>a.parentNode,children:[e(D.Option,{value:"",children:t.all_fund},"fund_0"),g.map(({id:a,name:i})=>e(D.Option,{value:a,children:i},a))]}),visible:!0},{label:t.label.payment_method,key:"paymentMethod",component:M(D,{fluid:"true",getPopupContainer:a=>a.parentNode,children:[e(D.Option,{value:"",children:t.all_method},"payment_method_0"),m?mt.map(({label:a,value:i})=>e(D.Option,{value:i,children:a},i)):null]}),visible:!0},{label:t.label.cashier,key:"cashier",component:e(q,{placeholder:t.label.cashier}),visible:!0},{label:t.label.label,key:"label",component:M(D,{showSearch:!0,filterOption:(a,i)=>i.children.toLowerCase().includes(a.toLowerCase()),placeholder:t.label.label,fluid:"true",getPopupContainer:a=>a.parentNode,children:[e(D.Option,{value:"",children:t.all_label},"label_0"),h.map(({id:a,title:i})=>e(D.Option,{value:a,children:i},a))]}),visible:!0}],[h,g]);return e($e.FilterBox,{defaultFilter:{...Q},onSearch:y,layout:"vertical",filters:I,formData:v})};function Bt(){const{idBuilding:p,showFormCreatePayslip:v,tableData:m,filter:g,paymentVoucherPermissionWrite:h,paymentVoucherPermissionExport:c}=n.useContext(R),[y]=Be(),I=ut(),[a,i]=n.useState({isFetching:!1,code:void 0,codeLanguage:void 0});oe(a.code,a.codeLanguage,{message:t.success,description:t.export_data_success});const f=async()=>{i({isFetching:!0,code:void 0,codeLanguage:void 0});try{const{time:S,code:C,fund:b,label:T,paymentMethod:w,status:o,unit:P,cashier:k}=g,O=await wt(p,{code:C||void 0,fundId:b||void 0,labelId:T||void 0,paymentMethod:w||void 0,unitId:P||void 0,status:o||void 0,from:S==null?void 0:S[0].startOf("day").toISOString(),to:S==null?void 0:S[1].endOf("day").toISOString(),cashier:k||void 0});i({isFetching:!1,code:O.code,codeLanguage:O.codeLanguage}),O.data&&Lt(O.data,document,"thong-tin-phieu-chi.xlsx")}catch(S){i({isFetching:!1,code:S.code,codeLanguage:S.codeLanguage})}},F=[c?e(ke,{onClick:()=>{I({action:yt,label:De}),f()},icon:e(K,{name:"icon-download-outlined"}),loading:a.isFetching,disabled:a.isFetching,type:"primary",ghost:!0,style:{marginRight:y.marginSm},children:t.label.export},"export"):null,h?e(ke,{type:"primary",icon:e(K,{name:"icon-plus-circle-outlined"}),onClick:()=>{I({action:ft,label:De}),v()},children:t.create_payment_voucher},"create_payment_voucher"):null].filter(Boolean);return e($e.ActionBox,{total:m.totalRecord,actions:F})}var Yt={name:"s5xdrg",styles:"display:flex;align-items:center"};const $t=()=>{const{tablePagination:p,tableDataTotal:v,tableData:m,showFormPrintPayslip:g,showFormUpdatePayslip:h,showFormCancelPayslip:c,filter:y,paymentVoucherPermissionWrite:I,paymentVoucherPermissionDelete:a}=n.useContext(R),[i]=Be(),[f]=V(),{currentBuilding:F}=gt(),{lockDataAt:S}=F,C="15/04/2024",b=r=>!!(S&&r&&A(r).isBefore(S)),T=r=>{g({...r})},w=r=>{h({...r})},o=r=>{c({...r})},P=n.useMemo(()=>[{title:t.payment_voucher_code,key:"code",dataIndex:"code",fixed:"left",width:180,render:(r,l)=>M("div",{css:Yt,children:[e("span",{css:et({marginRight:i.marginXs},"",""),children:r}),b(l==null?void 0:l.createdAt)?e(K,{name:"icon-lock-outlined"}):null]})},{title:`${t.unit}/${t.address}`,key:"unitName",dataIndex:"unitName",width:150},{title:t.label.created_at,key:"createdAt",dataIndex:"createdAt",width:150,render:r=>r?A(r).format("DD/MM/YYYY"):""},{title:t.label.content,key:"content",dataIndex:"content",ellipsis:!0,width:300},{title:t.label.cashier,key:"cashier",dataIndex:"cashier",width:150},{title:t.label.receiver,key:"payer",dataIndex:"payer",width:150},{title:t.label.note,key:"note",dataIndex:"note",ellipsis:!0,width:300},{title:t.label.fund,key:"fundName",dataIndex:"fundName",width:200},{title:t.label.payment_method,key:"paymentMethod",dataIndex:"paymentMethod",width:200},{title:t.label.voucher_day,key:"voucherDay",dataIndex:"voucherDay",width:150,render:r=>r?A(r).format("DD/MM/YYYY"):""},{title:t.label.label,key:"label",dataIndex:"label",render:(r,{label:l})=>l&&l.title&&e(be,{color:l.color,children:l.title})||"",width:200},{title:t.label.status,key:"status",dataIndex:"isDeleted",render:(r,l)=>l!=null&&l.deletedAt?e(be,{color:"error",children:t.label.canceled}):e(be,{color:"success",children:t.label.not_canceled}),width:150},{title:t.label.deleted_at_payslip,key:"deletedAt",dataIndex:"deletedAt",width:150,render:r=>r?A(r).format("DD/MM/YYYY"):""},{title:t.label.deleted_by,key:"deletedByName",dataIndex:"deletedByName",width:150},{title:`${t.label.total} (VND)`,align:"right",width:150,children:[{title:e(re.Text,{strong:!0,children:ne(v)}),key:"totalPayment",dataIndex:"totalPayment",fixed:"right",width:150,align:"right",render:r=>e(re.Text,{strong:!0,children:ne(r)})}]},{title:t.actions,key:"action",fixed:"right",align:"center",width:110,render:(r,l)=>{let Y=a&&!l.deletedAt&&(l==null?void 0:l.receiptId)===null;return Y&&l.unitAccountId&&A(C,"DD/MM/YYYY").isAfter(A(l.createdAt),"days")&&(Y=!1),M(ve,{children:[e(K,{style:{fontSize:i.fontSizeLargeIcon},onClick:()=>T(l),name:"icon-print-outlined",title:t.label.print}),b(l==null?void 0:l.createdAt)?null:M(ve,{children:[I&&!l.deletedAt?e(K,{style:{marginLeft:i.marginSm,fontSize:i.fontSizeLargeIcon},onClick:()=>w(l),name:"icon-edit-outlined",title:t.update}):null,Y?e(K,{style:{fontSize:i.fontSizeLargeIcon,marginLeft:i.marginSm},onClick:()=>o(l),name:"icon-minus-circle-outlined",title:t.button.cancel}):null]})]})}}],[v]),k=async(r,l)=>{p.current!==r?await f({filter:y,isChangeTableDataTotal:!1,tablePaginationInp:{current:r,limit:p.limit}}):p.limit!==l&&await f({filter:y,isChangeTableDataTotal:!1,tablePaginationInp:{current:p.current,limit:l}})},O=n.useMemo(()=>({pageSize:p.limit,defaultCurrent:X,current:p.current,total:m.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:k}),[p,m]),ee=m.records,W=n.useMemo(()=>P.reduce((r,l)=>r+l.width,0),[P]);return[O,P,ee,W,r=>r.deletedAt?"disabled":""]},Gt=20,jt=()=>{const p=tt(),{layoutScrollRef:v}=n.useContext(ge),{getListPayslipStatus:m}=n.useContext(R),[g]=V(),[h,c,y,I,a]=$t();return n.useEffect(()=>{(async()=>await g({filter:{...Q},isChangeTableDataTotal:!0,tablePaginationInp:{current:X,limit:Gt}}))()},[]),e(St,{rowClassName:a,bordered:!0,dataSource:y,columns:c,scroll:{x:I},loading:m.isFetching,pagination:h,sticky:{offsetScroll:p.offsetScrollX,getContainer:()=>v.current}})},zt=()=>{const{currentUser:p}=n.useContext(ge),{idBuilding:v,hideFormCreatePayslip:m,showFormPrintPayslip:g,setFilter:h,formFilter:c}=n.useContext(R),{fundData:y}=Ye(),{labelTreeDataStatistics:I}=Se(),[a]=_.useForm(),[i]=V(),[f,F]=n.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[S,C]=n.useState({isFetching:!1}),[b,T]=n.useState({balance:0}),[w,o]=n.useState([]),[P,k]=n.useState([]),[O,ee]=n.useState(null),[W,J]=n.useState(!1),[r,l]=n.useState(!1);oe(f.code,f.codeLanguage,{message:t.success,description:t.create_data_success});const Y=async s=>{var B;C({isFetching:!0});const d=(B=(await ht({idBuilding:v,page:X,limit:ie,filter:{name:s}})).data)==null?void 0:B.map(L=>{var z;const $={},G={},x={},j=((z=L==null?void 0:L.unitAccounts)==null?void 0:z.filter(N=>Number(N.balance)!==0))||[];return j==null||j.forEach(N=>{$[N.fundId]||($[N.fundId]=N.fund),G[N.serviceId]||(G[N.serviceId]=N.service),x[`${N.fundId}-${N.serviceId}`]||(x[`${N.fundId}-${N.serviceId}`]=Number(N.balance))}),{...L,funds:Object.values($),services:Object.values(G),unitAccountObj:x}});o(d),C({isFetching:!1})};n.useEffect(()=>{(async()=>await Y())()},[]);const U=async()=>{var u;if(a.setFieldsValue({cashier:Le(a.getFieldValue("cashier")),payer:Le(a.getFieldValue("payer"))}),await a.validateFields()){F({isFetching:!0,code:void 0,codeLanguage:void 0});const d=a.getFieldsValue(),B={...d,createdAt:d.createdAt?A(d.createdAt).toISOString():A().toISOString(),voucherDay:d.voucherDay?A(d.voucherDay).toISOString():void 0,cashier:d.cashier,payer:d.payer,content:d.content,note:d.note,labelId:((u=d==null?void 0:d.labelId)==null?void 0:u.value)||void 0};try{const L=await xt(v,B);F({isFetching:!1,code:L.code,codeLanguage:L.codeLanguage}),bt.includes(L.code)&&(c.setFieldsValue({...Q,status:he}),h({...Q,status:he}),await i({filter:{...Q,status:he},isChangeTableDataTotal:!0,tablePaginationInp:{current:X,limit:ie}}),m(),g({...L.data}))}catch(L){F({isFetching:!1,code:L.code,codeLanguage:L.codeLanguage})}}},te=()=>m(),le=(s,u)=>{var B,L,$,G;const d=w.find(x=>x.id===(u==null?void 0:u.unitId));if(ee(d),s!=null&&s.unitId&&(k((d==null?void 0:d.residents)??[]),a.setFieldsValue({type:fe,address:d==null?void 0:d.name,serviceId:void 0}),J(!0),l(!1),T({balance:0})),(u==null?void 0:u.type)!==Me&&!(u!=null&&u.unitId)&&(J(!1),l(!1)),s!=null&&s.type&&(l((s==null?void 0:s.type)===Me),(s==null?void 0:s.type)===fe&&(a.setFieldsValue({serviceId:void 0}),T({balance:0}))),s!=null&&s.paymentMethod){const x=(B=d==null?void 0:d.funds)==null?void 0:B.find(z=>z.method===(s==null?void 0:s.paymentMethod)),j=((L=d==null?void 0:d.unitAccountObj)==null?void 0:L[`${x==null?void 0:x.id}-${u==null?void 0:u.serviceId}`])||0;a.setFieldsValue({fundId:x==null?void 0:x.id,totalPayment:j}),T({balance:j})}if(s!=null&&s.fundId){const x=(($=d==null?void 0:d.unitAccountObj)==null?void 0:$[`${s==null?void 0:s.fundId}-${u==null?void 0:u.serviceId}`])||0;a.setFieldsValue({totalPayment:x}),u!=null&&u.unitId&&T({balance:x}),u!=null&&u.unitId||(J(!1),l(!1),T({balance:0}),a.setFieldsValue({serviceId:void 0}))}if(s!=null&&s.serviceId){const x=((G=d==null?void 0:d.unitAccountObj)==null?void 0:G[`${u==null?void 0:u.fundId}-${s==null?void 0:s.serviceId}`])||0;a.setFieldsValue({totalPayment:x}),T({balance:x})}(s!=null&&s.totalPayment||(s==null?void 0:s.totalPayment)===0)&&(r?(s==null?void 0:s.totalPayment)>b.balance?a.setFieldsValue({totalPayment:b.balance}):a.setFieldsValue({totalPayment:s==null?void 0:s.totalPayment}):a.setFieldsValue({totalPayment:s==null?void 0:s.totalPayment}))},ce={cashier:p.fullName,payer:"",unitId:void 0,address:"",content:"",note:"",createdAt:A(),totalPayment:0,paymentMethod:void 0,fundId:void 0,voucherDay:A(),labelId:void 0,type:fe},{services:de,funds:pe,maxTotalPayment:me}=n.useMemo(()=>W&&r?{services:(O==null?void 0:O.services)||[],funds:(O==null?void 0:O.funds)||[],maxTotalPayment:(b==null?void 0:b.balance)||0}:{services:[],funds:y,maxTotalPayment:Nt},[O,y,b,W,r]);return{getListUnit:Y,onOk:U,onCancel:te,createPayslipStatus:f,form:a,initialValues:ce,onValuesChange:le,listPayer:P,getListUnitStatus:S,listUnit:w,services:de,unitAccount:b,funds:pe,labelTree:I,maxTotalPayment:me,isShowType:W,isShowService:r}},qt=Re("button",{target:"e15nt7bz0"})({name:"eivff4",styles:"display:none"}),{Option:ae}=D,Wt=()=>{const{onOk:p,onCancel:v,createPayslipStatus:m,form:g,initialValues:h,onValuesChange:c,listPayer:y,getListUnitStatus:I,listUnit:a,services:i,unitAccount:f,funds:F,labelTree:S,getListUnit:C,maxTotalPayment:b,isShowType:T,isShowService:w}=zt();return e(_e,{title:t.create_payment_voucher,open:!0,width:"70%",onOk:p,onCancel:v,confirmLoading:m.isFetching,okText:t.label.confirm,cancelText:t.label.cancel,okButtonProps:{disabled:m.isFetching,loading:m.isFetching},children:M(_,{layout:"vertical",name:"form_data_payment_slip",form:g,initialValues:h,scrollToFirstError:!0,onValuesChange:c,children:[M(Mt,{gutter:[8,0],children:[e(E,{span:12,children:e(_.Item,{name:"cashier",rules:[{required:!0},Pe],label:t.label.cashier,children:e(q,{placeholder:t.label.cashier})})}),e(E,{span:12,children:e(_.Item,{name:"payer",rules:[{required:!0},Pe],label:t.label.receiver,children:e(Ue,{style:{width:"100%"},filterOption:(o,P)=>P.value.toUpperCase().indexOf(o.toUpperCase())!==-1,placeholder:t.label.receiver,getPopupContainer:()=>document.getElementById("form_data_payment_slip"),children:y.map(({id:o,fullName:P})=>e(Ue.Option,{value:P,children:P},`${P}-${o}`))})})}),e(E,{span:12,children:e(_.Item,{name:"unitId",label:t.label.apartment,children:e(D,{fluid:!0,showSearch:!0,placeholder:t.label.apartment,allowClear:!0,onSearch:_t(C),filterOption:!1,getPopupContainer:()=>document.getElementById("form_data_payment_slip"),dropdownRender:o=>I.isFetching?e("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:e(Et,{})}):o,children:a.map(o=>e(ae,{value:o.id,children:o.name},o.id))})})}),e(E,{span:12,children:e(_.Item,{name:"address",label:t.label.address,rules:[Pe],children:e(q,{placeholder:t.label.address})})}),e(E,{span:12,children:e(_.Item,{name:"paymentMethod",rules:[{required:!0}],label:t.label.payment_method,children:e(D,{fluid:!0,showSearch:!0,placeholder:t.label.payment_method,children:Pt.map(o=>e(ae,{value:o.id,children:o.name},o.id))})})}),e(E,{span:12,children:e(_.Item,{noStyle:!0,shouldUpdate:(o,P)=>o.paymentMethod!==P.paymentMethod,children:({getFieldValue:o})=>{var P;return e(_.Item,{name:"fundId",rules:[{required:!0}],label:t.label.fund,getPopupContainer:()=>document.getElementById("form_data_payment_slip"),children:e(D,{fluid:!0,placeholder:t.label.fund,children:(P=F==null?void 0:F.filter(k=>k.method===o("paymentMethod")))==null?void 0:P.map(({id:k,name:O})=>e(ae,{value:k,children:O},k))})})}})}),T&&e(E,{span:12,children:e(_.Item,{name:"type",label:t.label.service_advance_payment,children:e(D,{fluid:"true",placeholder:t.label.service_advance_payment,children:vt.map(o=>e(ae,{value:o.id,children:o.name},o.id))})})}),w?M(ve,{children:[e(E,{span:7,children:e(_.Item,{name:"serviceId",label:t.label.service,rules:[{required:!0}],children:e(D,{allowClear:!0,fluid:!0,showSearch:!0,placeholder:t.label.service,optionFilterProp:"children",getPopupContainer:o=>o.parentNode,filterOption:(o,P)=>Ne(P.children).indexOf(Ne(o))>=0,children:i==null?void 0:i.map(o=>e(ae,{value:o==null?void 0:o.id,children:o==null?void 0:o.name},o==null?void 0:o.id))})})}),M(E,{span:5,style:{display:"flex",justifyContent:"center",alignItems:"center",gap:4,flexDirection:"column"},children:[M(re.Text,{strong:!0,children:[t.label.service_advance_payment,":"]}),e(re.Text,{type:"danger",strong:!0,children:ne(f.balance)})]})]}):T?e(E,{span:12}):null,e(E,{span:12,children:e(_.Item,{name:"totalPayment",rules:[{required:!0,type:"integer",max:b,min:1}],label:t.label.total_money,children:e(Tt,{min:1,placeholder:t.label.total_money,formatter:o=>ne(o)})})}),e(E,{span:12,children:e(_.Item,{name:"createdAt",rules:[{required:!0}],label:t.label.date_created,children:e(Ie,{fluid:!0,placeholder:t.label.date_created,format:"DD/MM/YYYY",disabledDate:o=>!o||o.isAfter(A(new Date))})})}),e(E,{span:12,children:e(_.Item,{name:"voucherDay",label:t.label.voucher_day,children:e(Ie,{style:{width:"100%"},placeholder:t.label.voucher_day,format:"DD/MM/YYYY"})})}),e(E,{span:12,children:e(_.Item,{name:"labelId",label:t.label.label,children:e(Ge,{placeholder:t.label.label,style:{width:"100%"},treeDefaultExpandAll:!0,allowClear:!0,treeLine:!0,treeIcon:!0,virtual:"false",getPopupContainer:()=>document.getElementById("form_data_payment_slip"),treeData:je(S),labelInValue:!0})})}),e(E,{span:24,children:e(_.Item,{name:"content",label:t.label.content,rules:[],children:e(q.TextArea,{allowClear:!0,autoSize:{minRows:2,maxRows:6},placeholder:t.label.content})})}),e(E,{span:24,children:e(_.Item,{name:"note",label:t.label.note,rules:[],children:e(q,{placeholder:t.label.note})})})]}),e(qt,{type:"submit"})]})})};function Fe(p){const{hideFormPrintPayslip:v,idBuilding:m}=n.useContext(R),{idPayslip:g}=p,[h,c]=n.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[y,I]=n.useState();oe(h.code,h.codeLanguage);const a=()=>{v()},i=()=>{kt(y)};return n.useEffect(()=>{(async()=>{c({isFetching:!0});try{const f=await Ct(m,g);I(f.data),c({isFetching:!1,code:f.code,codeLanguage:f.codeLanguage})}catch(f){c({isFetching:!1,code:f.code,codeLanguage:f.codeLanguage})}})()},[]),e(At,{visible:!0,title:t.label.detail,okText:t.label.print,isLoadingPreview:h.isFetching,html:y||"<div />",onCancel:a,onOk:i})}Fe.defaultProps={idPayslip:0};Fe.propTypes={idPayslip:Z.number};const{useForm:Ht,Item:Xt}=_,Jt=Re(Xt,{target:"e8yegk0"})({name:"1annwmx",styles:"& .ant-form-item-control-input-content{width:100%;}"});function we(p){var b;const{hideFormUpdatePayslip:v,idBuilding:m,filter:g,tablePagination:h}=n.useContext(R),{payslip:c}=p,{labelTreeDataStatistics:y}=Se(),[I]=V(),[a,i]=n.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[f]=Ht(),F=async()=>{if(await f.validateFields()){i({isFetching:!0,code:void 0,codeLanguage:void 0});try{const{label:w}=f.getFieldsValue(),o=await Ot(m,(w==null?void 0:w.value)??null,c.id);i({isFetching:!1,code:o.code,codeLanguage:o.codeLanguage}),await I({filter:g,isChangeTotalRow:!1,tablePaginationInp:h}),v()}catch(w){i({isFetching:!1,code:w.code,codeLanguage:w.codeLanguage})}}},S=()=>v();oe(a.code,a.codeLanguage,{message:t.success,description:t.update_data_success});const C={label:c.labelId?{value:c.labelId}:void 0};return e(_e,{title:t.update_payment_voucher,open:!0,confirmLoading:a.isFetching,okText:t.confirm,cancelText:t.cancel,onOk:F,onCancel:S,children:M(_,{name:"payslipUpdateForm",layout:"vertical",scrollToFirstError:!0,form:f,initialValues:C,requiredMark:!1,children:[M(H,{size:"middle",column:2,layout:"horizontal",children:[e(H.Item,{span:2,label:t.payment_voucher_code,children:c.code},"receipt_code"),e(H.Item,{span:2,label:`${t.unit} / ${t.address}`,children:((b=c.unit)==null?void 0:b.name)??c.address},"apartment"),e(H.Item,{span:2,label:t.date_of_create_voucher,children:c.createdAt?A(c.createdAt).format("DD/MM/YYYY"):""},"dateOfCreateVoucher"),e(H.Item,{span:2,label:t.payment_method,children:c==null?void 0:c.paymentMethod},"paymentMethod"),e(H.Item,{label:t.cashier,children:c.cashier},"cashier"),e(H.Item,{label:t.payer,children:c.payer},"payer")]}),e(Jt,{name:"label",label:t.label.label,children:e(Ge,{placeholder:t.label.label,style:{width:"100%"},treeDefaultExpandAll:!0,allowClear:!0,labelInValue:!0,treeIcon:!0,treeLine:!0,treeData:je(y)})})]})})}we.defaultProps={payslip:void 0};we.propTypes={payslip:Z.objectOf(Z.any)};const xe=p=>{const{payslip:v}=p,{idBuilding:m,hideFormCancelPayslip:g,filter:h,tablePagination:c}=n.useContext(R),[y]=_.useForm(),[I]=V(),[a,i]=n.useState({isFetching:!1,code:void 0,codeLanguage:void 0});oe(a.code,a.codeLanguage,{message:t.success,description:t.cancel_payment_voucher_success});const f=async()=>{if(await y.validateFields()){const{reason:C}=y.getFieldsValue();i({isFetching:!0,code:void 0,codeLanguage:void 0});try{const b=await Dt(m,v.id,{reason:C});i({isFetching:!1,code:b.code,codeLanguage:b.codeLanguage}),await I({filter:h,isChangeTotalRow:!1,tablePaginationInp:c}),g()}catch({code:b,codeLanguage:T}){i({isFetching:!1,code:b,codeLanguage:T})}}},F=()=>g();return e(_e,{title:t.confirm,open:!0,onOk:f,onCancel:F,confirmLoading:a.isFetching,okText:t.confirm,cancelText:t.cancel,children:M(_,{layout:"vertical",name:"form_cancel_payslip",form:y,initialValues:{reason:""},children:[t.confirm_cancel_payment_voucher," ",e("b",{children:v.code})," ?",e(_.Item,{name:"reason",rules:[{required:!0}],label:t.reason,children:e(q,{placeholder:t.reason})})]})})};xe.propTypes={payslip:Z.objectOf(Z.any)};xe.defaultProps={payslip:void 0};const Kt=()=>{const{setTitlePage:p,setVisibleFilterBox:v,setVisibleSearchBox:m}=n.useContext(ge),{formCreatePayslip:g,formPrintPayslip:h,formUpdatePayslip:c,formCancelPayslip:y}=n.useContext(R);return n.useEffect(()=>(p(t.payslip),m(!0),()=>{p(""),m(!1),v(!1)}),[]),M("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[e(Rt,{}),M(ye,{style:{flex:1},children:[e(ye.Header,{children:e(Bt,{})}),e(ye.Content,{fluid:!0,children:e(jt,{})}),g.isShow?e(Wt,{}):null,h.isShow?e(Fe,{idPayslip:h.data.id}):null,c.isShow?e(we,{payslip:c.data}):null,y.isShow?e(xe,{payslip:y.data}):null]})]})},ki=()=>e(Ut,{children:e(Kt,{})});export{ki as default};
