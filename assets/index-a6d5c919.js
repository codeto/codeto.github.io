import{j as a,u as be,a as q,b as ke,F as ge}from"./@emotion-63839449.js";import{h as aa,u as Pe,d as Xe,a as ie,T as Le,k as Qe,P as ae,m as na,z as ue,D as Te,l as Ne,F as oa,N as ra}from"./index-b17d22e5.js";import{P as N}from"./prop-types-1172f4d5.js";import{s as z,a9 as J,eU as re,b0 as ia,K as te,az as sa,at as ca,bv as la,ax as da,eV as ua,eW as ma,g as ha,L as pa,eh as ga,eX as Ae,eY as fa,eZ as le,l as t,E as Ze,S as Ee,e_ as de,e$ as pe,f0 as fe,f1 as Oe,a as et,a3 as tt,I as Z,f2 as ya,f3 as _t,f4 as Bt,f5 as Ge,f6 as Ft,c6 as xe,f7 as va,b1 as It,f8 as at,f9 as Sa,bH as Ta,a5 as Se,bI as Ct,fa as wa,dq as _a,dP as Ba,fb as Fa,fc as Ia,fd as Ca,fe as Aa,ff as xa,fg as At,fh as Pa,cf as xt,fi as La,fj as Ea,fk as Pt,fl as Lt,b5 as Ra,a1 as De,fm as ft,fn as Et,fo as ka}from"./index-c2ded735.js";import{l as yt}from"./lodash-88fe09e6.js";import{h as P}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import{F as O,u as Be}from"./index-687ba9e6.js";import{r as y}from"./react-4fd50329.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{u as ba}from"./useTableCheckbox-753d19b2.js";import{u as ee}from"./react-router-a4308f7b.js";import{g as Da,a as Ya,s as Na,u as Rt,d as Oa,e as ja,c as Ma,b as Va,p as $a,f as Ua,h as qa,i as Ha,j as Ga}from"./bill-d9d0423c.js";import{b as za}from"./buildDetailBills-28b155ef.js";import{a as $,w as Ja,T as kt,B as ve,D as Ka,c as ze,b as K,n as nt,P as ot,S as bt,R as rt}from"./antd-f9eae174.js";import{A as Wa,a as Xa,b as Qa,c as it,d as Za}from"./constants-1272f83b.js";import{I as we,S as U}from"./index-43183512.js";import{u as je}from"./useService-37d60dc0.js";import{e as st}from"./exportExcel-837be6ed.js";import{g as Dt}from"./getListApartment-f9e300ed.js";import{M as en}from"./index-6a3b7dc6.js";import{f as tn}from"./feeNotification-74acc339.js";import{I as Yt}from"./index-9ef224b9.js";import{a as vt}from"./regex-deefadac.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./index-881eef42.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./xlsx-0fb7ed70.js";import"./index-f7aef2cc.js";import"./uuid-4a60fe23.js";const W=y.createContext({idBuilding:0,billingPermissionWrite:!1,billingPermissionExport:!1,billingPermissionApprove:!1,billingPermissionDelete:!1,formFilter:void 0,getListBillStatus:{isFetching:!1},setGetListBillStatus:()=>{},tableData:{records:[],totalRecord:0},setTableData:()=>{},tablePagination:{limit:z,current:J},setTablePagination:()=>{},totalPaymentOfListBill:0,setTotalPaymentOfListBill:()=>{},filterObject:{...re},setFilterObject:()=>{},formAddAdjust:void 0,showFormAddAdjust:()=>{},hideFormAddAdjust:()=>{},formUpdateAdjust:void 0,showFormUpdateAdjust:()=>{},hideFormUpdateAdjust:()=>{},formDelete:void 0,showFormDelete:()=>{},hideFormDelete:()=>{},formExport:void 0,showFormExport:()=>{},hideFormExport:()=>{},tableSelection:{isSelectAllItem:!1,isShowQuestionSelectAll:!1,selectedRowsCache:[],selectedRowKeysCache:[],selectedRowKeys:[],byId:{}},resetDataTableSelection:()=>{},onSelectRow:()=>{},onSelectAllRowOfPage:()=>{},selectAllRowComponent:()=>{},processPublic:void 0,showProcessPublic:()=>{},hideProcessPublic:()=>{},showBillUnpaidStatistic:()=>{},hideBillUnpaidStatistic:()=>{},billUnpaidStatistic:void 0,getTotalPaymentStatus:{isFetching:!1},setGetTotalPaymentStatus:()=>{},formImportAdjust:void 0,showFormImportAdjust:()=>{},hideFormImportAdjust:()=>{},editRowKey:"",setEditRowKey:()=>{},modalImportBill:void 0,showModalImportBill:()=>{},hideModalImportBill:()=>{},billingPermissionUpdateInfo:!1,formDeleteBill:{isShow:!1,data:{}},showFormDeleteBill:()=>{},hideFormDeleteBill:()=>{},formHistoryBill:void 0,showFormHistoryBill:()=>{},hideFormHistoryBill:()=>{},dataHistories:[],setDataHistories:()=>{}}),Nt=e=>{const{idBuilding:n}=ee(),{children:o}=e,{getPermissionByModuleCode:r}=ia(),[i,u]=y.useState({isFetching:!1}),[s,m]=y.useState({records:[],totalRecord:0}),[c,g]=y.useState({limit:z,current:J}),[l,h]=y.useState({isFetching:!1}),[p,f]=y.useState(0),[T,S]=y.useState({...re}),[_,L,v,B,C]=ba({dataRows:s.records,rowKey:"id",totalRows:s.totalRecord}),[A,b]=y.useState(""),[R,k]=y.useState([]),[D,Y,w]=te(),[d,I,M]=te(),[x,E,j]=te(),[V,X,G]=te(),[oe,ce,Fe]=te(),[Ie,Ce,Re]=te(),[Ye,Ve,F]=te(),[me,H,he]=te(),[Ut,qt,Ht]=te(),[Gt,zt,Jt]=te(),[Kt]=O.useForm(),Q=r(sa),Wt=(Q==null?void 0:Q[ca])??!1,Xt=(Q==null?void 0:Q[la])??!1,Qt=(Q==null?void 0:Q[da])??!1,Zt=(Q==null?void 0:Q[ua])??!1,ea=(Q==null?void 0:Q[ma])??!1,ta={idBuilding:n,billingPermissionWrite:Wt,billingPermissionExport:Xt,billingPermissionApprove:Qt,billingPermissionDelete:Zt,formFilter:Kt,getListBillStatus:i,setGetListBillStatus:u,tableData:s,setTableData:m,tablePagination:c,setTablePagination:g,getTotalPaymentStatus:l,setGetTotalPaymentStatus:h,totalPaymentOfListBill:p,setTotalPaymentOfListBill:f,filterObject:T,setFilterObject:S,formAddAdjust:D,showFormAddAdjust:Y,hideFormAddAdjust:w,formUpdateAdjust:d,showFormUpdateAdjust:I,hideFormUpdateAdjust:M,formDelete:x,showFormDelete:E,hideFormDelete:j,formExport:V,showFormExport:X,hideFormExport:G,tableSelection:_,resetDataTableSelection:L,onSelectRow:v,onSelectAllRowOfPage:B,selectAllRowComponent:C,processPublic:oe,showProcessPublic:ce,hideProcessPublic:Fe,billUnpaidStatistic:Ie,showBillUnpaidStatistic:Ce,hideBillUnpaidStatistic:Re,formImportAdjust:Ye,showFormImportAdjust:Ve,hideFormImportAdjust:F,editRowKey:A,setEditRowKey:b,modalImportBill:me,showModalImportBill:H,hideModalImportBill:he,billingPermissionUpdateInfo:ea,formDeleteBill:Ut,showFormDeleteBill:qt,hideFormDeleteBill:Ht,formHistoryBill:Gt,showFormHistoryBill:zt,hideFormHistoryBill:Jt,dataHistories:R,setDataHistories:k};return a(W.Provider,{value:ta,children:o})};Nt.propTypes={children:N.node.isRequired};const an=Nt,Je=e=>{var f,T,S,_,L,v,B,C,A,b,R,k,D,Y,w,d,I,M,x,E;const n=ha()===pa,o=Math.round(Number(e.totalPayment)),r=Math.round(Number(e.netRevenue)),i=((f=e==null?void 0:e.service)==null?void 0:f.systemCode)??"",u=((T=e==null?void 0:e.service)==null?void 0:T.name)??"",s=((S=e==null?void 0:e.contract)==null?void 0:S.registrationPlate)??"",m=(_=e==null?void 0:e.contract)!=null&&_.contractTemplate?`${((v=(L=e==null?void 0:e.contract)==null?void 0:L.contractTemplate)==null?void 0:v.name)??""}${i===ga?` (${s})`:""}`:"",{content:c,note:g}=za({createdFor:e.createdFor,serviceName:u,contractTemplateName:m,totalNumberUse:e.totalNumberUse,parentId:e.parentId,type:e.type,contentBill:e.content}),l=!!Ae.includes(e==null?void 0:e.type);let h="",p="";return l?p=e==null?void 0:e.code:h=e==null?void 0:e.code,{id:e.id,key:e.id,code:e.code,codeBill:h,codeVoucher:p,status:e.status,state:e.state,paymentState:e.paymentState,contractTemplate:{id:(C=(B=e==null?void 0:e.contract)==null?void 0:B.contractTemplate)==null?void 0:C.id,name:m},createdAt:e==null?void 0:e.createdAt,service:{id:(A=e==null?void 0:e.service)==null?void 0:A.id,name:u,code:i},total:o,netRevenue:r,usageTime:e.startDate&&e.endDate?`${P(e.startDate).format("DD/MM/YYYY")} - ${P(e.endDate).format("DD/MM/YYYY")}`:null,numberUsage:e.totalNumberUse?e.totalNumberUse:"",typeRow:"BILL",apartment:{id:((b=e==null?void 0:e.unit)==null?void 0:b.id)??"",name:((R=e==null?void 0:e.unit)==null?void 0:R.name)??"",type:n?aa(((Y=(D=(k=e==null?void 0:e.unit)==null?void 0:k.unitType)==null?void 0:D.id)==null?void 0:Y.replace(/_/g," "))??""):((d=(w=e==null?void 0:e.unit)==null?void 0:w.unitType)==null?void 0:d.name)??"",owner:((x=(M=(I=e==null?void 0:e.unit)==null?void 0:I.residents)==null?void 0:M[0])==null?void 0:x.fullName)??""},apartmentId:((E=e==null?void 0:e.unit)==null?void 0:E.id)??"",reasonForAdjustment:(e==null?void 0:e.reason)??"",content:c,billContent:(e==null?void 0:e.content)??"",note:g,parentId:e.parentId,originalBillId:e.originBillId,type:e.type,adjustmentCreatedFor:e.adjustmentCreatedFor,debtFor:e.createdFor,incurredCreatedFor:e.incurredCreatedFor,activityLog:{createdAt:e.createdAt,creator:e.creator,deletedAt:e.deletedAt,deleteBy:e.deleteBy,publicAt:e.publicAt,publicBy:e.publicBy,paidAt:e.paidAt,paidBy:e.paidBy},createType:(e==null?void 0:e.createType)??fa}},ne=async({filter:e,idBuilding:n,page:o,limit:r})=>{const{time:i,createdForType:u,billType:s,state:m,paymentState:c,code:g,unitName:l,unitType:h,serviceIds:p,createType:f,unitId:T,createdAt:S}=e,_=((i==null?void 0:i.length)??0)>0?P(i[0]).startOf("month").startOf("day").add(1,"day").toISOString():"",L=((i==null?void 0:i.length)??0)>0?P(i[1]).endOf("day").toISOString():"",v=((S==null?void 0:S.length)??0)>0?P(S[0]).startOf("day").toISOString():"",B=((S==null?void 0:S.length)??0)>0?P(S[1]).endOf("day").toISOString():"";try{const C=await Da({idBuilding:n,filterObject:{createdForType:u||void 0,billType:s||void 0,state:m||void 0,paymentStatus:c||void 0,code:g||void 0,unitName:l||void 0,unitType:h||void 0,serviceIds:p&&p.length>0?p:[],from:_||void 0,to:L||void 0,createdAtFrom:v||void 0,createdAtTo:B||void 0,createType:f||void 0,unitId:T||void 0},page:o,limit:r});return{code:C.code,codeLanguage:C.codeLanguage,data:C.data.map(A=>Je(A)),totalRecord:C.totalRecord}}catch(C){return{code:C.code,codeLanguage:C.codeLanguage,data:[],totalRecord:0}}},nn=async({filter:e,idBuilding:n})=>{const{time:o,createdForType:r,billType:i,state:u,paymentState:s,code:m,unitName:c,unitType:g,serviceIds:l,createType:h,unitId:p,createdAt:f}=e,T=((o==null?void 0:o.length)??0)>0?P(o[0]).startOf("month").startOf("day").add(1,"day").toISOString():"",S=((o==null?void 0:o.length)??0)>0?P(o[1]).endOf("day").toISOString():"",_=((f==null?void 0:f.length)??0)>0?P(f[0]).startOf("day").toISOString():"",L=((f==null?void 0:f.length)??0)>0?P(f[1]).endOf("day").toISOString():"";try{const v=await Ya({idBuilding:n,filterObject:{createdForType:r||void 0,billType:i||void 0,state:u||void 0,paymentStatus:s||void 0,code:m||void 0,unitName:c||void 0,unitType:g||void 0,serviceIds:l&&l.length>0?l:[],from:T||void 0,to:S||void 0,createdAtFrom:_||void 0,createdAtTo:L||void 0,createType:h||void 0,unitId:p||void 0}});return{code:v.code,codeLanguage:v.codeLanguage,data:v.data}}catch(v){return{code:v.code,codeLanguage:v.codeLanguage,data:0}}},$e=async(e,n)=>{const{time:o,createdForType:r,billType:i,state:u,paymentState:s,code:m,unitName:c,unitType:g,serviceIds:l,createType:h,unitId:p,createdAt:f}=n,T=((o==null?void 0:o.length)??0)>0?P(o[0]).startOf("month").startOf("day").add(1,"day").toISOString():"",S=((o==null?void 0:o.length)??0)>0?P(o[1]).endOf("day").toISOString():"",_=((f==null?void 0:f.length)??0)>0?P(f[0]).startOf("day").toISOString():"",L=((f==null?void 0:f.length)??0)>0?P(f[1]).endOf("day").toISOString():"";try{const v=await Na({idBuilding:e,filterObject:{createdForType:r||void 0,billType:i||void 0,state:u||void 0,paymentStatus:s||void 0,code:m||void 0,unitName:c||void 0,unitType:g||void 0,serviceIds:l&&l.length>0?l:[],from:T||void 0,to:S||void 0,createdAtFrom:_||void 0,createdAtTo:L||void 0,createType:h||void 0,unitId:p||void 0}});return{code:v.code,codeLanguage:v.codeLanguage,data:v.data}}catch(v){return{code:v.code,codeLanguage:v.codeLanguage,data:0}}},se=()=>{const{idBuilding:e}=ee(),{formFilter:n,setGetListBillStatus:o,setTableData:r,setTotalPaymentOfListBill:i,setFilterObject:u,setGetTotalPaymentStatus:s}=y.useContext(W);return{handleRefresh:async()=>{o({isFetching:!0}),s({isFetching:!0});let[l,h]=[[],0];const{data:p}=await nn({filter:{state:le},idBuilding:e});p>0?(n.setFieldsValue({...re,state:le}),u({...re,state:le}),[l,h]=await Promise.all([ne({filter:{...re,state:le},idBuilding:e,limit:z,page:J}),$e(e,{...re,state:le})])):(n.resetFields(),u({...re}),[l,h]=await Promise.all([ne({filter:{...re},idBuilding:e,limit:z,page:J}),$e(e,re)])),r({records:l.data,totalRecord:l.totalRecord}),i(h.data),s({isFetching:!1}),o({isFetching:!1})},handleReloadTable:async({filter:l,tablePagination:h})=>{o({isFetching:!0});const p=await ne({filter:{...l},idBuilding:e,limit:h.limit,page:h.current});r({records:p.data,totalRecord:p.totalRecord}),o({isFetching:!1})},handleReloadTotalPayment:async({filter:l})=>{s({isFetching:!0});const h=await $e(e,{...l});i(h.data),s({isFetching:!1})}}},on=async(e,n)=>{var r,i;const o=[{unitName:(r=n==null?void 0:n.apartment)==null?void 0:r.name,total:n==null?void 0:n.total,code:n==null?void 0:n.code,serviceName:(i=n==null?void 0:n.service)==null?void 0:i.name,note:n==null?void 0:n.note}];return Rt(e,o)},rn=()=>{const{idBuilding:e}=ee(),{getListBillStatus:n,totalPaymentOfListBill:o,showFormUpdateAdjust:r,tableData:i,tablePagination:u,filterObject:s,setTablePagination:m,onSelectRow:c,onSelectAllRowOfPage:g,tableSelection:l,billingPermissionWrite:h,billingPermissionDelete:p,editRowKey:f,setEditRowKey:T,showFormDeleteBill:S,resetDataTableSelection:_,showFormHistoryBill:L,billingPermissionUpdateInfo:v,getTotalPaymentStatus:B}=y.useContext(W),{handleReloadTable:C,handleReloadTotalPayment:A}=se(),{currentBuilding:b}=Pe(),{lockDataAt:R}=b,[k]=O.useForm(),[D,Y]=y.useState(!1),[w,d]=y.useState({code:void 0,codeLanguage:void 0});Be(w.code,w.codeLanguage,{message:t.success,description:t.update_data_success});const I=F=>{T(F.key),k.setFieldsValue({total:0,...F})},M=()=>{D||Y(!0)},x=()=>{D?ie.confirm({cancelText:t.cancel,okText:t.confirm,title:t.confirm,content:`${t.do_you_want_to_cancel_edit}?`,onOk:()=>{Y(!1),T("")}}):T("")},E=Xe(()=>{(async()=>{if(D){k.setFieldsValue({...Ze(k.getFieldsValue(),{})});const F=await k.validateFields(),me=k.getFieldValue();if(F)try{d({isFetching:!0,code:void 0,codeLanguage:void 0});const H=await on(e,me);d({isFetching:!1,code:H==null?void 0:H.code,codeLanguage:H==null?void 0:H.codeLanguage}),Ee.includes(H.code)&&(T(""),Y(!1),_(),C({filter:{...s},tablePagination:{...u}}),A({filter:{...s}}))}catch(H){d({code:H==null?void 0:H.code,codeLanguage:H==null?void 0:H.codeLanguage})}}})()},1e3),j=F=>{r({...F})},V=F=>{L({...F})},X=F=>{S({bill:F})},G=async(F,me)=>{let{current:H,limit:he}=u;F!==H&&(H=F),me!==he&&(he=me,H=J),m({limit:he,current:H}),await C({filter:{...s},tablePagination:{limit:he,current:H}})},oe=F=>!!(R&&(F!=null&&F.createdAt)&&P(F==null?void 0:F.createdAt).isBefore(R)),ce=F=>!(!h||F.originalBillId||!R||R&&(F!=null&&F.createdAt)&&P(F==null?void 0:F.createdAt).isBefore(R)||F.paymentState===pe||F.paymentState===fe||F.state===de||F.state===Oe||!Ae.includes(F.type)||Ae.includes(F.type)),Fe=F=>!(!p||R&&(F!=null&&F.createdAt)&&P(F==null?void 0:F.createdAt).isBefore(R)||F.parentId||F.originalBillId||F.paymentState===pe||F.paymentState===fe||F.state===de),Ie=F=>!(!v||R&&(F!=null&&F.createdAt)&&P(F==null?void 0:F.createdAt).isBefore(R)||F.paymentState===pe||F.paymentState===fe||F.state===de||F.state===Oe||Ae.includes(F.type)),Ce=F=>!(F.state!==le&&R&&(F!=null&&F.createdAt)&&P(F==null?void 0:F.createdAt).isBefore(R)||F.parentId||F.originalBillId||F.paymentState===pe||F.state===de),Re={pageSize:u.limit,defaultCurrent:J,current:u.current,total:i.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:G},{selectedRowKeys:Ye}=l,Ve=y.useMemo(()=>s.state!==de?{selectedRowKeys:Ye,onSelect:c,onSelectAll:g,fixed:!0,renderCell:(F,me,H,he)=>Ce(me)?he:null}:null,[s,Ye]);return{loading:n.isFetching,loadingTotalPayment:B.isFetching,totalPaymentOfListBill:o,isLockBill:oe,visibleBtnEditAdjustBill:ce,onClickBtnUpdateAdjustBill:j,dataSource:i.records,pagination:Re,rowSelection:Ve,onClickBtnDelete:X,visibleBtnDelete:Fe,filterObject:s,billingPermissionWrite:h,billingPermissionDelete:p,formEditRow:k,onClickBtnEdit:I,onValuesChange:M,onClickBtnCancel:x,onClickBtnSave:E,isEditedRow:D,editRowKey:f,onClickBtnHistoryBill:V,visibleBtnUpdateTotalPayment:Ie}},ct=({editing:e,dataIndex:n,title:o,inputType:r,record:i,index:u,children:s,...m})=>{const c=a(Qe,{size:"small",style:{textAlign:"right"},formatter:g=>xe(g),min:"0",defaultValue:0});return a("td",{...m,children:e?a(ge,{children:a(O.Item,{name:n,style:{margin:0},children:c})}):s})};ct.propTypes={editing:N.bool,dataIndex:N.string,title:N.string,inputType:N.string,record:N.objectOf(N.any),index:N.number,children:N.node};ct.defaultProps={editing:!1,dataIndex:"",title:"",inputType:"",record:void 0,index:0,children:a("div",{})};var sn={name:"s5xdrg",styles:"display:flex;align-items:center"};const cn=()=>{const e=be(),{layoutScrollRef:n}=y.useContext(et),{loading:o,loadingTotalPayment:r,totalPaymentOfListBill:i,isLockBill:u,visibleBtnEditAdjustBill:s,visibleBtnDelete:m,onClickBtnUpdateAdjustBill:c,dataSource:g,pagination:l,rowSelection:h,onClickBtnDelete:p,filterObject:f,billingPermissionWrite:T,formEditRow:S,onClickBtnEdit:_,onValuesChange:L,onClickBtnCancel:v,onClickBtnSave:B,isEditedRow:C,editRowKey:A,onClickBtnHistoryBill:b,visibleBtnUpdateTotalPayment:R}=rn(),k=tt(),D=[{title:t.unit,key:"unitName",fixed:"left",width:150,children:[{title:t.total,key:"unitName",fixed:"left",width:150,render:(w,d)=>q("div",{css:sn,children:[a("span",{css:ke({marginRight:e.margin.xs},"",""),children:d.apartment.name}),u(d)?a(Z,{name:"icon-lock-outlined"}):null]})}]},{title:t.bills,key:"code",width:200,children:[{title:"",key:"code",render:(w,d)=>{var M,x,E,j;let I=d.parentId?t.label.bill_debt:((M=ya[d.type])==null?void 0:M.name)??"";return d.type===_t&&(I=`${t.label.voucher} ${(x=t.label.adjust_up)==null?void 0:x.toLowerCase()} ${d.parentId?t.label.debt.toLowerCase():""}`),d.type===Bt&&(I=`${t.label.voucher} ${(E=t.label.adjust_down)==null?void 0:E.toLowerCase()} ${d.parentId?(j=t.label.debt)==null?void 0:j.toLowerCase():""}`),q("div",{children:[a($.Text,{css:ke({fontWeight:e.fontWeight.bold},"",""),children:d.code}),a("br",{}),a($.Text,{children:I})]})},width:200}]},{title:t.label.status1,key:"state",width:150,children:[{title:"",dataIndex:"state",key:"state",width:150,render:(w,d)=>{var I,M;return a(Ja,{color:((I=Ge[w])==null?void 0:I.color)??"default",children:((M=Ge[w])==null?void 0:M.name)??""})}}]},{title:t.label.service,key:"serviceName",width:200,children:[{title:"",key:"serviceName",render:(w,d)=>q("div",{children:[a($.Text,{css:ke({fontWeight:e.fontWeight.bold},"",""),children:d.service.name}),a("br",{}),q($.Text,{children:[t.label.month," ",P(d.debtFor,"YYYYMM").format("MM/YYYY")]})]}),width:200}]},{title:t.action_create,key:"createType",width:150,children:[{title:"",key:"createType",width:150,render:(w,d)=>{var I,M;return((M=(I=Ft)==null?void 0:I[d==null?void 0:d.createType])==null?void 0:M.name)??""}}]},{title:t.label.apartment_type,key:"unitType",width:150,children:[{title:"",key:"unitType",width:150,render:(w,d)=>d.apartment.type}]},{title:t.label.reason_for_adjustment,key:"reasonForAdjustment",width:150,children:[{title:"",dataIndex:"reasonForAdjustment",key:"reasonForAdjustment",width:150}]},{title:t.tariff,key:"contractTemplateName",width:150,children:[{title:"",key:"contractTemplateName",width:150,render:(w,d)=>d.contractTemplate.name}]},{title:t.label.consume,key:"numberUsage",width:100,children:[{title:"",dataIndex:"numberUsage",key:"numberUsage",width:100,render:(w,d)=>a($.Text,{children:w&&xe(w)})}]},{title:`${t.label.opening} - ${t.label.closing}`,key:"usageTime",width:200,children:[{title:"",dataIndex:"usageTime",key:"usageTime",width:200}]},{title:t.payment_status,key:"paymentState",width:200,children:[{title:"",dataIndex:"paymentState",key:"paymentState",width:200,render:(w,d)=>{var I;return a($.Text,{children:((I=va[w])==null?void 0:I.name)??""})}}]},{title:t.label.debt_month1,key:"createdFor",width:150,children:[{title:"",key:"createdFor",width:150,render:(w,d)=>a($.Text,{children:P(d.debtFor,"YYYYMM").format("MM/YYYY")})}]},{title:t.label.fee_notification_month,key:"feeNotificationMonth",width:150,children:[{title:"",dataIndex:"feeNotificationMonth",key:"feeNotificationMonth",width:150,render:(w,d)=>a($.Text,{children:P(d.incurredCreatedFor,"YYYYMM").format("MM/YYYY")})}]},{title:t.label.accrued_month,dataIndex:"incurredCreatedFor",key:"incurredCreatedFor",width:150,children:[{title:"",dataIndex:"incurredCreatedFor",key:"incurredCreatedFor",width:150,render:(w,d)=>a($.Text,{children:P(w,"YYYYMM").format("MM/YYYY")})}]},{title:t.label.created_at,key:"createdAt",width:150,children:[{title:"",dataIndex:"createdAt",key:"createdAt",width:150,render:(w,d)=>a($.Text,{children:P(d.activityLog.createdAt).format("DD/MM/YYYY HH:mm:ss")})}]},{title:t.note,key:"note",width:200,children:[{title:"",dataIndex:"note",key:"note",width:200,render:(w,d)=>{const I=d==null?void 0:d.billContent;return(I==null?void 0:I.length)>15?a(kt,{title:I,placement:"topLeft",children:a("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:I})}):a("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:I})}}]},{title:t.label.total,key:"total",align:"right",fixed:"right",width:150,editable:!0,children:[{title:r?a(It,{isLoading:!0}):xe(Math.round(i)),dataIndex:"total",key:"total",align:"right",editable:!0,render:(w,d)=>f.paymentState===at?a($.NegativeNumber,{children:d.netRevenue}):f.paymentState===Sa?a($.NegativeNumber,{children:d.total}):a($.NegativeNumber,{children:d.total-d.netRevenue}),fixed:"right",width:150}]},{title:t.actions,dataIndex:"actions",key:"actions",align:"center",fixed:"right",width:150,render:(w,d)=>q(ge,{children:[s(d)?a(Z,{title:t.update,css:ke({fontSize:e.iconSize,marginRight:e.margin.xs},"",""),name:"icon-edit-outlined",onClick:()=>{k({action:Ta,label:Se}),c(d)}}):null,d.key===A?q(ge,{children:[a(ve,{htmlType:"submit",type:"link",style:{marginRight:e.margin.xs,padding:0},disabled:!C,icon:a(Z,{title:t.save,style:{fontSize:e.iconSize},name:"icon-check-outlined"})}),a(Z,{title:t.delete,style:{marginRight:e.margin.xs,fontSize:e.iconSize},name:"icon-close-outlined",onClick:v})]}):q(ge,{children:[a(Z,{title:t.history,style:{fontSize:e.iconSize,marginRight:e.margin.xs},name:"icon-history-filled",onClick:()=>b(d)}),R(d)?a(Z,{title:t.update_total_payment,style:{fontSize:e.iconSize,marginRight:e.margin.xs},name:"icon-edit-outlined",onClick:()=>{_(d)},disabled:!!(A&&d.key!==A)}):null,m(d)?a(Z,{title:t.delete,css:ke({fontSize:e.iconSize},"",""),name:"icon-minus-circle-outlined",onClick:()=>{k({action:Ct,label:Se}),p(d)},disabled:!!(A&&d.key!==A)}):null]})]})}].filter(Boolean).map(w=>{var d;if(((d=w==null?void 0:w.children)==null?void 0:d.length)>0){const I=w.children[0];return I.editable?{...w,children:[{...I,onCell:M=>({record:M,inputType:"number",dataIndex:I.dataIndex,title:I.title,editing:M.key===A})}]}:w}return w.editable?{...w,onCell:I=>({record:I,inputType:"number",dataIndex:w.dataIndex,title:w.title,editing:I.key===A})}:w}),Y={offsetScroll:e.offsetScrollX,getContainer:()=>n.current};return a(O,{onFinish:B,onValuesChange:L,form:S,name:"formEditRow",children:a(Le,{components:{body:{cell:ct}},sticky:Y,columns:D,dataSource:g,loading:o,pagination:l,scroll:{x:D.reduce((w,d)=>w+d.width),scrollToFirstRowOnChange:!0},rowSelection:T?h:!1,bordered:!0})})},ln=()=>{const{billingPermissionExport:e,billingPermissionWrite:n,billingPermissionApprove:o,billingPermissionDelete:r,filterObject:i,tableSelection:u,showFormExport:s,showFormDelete:m,showFormAddAdjust:c,showProcessPublic:g,showBillUnpaidStatistic:l,showFormImportAdjust:h,selectAllRowComponent:p,showModalImportBill:f,billingPermissionUpdateInfo:T}=y.useContext(W),{currentBuilding:S}=Pe(),{lockDataAt:_}=S,{isSelectAllItem:L,selectedRowKeysCache:v,selectedRowsCache:B}=u,[C,A]=y.useState(!1),b=tt(),R=()=>{s()},k=()=>{const x=B.map(j=>j.id);let E=[];B.forEach(j=>{j&&(E.push(j),j.adjustBills&&j.adjustBills.length>0&&j.adjustBills.forEach(V=>{V&&E.push({...V,unit:j.unit})}))}),E=yt.uniqBy(E,"id"),m({billsSelected:E,ids:x,filterObject:i,isAll:L})},D=()=>{A(!0);const x=B.map(j=>j.id);let E=[];B.forEach(j=>{j&&E.push(j)}),E=yt.uniqBy(E,"id"),A(!1),g({billsSelected:E,ids:x})},Y=()=>{l()},w=()=>{f()},d=y.useMemo(()=>{const x=(B==null?void 0:B[0])||{};return!!(B.length===1&&(x.parentId||x.paymentState===pe||x.paymentState===fe||x.state===de||_&&P(x.createdAt).isBefore(_)))},[v.length]),I=y.useMemo(()=>!v.length,[v.length]),M={items:Wa,onClick:x=>{x.key===Xa&&(b({action:wa,label:Se}),c()),x.key===Qa&&h()}};return{isShowActionPublic:o&&i.state===le,isShowDeleteAction:r,isShowExportAction:e,isShowCreateAdjustmentAction:n&&_,isDisabledDeleteAction:I||d,isDisabledPublicAction:I,publicStatus:C,handleDelete:k,handleExport:R,handlePublic:D,handleShowBillUnpaidStatistic:Y,selectAllRowComponent:p,menuAction:M,handleImportBill:w,isShowImportBill:T}},dn=()=>{const{isShowActionPublic:e,isShowDeleteAction:n,isShowExportAction:o,isShowCreateAdjustmentAction:r,isDisabledDeleteAction:i,isDisabledPublicAction:u,publicStatus:s,handleDelete:m,handleExport:c,handlePublic:g,selectAllRowComponent:l,menuAction:h,handleImportBill:p,isShowImportBill:f}=ln(),T=tt(),S=[n?a(ve,{type:"primary",onClick:()=>{T({action:Ct,label:Se}),m()},icon:a(Z,{name:"icon-minus-circle-outlined"}),disabled:i,css:_=>({marginRight:_.margin.xs}),children:t.delete},"delete"):null,o?a(ve,{ghost:!0,type:"primary",onClick:()=>{T({action:_a,label:Se}),c()},icon:a(Z,{name:"icon-download-outlined"}),css:_=>({marginRight:_.margin.xs}),children:t.export},"export"):null,r?a(Ka,{menu:h,children:q(ve,{type:"primary",css:_=>({marginRight:_.margin.xs}),icon:a(Z,{name:"icon-assessment-outlined"}),children:[t.create_adjustment," ",a(Z,{name:"icon-arrow-down-outlined"})]},"create-adjustment")},"action"):null,f?a(ve,{type:"primary",icon:a(Z,{name:"icon-upload-outlined"}),css:_=>({marginRight:_.margin.xs}),onClick:()=>{T({action:Ba,label:Se}),p()},children:t.update_total_payment},"import"):null,e?a(ve,{type:"primary",icon:a(Z,{name:"icon-check-outlined"}),disabled:u,onClick:()=>{T({action:Fa,label:Se}),g()},loading:s,children:t.public},"public"):null].filter(Boolean);return a(ae.ActionBox,{actions:S,total:l()})},un=()=>{const[e,n]=y.useState(),{apartmentTypes:o}=na(),{formFilter:r,setFilterObject:i,setTablePagination:u,resetDataTableSelection:s,filterObject:m}=y.useContext(W),c=ee(),{idBuilding:g}=c,{services:l,getServices:h,loading:p}=je(),{handleRefresh:f,handleReloadTable:T,handleReloadTotalPayment:S}=se(),_=async C=>{i({...C}),u({limit:z,current:J}),s(),T({filter:C,tablePagination:{limit:z,current:J}}),S({filter:C})},L=async C=>{i({...C}),u({limit:z,current:J}),s(),await f()};y.useEffect(()=>{h({idBuilding:g})},[]);const v=C=>{n(C)},B=y.useMemo(()=>e===Ia?t.label.debt_month1:e===Ca?t.label.fee_notification_month:t.label.fee_notification_month,[e]);return{onMonthTypeChange:v,renderCreatedForTypeTitle:B,apartmentTypes:o,services:l,loadingService:p,onSearch:_,onRefresh:L,formFilter:r,filterObject:m}},mn=()=>{const{onMonthTypeChange:e,renderCreatedForTypeTitle:n,apartmentTypes:o,services:r,loadingService:i,onSearch:u,onRefresh:s,formFilter:m,filterObject:c}=un(),g=y.useMemo(()=>[{label:t.unit,key:"unitName",component:a(we,{placeholder:t.unit}),visible:!0},{label:t.month_type,key:"createdForType",component:a(U,{fluid:"true",placeholder:t.month_type,onChange:e,getPopupContainer:l=>l.parentNode,children:Aa.map(l=>a(U.Option,{value:l.id,children:l.name},l.id))}),visible:!0},{label:n,key:"time",component:a(Te.RangePicker,{picker:"month",format:[ue,ue],placeholder:[ue,ue],fluid:"true",getPopupContainer:l=>l.parentNode}),visible:!0},{label:t.label.created_at,key:"createdAt",component:a(Te.RangePicker,{fluid:"true",placeholder:[Ne,Ne],format:[Ne,Ne],getPopupContainer:l=>l.parentNode}),visible:!0},{label:`${t.label.type_of_invoice} / ${t.label.voucher}`,key:"billType",component:a(U,{fluid:"true",mode:"multiple",maxTagCount:1,showSearch:!1,placeholder:`${t.label.type_of_invoice} / ${t.label.voucher}`,getPopupContainer:l=>l.parentNode,children:xa.map(l=>a(U.Option,{value:l.id,children:l.name},l.id))}),visible:!0},{label:t.status1,key:"state",component:a(U,{fluid:"true",placeholder:t.status1,getPopupContainer:l=>l.parentNode,children:At.map(l=>a(U.Option,{value:l.id,children:l.name},l.id))}),visible:!0},{label:t.state,key:"paymentState",component:a(U,{fluid:"true",showSearch:!1,placeholder:t.state,getPopupContainer:l=>l.parentNode,children:Pa.map(l=>a(U.Option,{value:l.id,children:l.name},l.id))}),visible:!0},{label:t.code,key:"code",component:a(we,{placeholder:t.code}),visible:!0},{label:t.apartment_type,key:"unitType",component:q(U,{fluid:"true",placeholder:t.apartment_type,showSearch:!0,filterOption:(l,h)=>h.children.toLowerCase().indexOf(l.toLowerCase())>=0,getPopupContainer:l=>l.parentNode,children:[a(U.Option,{value:"",children:t.all_apartment_type},"apartment_type_0"),o.map(l=>a(U.Option,{value:l.id,children:l.name},l.id))]}),visible:!0},{label:t.service,key:"serviceIds",component:a(U,{fluid:"true",mode:"multiple",maxTagCount:1,placeholder:t.service,showSearch:!0,filterOption:(l,h)=>h.children.toLowerCase().indexOf(l.toLowerCase())>=0,getPopupContainer:l=>l.parentNode,disabled:i,loading:i,children:r.map(l=>a(U.Option,{value:l.id,children:`${l.name}${l.deletedAt&&` (${t.deleted})`||""}${l.status===xt&&` (${t.inactive})`||""}`},l.id))}),visible:!0},{label:t.action_create,key:"createType",component:a(U,{fluid:"true",mode:"multiple",maxTagCount:1,showSearch:!1,placeholder:t.action_create,getPopupContainer:l=>l.parentNode,children:La.map(l=>a(U.Option,{value:l.id,children:l.name},l.id))}),visible:!0}],[n,o,r,i]);return a(ae.FilterBox,{defaultFilter:{...c},onSearch:u,onRefresh:s,layout:"vertical",filters:g,formData:m})},Ke=e=>{let n=0,o=0;return e.length>0&&(e.forEach(r=>{Ae.includes(r.type)&&(o+=1)}),n=e.length-o),[n,o]},_e=(e,n)=>{if(n)return`${n} ${t.label.invoice1}`;const[o,r]=Ke(e),i=`${o} ${t.label.invoice1}`,u=`${r} ${t.label.voucher}`;return o>0&&r===0?i:r>0&&o===0?u:`${i} ${t.label.and} ${u}`};function lt(e){let n=[];const o=[{title:t.label.invoice1,key:"codeBill",dataIndex:"codeBill",width:100},{title:t.label.content,key:"content",dataIndex:"content",width:200},{title:t.label.apartment,key:"target",width:e==="normal"?100:50,render:(r,i)=>{var u;return((u=i==null?void 0:i.apartment)==null?void 0:u.name)??""}}];return e==="normal"&&(n=o),e==="success"&&(n=[...o,{title:t.label.status,key:"state",dataIndex:"state",width:100}]),e==="error"&&(n=[...o,{title:t.label.reason,key:"errorCode",dataIndex:"errorCode",width:200}]),n}function hn({isAll:e,dataCache:n,idBuilding:o,filterObject:r}){const[i,u]=y.useState(J),[s,m]=y.useState([]),[c,g]=y.useState([]),[l,h]=y.useState(!1);y.useEffect(()=>{(async()=>{if(e){h(!0);const S=await ne({filter:r,page:i,limit:z,idBuilding:o});S.data&&(m(S.data),g(S.totalRecord)),h(!1)}})()},[]);const p=async(S,_,L)=>{if(S.current!==i&&(u(S.current),e)){h(!0);const v=await ne({filter:r,page:S.current,limit:z,idBuilding:o});v.data&&(m(v.data),g(v.totalRecord)),h(!1)}},f=e?s:n,T={pageSize:z,defaultCurrent:1,current:i,total:e?c:f.length,showQuickJumper:!0};return{loadingTable:l,tablePagination:T,dataSource:f,totalDataTableItem:c,onTableChange:p}}function dt({isAll:e,dataCache:n,idBuilding:o,filterObject:r}){var g;const{loadingTable:i,tablePagination:u,dataSource:s,totalDataTableItem:m,onTableChange:c}=hn({dataCache:n,filterObject:r,idBuilding:o,isAll:e});return q(ge,{children:[a($.Text,{strong:!0,children:s.length>0&&`${(g=t.show_total_bill_cancel)==null?void 0:g.replace("{total}",e?_e(null,m):_e(s))}`}),a("br",{}),s.length>0&&a(Le,{bordered:!0,dataSource:s,columns:lt("normal"),onChange:c,loading:i,pagination:u})]})}dt.propTypes={dataCache:N.arrayOf(N.object),filterObject:N.shape({}),isAll:N.bool,idBuilding:N.string};dt.defaultProps={dataCache:[],filterObject:{},isAll:!1,idBuilding:""};function pn({dataCache:e}){const n=e.map(r=>({...r,state:t.success}));return{tablePagination:{pageSize:z,defaultCurrent:1,current:1,total:n.length,showQuickJumper:!0},dataSource:n}}function ut({dataCache:e}){var r;const{tablePagination:n,dataSource:o}=pn({dataCache:e});return q(ge,{children:[a($.Text,{strong:!0,style:{color:"#237804"},children:o.length>0&&`${(r=t.show_total_cancelled_bill)==null?void 0:r.replace("{total}",_e(o))}`}),a("br",{}),a(Le,{bordered:!0,dataSource:o,columns:lt("success"),pagination:n})]})}ut.propTypes={dataCache:N.oneOfType([N.shape({filter:N.func}),N.array])};ut.defaultProps={dataCache:[]};function gn({dataCache:e,errorBills:n}){const[o,r]=y.useState(1),i=n.map(c=>c.id)||[],u=e.filter(c=>!i.includes(c.id)),s=c=>{c.current!==o&&r(c.current)};return{tablePagination:{pageSize:z,defaultCurrent:1,current:o||1,total:u.length,showQuickJumper:!0},dataSource:u,onTableChange:s}}function mt({actionDone:e,dataCache:n,errorBills:o}){var s,m;const{tablePagination:r,dataSource:i,onTableChange:u}=gn({dataCache:n,errorBills:o});return q(ge,{children:[a($.Text,{strong:!0,style:{color:"#a8071a"},children:e&&i.length>0&&`${(s=t.show_total_cancelled_failure_bill)==null?void 0:s.replace("{total}",_e(i))}`}),a($.Text,{strong:!0,children:!e&&i.length>0&&`${(m=t.show_list_bills_fail)==null?void 0:m.replace("{total}",_e(i))}`}),a("br",{}),i.length>0&&a(Le,{bordered:!0,dataSource:i,columns:lt("error"),onChange:u,pagination:r})]})}mt.propTypes={actionDone:N.bool,dataCache:N.oneOfType([N.shape({filter:N.func}),N.array]),errorBills:N.oneOfType([N.shape({map:N.func}),N.array])};mt.defaultProps={actionDone:!1,dataCache:[],errorBills:[]};const We=e=>{const n=!!Ae.includes(e==null?void 0:e.type);let o="";return(e==null?void 0:e.code)===Ea&&(o=t.error.bill_cannot_cancel_different_month),(e==null?void 0:e.code)===Pt&&(o=t.error.data_is_locked),(e==null?void 0:e.code)===fe&&(e!=null&&e.parentId)&&(n?((e==null?void 0:e.type)===Bt&&(o=`${t.label.voucher_adjust_down} (${t.label.debt})`),(e==null?void 0:e.type)===_t&&(o=`${t.label.voucher_adjust_up} (${t.label.debt})`)):o=t.label.debt_bill),(e==null?void 0:e.code)===fe&&!(e!=null&&e.parentId)&&(n?o=t.error.voucher_partial_paid:o=t.error.bill_partial_paid),(e==null?void 0:e.code)===pe&&(n?o=t.error.voucher_paid:o=t.error.bill_paid),(e==null?void 0:e.code)===Lt&&(o=t.error.exists_adjust_bill_have_not_cancelled_yet),(e==null?void 0:e.code)===de&&(n?o=t.error.voucher_has_been_cancelled:o=t.error.bill_has_been_canceled),o||(o=Ra[e==null?void 0:e.code]),{...e,state:o?t.canceled:t.success,errorCode:o}},Ot=(e,n)=>{const[o,r]=Ke(e),[i,u]=Ke(n),s=o-i,m=r-u,c=`${s} ${t.label.invoice1}`,g=`${m} ${t.label.voucher}`;return s>0&&m===0?c:m>0&&s===0?g:`${c} ${t.label.and} ${g}`},jt=async({isAll:e,idBills:n,idBuilding:o,filter:r={time:[]},deleteBy:i,reason:u})=>{const{time:s,createdForType:m,billType:c,state:g,paymentState:l,code:h,unitName:p,unitType:f,serviceIds:T,createType:S,unitId:_}=r,L=((s==null?void 0:s.length)??0)>0?P(s[0]).startOf("month").startOf("day").add(1,"day").toISOString():"",v=((s==null?void 0:s.length)??0)>0?P(s[1]).endOf("day").toISOString():"";try{const B=await Oa({idBuilding:o,deleteBy:i,reason:u,idBills:e?[]:n,isAll:e,filterObject:e?{createdForType:m||void 0,billType:c||void 0,state:g||void 0,paymentStatus:l||void 0,code:h||void 0,unitName:p||void 0,unitType:f||void 0,serviceIds:T&&T.length>0?T:[],from:L||void 0,to:v||void 0,createType:S||void 0,unitId:_||void 0}:void 0});return{code:B.code,codeLanguage:B.codeLanguage,data:B.data.map(C=>We(C)),totalRecord:B.totalRecord}}catch(B){return{code:B.code,codeLanguage:B.codeLanguage,data:[],totalRecord:0}}},fn=()=>{const[e]=O.useForm(),{currentBuilding:n}=Pe(),{lockDataAt:o,id:r}=n,{hideFormDelete:i,tableSelection:u,filterObject:s,setFilterObject:m,resetDataTableSelection:c,tablePagination:g,formFilter:l}=y.useContext(W),{isSelectAllItem:h,selectedRowsCache:p,selectedRowKeysCache:f}=u,{currentEmployee:T}=De(),{handleReloadTable:S,handleReloadTotalPayment:_}=se(),[L,v]=y.useState([]),[B,C]=y.useState([]),[A,b]=y.useState(!1),[R,k]=y.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),[D,Y]=y.useState(!1);Be(R.code,R.codeLanguage,{message:t.success,description:t.delete_data_success});const w=async()=>{const x=e.getFieldsValue();try{k({code:void 0,codeLanguage:void 0,isFetching:!0});const E=await jt({isAll:h,idBills:f,idBuilding:r,filter:s,deleteBy:T.id,reason:x==null?void 0:x.reason}),j=(E==null?void 0:E.data)??[],V=j.filter(G=>G.code!==ft),X=j.filter(G=>G.code===ft);m({BILL_LIST_DEFAULT_FILTER:re,state:s.state}),v(V.map(G=>({...We({...Je({...G.bill}),code:G.code})}))),C(X.map(G=>({...Je(G.bill),code:G.code}))),b(!0),k({code:E.code,codeLanguage:E.codeLanguage,isFetching:!1})}catch(E){k({code:E.code,codeLanguage:E.codeLanguage,isFetching:!1})}},d=async()=>{A&&(c(),l.resetFields(),S({filter:{...s},tablePagination:{...g}}),_({filter:{...s}})),i()},I=(x,E)=>{if(!x)return null;if(E&&P(x.createdAt).isBefore(E))return{...x,code:Pt};if(x.parentId||x.paymentState===fe)return{...x,code:fe};if(x.paymentState===pe)return{...x,code:pe};if(x.state===de)return{...x,code:de};if(x.adjustBills&&x.adjustBills.length>0){const j=[];if(x.adjustBills.forEach(V=>{const X=I(V,E);X&&j.push(X)}),j.length>0)return{...x,adjustBillNotDeletes:j,code:Lt}}return null};y.useEffect(()=>{if(p.length>0&&!h){const x=[];for(let E=0;E<p.length;E+=1){const j=p[E],V=I(j,o);V&&x.push(We(V))}v(x)}},[p.length]);const M=x=>{Y(x.target.checked)};return{loading:R.isFetching,actionDone:A,handleDelete:w,handleCancelDelete:d,isSelectedAllBill:h,billsSelected:p,filterObject:s,errorBills:L,successBills:B,renderRemainTotalBillAndVoucher:Ot,confirmDeleteBill:D,onConfirmDelete:M,formConfirmDeleteBill:e}},yn=()=>{var T;const{idBuilding:e}=ee(),{loading:n,actionDone:o,handleDelete:r,handleCancelDelete:i,isSelectedAllBill:u,billsSelected:s,filterObject:m,errorBills:c,successBills:g,renderRemainTotalBillAndVoucher:l,confirmDeleteBill:h,onConfirmDelete:p,formConfirmDeleteBill:f}=fn();return a(ie,{title:t.label.cancel_bill_or_voucher,onOk:o?i:r,onCancel:i,confirmLoading:n,cancelLoading:n,okText:o?t.complete:t.confirm,cancelText:t.cancel,width:"70%",open:!0,okButtonProps:{disabled:!h},cancelButtonProps:{disabled:n||o},closable:!1,children:q(O,{initialValues:{reason:""},form:f,name:"formConfirmDeleteBill",layout:"vertical",children:[!o&&a(dt,{isAll:u,dataCache:s,idBuilding:e,filterObject:m}),a("br",{}),o&&a(ut,{dataCache:g}),a("br",{}),c.length>0&&a(mt,{actionDone:o,dataCache:c,idBuilding:e}),a("br",{}),!o&&c.length>0&&c.length!==s.length&&!u&&a(ze,{onChange:p,children:a($.Text,{strong:!0,underline:!0,css:S=>({color:S.color.primary}),children:(T=t.error.show_total_cancel_bill_remain)==null?void 0:T.replace("{total}",l(s,c))})}),a("br",{}),!o&&a(K,{span:"24",children:a(O.Item,{label:t.reason,name:"reason",children:a(we.TextArea,{maxLength:"255",fluid:"true",placeholder:t.reason,rows:"4"})})}),a("br",{}),!o&&c.length===0&&a(ze,{onChange:p,children:a($.Text,{strong:!0,underline:!0,css:S=>({color:S.color.primary}),children:t.are_you_sure_to_cancel_all_of_the_above_bills})})]})})},Ue=100,vn=()=>{const{idBuilding:e}=ee(),{hideFormExport:n,tableData:o,filterObject:r}=y.useContext(W),[i,u]=y.useState({isFetching:!1}),[s,m]=y.useState(0),c=async()=>{var S,_,L,v,B,C,A,b,R;u({isFetching:!0}),m(0);const l=[];let h=1;const p=o.totalRecord,f=Math.floor(p/Ue)+1;let T=0;for(await ja({idBuilding:e,filter:{...r}});h<=f;){const k=await ne({idBuilding:e,filter:{...r},page:h,limit:Ue});if(k.data.length>0){const D=l.length;for(let w=0;w<k.data.length;w+=1){const d=k.data[w],I=[D+w+1];let M=(d==null?void 0:d.total)??0;r.paymentState===at?M=(d==null?void 0:d.netRevenue)??0:r.paymentState===Et&&(M=(d==null?void 0:d.total)-(d==null?void 0:d.netRevenue)),I.push(((S=d==null?void 0:d.apartment)==null?void 0:S.name)??""),I.push((d==null?void 0:d.code)??""),I.push(((_=d==null?void 0:d.service)==null?void 0:_.name)??""),I.push(((v=(L=Ft)==null?void 0:L[d==null?void 0:d.createType])==null?void 0:v.name)??""),I.push(((B=d==null?void 0:d.apartment)==null?void 0:B.type)??""),I.push((d==null?void 0:d.reasonForAdjustment)??""),I.push(((C=d==null?void 0:d.contractTemplate)==null?void 0:C.name)??""),I.push((d==null?void 0:d.numberUsage)??""),I.push((d==null?void 0:d.usageTime)??""),I.push(((A=At.find(x=>d.state===x.id))==null?void 0:A.name)??""),I.push(((b=ka.find(x=>d.paymentState===x.id))==null?void 0:b.name)??""),I.push(d!=null&&d.debtFor?P(d.debtFor,"YYYYMM").format("MM/YYYY"):""),I.push(d!=null&&d.incurredCreatedFor?P(d.incurredCreatedFor,"YYYYMM").format("MM/YYYY"):""),I.push(d!=null&&d.incurredCreatedFor?P(d.incurredCreatedFor,"YYYYMM").format("MM/YYYY"):""),I.push((R=d==null?void 0:d.activityLog)!=null&&R.createdAt?P(d.activityLog.createdAt).format("DD/MM/YYYY HH:mm"):""),I.push(M),I.push((d==null?void 0:d.billContent)??""),l.push(I)}h+=1;const Y=Ue/p*100;T+=Y,m(Math.round(T))}else break}l.unshift(["#","Căn hộ","Phí dịch vụ","Dịch vụ","Hình thức tạo phí","Loại căn hộ","Lý do điều chỉnh","Biểu phí","Tiêu thụ","Đầu kỳ - Cuối kỳ","Trạng thái","Tình trạng thanh toán","Tháng nợ","Tháng thông báo phí","Tháng phát sinh","Ngày tạo","Tổng cộng","Ghi chú"]),st(l,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8","thong-tin-phi-dich-vu",".xlsx"),u({isFetching:!1}),nt.success({message:t.success,description:t.export_data_success}),n()};y.useEffect(()=>{c()},[]);const g=()=>n();return[i.isFetching,s,g]},Sn=()=>{const[e,n]=vn();return a(ie,{open:!0,okText:t.export,cancelText:t.cancel,okButtonProps:{loading:e,disabled:e},footer:null,closable:!1,children:a(ot,{strokeColor:{from:"#108ee9",to:"#87d068"},percent:n,status:"active"})})},Tn=async(e,n)=>{const{adjustmentType:o,apartment:r,service:i,adjustmentFor:u,incurredCreatedFor:s,totalPayment:m,reason:c,creator:g}=n,l={type:o||void 0,reason:c||void 0,serviceId:i||void 0,totalPayment:m||void 0,adjustmentCreatedFor:u?P(u).format("YYYYMM"):void 0,incurredCreatedFor:s?P(s).format("YYYYMM"):void 0,unitId:r||void 0,billingId:g||void 0,employeeId:g||void 0};try{const h=await Ma(e,l);return{code:h.code,codeLanguage:h.codeLanguage}}catch(h){return{code:h.code,codeLanguage:h.codeLanguage}}},wn=()=>{const{idBuilding:e}=ee(),{currentBuilding:n}=Pe(),{lockDataAt:o}=n,{currentEmployee:r}=De(),{hideFormAddAdjust:i,filterObject:u,tablePagination:s}=y.useContext(W),{handleReloadTable:m,handleReloadTotalPayment:c}=se(),[g,l]=y.useState({isFetching:!1,records:[]}),[h]=O.useForm(),{getServiceInUses:p,serviceInUses:f,loading:T}=je(),[S,_]=y.useState({isFetching:!1,code:void 0,codeLanguage:void 0});Be(S.code,S.codeLanguage,{message:t.success,description:t.add_data_success});const L=async A=>{l({...g,isFetching:!0});const{data:b}=await Dt({idBuilding:e,filter:{name:A}});l({records:b,isFetching:!1})},v=async()=>{if(h.setFieldsValue({...Ze(h.getFieldsValue(),{})}),await h.validateFields()){_({isFetching:!0,code:void 0,codeLanguage:void 0});const{code:b,codeLanguage:R}=await Tn(e,{...h.getFieldsValue(),creator:r.id});Ee.includes(b)&&(i(),m({filter:{...u},tablePagination:{...s}}),c({filter:{...u}})),_({isFetching:!1,code:b,codeLanguage:R})}},B=()=>i();y.useEffect(()=>{(async()=>await Promise.all([L(""),p({idBuilding:e})]))()},[]);const C={adjustmentType:void 0,apartment:void 0,service:void 0,adjustmentFor:void 0,incurredCreatedFor:P(),totalPayment:void 0,reason:void 0};return{loadingCreateAdjustment:S.isFetching,lockDataAt:o,loadingApartment:g.isFetching,loadingService:T,initialValues:C,listApartment:g.records,listService:f,formAddAdjustment:h,handleSearchApartment:L,handleAddAdjustment:v,handleCancelAddAdjustment:B}},_n=()=>{const{loadingCreateAdjustment:e,lockDataAt:n,formAddAdjustment:o,handleAddAdjustment:r,handleCancelAddAdjustment:i,handleSearchApartment:u,initialValues:s,listApartment:m,listService:c,loadingApartment:g,loadingService:l}=wn(),h=be();return a(ie,{title:t.add_adjustment,onOk:r,onCancel:i,okText:t.add,cancelText:t.cancel,open:!0,okButtonProps:{disabled:e,loading:e},children:a(O,{layout:"vertical",initialValues:s,form:o,name:"formAddAdjustment",children:q(rt,{gutter:[h.margin.xs,0],children:[a(K,{span:"12",children:a(O.Item,{rules:[{required:!0}],name:"apartment",label:t.unit,children:a(U,{loading:g,showSearch:!0,onSearch:Xe(u),fluid:!0,placeholder:t.unit,filterOption:!1,dropdownRender:p=>g?a("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:a(bt,{})}):p,children:m.map(({id:p,name:f})=>a(U.Option,{value:p,children:f},p))})})}),a(K,{span:"12",children:a(O.Item,{rules:[{required:!0}],name:"service",label:t.service,children:a(U,{loading:l,fluid:!0,placeholder:t.service,children:c.map(({id:p,name:f})=>a(U.Option,{value:p,children:f},p))})})}),a(K,{span:"12",children:a(O.Item,{rules:[{required:!0}],name:"adjustmentType",label:t.adjustment_type,children:a(U,{fluid:!0,placeholder:t.adjustment_type,children:it.map(({label:p,value:f})=>a(U.Option,{value:f,children:p},f))})})}),a(K,{span:"12",children:a(O.Item,{name:"totalPayment",label:`${t.total_money} (VNĐ)`,required:!0,rules:[{required:!0,type:"integer",max:Number.MAX_SAFE_INTEGER,min:1}],children:a(Qe,{formatter:p=>xe(p),placeholder:t.total_money})})}),a(K,{span:"12",children:a(O.Item,{rules:[{required:!0}],name:"adjustmentFor",label:t.adjustment_for,children:a(Te,{disabledDate:p=>P(p).isAfter(P(n)),picker:"month",fluid:!0,format:"MM/YYYY",placeholder:"MM/YYYY"})})}),a(K,{span:"12",children:a(O.Item,{noStyle:!0,shouldUpdate:(p,f)=>p.adjustmentFor!==f.adjustmentFor,children:({getFieldValue:p})=>a(O.Item,{rules:[{required:!0}],name:"incurredCreatedFor",label:t.incurred_created_for,children:a(Te,{picker:"month",fluid:!0,format:"MM/YYYY",placeholder:"MM/YYYY",disabledDate:f=>P(f).isBefore(P(p("adjustmentFor"),"MM/YYYY"))})})})}),a(K,{span:"24",children:a(O.Item,{rules:[{required:!0}],name:"reason",label:t.reason,children:a(we.TextArea,{maxLength:"255",placeholder:t.reason})})})]})})})},Bn=async(e,n,o)=>{const{adjustmentType:r,apartment:i,service:u,adjustmentFor:s,incurredCreatedFor:m,totalPayment:c,reason:g,creator:l}=o,h={type:r||void 0,reason:g||void 0,serviceId:u||void 0,totalPayment:c||void 0,adjustmentCreatedFor:s?P(s).format("YYYYMM"):void 0,incurredCreatedFor:m?P(m).format("YYYYMM"):void 0,unitId:i||void 0,billingId:l||void 0};try{const p=await Va(e,n,h);return{code:p.code,codeLanguage:p.codeLanguage}}catch(p){return{code:p.code,codeLanguage:p.codeLanguage}}},Fn=()=>{const{idBuilding:e}=ee(),{currentBuilding:n}=Pe(),{lockDataAt:o}=n,{currentEmployee:r}=De(),{hideFormUpdateAdjust:i,formUpdateAdjust:u,filterObject:s,tablePagination:m}=y.useContext(W),{handleReloadTable:c,handleReloadTotalPayment:g}=se(),{data:l}=u,[h,p]=y.useState({isFetching:!1,records:[]}),[f]=O.useForm(),{getServiceInUses:T,serviceInUses:S,loading:_}=je(),[L,v]=y.useState(!1),[B,C]=y.useState({isFetching:!1,code:void 0,codeLanguage:void 0});Be(B.code,B.codeLanguage,{message:t.success,description:t.update_data_success});const A=async k=>{p({...h,isFetching:!0});const{data:D}=await Dt({idBuilding:e,filter:{name:k}});p({records:D,isFetching:!1})},b=async()=>{if(f.setFieldsValue({...Ze(f.getFieldsValue(),{})}),await f.validateFields()){C({isFetching:!0,code:void 0,codeLanguage:void 0});const{code:D,codeLanguage:Y}=await Bn(e,l.id,{...f.getFieldsValue(),creator:r.id});Ee.includes(D)&&(c({filter:{...s},tablePagination:{...m}}),g({filter:{...s}})),C({isFetching:!1,code:D,codeLanguage:Y}),i()}},R=()=>i();return y.useEffect(()=>{(async()=>(v(!0),await Promise.all([A(""),T({idBuilding:e})]),f.setFieldsValue({adjustmentType:l.type,apartment:l.apartment.id,service:l.service.id,adjustmentFor:P(l.adjustmentCreatedFor,"YYYYMM"),incurredCreatedFor:P(l.incurredCreatedFor,"YYYYMM"),totalPayment:l.total<0?l.total*-1:l.total,reason:l.reasonForAdjustment}),v(!1)))()},[]),{loading:L,lockDataAt:o,loadingApartment:h.isFetching,loadingService:_,listApartment:h.records,listService:S,formUpdateAdjustment:f,handleSearchApartment:A,handleUpdateAdjustment:b,handleCancelUpdateAdjustment:R}},In=()=>{const{loading:e,lockDataAt:n,formUpdateAdjustment:o,handleUpdateAdjustment:r,handleCancelUpdateAdjustment:i,handleSearchApartment:u,listApartment:s,listService:m,loadingApartment:c,loadingService:g}=Fn(),l=be();return q(ie,{title:t.update_adjustment,onOk:r,onCancel:i,okText:t.update,cancelText:t.cancel,open:!0,children:[e?a(It,{isLoading:!0}):null,a(O,{layout:"vertical",form:o,name:"formUpdateAdjustment",children:q(rt,{gutter:[l.margin.xs,0],children:[a(K,{span:"12",children:a(O.Item,{rules:[{required:!0}],name:"apartment",label:t.unit,children:a(U,{loading:c,showSearch:!0,onSearch:Xe(u),fluid:!0,placeholder:t.unit,filterOption:!1,dropdownRender:h=>c?a("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:a(bt,{})}):h,children:s.map(({id:h,name:p})=>a(U.Option,{value:h,children:p},h))})})}),a(K,{span:"12",children:a(O.Item,{rules:[{required:!0}],name:"service",label:t.service,children:a(U,{loading:g,fluid:!0,placeholder:t.service,children:m.map(({id:h,name:p})=>a(U.Option,{value:h,children:p},h))})})}),a(K,{span:"12",children:a(O.Item,{rules:[{required:!0}],name:"adjustmentType",label:t.adjustment_type,children:a(U,{fluid:!0,placeholder:t.adjustment_type,children:it.map(({label:h,value:p})=>a(U.Option,{value:p,children:h},p))})})}),a(K,{span:"12",children:a(O.Item,{name:"totalPayment",label:`${t.total_money} (VNĐ)`,required:!0,rules:[{required:!0,type:"integer",max:Number.MAX_SAFE_INTEGER,min:1}],children:a(Qe,{formatter:h=>xe(h),placeholder:t.total_money})})}),a(K,{span:"12",children:a(O.Item,{rules:[{required:!0}],name:"adjustmentFor",label:t.adjustment_for,children:a(Te,{disabledDate:h=>P(h).isAfter(P(n)),picker:"month",fluid:!0,format:"MM/YYYY",placeholder:"MM/YYYY"})})}),a(K,{span:"12",children:a(O.Item,{noStyle:!0,shouldUpdate:(h,p)=>h.adjustmentFor!==p.adjustmentFor,children:({getFieldValue:h})=>a(O.Item,{rules:[{required:!0}],name:"incurredCreatedFor",label:t.incurred_created_for,children:a(Te,{picker:"month",fluid:!0,format:"MM/YYYY",placeholder:"MM/YYYY",disabledDate:p=>P(p).isBefore(P(h("adjustmentFor"),"MM/YYYY"))})})})}),a(K,{span:"24",children:a(O.Item,{rules:[{required:!0}],name:"reason",label:t.reason,children:a(we.TextArea,{maxLength:"255",placeholder:t.reason})})})]})})]})};function Cn({isAll:e,dataCache:n,idBuilding:o,filterObject:r}){const[i,u]=y.useState(J),[s,m]=y.useState([]),[c,g]=y.useState([]),[l,h]=y.useState(!1);y.useEffect(()=>{(async()=>{if(e){h(!0);const S=await ne({filter:r,page:i,limit:z,idBuilding:o});S.data&&(m(S.data),g(S.totalRecord)),h(!1)}})()},[]);const p=async(S,_,L)=>{if(S.current!==i&&(u(S.current),e)){h(!0);const v=await ne({filter:r,page:S.current,limit:z,idBuilding:o});v.data&&(m(v.data),g(v.totalRecord)),h(!1)}},f=e?s:n,T={pageSize:z,defaultCurrent:1,current:i,total:e?c:f.length,showQuickJumper:!0};return{loadingTable:l,tablePagination:T,dataSource:f,totalDataTableItem:c,onTableChange:p}}function ht({isAll:e,dataCache:n,idBuilding:o,filterObject:r}){var l;const{loadingTable:i,tablePagination:u,dataSource:s,totalDataTableItem:m,onTableChange:c}=Cn({dataCache:n,filterObject:r,idBuilding:o,isAll:e}),g=[{title:t.label.invoice1,key:"codeBill",dataIndex:"codeBill",width:100},{title:t.label.content,key:"content",dataIndex:"content",width:200},{title:t.label.apartment,key:"target",width:100,render:(h,p)=>{var f;return((f=p==null?void 0:p.apartment)==null?void 0:f.name)??""}}];return q(ge,{children:[a($.Text,{strong:!0,children:s.length>0&&`${(l=t.show_total_bill_public)==null?void 0:l.replace("{total}",e?_e(null,m):_e(s))}`}),a("br",{}),s.length>0&&a(Le,{bordered:!0,dataSource:s,columns:g,onChange:c,loading:i,pagination:u})]})}ht.propTypes={dataCache:N.arrayOf(N.object),filterObject:N.shape({}),isAll:N.bool,idBuilding:N.string};ht.defaultProps={dataCache:[],filterObject:{},isAll:!1,idBuilding:""};const St=async(e,n)=>{try{const{code:o,codeLanguage:r}=await $a(e,n);return{code:o,codeLanguage:r}}catch({code:o,codeLanguage:r}){return{code:o,codeLanguage:r}}},qe=20,An=()=>{const{hideProcessPublic:e,tableSelection:n,filterObject:o,tableData:r,resetDataTableSelection:i}=y.useContext(W),{isSelectAllItem:u,selectedRowsCache:s}=n,[m,c]=y.useState(!1),[g,l]=y.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),[h,p]=y.useState(0),{handleRefresh:f}=se(),[T,S]=y.useState(!1),{idBuilding:_}=ee(),{totalRecord:L}=r,v=async()=>{var A,b,R,k,D;if(l({isFetching:!0}),u||(s==null?void 0:s.length)>=200){let Y=1;const w=Math.ceil(L/qe),d={},I=w*2;let M=0;for(;Y<=w;){const V=await ne({filter:{...o},idBuilding:_,limit:qe,page:Y});((A=V==null?void 0:V.data)==null?void 0:A.length)>0&&((b=V==null?void 0:V.data)==null||b.forEach(G=>{var ce;const oe=(ce=G==null?void 0:G.apartment)==null?void 0:ce.id;d[oe]||(d[oe]=[]),d[oe].push(G)})),M+=1;const X=Math.floor(M*100/I);p(X),Y+=1}const x=(R=Object.keys(d))!=null&&R.length?Object.keys(d).map(V=>{var X,G,oe,ce,Fe,Ie,Ce;return{unitId:V,name:(oe=(G=(X=d==null?void 0:d[V])==null?void 0:X[0])==null?void 0:G.unit)==null?void 0:oe.name,bills:(ce=d==null?void 0:d[V])==null?void 0:ce.map(Re=>Re.id),floorName:(Ce=(Ie=(Fe=d==null?void 0:d[V])==null?void 0:Fe[0])==null?void 0:Ie.unit)==null?void 0:Ce.floorName}}):[];let E=[],j=0;for(let V=0;V<(x==null?void 0:x.length);V+=1){if(E.push({id:(k=x[V])==null?void 0:k.unitId,billIds:((D=x[V])==null?void 0:D.bills)||[]}),E.length===qe||V===x.length-1){j+=E.length,await St(_,[...E]),E=[];const X=Math.floor(j*100/x.length);p(X)}p(100)}}else{const Y={};s.forEach(d=>{const{apartmentId:I}=d;Y[I]=Y[I]??[],Y[I].push(d==null?void 0:d.id)});const w=Object.keys(Y);for(let d=0;d<w.length;d+=1){const I=w[d],M={id:I,billIds:Y[I]};await St(_,[M]),p(Math.ceil((d+1)/w.length*100))}}c(!0),nt.success({message:t.public_invoice_success}),await f(),e(),l({isFetching:!1}),p(100),i()},B=()=>{g.isFetching||e()},C=A=>{S(A.target.checked)};return{loading:g.isFetching,actionDone:m,handlePublic:v,handleCancelPublic:B,isSelectedAllBill:u,billsSelected:s,filterObject:o,renderRemainTotalBillAndVoucher:Ot,percent:h,confirmPublicBill:T,onConfirmPublic:C}},xn=()=>{const{idBuilding:e}=ee(),{loading:n,actionDone:o,handlePublic:r,handleCancelPublic:i,isSelectedAllBill:u,billsSelected:s,filterObject:m,percent:c,confirmPublicBill:g,onConfirmPublic:l}=An();return q(ie,{title:t.public_notice_fee,onOk:r,onCancel:i,confirmLoading:n,okText:t.confirm,cancelText:t.cancel,width:"70%",open:!0,okButtonProps:{disabled:!g||o},cancelButtonProps:{disabled:o},closable:!1,children:[q("div",{style:{height:"500px",overflowY:"scroll"},children:[c?a(ot,{strokeColor:{from:"#108ee9",to:"#87d068"},percent:c,status:"active",css:h=>({marginTop:h.margin.xs,marginBottom:h.margin.xs})}):null,a(ht,{isAll:u,dataCache:s,idBuilding:e,filterObject:m}),a("br",{})]}),a(ze,{onChange:l,children:a($.Text,{strong:!0,underline:!0,css:h=>({color:h.color.primary}),children:t.are_you_sure_you_want_to_issue_all_of_the_above_bills})})]})},Me={unitName:"",serviceIds:[]},ye=y.createContext({idBuilding:0,getListBillUnpaidStatus:{isFetching:!1},setGetListBillUnpaidStatus:()=>{},filter:{...Me},setFilter:()=>{},tableData:{records:[],totalRecord:0,totalRow:{}},setTableData:()=>{},tablePagination:{current:J,limit:z},setTablePagination:()=>{},hideBillUnpaidStatistic:()=>{},formExport:void 0,showFormExport:()=>{},hideFormExport:()=>{},formPreviewFee:void 0,showFormPreviewFee:()=>{},hideFormPreviewFee:()=>{}}),pt=({children:e})=>{const{hideBillUnpaidStatistic:n}=y.useContext(W),{idBuilding:o}=ee(),[r,i]=y.useState({isFetching:!1}),[u,s]=y.useState({...Me}),[m,c]=y.useState({records:[],totalRecord:0,totalRow:{}}),[g,l]=y.useState({current:J,limit:z}),[h,p,f]=te(),[T,S,_]=te(),L={idBuilding:o,getListBillUnpaidStatus:r,setGetListBillUnpaidStatus:i,filter:u,setFilter:s,tableData:m,setTableData:c,tablePagination:g,setTablePagination:l,hideBillUnpaidStatistic:n,formExport:h,showFormExport:p,hideFormExport:f,formPreviewFee:T,showFormPreviewFee:S,hideFormPreviewFee:_};return a(ye.Provider,{value:L,children:e})};pt.propTypes={children:N.node};pt.defaultProps={children:a("div",{})};const Mt=({name:e,totalBalance:n,totalDraft:o,totalDebt:r,totalMustPay:i,totalPaid:u,id:s})=>({id:s||"total",key:s||"total",apartment:e||t.total,totalBalance:Number(n||0),totalExpectedReceivable:Number(o||0),totalDebt:Number(r||0)-Number(u||0),totalMustPay:i||0}),Vt=async({filter:e,idBuilding:n,page:o,limit:r})=>{const{unitName:i,serviceIds:u}=e;try{const s=await Ua({idBuilding:n,filter:{unitName:i||void 0,serviceIds:u&&u.length>0?u:[]},page:o,limit:r});return{code:s.code,codeLanguage:s.codeLanguage,data:s.data.map(m=>Mt(m)),totalRecord:s.totalRecord}}catch(s){return{code:s.code,codeLanguage:s.codeLanguage,data:[],totalRecord:0}}},$t=async({filter:e,idBuilding:n})=>{const{unitName:o,serviceIds:r}=e;try{const i=await qa({idBuilding:n,filter:{unitName:o||void 0,serviceIds:r&&r.length>0?r:[]}});return{code:i.code,codeLanguage:i.codeLanguage,data:Mt(i.data),totalRecord:i.totalRecord}}catch(i){return{code:i.code,codeLanguage:i.codeLanguage,data:[],totalRecord:0}}},He=20,Pn=()=>{const{idBuilding:e}=ee(),{hideFormExport:n,tableData:o,filter:r}=y.useContext(ye),[i,u]=y.useState({isFetching:!1}),[s,m]=y.useState(0),c=async()=>{u({isFetching:!0}),m(0);const g=[];let l=1;const h=o.totalRecord,p=Math.floor(h/He)+1;let f=0;const{data:T}=await $t({filter:r,idBuilding:e});if(T&&Object.keys(T).length){const S=["",t.total,Number((T==null?void 0:T.totalDebt)||0),Number((T==null?void 0:T.totalExpectedReceivable)||0),Number((T==null?void 0:T.totalBalance)||0),Number((T==null?void 0:T.totalMustPay)||0)];g.push(S)}for(;l<=p;){const S=await Vt({idBuilding:e,filter:{...r},page:l,limit:He});if(S.data.length>0){const _=g.length-1;for(let v=0;v<S.data.length;v+=1){const B=S.data[v],C=[_+v+1];C.push((B==null?void 0:B.apartment)??""),C.push((B==null?void 0:B.totalDebt)??0),C.push((B==null?void 0:B.totalExpectedReceivable)??0),C.push((B==null?void 0:B.totalBalance)??0),C.push((B==null?void 0:B.totalMustPay)??0),g.push(C)}l+=1;const L=He/h*100;f+=L,m(Math.round(f))}else break}g.unshift(["#",t.unit,t.debt,t.expected_receivable,t.apartment_account,t.total]),st(g,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8","xem-truoc-thong-bao-phi",".xlsx"),u({isFetching:!1}),nt.success({message:t.success,description:t.export_data_success}),n()};return y.useEffect(()=>{c()},[]),[i.isFetching,s]},Ln=()=>{const[e,n]=Pn();return a(ie,{open:!0,okText:t.export,cancelText:t.cancel,okButtonProps:{loading:e,disabled:e},footer:null,closable:!1,children:a(ot,{strokeColor:{from:"#108ee9",to:"#87d068"},percent:n,status:"active"})})},gt=()=>{const{idBuilding:e,setTablePagination:n,setTableData:o,setGetListBillUnpaidStatus:r,tableData:i}=y.useContext(ye);return{changeDataTable:async({filter:s,pagination:m,isChangeTotalRow:c})=>{const{current:g,limit:l}=m;r({isFetching:!0,code:void 0,codeLanguage:void 0}),n({current:g,limit:l});const{data:h,totalRecord:p}=await Vt({filter:s,idBuilding:e,page:g,limit:l}),f={...i,records:h,totalRecord:p};if(c){const{data:T}=await $t({filter:s,idBuilding:e});T&&Object.keys(T).length&&(f.totalRow=T)}o(f),r({isFetching:!1,code:void 0,codeLanguage:void 0})}}},En=()=>{const{setFilter:e}=y.useContext(ye),{changeDataTable:n}=gt(),o=ee(),{idBuilding:r}=o,{services:i,getServices:u,loading:s}=je(),m=async c=>{e(c),await n({filter:{...c},pagination:{current:J,limit:z},isChangeTotalRow:!0})};return y.useEffect(()=>{u({idBuilding:r})},[]),{services:i,loadingService:s,onSearch:m}},Rn=()=>{const{services:e,loadingService:n,onSearch:o}=En(),r=y.useMemo(()=>[{label:t.unit,key:"unitName",component:a(we,{placeholder:t.unit}),visible:!0},{label:t.service,key:"serviceIds",component:a(U,{fluid:"true",mode:"multiple",maxTagCount:1,placeholder:t.service,showSearch:!0,filterOption:(i,u)=>u.children.toLowerCase().indexOf(i.toLowerCase())>=0,disabled:n,loading:n,children:e.map(i=>a(U.Option,{value:i.id,children:`${i.name}${i.deletedAt&&` (${t.deleted})`||""}${i.status===xt&&` (${t.inactive})`||""}`},i.id))}),visible:!0}],[e,n]);return a(oa,{defaultFilter:{...Me},onSearch:o,layout:"vertical",visibleFilterBox:!0,filters:r})},kn=()=>{const{tableData:e,showFormExport:n}=y.useContext(ye),o=()=>{n()};return[e.totalRecord,o]},bn=()=>{const[e,n]=kn(),o=[a(ve,{ghost:!0,type:"primary",onClick:()=>n(),icon:a(Z,{name:"icon-download-outlined"}),css:r=>({marginRight:r.margin.xs}),children:t.export},"export")];return a(ae.ActionBox,{actions:o,total:e})},Dn=()=>{const{getListBillUnpaidStatus:e,tablePagination:n,tableData:o,filter:r,showFormPreviewFee:i}=y.useContext(ye),{layoutScrollRef:u}=y.useContext(et),s=be(),{changeDataTable:m}=gt(),c=async(p,f)=>{n.current!==p?await m({filter:{...r},pagination:{current:p,limit:n.limit},isChangeTotalRow:!1}):n.limit!==f&&await m({filter:{...r},pagination:{current:n.current,limit:f},isChangeTotalRow:!1})},g=p=>{i({...p})},l={pageSize:n.limit,defaultCurrent:J,current:n.current,total:o.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:c};return{sticky:{offsetScroll:s.offsetScrollX,getContainer:()=>u.current},dataSource:o.records,pagination:l,loading:e.isFetching,totalRow:o.totalRow,onClickBtnPreview:g}},Yn=()=>{const{sticky:e,dataSource:n,pagination:o,loading:r,totalRow:i,onClickBtnPreview:u}=Dn(),s=[{title:t.unit,key:"apartment",width:120,fixed:"left",children:[{title:t.total,key:"total",dataIndex:"apartment",width:150}]},{title:t.debt,key:"totalDebt",width:150,align:"right",children:[{title:a($.NegativeNumber,{children:(i==null?void 0:i.totalDebt)??0}),key:"totalDebt",dataIndex:"totalDebt",width:150,align:"right",render:c=>a($.NegativeNumber,{children:c})}]},{title:t.expected_receivable,key:"totalExpectedReceivable",width:150,align:"right",children:[{title:a($.NegativeNumber,{children:(i==null?void 0:i.totalExpectedReceivable)??0}),key:"totalExpectedReceivable",dataIndex:"totalExpectedReceivable",width:150,align:"right",render:c=>a($.NegativeNumber,{children:c})}]},{title:t.apartment_account,key:"totalBalance",width:150,align:"right",children:[{title:a($.NegativeNumber,{children:(i==null?void 0:i.totalBalance)??0}),key:"totalBalance",dataIndex:"totalBalance",width:150,align:"right",render:c=>a($.NegativeNumber,{children:c})}]},{title:t.total,key:"totalMustPay",width:150,align:"right",children:[{title:a($.NegativeNumber,{children:(i==null?void 0:i.totalMustPay)??0}),key:"totalMustPay",dataIndex:"totalMustPay",width:150,align:"right",render:c=>a($.NegativeNumber,{children:c})}]},{title:t.action,key:"action",dataIndex:"action",width:100,align:"center",fixed:"right",render:(c,g)=>a(Z,{onClick:()=>u(g),name:"icon-eye-outlined",css:l=>({fontSize:l.iconSize}),title:t.label.preview})}],m={x:s.reduce((c,g)=>g+c.width,0),scrollToFirstRowOnChange:!0};return a(ae.Table,{sticky:e,scroll:m,columns:s,dataSource:n,loading:r,pagination:o})},Tt=async({billIds:e,idBuilding:n,incurredCreatedFor:o,unitId:r})=>{try{const i=P(o).startOf("month").format("YYYYMM"),u=await tn({bills:e,idBuilding:n,incurredCreatedFor:i,unitId:r});return{code:u.code,codeLanguage:u.codeLanguage,data:u.data}}catch({code:i,codeLanguage:u}){return{code:i,codeLanguage:u,data:void 0}}},Nn=()=>{const{idBuilding:e}=ee(),[n]=O.useForm(),{hideFormPreviewFee:o,formPreviewFee:r,filter:i}=y.useContext(ye),[u,s]=y.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[m,c]=y.useState();Be(u.code,u.codeLanguage),y.useEffect(()=>{(async()=>{var T,S,_;s({isFetching:!0,code:void 0,codeLanguage:void 0});const h=await ne({filter:{unitId:(T=r==null?void 0:r.data)==null?void 0:T.id,state:[Oe,le],serviceIds:i.serviceIds||[]},idBuilding:e,page:J,limit:100}),p=((S=h==null?void 0:h.data)==null?void 0:S.map(({id:L})=>L))??[],f=await Tt({billIds:p,unitId:(_=r==null?void 0:r.data)==null?void 0:_.id,idBuilding:e,incurredCreatedFor:P()});c(f.data),s({isFetching:!1,code:f.code,codeLanguage:f.codeLanguage})})()},[]);const g=async h=>{var S,_,L;s({isFetching:!0,code:void 0,codeLanguage:void 0});const p=await ne({filter:{unitId:(S=r==null?void 0:r.data)==null?void 0:S.id,state:[Oe,le],serviceIds:i.serviceIds||[]},idBuilding:e,page:J,limit:100}),f=((_=p==null?void 0:p.data)==null?void 0:_.map(({id:v})=>v))??[],T=await Tt({billIds:f,unitId:(L=r==null?void 0:r.data)==null?void 0:L.id,idBuilding:e,incurredCreatedFor:h});c(T.data),s({isFetching:!1,code:T.code,codeLanguage:T.codeLanguage})},l=()=>{o()};return{loadingPreview:u.isFetching,form:n,previewData:m,onChangeFeeNoticePeriod:g,handleCancelProcessPreview:l}},On=()=>{const{loadingPreview:e,form:n,previewData:o,onChangeFeeNoticePeriod:r,handleCancelProcessPreview:i}=Nn(),u=y.useMemo(()=>a(O,{form:n,name:"form_print_bill",layout:"vertical",initialValues:{feeNoticePeriod:P()},children:a(O.Item,{label:t.label.fee_notification_period,name:"feeNoticePeriod",children:a(Te,{fluid:"true",picker:"month",allowClear:!1,format:"MM/YYYY",onChange:r})})}),[]);return a(en,{visible:!0,title:t.invoice,onCancel:i,isLoadingPreview:e,beforePreview:u,html:o||"<div />",footer:!1})},jn=()=>{const{hideBillUnpaidStatistic:e,formExport:n,formPreviewFee:o}=y.useContext(ye),{changeDataTable:r}=gt();return y.useEffect(()=>{(async()=>await r({filter:{...Me},pagination:{current:J,limit:z},isChangeTotalRow:!0}))()},[]),{hideBillUnpaidStatistic:e,isShowFormExport:n.isShow,isShowFormPreviewFee:o.isShow}},Mn=()=>{const{hideBillUnpaidStatistic:e,isShowFormExport:n,isShowFormPreviewFee:o}=jn();return q(ie,{title:t.preview_invoice,open:!0,onCancel:e,footer:null,width:"75%",children:[a(Rn,{}),q(ae.Container,{children:[a(ae.Header,{children:a(bn,{})}),a(ae.Content,{children:a(Yn,{})})]}),n&&a(Ln,{}),o&&a(On,{})]})},Vn=()=>a(pt,{children:a(Mn,{})}),$n=(e,n)=>{var i,u;const o=n==null?void 0:n[e==null?void 0:e.index],r={errorDescription:(i=e==null?void 0:e.errorDescription)!=null&&i.length?e==null?void 0:e.errorDescription:void 0,...o};if((u=r==null?void 0:r.errorDescription)!=null&&u.length)return r},Un=async({idBuilding:e,listData:n,employeeId:o})=>{var r;try{const i={},u=n==null?void 0:n.map(c=>(i[c==null?void 0:c.index]=c,{index:c==null?void 0:c.index,unitName:(c==null?void 0:c.unitName)||void 0,serviceName:(c==null?void 0:c.serviceName)||void 0,type:(c==null?void 0:c.type)||void 0,totalPayment:(c==null?void 0:c.totalPayment)||void 0,adjustmentCreatedFor:c!=null&&c.adjustmentCreatedFor?P(c==null?void 0:c.adjustmentCreatedFor,ue).format("YYYYMM"):void 0,incurredCreatedFor:c!=null&&c.incurredCreatedFor?P(c==null?void 0:c.incurredCreatedFor,ue).format("YYYYMM"):void 0,reason:(c==null?void 0:c.reason)||void 0,employeeId:o||void 0})),s=await Ha({idBuilding:e,listData:u}),m=[];return(r=s==null?void 0:s.data)==null||r.forEach(c=>{const g=$n(c,i);g!=null&&g.errorDescription&&m.push(g)}),{code:s==null?void 0:s.code,codeLanguage:s==null?void 0:s.codeLanguage,data:m}}catch(i){return{code:i==null?void 0:i.code,codeLanguage:i==null?void 0:i.codeLanguage,data:[]}}},qn=100,Hn=()=>{const{hideFormImportAdjust:e,idBuilding:n,filterObject:o,tablePagination:r}=y.useContext(W),{handleReloadTable:i,handleReloadTotalPayment:u}=se(),{currentBuilding:s}=Pe(),{currentEmployee:m}=De(),{lockDataAt:c}=s,g=[{name:"#",key:"index",rules:{type:"number",required:!0},isRequiredColumn:!0},{name:t.unit,key:"unitName",rules:{type:"string",required:!0},isRequiredColumn:!0},{name:t.service,key:"serviceName",rules:{type:"string",required:!0},isRequiredColumn:!0},{name:t.adjustment_type,key:"type",rules:{type:"enum",required:!0,enum:it.map(S=>S.label)},isRequiredColumn:!0},{name:t.total_money,key:"totalPayment",rules:{type:"number",required:!0,max:Number.MAX_SAFE_INTEGER,min:1},isRequiredColumn:!0},{name:t.adjustment_for,key:"adjustmentCreatedFor",rules:{type:"string",validator(S,_,L,v,B){if(_==null||_==="")return new Error(t.status.data_require);const C=new RegExp(vt);return _&&!C.test(_)?new Error(`${t.status.date_invalid} (${t.label.valid}: DD/MM/YYYY)`):P(_,ue).isAfter(P(c))?new Error(t.adjustment_month_must_higher_or_equal_than_lock_data_month.replace("{month}",P(c).format("MM/YYYY"))):!0}},isRequiredColumn:!0},{name:t.incurred_created_for,key:"incurredCreatedFor",rules:{type:"string",validator(S,_,L,v,B){if(_==null||_==="")return new Error(t.status.data_require);const C=new RegExp(vt);return _&&!C.test(_)?new Error(`${t.status.date_invalid} (${t.label.valid}: DD/MM/YYYY)`):P(_,ue).isBefore(P(v[t.adjustment_for],ue))?new Error(t.adjustment_month_must_lower_or_equal_than_incurred_created_month):!0}},isRequiredColumn:!0},{name:t.reason,key:"reason",rules:{type:"string",required:!0,max:255},isRequiredColumn:!0}],[l,h]=y.useState(0),[p,f]=y.useState({isFetching:!1,code:void 0,codeLanguage:void 0,totalSuccess:0,totalFailed:0,errors:[],data:[]});return{headers:g,handleCloseImportAdjustment:e,percentImportAdjustment:l,importAdjustmentStatus:p,handleImportAdjustment:async S=>{var A;f({isFetching:!0,code:void 0,codeLanguage:void 0,totalSuccess:0,totalFailed:0,errors:[]});let _=[],L=0;const v={code:500,codeLanguage:null,errors:[]};for(let b=0;b<(S==null?void 0:S.length);b+=1)if(_.push(S[b]),_.length===qn||b===(S==null?void 0:S.length)-1){L+=_==null?void 0:_.length;const{code:R,codeLanguage:k,data:D}=await Un({idBuilding:n,listData:_,employeeId:m.id});v.code=R,v.codeLanguage=k,v.errors=[...v.errors,...D],_=[],h(Math.floor(L*100/(S==null?void 0:S.length)))}h(0);const B=(A=v==null?void 0:v.errors)==null?void 0:A.length,C=L-B;Ee.includes(v.code)&&(i({filter:{...o},tablePagination:{...r}}),u({filter:{...o}})),f({isFetching:!1,code:v==null?void 0:v.code,codeLanguage:v==null?void 0:v.codeLanguage,totalFailed:B,totalSuccess:C,errors:v==null?void 0:v.errors})}}},Gn=()=>{const{headers:e,handleCloseImportAdjustment:n,percentImportAdjustment:o,importAdjustmentStatus:r,handleImportAdjustment:i}=Hn();return a(Yt,{headers:e,onClose:n,onOk:i,visible:!0,fileNameTemplate:t.create_adjustment_template,code:r.code,codeLanguage:r.codeLanguage,loading:r.isFetching,numberSuccess:(r==null?void 0:r.totalSuccess)??0,numberFail:(r==null?void 0:r.totalFailed)??0,problemResponseServerDataSource:(r==null?void 0:r.errors)??[],percentImport:o})},zn=(e,n)=>{var i,u;const o=n==null?void 0:n[e==null?void 0:e.index],r={errorDescription:(i=e==null?void 0:e.errorDescription)!=null&&i.length?e==null?void 0:e.errorDescription:void 0,...o};if((u=r==null?void 0:r.errorDescription)!=null&&u.length)return r},Jn=async(e,n)=>{var o;try{const r={},i=n==null?void 0:n.map(m=>(r[m==null?void 0:m.index]=m,{...m,code:(m==null?void 0:m.code)||void 0,note:(m==null?void 0:m.note)||void 0})),u=await Rt(e,i),s=[];return(o=u==null?void 0:u.data)==null||o.forEach(m=>{const c=zn(m,r);c!=null&&c.errorDescription&&s.push(c)}),{code:u==null?void 0:u.code,codeLanguage:u==null?void 0:u.codeLanguage,data:s}}catch(r){return{code:r==null?void 0:r.code,codeLanguage:r==null?void 0:r.codeLanguage,data:[]}}},Kn=50,wt=100,Wn=[{name:"#",key:"index",rules:{type:"number",required:!0},isRequiredColumn:!0},{name:t.apartment,key:"unitName",rules:{type:"string",required:!0,max:50},isRequiredColumn:!0},{name:t.bills,key:"code",rules:{type:"string",required:!0,max:50},isRequiredColumn:!0},{name:t.service,key:"serviceName",rules:{type:"string",required:!0},isRequiredColumn:!0},{name:t.total,key:"total",rules:{type:"number",required:!0},isRequiredColumn:!0},{name:t.note,key:"note",rules:{type:"string",max:3e3},isRequiredColumn:!0}],Xn=()=>{const{hideModalImportBill:e,idBuilding:n,formFilter:o,resetDataTableSelection:r,filterObject:i,tablePagination:u,tableData:s}=y.useContext(W),{handleReloadTable:m,handleReloadTotalPayment:c}=se(),[g,l]=y.useState(!1),[h,p]=y.useState(0),[f,T]=y.useState({isFetching:!1,code:void 0,codeLanguage:void 0,totalSuccess:0,totalFailed:0,errors:[],data:[]});return Be(f.code,f.codeLanguage,{message:t.success,description:t.import_data_success}),[Wn,f,async v=>{var k;T({isFetching:!0,code:void 0,codeLanguage:void 0,totalSuccess:0,totalFailed:0,errors:[]});let B=[],C=0;const A={code:500,codeLanguage:null,errors:[]};for(let D=0;D<(v==null?void 0:v.length);D+=1)if(B.push(v[D]),B.length===Kn||D===(v==null?void 0:v.length)-1){C+=B==null?void 0:B.length;const{code:Y,codeLanguage:w,data:d}=await Jn(n,B);A.code=Y,A.codeLanguage=w,A.errors=[...A.errors,...d],B=[],p(Math.floor(C*100/(v==null?void 0:v.length)))}p(0);const b=(k=A==null?void 0:A.errors)==null?void 0:k.length,R=C-b;Ee.includes(A.code)&&(o.resetFields(),r(),m({filter:{...i},tablePagination:{...u}}),c({filter:{...i}})),T({isFetching:!1,code:A==null?void 0:A.code,codeLanguage:A==null?void 0:A.codeLanguage,totalFailed:b,totalSuccess:R,errors:A==null?void 0:A.errors})},()=>e(),h,async()=>{var b,R;const v=[];let B=1;const C=s.totalRecord,A=Math.floor(C/wt)+1;for(l(!0);B<=A;){const k=await ne({idBuilding:n,filter:{...i},page:B,limit:wt});if(k.data.length>0){const D=v.length;for(let Y=0;Y<k.data.length;Y+=1){const w=k.data[Y],d=[D+Y+1];let I=(w==null?void 0:w.total)??0;i.paymentState===at?I=(w==null?void 0:w.netRevenue)??0:i.paymentState===Et&&(I=(w==null?void 0:w.total)-(w==null?void 0:w.netRevenue)),d.push(((b=w==null?void 0:w.apartment)==null?void 0:b.name)??""),d.push((w==null?void 0:w.code)??""),d.push(((R=w==null?void 0:w.service)==null?void 0:R.name)??""),d.push(I),d.push(w.note),v.push(d)}B+=1}else break}l(!1),v.unshift(["#",t.apartment,t.bills,t.services,t.total,t.note]),st(v,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8",t.bill_info_template,".xlsx")},g]},Qn=()=>{const[e,n,o,r,i,u,s]=Xn();return a(Yt,{headers:e,onClose:r,onOk:o,visible:!0,fileNameTemplate:t.bill_info_template,code:n.code,codeLanguage:n.codeLanguage,loading:n.isFetching,numberSuccess:(n==null?void 0:n.totalSuccess)??0,numberFail:(n==null?void 0:n.totalFailed)??0,problemResponseServerDataSource:(n==null?void 0:n.errors)??[],percentImport:i,onDownloadTemplateFile:u,loadingTemplateFile:s})},Zn=()=>{const{currentEmployee:e}=De(),{formDeleteBill:n,hideFormDeleteBill:o,resetDataTableSelection:r,idBuilding:i,filterObject:u,tablePagination:s}=y.useContext(W),{handleReloadTable:m,handleReloadTotalPayment:c}=se(),[g]=O.useForm(),[l,h]=y.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[p,f]=y.useState(3),[T,S]=y.useState(!0);return y.useEffect(()=>{p>0?(setTimeout(()=>f(p-1),1e3),S(!0)):(f(""),S(!1))},[p]),Be(l.code,l.codeLanguage,{message:t.success,description:t.delete_data_success}),[o,g,async()=>{var B,C;const L=g.getFieldsValue(),v=(C=(B=n==null?void 0:n.data)==null?void 0:B.bill)==null?void 0:C.id;if(L){h({isFetching:!0,code:void 0,codeLanguage:void 0});const{code:A,codeLanguage:b}=await jt({isAll:!1,idBills:[v],idBuilding:i,deleteBy:e.id,reason:L.reason});h({isFetching:!1,code:A,codeLanguage:b}),Ee.includes(A)&&(r(),o(),m({filter:{...u},tablePagination:{...s}}),c({filter:{...u}}))}},p,T,l.isFetching]},eo=()=>{const[e,n,o,r,i,u]=Zn(),s=be();return a(ie,{okButtonProps:{disabled:i,loading:u},okText:r>0?`(${r}) ${t.accept}`:`${t.accept}`,open:!0,title:t.delete_bill,onCancel:e,onOk:o,width:"35%",children:a(O,{form:n,layout:"vertical",name:"formDeleteSingleBill",children:q(rt,{gutter:[s.margin.md,s.margin.md],children:[a(K,{span:"24",children:a($.Text,{children:t.do_you_want_to_delete_one_bill})}),a(K,{span:"24",children:a(O.Item,{label:t.reason,name:"reason",children:a(we.TextArea,{maxLength:"255",fluid:"true",placeholder:t.reason,rows:"3"})})})]})})})},to=(e,n,o)=>{var i,u,s,m,c,g,l;return{...e,id:(e==null?void 0:e.id)??"",userFullName:(e==null?void 0:e.userFullName)??"",action:e!=null&&e.action?(i=Za[e==null?void 0:e.action])==null?void 0:i.name:"",createdAt:e!=null&&e.createdAt?(u=P(e==null?void 0:e.createdAt))==null?void 0:u.format(ra):"",reason:(e==null?void 0:e.reason)??"",status:(s=e==null?void 0:e.dataLogs)!=null&&s.state?(c=Ge[(m=e==null?void 0:e.dataLogs)==null?void 0:m.state])==null?void 0:c.name:"",total:(g=e==null?void 0:e.dataLogs)!=null&&g.totalPayment?xe((l=e==null?void 0:e.dataLogs)==null?void 0:l.totalPayment):0,isChangeTotalPayment:o[n]?"red":"black"}},ao=async({idBuilding:e,idBill:n})=>{try{const{code:o,data:r,codeLanguage:i}=await Ga({idBuilding:e,idBill:n}),u=[!1];return r.forEach((s,m,c)=>{var g,l,h,p;if(m>0){const f=(l=(g=c[m])==null?void 0:g.dataLogs)==null?void 0:l.totalPayment,T=(p=(h=c[m-1])==null?void 0:h.dataLogs)==null?void 0:p.totalPayment,S=f!==T;u.push(S)}}),{code:o,codeLanguage:i,data:r==null?void 0:r.map((s,m)=>to(s,m,u))}}catch({code:o,codeLanguage:r}){return{code:o,codeLanguage:r,data:[]}}},no=()=>{var l;const{formHistoryBill:e,hideFormHistoryBill:n,idBuilding:o,dataHistories:r,setDataHistories:i}=y.useContext(W),u=(l=e==null?void 0:e.data)==null?void 0:l.id,[s,m]=y.useState({code:void 0,codeLanguage:void 0,isFetching:!1});y.useEffect(()=>{(async()=>{m({code:void 0,codeLanguage:void 0,isFetching:!0});const h=await ao({idBuilding:o,idBill:u});i((h==null?void 0:h.data)??[]),m({code:h.code,codeLanguage:h.codeLanguage,isFetching:!1})})()},[]);const c=()=>{n(),i([])},g={scrollToFirstRowOnChange:!0};return{dataSource:r,totalRecord:r.length,hideFormHistoryBill:n,loading:s.isFetching,scroll:g,onCancelHistoryBill:c}},oo=()=>{const{dataSource:e,loading:n,totalRecord:o,scroll:r,onCancelHistoryBill:i}=no(),u=[{title:t.the_operator,key:"userFullName",dataIndex:"userFullName",width:200,align:"left",fixed:"left"},{title:t.action_bill,key:"action",dataIndex:"action",width:80,align:"left"},{title:t.time,key:"createdAt",dataIndex:"createdAt",width:130,align:"left"},{title:t.reason,key:"reason",dataIndex:"reason",width:250,align:"center",render:(s,m)=>{const c=s;return(c==null?void 0:c.length)>10?a(kt,{title:c,placement:"topLeft",children:a("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:c})}):a("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:c})}},{title:t.status1,key:"status",dataIndex:"status",width:150,align:"center"},{title:t.total_money,key:"total",dataIndex:"total",width:120,align:"center",fixed:"right",render:(s,m)=>a($.Text,{style:{color:m==null?void 0:m.isChangeTotalPayment},children:m==null?void 0:m.total})}];return q(ie,{title:t.history_bill,footer:null,open:!0,onCancel:i,width:"75%",children:[a(ae.ActionBox,{total:o}),a(Le,{loading:n,columns:u,pagination:!1,dataSource:e,bordered:!0,scroll:{...r,x:u.reduce((s,m)=>s+ +((m==null?void 0:m.width)??0),0)}})]})},ro=()=>{const{setTitlePage:e,setVisibleFilterBox:n,setVisibleSearchBox:o}=y.useContext(et),{formAddAdjust:r,formUpdateAdjust:i,formHistoryBill:u,formDelete:s,formExport:m,processPublic:c,billUnpaidStatistic:g,modalImportBill:l,formDeleteBill:h,formImportAdjust:p}=y.useContext(W),{handleRefresh:f}=se();return y.useEffect(()=>(e(t.bill_list),o(!0),f(),()=>{e(""),n(!1),o(!1)}),[]),[r.isShow,i.isShow,s.isShow,m.isShow,p.isShow,c.isShow,g.isShow,l.isShow,h.isShow,u.isShow]},io=()=>{const[e,n,o,r,i,u,s,m,c,g]=ro();return q(ae.Wrapper,{children:[a(mn,{}),q(ae.Container,{children:[a(ae.Header,{children:a(dn,{})}),a(ae.Content,{children:a(cn,{})})]}),o&&a(yn,{}),e&&a(_n,{}),n&&a(In,{}),r&&a(Sn,{}),u&&a(xn,{}),s&&a(Vn,{}),i&&a(Gn,{}),m&&a(Qn,{}),c&&a(eo,{}),g?a(oo,{}):null]})},Zr=()=>a(an,{children:a(io,{})});export{Zr as default};
