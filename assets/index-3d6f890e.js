import{j as a,F as J,u as W,a as U}from"./@emotion-63839449.js";import{P as N,l as S,N as _,D as $,O as Z,a as j}from"./index-b17d22e5.js";import{a9 as I,s as O,el as K,b0 as ee,K as te,aw as ie,X as ae,l as r,a3 as oe,I as b,dq as re,a5 as X,bG as ne,a as H,em as se,en as me,eo as de,S as ce}from"./index-c2ded735.js";import"./lodash-88fe09e6.js";import{h as g}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import{r as T}from"./react-4fd50329.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{F as R,u as Y}from"./index-687ba9e6.js";import{d as ue}from"./downloadFileFromUrl-79614833.js";import{P as le}from"./prop-types-1172f4d5.js";import{A as w,a as pe,b as q}from"./formula-46f71781.js";import{u as ge,d as he,a as Te}from"./react-router-a4308f7b.js";import{e as ye,u as xe}from"./amenities-1e1bae0f.js";import{B as z,I as Ae,T as Fe,w as fe,R as Se,b as ve}from"./antd-f9eae174.js";import{L as Pe}from"./react-router-dom-2a8f5f6d.js";import{u as _e}from"./useQuery-d54d310a.js";import{I as C}from"./index-43183512.js";import{c as ke}from"./compareObject-7b349d22.js";import{c as Ne}from"./amenityBooking-f01c56ae.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./account-86ffff50.js";import"./index-881eef42.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./classnames-4ba1ba1a.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./convertNumberToDateTime-e1623b31.js";const k=T.createContext({idBuilding:0,tablePagination:{current:I,limit:O},setTablePagination:()=>{},filter:{...w},setFilter:()=>{},formFilter:void 0,status:K,setStatus:()=>{},formUpdateData:{isShow:!1,data:{}},showFormUpdate:()=>{},hideFormUpdate:()=>{},amenityBookingPermissionExport:!1,amenityBookingPermissionApprove:!1,getsStatus:{isFetching:!1},setGetsStatus:()=>{},tableData:{records:[],totalRecord:0},setTableData:()=>{}}),L=({children:t})=>{const{getPermissionByModuleCode:e}=ee(),{idBuilding:m}=ge(),[n]=R.useForm(),[s,u]=T.useState({...w}),[l,o]=T.useState({current:I,limit:O}),[d,c]=T.useState(K),[i,p]=T.useState({isFetching:!1}),[f,v]=T.useState({records:[],totalRecord:0}),[P,F,x]=te(),y=e(ie),A=y.export??!1,h=y.approve??!1,E={idBuilding:m,filter:s,setFilter:u,formUpdateData:P,showFormUpdate:F,hideFormUpdate:x,tableData:f,setTableData:v,tablePagination:l,setTablePagination:o,formFilter:n,status:d,setStatus:c,amenityBookingPermissionExport:A,amenityBookingPermissionApprove:h,getsStatus:i,setGetsStatus:p};return a(k.Provider,{value:E,children:t})};L.propTypes={children:le.node};L.defaultProps={children:a("div",{})};const Ie=L,Ee=async({idBuilding:t,filter:e})=>{var m,n,s,u;try{const l={[ae]:t},o={from:(m=e==null?void 0:e.orderTime)!=null&&m.length?g(e.orderTime[0]).startOf("days").toISOString():void 0,to:(n=e==null?void 0:e.orderTime)!=null&&n.length?g(e.orderTime[1]).endOf("days").toISOString():void 0,dateUsageFrom:(s=e==null?void 0:e.usageTime)!=null&&s.length?g(e.usageTime[0]).toISOString():void 0,dateUsageTo:(u=e==null?void 0:e.usageTime)!=null&&u.length?g(e.usageTime[1]).toISOString():void 0,status:e.status!==pe?e.status:void 0,code:e.code||void 0,name:e.name||void 0,groupName:e.groupName||void 0,unitName:e.unitName||void 0},{code:d,codeLanguage:c,data:i}=await ye({params:o,headers:l});return{code:d,codeLanguage:c,data:i}}catch({code:l,codeLanguage:o}){return{code:l,codeLanguage:o,data:void 0}}},Oe=()=>{const{tableData:t,filter:e,amenityBookingPermissionExport:m,amenityBookingPermissionApprove:n,status:s,idBuilding:u}=T.useContext(k),l=he(),[o,d]=T.useState({isFetching:!1,code:void 0,codeLanguage:void 0});Y(o.code,o.codeLanguage,{message:r.success,description:r.export_data_success});const c=async()=>{d({isFetching:!0,code:void 0,codeLanguage:void 0});const p=await Ee({idBuilding:u,filter:{...e,status:s}});p.data&&ue(p.data,document,"Danh-sach-don-dat-tien-ich.xlsx"),d({isFetching:!1,code:p.code,codeLanguage:p.codeLanguage})},i=()=>{l.push(`/buildings/${u}/amenities-orders/booking`)};return{totalRecord:t.totalRecord,amenityBookingPermissionExport:m,amenityBookingPermissionApprove:n,handleExportListAmenitiesOrder:c,handleBookingAmenitiesOrder:i,loadingExport:o.isFetching}},Ce=()=>{const{totalRecord:t,amenityBookingPermissionExport:e,handleExportListAmenitiesOrder:m,handleBookingAmenitiesOrder:n,loadingExport:s,amenityBookingPermissionApprove:u}=Oe(),l=oe(),o=[e?a(z,{type:"primary",ghost:!0,loading:s,icon:a(b,{name:"icon-download-outlined"}),onClick:()=>{l({action:re,label:X}),m()},css:d=>({marginRight:d.margin.xs}),children:r.export},"export"):null,u?a(z,{type:"primary",loading:s,icon:a(b,{name:"icon-library-add-check-outlined"}),onClick:()=>{l({action:ne,label:X}),n()},children:r.order_amenity},"booking"):null].filter(Boolean);return a(N.ActionBox,{total:a(J,{children:t}),actions:o})},B=()=>{const{getAllQuery:t,setQuery:e}=_e(),{setTablePagination:m,setStatus:n,setFilter:s,formFilter:u}=T.useContext(k);return{getQueryParamsAmenitiesOrder:()=>{var M,V,G,Q;const{limit:d,page:c,status:i,code:p,name:f,unitName:v,groupName:P,orderTimeFrom:F,orderTimeTo:x,usageTimeFrom:y,usageTimeTo:A}=t(),h={pagination:{limit:d&&+d||O,page:c&&+c||I},status:i||q,filter:{code:p||"",groupName:P||"",name:f||"",unitName:v||"",orderTime:F&&x&&g(F,S,!0).isValid()&&g(x,S,!0).isValid()?[g(F,S,!0),g(x,S,!0)]:[],usageTime:y&&A&&g(y,_,!0).isValid()&&g(A,_,!0).isValid()?[g(y,_,!0),g(A,_,!0)]:[]}};m({limit:h.pagination.limit,current:h.pagination.page}),n(h.status),s({...h.filter}),u.setFieldsValue({...h.filter});const E={limit:h.pagination.limit,page:h.pagination.page,status:h.status,code:(M=h.filter)==null?void 0:M.code,name:(V=h.filter)==null?void 0:V.name,unitName:(G=h.filter)==null?void 0:G.unitName,groupName:(Q=h.filter)==null?void 0:Q.groupName,orderTimeFrom:"",orderTimeTo:"",usageTimeFrom:"",usageTimeTo:""};return Array.isArray(h.filter.orderTime)&&h.filter.orderTime.length&&(E.orderTimeFrom=g(h.filter.orderTime[0]).format(S),E.orderTimeTo=g(h.filter.orderTime[1]).format(S)),Array.isArray(h.filter.usageTime)&&h.filter.usageTime.length&&(E.usageTimeFrom=g(h.filter.usageTime[0]).format(_),E.usageTimeTo=g(h.filter.usageTime[1]).format(_)),e(E),h},setQueryParamsAmenitiesOrder:({limit:d=O,page:c=I,status:i=q,filter:p=w})=>{const{code:f="",name:v="",unitName:P="",groupName:F="",orderTime:x=null,usageTime:y=null}=p,A={limit:d,page:c,status:i,code:f,name:v,unitName:P,groupName:F,orderTimeFrom:"",orderTimeTo:"",usageTimeFrom:"",usageTimeTo:""};Array.isArray(x)&&x.length&&(A.orderTimeFrom=g(x[0]).format(S),A.orderTimeTo=g(x[1]).format(S)),Array.isArray(y)&&y.length&&(A.usageTimeFrom=g(y[0]).format(_),A.usageTimeTo=g(y[1]).format(_)),e(A)}}},Ue=()=>{const{layoutScrollRef:t}=T.useContext(H),{idBuilding:e,filter:m,tableData:n,showFormUpdate:s,tablePagination:u,status:l,amenityBookingPermissionApprove:o,getsStatus:d}=T.useContext(k),c=W(),{setQueryParamsAmenitiesOrder:i}=B(),p=F=>{s(F)},f=(F,x)=>{let{current:y,limit:A}=u;F!==y&&(y=F),x!==A&&(A=x,y=I),i({limit:A,page:y,status:l,filter:m})},v={pageSize:u.limit,defaultCurrent:I,current:u.current,total:n.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:f},P={offsetScroll:c.offsetScrollX,getContainer:()=>t.current};return{onClickBtnUpdate:p,amenitiesOrderPagination:v,isLoading:d.isFetching,dataSource:n.records,idBuilding:e,amenityBookingPermissionApprove:o,sticky:P}},Re=()=>{const{onClickBtnUpdate:t,amenitiesOrderPagination:e,isLoading:m,dataSource:n,idBuilding:s,amenityBookingPermissionApprove:u,sticky:l}=Ue(),o=[{title:r.amenities_code,key:"code",dataIndex:"code",fixed:"left",render:(c,i)=>a(Pe,{to:`/buildings/${s}/amenities-orders/${i==null?void 0:i.id}`,children:a("span",{children:i==null?void 0:i.code})}),width:150},{title:r.amenities_group,key:"amenityGroupName",dataIndex:"amenityGroupName",width:200},{title:r.amenities,key:"amenitiesName",dataIndex:"amenitiesName",render:(c,i,p)=>U("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[a(Ae,{alt:"avatar",style:{width:"100px",height:"50px",marginRight:"5px"},src:(i==null?void 0:i.coverPhoto)??""}),a("span",{style:{wordBreak:"break-word"},children:i==null?void 0:i.amenityName})]}),width:300},{title:r.unit,key:"unitName",dataIndex:"unitName",width:200},{title:r.orderer,key:"residentName",dataIndex:"residentName",width:200},{title:r.management_note,key:"employeeNote",dataIndex:"employeeNote",width:200,render:(c,i)=>{const p=c;return(p==null?void 0:p.length)>10?a(Fe,{title:p,placement:"topLeft",children:a("div",{style:{width:"150px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:p})}):a("div",{style:{width:"150px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:p})}},{title:r.status1,key:"amenitiesStatus",dataIndex:"amenitiesStatus",width:150,render:(c,i)=>a(fe,{color:i.statusColor??"default",children:i.statusFormat})},{title:r.order_time,key:"createdAt",dataIndex:"createdAt",width:150},{title:r.usage_time,key:"usageTime",dataIndex:"usageTime",width:200},{title:r.amount,key:"totalTimeUsage",dataIndex:"totalTimeUsage",width:100,render:(c,i)=>`${i.totalTimeUsage} ${i.amenitiesUnit}`},{title:r.amenities_fee,key:"utilityPriceFormat",dataIndex:"utilityPriceFormat",align:"right",width:100,render:(c,i)=>i.utilityPrice===0?a("span",{children:i.utilityPriceFormat}):a("span",{style:{color:i.utilityPricePaidAt?void 0:"red"},children:i.utilityPriceFormat})},{title:r.deposit_amount,key:"depositsFormat",dataIndex:"depositsFormat",align:"right",width:100,render:(c,i)=>i.deposits===0?a("span",{children:i.depositsFormat}):a("span",{style:{color:i.depositsPaidAt?void 0:"red"},children:i.depositsFormat})},{title:r.surcharge,key:"surchargeFee",dataIndex:"surchargeFee",align:"right",width:100,render:(c,i)=>i.surchargeFee===0?a("span",{children:i.surchargeFeeFormat}):a("span",{style:{color:i.surchargePaidAt?void 0:"red"},children:i.surchargeFeeFormat})},{title:r.total_payment,key:"amountFormat",dataIndex:"amountFormat",align:"right",fixed:"right",width:100},u?{title:r.action,key:"action",dataIndex:"action",width:100,align:"center",fixed:"right",render:(c,i)=>a(b,{onClick:()=>t(i),name:"icon-edit-outlined",css:p=>({fontSize:p.iconSize}),title:r.update})}:null].filter(Boolean),d={x:o.reduce((c,i)=>i+c.width,0),scrollToFirstRowOnChange:!0};return a(N.Table,{columns:o,pagination:e,dataSource:n,loading:m,scroll:d,sticky:l})},we=async({filter:t,idBuilding:e,limit:m,page:n})=>{var s,u,l,o;try{const d={from:(s=t==null?void 0:t.orderTime)!=null&&s.length?g(t.orderTime[0]).startOf("days").toISOString():void 0,to:(u=t==null?void 0:t.orderTime)!=null&&u.length?g(t.orderTime[1]).endOf("days").toISOString():void 0,dateUsageFrom:(l=t==null?void 0:t.usageTime)!=null&&l.length?g(t.usageTime[0]).toISOString():void 0,dateUsageTo:(o=t==null?void 0:t.usageTime)!=null&&o.length?g(t.usageTime[1]).toISOString():void 0,status:t.status!==se?t.status:void 0,limit:m,code:t.code||void 0,name:t.name||void 0,groupName:t.groupName||void 0,unitName:t.unitName||void 0,page:n},{code:c,codeLanguage:i,data:p,totalRecord:f}=await me({filter:d,idBuilding:e,limit:m,page:n});return{code:c,codeLanguage:i,data:p.map(v=>Ne(v)),totalRecord:f}}catch(d){return{code:d.code,codeLanguage:d.codeLanguage,data:[],totalRecord:0}}},D=()=>{const{idBuilding:t,setGetsStatus:e,setTableData:m}=T.useContext(k);return[async({filter:s,limit:u,page:l})=>{e({isFetching:!0});const o=await we({filter:s,limit:u,page:l,idBuilding:t});m({records:(o==null?void 0:o.data)??[],totalRecord:(o==null?void 0:o.totalRecord)??0}),e({isFetching:!1})}]},Be=()=>{const{formFilter:t,status:e,filter:m,tablePagination:n}=T.useContext(k),{setQueryParamsAmenitiesOrder:s}=B(),[u]=D();return{onSearch:async o=>{const d=ke(o,m);d&&await u({filter:{...o,status:e},limit:n.limit,page:n.current}),d||s({limit:O,page:I,filter:{...o},status:e})},defaultFilter:w,formFilter:t}},be=()=>{const{onSearch:t,defaultFilter:e,formFilter:m}=Be(),n=T.useMemo(()=>[{label:r.amenities_code,key:"code",component:a(C,{placeholder:r.amenities_code}),visible:!0},{label:r.amenities_group,key:"groupName",component:a(C,{placeholder:r.amenities_group}),visible:!0},{label:r.amenities,key:"name",component:a(C,{placeholder:r.amenities}),visible:!0},{label:r.unit,key:"unitName",component:a(C,{placeholder:r.unit}),visible:!0},{label:r.order_time,key:"orderTime",component:a($.RangePicker,{fluid:"true",placeholder:[S,S],format:[S,S],getPopupContainer:s=>s.parentNode}),visible:!0},{label:r.usage_time,key:"usageTime",component:a($.RangePicker,{fluid:!0,getPopupContainer:s=>s.parentNode,showTime:{format:Z},format:[_,_],minuteStep:15}),visible:!0}],[]);return a(N.FilterBox,{defaultFilter:e,onSearch:t,layout:"vertical",filters:n,formData:m})},Le=()=>{const{filter:t,status:e}=T.useContext(k),{setQueryParamsAmenitiesOrder:m}=B();return{onTabChange:s=>{e!==s&&m({limit:O,page:I,status:s,filter:t})},activeKey:e}},De=()=>{const{onTabChange:t,activeKey:e}=Le();return a(N.Tabs,{activeKey:e,onTabChange:t,tabs:de})},Me=()=>{var f;const[t]=R.useForm(),{hideFormUpdate:e,idBuilding:m,formUpdateData:n,filter:s,status:u,tablePagination:l}=T.useContext(k),[o,d]=T.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),[c]=D(),i={employeeNote:((f=n==null?void 0:n.data)==null?void 0:f.employeeNote)??""};return Y(o.code,o.codeLanguage,{message:r.success,description:r.update_data_success}),{initialValues:i,hideFormUpdate:e,handleUpdateAmenitiesOrderView:async()=>{var P;if(await t.validateFields()){d({code:void 0,codeLanguage:void 0,isFetching:!0});const F=t.getFieldsValue(),x=(P=n==null?void 0:n.data)==null?void 0:P.id,y=await xe({id:x,body:F,idBuilding:m});d({code:y.code,codeLanguage:y.codeLanguage,isFetching:!1}),ce.includes(y.code)&&(await c({filter:{...s,status:u},limit:l.limit,page:l.current}),e())}},formUpdate:t,isFetchingUpdate:o.isFetching}},Ve=()=>{const{initialValues:t,hideFormUpdate:e,handleUpdateAmenitiesOrderView:m,formUpdate:n,isFetchingUpdate:s}=Me();return a(j,{title:r.label.update_utility,okText:r.update,cancelText:r.cancel,onOk:m,onCancel:e,open:!0,okButtonProps:{disabled:s,loading:s},width:"50%",children:a(R,{initialValues:t,form:n,name:"formUpdate",layout:"vertical",children:a(Se,{gutter:[12,12],children:a(ve,{span:"24",children:a(R.Item,{label:r.management_note,name:"employeeNote",children:a(C.TextArea,{maxLength:"255",fluid:"true",placeholder:r.management_note,rows:"4"})})})})})})},Ge=()=>{const{setVisibleSearchBox:t,setTitlePage:e,setVisibleFilterBox:m}=T.useContext(H),{formUpdateData:n,idBuilding:s}=T.useContext(k),{getQueryParamsAmenitiesOrder:u}=B(),[l]=D(),{search:o}=Te();return T.useEffect(()=>(t(!0),e(r.amenities_orders),()=>{t(!1),m(!1),e("")}),[]),T.useEffect(()=>{(async()=>{if(s){const{pagination:d,filter:c,status:i}=u();o&&l({filter:{...c,status:i},limit:d.limit,page:d.page})}})()},[o]),{showFormUpdateAmenitiesOrder:n.isShow}},Qe=()=>{const{showFormUpdateAmenitiesOrder:t}=Ge();return U(N.Wrapper,{children:[a(be,{}),U(N.Container,{children:[a(N.Header,{children:a(Ce,{})}),U(N.Content,{children:[a(De,{}),a(Re,{})]})]}),t&&a(Ve,{})]})},Ni=()=>a(Ie,{children:a(Qe,{})});export{Ni as default};
