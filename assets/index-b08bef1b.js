import{j as t,a as R,u as ve,F as pt,c as Ge,b as le}from"./@emotion-63839449.js";import{P as G,n as $,o as mt,b as He,D as Se,k as we,w as ht,a as de,F as gt}from"./index-b17d22e5.js";import{a9 as O,s as Y,b0 as ze,K as ae,aV as Xe,at as fe,bv as je,ag as ft,i as j,A as ye,M as J,X as Q,ea as Je,e4 as Pe,j as St,l as o,I as q,a as Me,S as xe,b1 as yt,w as wt,c6 as vt,gX as xt}from"./index-c2ded735.js";import{r as w}from"./react-4fd50329.js";import"./react-redux-896b353b.js";import"./lodash-88fe09e6.js";import{h as H}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import"./@firebase-43527ee1.js";import{P as M}from"./prop-types-1172f4d5.js";import{F,u as ne}from"./index-687ba9e6.js";import{D as oe,b as It,c as _t,d as Tt,S as Ft,I as bt,e as Qe,f as Ke,g as Ct,h as Ce,i as Ze,A as Et,a as Pt,j as De,k as Dt,l as Lt}from"./constants-756f802c.js";import{u as et}from"./react-router-a4308f7b.js";import{d as Re}from"./downloadFileFromUrl-79614833.js";import{B as ce,D as At,w as Fe,T as Ue,R as he,b as V,k as $e,S as tt,n as at,P as Ot,I as Ut,a as be}from"./antd-f9eae174.js";import{I as z,S as k}from"./index-43183512.js";import{g as Mt}from"./partner-15abd2bf.js";import{g as Rt}from"./department-807891d3.js";import{a as Nt}from"./staff-2880022d.js";import{P as Ee}from"./index-d2c5b7c0.js";import{I as Le}from"./index-0335a746.js";import{e as kt}from"./exportExcel-837be6ed.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./index-881eef42.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./classnames-4ba1ba1a.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./regex-deefadac.js";import"./xlsx-0fb7ed70.js";import"./uuid-4a60fe23.js";const W=w.createContext({idBuilding:0,isShowActionAdd:!1,isShowActionUpdate:!1,isShowActionDelete:!1,isShowActionImport:!1,isShowActionExport:!1,isShowActionViewHistoryUsage:!1,isShowActionImportSuppliesToWarehouse:!1,isShowActionExportSuppliesToWarehouse:!1,formFilter:void 0,filter:{...oe},setFilter:()=>{},tableData:{records:[],totalRecord:0},setTableData:()=>{},tablePagination:{current:O,limit:Y},setTablePagination:()=>{},getListSuppliesStatus:{isFetching:!1},setGetListSuppliesStatus:()=>{},modalAddSupplies:void 0,showModalAddSupplies:()=>{},hideModalAddSupplies:()=>{},modalUpdateSupplies:void 0,showModalUpdateSupplies:()=>{},hideModalUpdateSupplies:()=>{},modalImportSupplies:void 0,showModalImportSupplies:()=>{},hideModalImportSupplies:()=>{},modalImportAvailableSupplies:void 0,showModalImportAvailableSupplies:()=>{},hideModalImportAvailableSupplies:()=>{},modalViewHistoryUsage:void 0,showModalViewHistoryUsage:()=>{},hideModalViewHistoryUsage:()=>{},modalImportSuppliesToWarehouse:void 0,showModalImportSuppliesToWarehouse:()=>{},hideModalImportSuppliesToWarehouse:()=>{},modalExportSuppliesToWarehouse:void 0,showModalExportSuppliesToWarehouse:()=>{},hideModalExportSuppliesToWarehouse:()=>{},formConfirmImportSupplies:{isShow:!1,data:{}},showFormConfirmImportSupplies:()=>{},hideFormConfirmImportSupplies:()=>{},formExportInventoryReport:{isShow:!1,data:{}},showFormExportInventoryReport:()=>{},hideFormExportInventoryReport:()=>{}}),Ne=({children:e})=>{const{getPermissionByModuleCode:a}=ze(),{idBuilding:r}=et(),[s,n]=w.useState({isFetching:!1}),[i,d]=w.useState({...oe}),[c,u]=w.useState({records:[],totalRecord:0}),[m,l]=w.useState({current:O,limit:Y}),[g]=F.useForm(),[h,S,f]=ae(),[p,y,I]=ae(),[E,b,x]=ae(),[T,X,ee]=ae(),[ie,se,ue]=ae(),[v,P,D]=ae(),[A,te,pe]=ae(),[_,C,U]=ae(),[N,K,me]=ae(),L=a(Xe),B=(L==null?void 0:L[fe])??!1,_e=(L==null?void 0:L[fe])??!1,Te=(L==null?void 0:L[fe])??!1,it=(L==null?void 0:L[fe])??!1,st=(L==null?void 0:L[je])??!1,lt=(L==null?void 0:L[ft])??!1,ct=(L==null?void 0:L[fe])??!1,dt=(L==null?void 0:L[fe])??!1,ut={idBuilding:r,isShowActionAdd:B,isShowActionUpdate:_e,isShowActionDelete:Te,isShowActionImport:it,isShowActionExport:st,isShowActionViewHistoryUsage:lt,isShowActionImportSuppliesToWarehouse:ct,isShowActionExportSuppliesToWarehouse:dt,formFilter:g,filter:i,setFilter:d,tableData:c,setTableData:u,tablePagination:m,setTablePagination:l,getListSuppliesStatus:s,setGetListSuppliesStatus:n,modalAddSupplies:h,showModalAddSupplies:S,hideModalAddSupplies:f,modalUpdateSupplies:p,showModalUpdateSupplies:y,hideModalUpdateSupplies:I,modalImportSupplies:E,showModalImportSupplies:b,hideModalImportSupplies:x,modalViewHistoryUsage:ie,showModalViewHistoryUsage:se,hideModalViewHistoryUsage:ue,modalImportSuppliesToWarehouse:v,showModalImportSuppliesToWarehouse:P,hideModalImportSuppliesToWarehouse:D,modalExportSuppliesToWarehouse:A,showModalExportSuppliesToWarehouse:te,hideModalExportSuppliesToWarehouse:pe,formConfirmImportSupplies:_,showFormConfirmImportSupplies:C,hideFormConfirmImportSupplies:U,modalImportAvailableSupplies:T,showModalImportAvailableSupplies:X,hideModalImportAvailableSupplies:ee,formExportInventoryReport:N,showFormExportInventoryReport:K,hideFormExportInventoryReport:me};return t(W.Provider,{value:ut,children:e})};Ne.propTypes={children:M.node};Ne.defaultProps={children:t("div",{})};const Yt=Ne,Z=`${St}/supply`,Vt=`${Z}/list`,Wt=e=>`${Z}/${e}`,Bt=e=>`${Z}/${e}`,qt=e=>`${Z}/${e}/update-amount`,ot=`${Z}/history`,Ht=`${Z}/export-data`,$t=`${Z}/export-inventory-report`,Gt=`${Z}/import-data`,zt=`${Z}/import-available`,Xt=`${ot}/export-data`,jt=`${Z}/export-available`,Jt=async({idBuilding:e,filter:a,page:r,limit:s})=>{const{status:n,inventoryStatus:i,departmentId:d,supplyCode:c,supplyName:u}=a;return await j({type:ye,payload:{apiUrl:Vt,method:J.GET,options:{headers:{[Q]:e},params:{status:n,inventoryStatus:i,departmentId:d,supplyCode:c,supplyName:u,page:r,limit:s}}}})},Qt=async(e,a)=>{const{departmentId:r,employeeId:s,employeeName:n,limit:i,measureUnit:d,name:c,note:u,partnerId:m,warehousingAmount:l,warehousingDate:g,supplyCode:h,status:S,inventoryStatus:f,locationType:p,supplyLocation:y,supplyType:I,supplyCategory:E,supplySpecification:b,origin:x,expiryDate:T,entryDocument:X}=a;return await j({type:ye,payload:{apiUrl:Z,method:J.POST,body:{departmentId:r,employeeId:s,employeeName:n,limit:i,measureUnit:d,name:c,note:u,partnerId:m,warehousingAmount:l,warehousingDate:g,supplyCode:h,status:S,inventoryStatus:f,locationType:p,supplyLocation:y,supplyType:I,supplyCategory:E,supplySpecification:b,origin:x,expiryDate:T,entryDocument:X},options:{headers:{[Q]:e}}}})},Kt=async(e,a,r)=>{const{departmentId:s,employeeId:n,employeeName:i,limit:d,measureUnit:c,name:u,note:m,partnerId:l,warehousingAmount:g,warehousingDate:h,supplyCode:S,status:f,inventoryStatus:p,locationType:y,supplyLocation:I,supplyType:E,supplyCategory:b,supplySpecification:x,origin:T,expiryDate:X,entryDocument:ee}=r;return await j({type:ye,payload:{apiUrl:Wt(a),method:J.PUT,body:{departmentId:s,employeeId:n,employeeName:i,limit:d,measureUnit:c,name:u,note:m,partnerId:l,warehousingAmount:g,warehousingDate:h,supplyCode:S,status:f,inventoryStatus:p,locationType:y,supplyLocation:I,supplyType:E,supplyCategory:b,supplySpecification:x,origin:T,expiryDate:X,entryDocument:ee},options:{headers:{[Q]:e}}}})},Zt=async(e,a)=>await j({type:ye,payload:{apiUrl:Bt(a),method:J.DELETE,options:{headers:{[Q]:e}}}}),nt=async(e,a,r)=>{const{amount:s,billNo:n,note:i,price:d,type:c,dateOfImportToWarehouse:u,dateOfExportToWarehouse:m,warehouseInboundCode:l,receiverId:g}=r;return await j({type:ye,payload:{apiUrl:qt(a),method:J.PUT,body:{amount:s,billNo:n,note:i,price:d,type:c,dateOfImportToWarehouse:u,dateOfExportToWarehouse:m,warehouseInboundCode:l,receiverId:g},options:{headers:{[Q]:e}}}})},ea=async({idBuilding:e,filter:a,page:r,limit:s})=>{const{action:n,billNo:i,supplyName:d,userId:c,from:u,to:m,supplyId:l}=a;return await j({type:ye,payload:{apiUrl:ot,method:J.GET,options:{headers:{[Q]:e},params:{action:n,billNo:i,supplyName:d,userId:c,from:u,to:m,supplyId:l,page:r,limit:s}}}})},ta=async(e,a)=>{const{supplyCode:r,status:s,inventoryStatus:n,departmentId:i,supplyName:d}=a;return await j({type:Pe,payload:{apiUrl:Ht,method:J.GET,options:{headers:{[Q]:e},params:{supplyCode:r,status:s,inventoryStatus:n,departmentId:i,supplyName:d}}}})},aa=async(e,a,r)=>{const{supplyCode:s,status:n,inventoryStatus:i,departmentId:d,supplyName:c}=a,{from:u,to:m}=r;return await j({type:Pe,payload:{apiUrl:$t,method:J.GET,options:{headers:{[Q]:e},params:{from:u,to:m,supplyCode:s,status:n,inventoryStatus:i,departmentId:d,supplyName:c}},dataExportInventoryReport:r}})};async function oa(e,a){return await j({type:Je,payload:{apiUrl:Gt,method:J.POST,file:a,options:{headers:{[Q]:e}}}})}async function na(e,a){return await j({type:Je,payload:{apiUrl:zt,method:J.POST,file:a,options:{headers:{[Q]:e}}}})}const ra=async({idBuilding:e,filter:a})=>{const{action:r,billNo:s,supplyName:n,userId:i}=a;return await j({type:Pe,payload:{apiUrl:Xt,method:J.GET,options:{headers:{[Q]:e},params:{action:r,billNo:s,supplyName:n,userId:i}}}})};async function ia({idBuilding:e}){return await j({type:Pe,payload:{apiUrl:jt,method:J.GET,options:{headers:{[Q]:e}}}})}const sa=async(e,a)=>{try{const r={supplyCode:a.supplyCode??null,status:a.status??null,inventoryStatus:a.inventoryStatus??"",supplyName:a.supplyName??"",departmentId:a.departmentId??null},{code:s,codeLanguage:n,data:i}=await ta(e,r);return{code:s,codeLanguage:n,data:i}}catch({code:r,codeLanguage:s}){return{code:r,codeLanguage:s,data:void 0}}},la=()=>{const{idBuilding:e,filter:a,isShowActionAdd:r,isShowActionExport:s,isShowActionImport:n,isShowActionViewHistoryUsage:i,tableData:d,showModalAddSupplies:c,showModalViewHistoryUsage:u,showFormConfirmImportSupplies:m,showFormExportInventoryReport:l}=w.useContext(W),[g,h]=w.useState({isFetching:!1,code:void 0,codeLanguage:void 0});ne(g.code,g.codeLanguage,{message:o.success,description:o.export_data_success});const S=()=>{m()},f=async()=>{h({isFetching:!0,code:void 0,codeLanguage:void 0});const b=await sa(e,a);b.data&&Re(b.data,document,"thong-tin-vat-tu.xlsx"),h({isFetching:!1,code:b.code,codeLanguage:b.codeLanguage})},p=async()=>{l()},y=()=>{c()},I=()=>{u()},E={items:It,onClick:b=>{b.key===_t&&f(),b.key===Tt&&p()}};return{isShowActionAdd:r,isShowActionImport:n,isShowActionExport:s,isShowActionViewHistoryUsage:i,loadingExport:g.isFetching,totalRecord:d.totalRecord,handleExportListSupplies:f,handleAddSupplies:y,handleViewHistoryUsage:I,handleConfirmImportSupplies:S,menuExport:E}};function ca(){const{isShowActionAdd:e,isShowActionImport:a,isShowActionExport:r,isShowActionViewHistoryUsage:s,loadingExport:n,totalRecord:i,handleAddSupplies:d,handleViewHistoryUsage:c,handleConfirmImportSupplies:u,menuExport:m}=la(),l=[s?t(ce,{css:g=>({marginRight:g.margin.xs}),type:"primary",ghost:!0,icon:t(q,{name:"icon-history-outlined"}),onClick:c,children:o.history},"history"):null,r?t(At,{menu:m,children:R(ce,{css:g=>({marginRight:g.margin.xs}),loading:n,ghost:!0,type:"primary",icon:t(q,{name:"icon-download-outlined"}),children:[o.export," ",t(q,{name:"icon-arrow-down-outlined"})]})}):null,a?t(ce,{css:g=>({marginRight:g.margin.xs}),type:"primary",ghost:!0,icon:t(q,{name:"icon-upload-outlined"}),onClick:u,children:o.import},"import"):null,e?t(ce,{type:"primary",icon:t(q,{name:"icon-plus-circle-outlined"}),onClick:d,children:o.create},"add"):null];return t(G.ActionBox,{actions:l,total:i})}const da=e=>({id:e==null?void 0:e.id,name:(e==null?void 0:e.companyName)??""}),ke=async({idBuilding:e,filter:a,page:r,limit:s})=>{try{const{name:n}=a,{code:i,codeLanguage:d,data:c,totalRecord:u}=await Mt({filter:{companyName:n||void 0},idBuilding:e,limit:s,page:r});return{code:i,codeLanguage:d,data:c.map(m=>da(m)),totalRecord:u}}catch({code:n,codeLanguage:i}){return{code:n,codeLanguage:i,data:[],totalRecord:0}}},ua=e=>({id:e==null?void 0:e.id,name:(e==null?void 0:e.name)??""}),Ye=async e=>{try{const{code:a,codeLanguage:r,data:s,totalRecord:n}=await Rt(e);return{code:a,codeLanguage:r,data:s.map(i=>ua(i)),totalRecord:n}}catch({code:a,codeLanguage:r}){return{code:a,codeLanguage:r,data:[],totalRecord:0}}},pa=e=>({id:e==null?void 0:e.id,userId:e==null?void 0:e.UserId,name:(e==null?void 0:e.fullName)??""}),Ie=async({idBuilding:e,filter:a,page:r,limit:s})=>{try{const{name:n}=a,{code:i,codeLanguage:d,data:c,totalRecord:u}=await Nt({filter:{name:n||void 0},idBuilding:e,limit:s,page:r});return{code:i,codeLanguage:d,data:c.map(m=>pa(m)),totalRecord:u}}catch({code:n,codeLanguage:i}){return{code:n,codeLanguage:i,data:[],totalRecord:0}}},ma=e=>{var a,r,s,n,i,d;return{id:e==null?void 0:e.id,key:e==null?void 0:e.id,name:(e==null?void 0:e.name)??"",supplyCode:(e==null?void 0:e.supplyCode)??"",office:(e==null?void 0:e.office)??"",locationType:(e==null?void 0:e.locationType)??"",supplyLocation:(e==null?void 0:e.supplyLocation)??"",measureUnit:(e==null?void 0:e.measureUnit)??"",quota:(e==null?void 0:e.quota)??"",expiryDate:(e==null?void 0:e.expiryDate)??"",status:e.status?Ft[e.status]:{},inventoryStatus:e.inventoryStatus?bt[e.inventoryStatus]:{},managerUnit:{id:(a=e==null?void 0:e.department)==null?void 0:a.id,name:(r=e==null?void 0:e.department)==null?void 0:r.name},staffInCharge:{id:(s=e==null?void 0:e.employee)==null?void 0:s.id,name:(n=e==null?void 0:e.employee)==null?void 0:n.fullName},partner:{id:(i=e==null?void 0:e.partner)==null?void 0:i.id,name:(d=e==null?void 0:e.partner)==null?void 0:d.companyName},quotation:(e==null?void 0:e.limit)??0,amount:(e==null?void 0:e.warehousingAmount)??0,measure:(e==null?void 0:e.measureUnit)??"",note:(e==null?void 0:e.note)??"",dateOfImportingToWarehouse:(e==null?void 0:e.warehousingDate)??"",supplyType:(e==null?void 0:e.supplyType)??"",supplyCategory:(e==null?void 0:e.supplyCategory)??"",supplySpecification:(e==null?void 0:e.supplySpecification)??"",origin:(e==null?void 0:e.origin)??"",entryDocument:e==null?void 0:e.entryDocument}},ha=async({idBuilding:e,filter:a,page:r,limit:s})=>{const{status:n,inventoryStatus:i,departmentId:d,supplyCode:c,supplyName:u}=a;try{const m={status:n||void 0,inventoryStatus:i||void 0,departmentId:d||void 0,supplyCode:c||void 0,supplyName:u||void 0},{code:l,codeLanguage:g,data:h,totalRecord:S}=await Jt({filter:{...m},idBuilding:e,limit:s,page:r});return{code:l,codeLanguage:g,data:h.map(f=>ma(f)),totalRecord:S}}catch({code:m,codeLanguage:l}){return{code:m,codeLanguage:l,data:[],totalRecord:0}}},re=()=>{const{setTableData:e,idBuilding:a,setGetListSuppliesStatus:r}=w.useContext(W);return{changeDataTable:async({filter:n,page:i,limit:d})=>{r({isFetching:!0});const c=await ha({filter:n,page:i,limit:d,idBuilding:a});e({records:c.data,totalRecord:c.totalRecord}),r({isFetching:!1})}}},ga=()=>{const{idBuilding:e,setFilter:a,formFilter:r,setTablePagination:s}=w.useContext(W),{changeDataTable:n}=re(),[i,d]=w.useState({isFetching:!1,records:[]}),[c,u]=w.useState({isFetching:!1,records:[]}),[m,l]=w.useState({isFetching:!1,records:[]}),g=async f=>{a(f),s({current:O,limit:Y}),await n({filter:{...f},page:O,limit:Y})},h=async f=>{d({...i,isFetching:!0});const{data:p}=await ke({filter:{name:f},idBuilding:e,limit:Y,page:O});d({isFetching:!1,records:p})},S=async f=>{u({...c,isFetching:!0});const{data:p}=await Ie({filter:{name:f},idBuilding:e,limit:Y,page:O});u({isFetching:!1,records:p})};return w.useEffect(()=>{(async()=>{l({isFetching:!0,records:[]});const[f,,]=await Promise.all([Ye(e),h(""),S("")]);l({isFetching:!1,records:f==null?void 0:f.data})})()},[]),{loadingListPartner:i.isFetching,loadingListManagerUnit:m.isFetching,loadingListStaff:c.isFetching,listPartner:i.records,listManagerUnit:m.records,listStaff:c.records,onSearch:g,formFilter:r,handleSearchPartner:h,handleSearchStaff:S}},fa=()=>{const{loadingListPartner:e,loadingListManagerUnit:a,listPartner:r,listManagerUnit:s,listStaff:n,onSearch:i,formFilter:d}=ga(),c=w.useMemo(()=>{var u,m;return[{label:o.supply_code,key:"supplyCode",component:t(z,{placeholder:o.supply_code}),visible:!0},{label:o.supply_name,key:"supplyName",component:t(z,{placeholder:o.supply_name}),visible:!0},{label:o.supply_status,key:"status",component:R(k,{loading:e,fluid:!0,placeholder:o.supply_status,optionFilterProp:"children",getPopupContainer:l=>l.parentNode,filterOption:(l,g)=>$(g.children).indexOf($(l))>=0,children:[t(k.Option,{value:"",children:o.all_status},"status_0"),(u=Qe)==null?void 0:u.map(({value:l,label:g})=>t(k.Option,{value:l,children:g},l))]}),visible:!0},{label:o.inventory_status,key:"inventoryStatus",component:R(k,{fluid:!0,placeholder:o.inventory_status,optionFilterProp:"children",getPopupContainer:l=>l.parentNode,filterOption:(l,g)=>$(g.children).indexOf($(l))>=0,children:[t(k.Option,{value:"",children:o.all_status},"status_0"),(m=Ke)==null?void 0:m.map(({value:l,label:g})=>t(k.Option,{value:l,children:g},l))]}),visible:!0},{label:o.manager_unit,key:"departmentId",component:R(k,{loading:a,fluid:!0,children:[t(k.Option,{value:"",children:o.all_unit},"manager_unit_0"),s==null?void 0:s.map(({id:l,name:g})=>t(k.Option,{value:l,children:g},l))]}),visible:!0}]},[r,n,s]);return t(G.FilterBox,{defaultFilter:oe,filters:c,formData:d,onSearch:i})},Sa=async(e,a)=>{try{const{code:r,codeLanguage:s}=await Zt(e,a);return{code:r,codeLanguage:s}}catch({code:r,codeLanguage:s}){return{code:r,codeLanguage:s}}},ya=()=>{const{layoutScrollRef:e}=w.useContext(Me),{idBuilding:a,isShowActionUpdate:r,isShowActionDelete:s,isShowActionImportSuppliesToWarehouse:n,isShowActionExportSuppliesToWarehouse:i,getListSuppliesStatus:d,tablePagination:c,setTablePagination:u,filter:m,showModalUpdateSupplies:l,showModalImportSuppliesToWarehouse:g,showModalExportSuppliesToWarehouse:h,tableData:S}=w.useContext(W),{changeDataTable:f}=re(),p=ve(),[y,I]=w.useState({isFetching:!1,code:void 0,codeLanguage:void 0});ne(y.code,y.codeLanguage,{message:o.success,description:o.delete_data_success});const E=async(v,P)=>{let{limit:D,current:A}=c;A!==v?A=v:D!==P&&(A=O,D=P),u({limit:D,current:A}),await f({filter:{...m},page:A,limit:D})},b=v=>{l({...v})},x=async v=>{mt({loading:y.isFetching,onCancel:()=>{I({isFetching:!1,code:void 0,codeLanguage:void 0})},isAll:!1,onOk:async()=>{I({isFetching:!0,code:void 0,codeLanguage:void 0});const P=await Sa(a,v.id),D=xe.includes(P.code);return D&&await f({filter:{...m},page:c.current,limit:c.limit}),I({isFetching:!1,code:P.code,codeLanguage:P.codeLanguage}),D?Promise.resolve():Promise.reject()},questionText:o.do_you_want_to_delete_supplies,totalItem:1})},T=v=>{g({...v})},X=v=>{h({...v})},ee=S.records,ie={pageSize:c.limit,defaultCurrent:O,current:c.current,total:S.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:E},se={offsetScroll:p.offsetScrollX,getContainer:()=>e.current},ue={scrollToFirstRowOnChange:!0};return{loading:d.isFetching,isShowActionUpdate:r,isShowActionDelete:s,isShowActionImportSuppliesToWarehouse:n,isShowActionExportSuppliesToWarehouse:i,handleUpdateSupplies:b,handleDeleteSupplies:x,dataSource:ee,pagination:ie,scroll:ue,sticky:se,handleImportSupplies:T,handleExportSupplies:X}};var wa={name:"e0dnmk",styles:"cursor:pointer"},va={name:"e0dnmk",styles:"cursor:pointer"},xa={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"};function Ia(){const{loading:e,isShowActionUpdate:a,isShowActionDelete:r,isShowActionImportSuppliesToWarehouse:s,isShowActionExportSuppliesToWarehouse:n,handleUpdateSupplies:i,handleDeleteSupplies:d,dataSource:c,pagination:u,scroll:m,sticky:l,handleImportSupplies:g,handleExportSupplies:h}=ya(),S=[{title:o.supply_code,key:"supplyCode",dataIndex:"supplyCode",fixed:"left",width:150},{title:o.supply_status,key:"status",dataIndex:"status",fixed:"left",width:170,render:(f,p)=>{var y,I;return t(Fe,{css:wa,color:((y=p==null?void 0:p.status)==null?void 0:y.color)??"default",children:((I=p==null?void 0:p.status)==null?void 0:I.label)??""})}},{title:o.inventory_status,key:"inventoryStatus",dataIndex:"inventoryStatus",width:170,render:(f,p)=>{var y,I;return t(Fe,{css:va,color:((y=p==null?void 0:p.inventoryStatus)==null?void 0:y.color)??"default",children:((I=p==null?void 0:p.inventoryStatus)==null?void 0:I.label)??""})}},{title:o.manager_unit,key:"managerUnit",width:150,render:(f,p)=>p.managerUnit.name},{title:o.staff_in_charge,key:"staff",width:150,render:(f,p)=>{var y;return(y=p==null?void 0:p.staffInCharge)==null?void 0:y.name}},{title:o.supply_name,key:"name",dataIndex:"name",width:150,render:(f,p)=>{const y=f;return(y==null?void 0:y.length)>30?t(Ue,{title:y,placement:"topLeft",children:t("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:y})}):t("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:y})}},{title:o.label.unit,key:"measureUnit",dataIndex:"measureUnit",width:150},{title:o.quotation,key:"quotation",dataIndex:"quotation",width:150,render:(f,p)=>+f>+p.amount?t(Fe,{color:"warning",children:f}):t(Fe,{color:"default",children:f})},{title:o.in_stock,key:"amount",dataIndex:"amount",width:150,render:(f,p)=>R("div",{css:xa,children:[s?t(q,{css:y=>({marginRight:y.margin.sm,fontSize:y.iconSize}),name:"icon-plus-circle-outlined",onClick:()=>g(p),title:o.import_supplies_to_warehouse}):null,p.amount,n?t(q,{css:y=>({marginLeft:y.margin.sm,fontSize:y.iconSize}),name:"icon-minus-circle-outlined",onClick:()=>h(p),title:o.export_supplies_to_warehouse}):null]})},{title:o.actions,key:"action",fixed:"right",align:"center",width:120,render:(f,p)=>R(pt,{children:[a&&!p.inactiveAt?t(q,{css:y=>({fontSize:y.iconSize}),onClick:()=>i(p),name:"icon-edit-outlined",title:o.update}):null,r&&!p.inactiveAt?t(q,{css:y=>({fontSize:y.iconSize,marginLeft:y.margin.sm}),onClick:()=>d(p),name:"icon-minus-circle-outlined",title:o.delete}):null]})}];return t(G.Table,{columns:S,dataSource:c,loading:e,pagination:u,scroll:{...m,x:S.reduce((f,p)=>f+p.width,0)},sticky:l})}var _a={name:"99halj",styles:"color:#2424f3"};const Ta=Ge("span",{target:"extx5an0"})("cursor:pointer;width:85%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;",e=>e.isUploaded&&_a,";"),Ve=({file:e,handlePreviewAttachment:a})=>t(Ta,{title:e.name,onClick:()=>a(e),children:e.name});Ve.propTypes={file:M.arrayOf(M.any),handlePreviewAttachment:M.func};Ve.defaultProps={file:{},handlePreviewAttachment:()=>{}};const Fa=Ge("div",{target:"ek8f7k50"})({name:"seoft9",styles:"display:flex;justify-content:space-between;margin:10px;&:hover{background:#f7f7f7;}"}),We=({file:e,handlePreviewAttachment:a,handleRemoveFile:r})=>{const s=ve();return R(Fa,{children:[R(he,{style:{flexFlow:"row"},children:[t(q,{name:"icon-attachment-outlined",css:le({fontsize:s.iconSize,marginRight:s.margin.xs},"","")}),t(Ve,{file:e,handlePreviewAttachment:a})]}),t(q,{name:"icon-delete-outlined",css:le({fontsize:s.iconSize,marginLeft:s.margin.xs},"",""),onClick:()=>{r(e==null?void 0:e.uid)}})]},e)};We.propTypes={file:M.arrayOf(M.any),handlePreviewAttachment:M.func,handleRemoveFile:M.func};We.defaultProps={file:{},handlePreviewAttachment:()=>{},handleRemoveFile:()=>{}};var ba={name:"1kevbid",styles:"& .ant-upload{width:100%;}"};const Ae=({listManagerUnit:e,listStaff:a,loadingPartner:r,listPartner:s,handleSearchPartner:n,disabledComponent:i,handlePreviewAttachment:d,fileList:c,handleChange:u,handleRemoveFile:m,handleSelectStaff:l})=>{const g=ve();return R(he,{gutter:[g.margin.sm,0],children:[R(V,{span:"24",children:[t(q,{name:"icon-info-circle-filled",css:le({fontSize:g.iconSize,marginRight:g.margin.xs,color:g.color.primary},"","")}),t(He,{css:le({color:g.color.primary,fontWeight:g.fontWeight.bold},"",""),children:o.label.general_information})]}),t(V,{span:"8",children:t(F.Item,{name:"managerUnit",label:o.manager_unit,rules:[{required:!0}],children:t(k,{fluid:!0,placeholder:o.manager_unit,optionFilterProp:"children",getPopupContainer:h=>h.parentNode,showSearch:!0,filterOption:(h,S)=>$(S.children).indexOf($(h))>=0,allowClear:!0,children:e.map(({id:h,name:S})=>t(k.Option,{value:h,children:S},h))})})}),R(V,{span:"8",children:[t(F.Item,{name:"staffInCharge",label:o.staff_in_charge,rules:[{required:!0}],children:t($e,{filterOption:(h,S)=>{var f,p;return((p=(f=S==null?void 0:S.value)==null?void 0:f.toUpperCase())==null?void 0:p.indexOf(h.toUpperCase()))!==-1},placeholder:o.staff_in_charge,onSelect:(h,S)=>{l(S)},children:a==null?void 0:a.map(({id:h,name:S})=>t($e.Option,{value:S,children:S},h))})}),t(F.Item,{name:"staffId"})]}),t(V,{span:"8",children:t(F.Item,{name:"status",label:o.supply_status,rules:[{required:!0}],children:t(k,{fluid:!0,placeholder:o.supply_status,optionFilterProp:"children",getPopupContainer:h=>h.parentNode,showSearch:!0,filterOption:(h,S)=>$(S.children).indexOf($(h))>=0,allowClear:!0,children:Qe.map(({value:h,label:S})=>t(k.Option,{value:h,children:S},h))})})}),t(V,{span:"24",children:t(F.Item,{name:"inventoryStatus",label:o.inventory_status,children:t(k,{fluid:!0,placeholder:o.inventory_status,optionFilterProp:"children",getPopupContainer:h=>h.parentNode,showSearch:!0,filterOption:(h,S)=>$(S.children).indexOf($(h))>=0,allowClear:!0,disabled:!0,children:Ke.map(({value:h,label:S})=>t(k.Option,{value:h,children:S},h))})})}),R(V,{span:"24",children:[t(q,{name:"icon-info-circle-filled",css:le({fontSize:g.iconSize,marginRight:g.margin.xs,color:g.color.primary},"","")}),t(He,{css:le({color:g.color.primary,fontWeight:g.fontWeight.bold},"",""),children:o.detail_information})]}),t(V,{span:"8",children:t(F.Item,{name:"supplyCode",label:o.supply_code,rules:[{required:!0}],children:t(z,{placeholder:o.supply_code})})}),t(V,{span:"8",children:t(F.Item,{name:"name",label:o.supply_name,rules:[{required:!0}],children:t(z,{placeholder:o.supply_name})})}),t(V,{span:"8",children:t(F.Item,{name:"measure",label:o.measure_unit,rules:[{required:!0}],children:t(z,{placeholder:o.measure_unit})})}),t(V,{span:"8",children:t(F.Item,{name:"dateOfImportingToWarehouse",label:o.date_of_importing_to_warehouse,rules:[{required:!0}],children:t(Se,{fluid:!0,format:"DD/MM/YYYY",placeholder:"DD/MM/YYYY"})})}),t(V,{span:"8",children:t(F.Item,{name:"quotation",label:o.quotation,rules:[{required:!0}],children:t(we,{min:"0",max:Number.MAX_SAFE_INTEGER,placeholder:o.quotation})})}),t(V,{span:"8",children:t(F.Item,{name:"amount",label:o.in_stock,rules:[{required:!0}],children:t(we,{disabled:i.includes("amount"),min:"0",max:Number.MAX_SAFE_INTEGER,placeholder:o.in_stock})})}),t(V,{span:"24",children:t(F.Item,{name:"partner",label:o.partner,children:t(k,{allowClear:!0,showSearch:!0,onSearch:n,dropdownRender:h=>r?t("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:t(tt,{})}):h,fluid:!0,placeholder:o.partner,optionFilterProp:"children",getPopupContainer:h=>h.parentNode,filterOption:(h,S)=>$(S.children).indexOf($(h))>=0,children:s.map(({id:h,name:S})=>t(k.Option,{value:h,children:S},h))})})}),t(V,{span:"24",children:t(F.Item,{name:"note",label:o.note,children:t(z.TextArea,{placeholder:o.note,rows:"3"})})}),R(V,{span:"24",children:[t(F.Item,{name:"entryDocument",label:o.entry_document,children:t(ht,{multiple:!0,maxCount:"10",css:ba,limitSizeFile:Ct,onPreview:d,isUploadAllFile:!0,fileList:c,onChange:u,showUploadList:!1,children:t(ce,{icon:t(q,{name:"icon-attachment-outlined",css:le({fontsize:g.iconSize},"","")}),type:"primary",ghost:!0,block:!0,size:"default",children:o.attachments})})}),c==null?void 0:c.map(h=>t(We,{file:h,handlePreviewAttachment:d,handleRemoveFile:m})),R("i",{css:le({fontSize:g.fontSize.sm,color:g.labelColor},"",""),children:["* ",o.file_format]})]})]})};Ae.propTypes={listManagerUnit:M.arrayOf(M.any),listStaff:M.arrayOf(M.any),listPartner:M.arrayOf(M.any),loadingPartner:M.bool,handleSearchPartner:M.func,disabledComponent:M.arrayOf(M.string),handlePreviewAttachment:M.func,fileList:M.arrayOf(M.any),handleChange:M.func,handleRemoveFile:M.func,handleSelectStaff:M.func};Ae.defaultProps={listManagerUnit:[],listStaff:[],listPartner:[],loadingPartner:!1,handleSearchPartner:()=>{},disabledComponent:[],handlePreviewAttachment:()=>{},fileList:[],handleChange:()=>{},handleRemoveFile:()=>{},handleSelectStaff:()=>{}};const Ca=async(e,a,r)=>{const{supplyCode:s,status:n,inventoryStatus:i,locationType:d,supplyLocation:c,supplyType:u,supplyCategory:m,supplySpecification:l,origin:g,expiryDate:h,quotation:S,amount:f,staffInCharge:p,staffId:y}=a;try{const I={departmentId:a.managerUnit??null,employeeId:y??null,employeeName:p??null,limit:S??null,measureUnit:a.measure??null,name:a.name??null,note:a.note??null,partnerId:a.partner??null,warehousingAmount:f??null,warehousingDate:a.dateOfImportingToWarehouse??null,supplyCode:s??null,status:n??null,inventoryStatus:i??null,locationType:d??null,supplyLocation:c??null,supplyType:u??null,supplyCategory:m??null,supplySpecification:l??null,origin:g??null,expiryDate:h?H(h).startOf("day").toISOString():null,entryDocument:r??null},{code:E,codeLanguage:b}=await Qt(e,I);return{code:E,codeLanguage:b}}catch({code:I,codeLanguage:E}){return{code:I,codeLanguage:E}}},Ea=()=>{const{idBuilding:e,hideModalAddSupplies:a,setFilter:r,setTablePagination:s,formFilter:n}=w.useContext(W),{changeDataTable:i}=re(),[d]=F.useForm(),[c,u]=w.useState({isFetching:!1,records:[]}),[m,l]=w.useState({isFetching:!1,records:[]}),[g,h]=w.useState({isFetching:!1,records:[]}),[S,f]=w.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[p,y]=w.useState([]),I=({file:v,fileList:P})=>{let D=P;v.status==="removed"&&(D=P),(v.status==="done"||v.status==="uploading")&&(D=P),v.status||(D=P.filter(A=>A.uid!==v.uid)),y(D.filter(A=>["done","uploading"].includes(A.status)))};ne(S.code,S.codeLanguage,{message:o.success,description:o.add_data_success},()=>{a()});const E=v=>{var P,D,A,te;(D=(P=v==null?void 0:v.response)==null?void 0:P.data)!=null&&D.url?Ee.open({url:(te=(A=v==null?void 0:v.response)==null?void 0:A.data)==null?void 0:te.url}):v!=null&&v.url&&Ee.open(v!=null&&v.url?{url:v==null?void 0:v.url}:"")},b=async v=>{u({...c,isFetching:!0});const{data:P}=await ke({filter:{name:v},idBuilding:e,limit:Y,page:O});u({records:P,isFetching:!1})},x=async v=>{h({...g,isFetching:!0});const{data:P}=await Ie({filter:{name:v},idBuilding:e,limit:Y,page:O});h({records:P,isFetching:!1})},T=()=>{(async()=>{var P;if(await d.validateFields()){const D=d.getFieldsValue(),A=d.getFieldValue("entryDocument");let te=[];p!=null&&p.length?te=(p==null?void 0:p.map(C=>{var U,N;return((N=(U=C==null?void 0:C.response)==null?void 0:U.data)==null?void 0:N.url)??(C==null?void 0:C.url)}))??[]:te=((P=A==null?void 0:A.map(C=>(C==null?void 0:C.url)??null))==null?void 0:P.filter(Boolean))??[],f({isFetching:!0,code:void 0,codeLanguage:void 0});const{code:pe,codeLanguage:_}=await Ca(e,D,te);f({isFetching:!1,code:pe,codeLanguage:_}),xe.includes(pe)&&(r({...oe}),n.resetFields(),s({limit:Y,current:O}),await i({filter:{...oe},page:O,limit:Y}))}})()},X=()=>{a()};w.useEffect(()=>{(async()=>{l({isFetching:!0,records:[]});const[v,,]=await Promise.all([Ye(e),b(""),x("")]);l({isFetching:!1,records:v.data})})()},[]);const ee=async(v,P)=>{const{amount:D,quotation:A}=P;(A||D)&&(D>=A&&d.setFieldsValue({inventoryStatus:Ce}),D<A&&d.setFieldsValue({inventoryStatus:Ze}),(A===null||D===null)&&d.setFieldsValue({inventoryStatus:void 0})),A===0&&D===0&&d.setFieldsValue({inventoryStatus:Ce})},ie={name:void 0,amount:void 0,measure:void 0,quotation:void 0,managerUnit:void 0,staffInCharge:void 0,partner:void 0,dateOfImportingToWarehouse:void 0,supplyCode:void 0,status:void 0,inventoryStatus:void 0,locationType:void 0,supplyLocation:void 0,supplyType:void 0,supplyCategory:void 0,supplySpecification:void 0,origin:void 0,expiryDate:void 0,entryDocument:void 0,note:void 0},se=v=>{const P=p.filter(D=>D.uid!==v);y(P)},ue=v=>{d.setFieldsValue({staffInCharge:v==null?void 0:v.value,staffId:v==null?void 0:v.key})};return{formAddSupplies:d,initialValues:ie,handleAddSupplies:T,handleCancelAddSupplies:X,handleSearchPartner:b,listManagerUnit:m.records,listPartner:c.records,listStaff:g.records,loadingPartner:c.isFetching,loading:S==null?void 0:S.isFetching,handlePreviewAttachment:E,fileList:p,handleChange:I,handleRemoveFile:se,onValuesChange:ee,handleSelectStaff:ue}},Pa=()=>{const{loading:e,formAddSupplies:a,handleAddSupplies:r,handleCancelAddSupplies:s,initialValues:n,handleSearchPartner:i,listManagerUnit:d,listPartner:c,listStaff:u,loadingPartner:m,handlePreviewAttachment:l,fileList:g,handleChange:h,handleRemoveFile:S,onValuesChange:f,handleSelectStaff:p}=Ea();return t(de,{title:o.add_supplies,open:!0,okText:o.add,cancelText:o.cancel,onOk:r,onCancel:s,okButtonProps:{disabled:e,loading:e},width:"75%",children:t(F,{onValuesChange:f,layout:"vertical",initialValues:n,form:a,name:"formAddSupplies",children:t(Ae,{handleSearchPartner:i,listManagerUnit:d,listPartner:c,listStaff:u,loadingPartner:m,handlePreviewAttachment:l,fileList:g,handleChange:h,handleRemoveFile:S,handleSelectStaff:p})})})},Da=async(e,a,r)=>{const{supplyCode:s,status:n,inventoryStatus:i,locationType:d,supplyLocation:c,supplyType:u,supplyCategory:m,supplySpecification:l,origin:g,expiryDate:h,entryDocumentFiles:S,warehouseInboundCode:f,staffInCharge:p,staffId:y}=r;try{const I={departmentId:r.managerUnit??null,employeeId:y??null,employeeName:p??null,limit:r.quotation??null,measureUnit:r.measure??null,name:r.name??null,note:r.note??null,partnerId:r.partner??null,warehousingAmount:r.amount??null,warehousingDate:r.dateOfImportingToWarehouse??null,supplyCode:s??null,status:n??null,inventoryStatus:i??null,locationType:d??null,supplyLocation:c??null,supplyType:u??null,supplyCategory:m??null,supplySpecification:l??null,origin:g??null,expiryDate:h?H(h).startOf("day").toISOString():null,entryDocument:S??null,warehouseInboundCode:f??null},{code:E,codeLanguage:b}=await Kt(e,a,{...I});return{code:E,codeLanguage:b}}catch({code:I,codeLanguage:E}){return{code:I,codeLanguage:E}}},La=()=>{var pe;const{idBuilding:e,hideModalUpdateSupplies:a,tablePagination:r,filter:s,modalUpdateSupplies:n,setFilter:i,setTablePagination:d,formFilter:c}=w.useContext(W),{changeDataTable:u}=re(),[m]=F.useForm(),{data:l}=n,[g,h]=w.useState({isFetching:!1,records:[]}),[S,f]=w.useState({isFetching:!1,records:[]}),[p,y]=w.useState({isFetching:!1,records:[]}),[I,E]=w.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[b,x]=w.useState(!1),[T,X]=w.useState(((pe=l==null?void 0:l.entryDocument)==null?void 0:pe.map(_=>({url:_,status:"done",name:_,isUploaded:!0})))??[]),ee=({file:_,fileList:C})=>{let U=C;_.status==="removed"&&(U=C),(_.status==="done"||_.status==="uploading")&&(U=C),_.status||(U=C.filter(N=>N.uid!==_.uid)),X(U.filter(N=>["done","uploading"].includes(N.status)))};ne(I.code,I.codeLanguage,{message:o.success,description:o.update_data_success},()=>{a()});const ie=_=>{var C,U,N,K;(U=(C=_==null?void 0:_.response)==null?void 0:C.data)!=null&&U.url?Ee.open({url:(K=(N=_==null?void 0:_.response)==null?void 0:N.data)==null?void 0:K.url}):_!=null&&_.url&&Ee.open(_!=null&&_.url?{url:_==null?void 0:_.url}:"")},se=_=>{(async()=>{h({...g,isFetching:!0});const{data:C}=await ke({filter:{name:_},idBuilding:e,limit:Y,page:O});h({records:C,isFetching:!1})})()},ue=_=>{(async()=>{y({...p,isFetching:!0});const{data:C}=await Ie({filter:{name:_},idBuilding:e,limit:Y,page:O});y({records:C,isFetching:!1})})()},v=()=>{(async()=>{var C;if(await m.validateFields()){const U=m.getFieldsValue(),N=m.getFieldValue("entryDocument");let K=[];T!=null&&T.length?K=(T==null?void 0:T.map(B=>{var _e,Te;return((Te=(_e=B==null?void 0:B.response)==null?void 0:_e.data)==null?void 0:Te.url)??(B==null?void 0:B.url)}))??[]:K=((C=N==null?void 0:N.map(B=>(B==null?void 0:B.url)??null))==null?void 0:C.filter(Boolean))??[],E({isFetching:!0,code:void 0,codeLanguage:void 0});const{code:me,codeLanguage:L}=await Da(e,l.id,{...U,amount:l.amount,entryDocumentFiles:K});E({isFetching:!1,code:me,codeLanguage:L}),xe.includes(me)&&(i({...oe}),c.resetFields(),d({limit:Y,current:O}),await u({filter:{...s},page:r.current,limit:r.limit}))}})()},P=()=>{a()};w.useEffect(()=>{(async()=>{var C,U,N,K,me,L;x(!0),f({isFetching:!0,records:[]});const[_,,]=await Promise.all([Ye(e),se(""),ue("")]);m.setFieldsValue({name:l.name,amount:l.amount,measure:l.measure,quotation:l.quotation,managerUnit:l.managerUnit.id,staffInCharge:(C=l==null?void 0:l.staffInCharge)==null?void 0:C.name,staffId:(U=l==null?void 0:l.staffInCharge)==null?void 0:U.id,partner:(N=l==null?void 0:l.partner)==null?void 0:N.id,dateOfImportingToWarehouse:l.dateOfImportingToWarehouse?H(l.dateOfImportingToWarehouse):void 0,supplyCode:l.supplyCode,status:((K=l==null?void 0:l.status)==null?void 0:K.value)??(l==null?void 0:l.status),inventoryStatus:((me=l==null?void 0:l.inventoryStatus)==null?void 0:me.value)??(l==null?void 0:l.inventoryStatus),locationType:l.locationType,supplyLocation:l.supplyLocation,supplyType:l.supplyType,supplyCategory:l.supplyCategory,supplySpecification:l.supplySpecification,origin:l.origin,expiryDate:l.expiryDate?H(l.expiryDate):void 0,entryDocument:(L=l==null?void 0:l.entryDocument)==null?void 0:L.map(B=>({url:B,status:"done",name:B})),note:l.note,warehouseInboundCode:l.warehouseInboundCode}),f({isFetching:!1,records:_.data}),x(!1)})()},[]);const D=_=>{const C=T.filter(U=>U.uid!==_);X(C)},A=(_,C)=>{(async()=>{const{amount:U,quotation:N}=C;(N||U)&&(U>=N&&m.setFieldsValue({inventoryStatus:Ce}),U<N&&m.setFieldsValue({inventoryStatus:Ze}),(N===null||U===null)&&m.setFieldsValue({inventoryStatus:void 0})),N===0&&U===0&&m.setFieldsValue({inventoryStatus:Ce})})()},te=_=>{m.setFieldsValue({staffInCharge:_==null?void 0:_.value,staffId:_==null?void 0:_.key})};return{formUpdateSupplies:m,handleUpdateSupplies:v,handleCancelUpdateSupplies:P,handleSearchPartner:se,listManagerUnit:S.records,listPartner:g.records,listStaff:p.records,loadingPartner:g.isFetching,loading:I.isFetching,loadingView:b,handlePreviewAttachment:ie,fileList:T,handleChange:ee,handleRemoveFile:D,onValuesChange:A,handleSelectStaff:te}},Aa=()=>{const{loading:e,formUpdateSupplies:a,handleUpdateSupplies:r,handleCancelUpdateSupplies:s,handleSearchPartner:n,listManagerUnit:i,listPartner:d,listStaff:c,loadingPartner:u,loadingView:m,handlePreviewAttachment:l,fileList:g,handleChange:h,handleRemoveFile:S,onValuesChange:f,handleSelectStaff:p}=La();return t(de,{title:o.update_supplies,visible:!0,okText:o.update,cancelText:o.cancel,onOk:r,onCancel:s,okButtonProps:{disabled:e,loading:e},width:"75%",children:R(F,{onValuesChange:f,layout:"vertical",form:a,name:"formUpdateSupplies",children:[m?t(yt,{isLoading:!0}):null,t(Ae,{handleSearchPartner:n,listManagerUnit:i,listPartner:d,listStaff:c,loadingPartner:u,disabledComponent:["amount"],handlePreviewAttachment:l,fileList:g,handleChange:h,handleRemoveFile:S,handleSelectStaff:p})]})})},Oa=async(e,a)=>{var r;try{const{code:s,codeLanguage:n,data:i}=await oa(e,a);return{code:s,codeLanguage:n,totalSuccess:(i==null?void 0:i.success)??0,totalFailed:((i==null?void 0:i.errors)??[]).length,errors:((r=i==null?void 0:i.errors)==null?void 0:r.map(d=>({index:d.index,message:d.message,code:d.code})))??[],data:i}}catch({code:s,codeLanguage:n}){return{code:s,codeLanguage:n,totalSuccess:0,totalFailed:0,errors:[],data:void 0}}},{rules:Ua}=Le,{dateImportRule:Ma}=Ua,Ra=[{name:"#",rules:{type:"number",required:!0}},{name:"Mã vật tư",rules:{type:"string",required:!0,max:50}},{name:"Tên vật tư",rules:{type:"string",required:!0,max:100}},{name:"Trạng thái vật tư",rules:{type:"enum",required:!0,enum:["Sử dụng","Ngưng sử dụng"]}},{name:"Nhà cung cấp",rules:{type:"string",max:50}},{name:"Đơn vị quản lý",rules:{type:"string",max:50,required:!0}},{name:"Nhân viên phụ trách",rules:{type:"string",max:50,required:!0}},{name:"Tồn kho",rules:{type:"number",max:Number.MAX_SAFE_INTEGER,required:!0}},{name:"Định mức sử dụng",rules:{type:"number",max:Number.MAX_SAFE_INTEGER,required:!0}},{name:"Đơn vị",rules:{type:"string",max:50,required:!0}},{name:"Ngày nhập kho",rules:{...Ma,required:!0}},{name:"Ghi chú",rules:{type:"string",max:3e3}}],Na=()=>{const{idBuilding:e,hideModalImportSupplies:a,setFilter:r,setTablePagination:s,formFilter:n}=w.useContext(W),{changeDataTable:i}=re(),[d,c]=w.useState({isFetching:!1,code:void 0,codeLanguage:void 0,totalSuccess:0,totalFailed:0,errors:[],data:[]});return ne(d.code,d.codeLanguage,{message:o.success,description:o.import_data_success}),[Ra,d,async l=>{c({isFetching:!0,code:void 0,codeLanguage:void 0,totalSuccess:0,totalFailed:0,errors:[],data:[]});const{code:g,codeLanguage:h,totalSuccess:S,totalFailed:f,errors:p,data:y}=await Oa(e,l);S!==0&&(r({...oe}),n.resetFields(),s({current:O,limit:Y}),await i({filter:{...oe},page:O,limit:Y})),c({isFetching:!1,code:g,codeLanguage:h,totalSuccess:S,totalFailed:f,errors:p,data:y})},()=>a()]},ka=()=>{var n;const[e,a,r,s]=Na();return t(Le,{headers:e,onClose:s,onOk:r,visible:!0,fileNameTemplate:"mau-thong-tin-vat-tu",templateUrl:wt.document.mau_thong_tin_vat_tu,code:a.code,codeLanguage:a.codeLanguage,loading:a.isFetching,numberSuccess:(a==null?void 0:a.totalSuccess)??0,numberFail:(a==null?void 0:a.totalFailed)??0,problemResponseServerDataSource:(a==null?void 0:a.errors)??[],errorFile:((n=a==null?void 0:a.data)==null?void 0:n.data)??null})},Ya=async(e,a,r)=>{var s,n;try{const{billNo:i,amount:d,note:c,totalPayment:u,dateOfImportToWarehouse:m,warehouseInboundCode:l}=r,g={amount:d??null,billNo:i??null,note:c??null,price:u??null,type:Et??null,warehouseInboundCode:l??null,dateOfImportToWarehouse:m?(n=(s=H(m))==null?void 0:s.startOf("day"))==null?void 0:n.toISOString():null},{code:h,codeLanguage:S}=await nt(e,a,g);return{code:h,codeLanguage:S}}catch({code:i,codeLanguage:d}){return{code:i,codeLanguage:d}}},Va=()=>{const{idBuilding:e,hideModalImportSuppliesToWarehouse:a,modalImportSuppliesToWarehouse:r,filter:s,tablePagination:n}=w.useContext(W),{changeDataTable:i}=re(),{data:d}=r,[c]=F.useForm(),[u,m]=w.useState({isFetching:!1,code:void 0,codeLanguage:void 0});ne(u.code,u.codeLanguage,{message:o.success,description:o.add_data_success});const l=async()=>{if(await c.validateFields()){const f=c.getFieldsValue();m({isFetching:!0,code:void 0,codeLanguage:void 0});const{code:p,codeLanguage:y}=await Ya(e,d.id,f);xe.includes(p)&&await i({filter:{...s},page:n.current,limit:n.limit}),m({isFetching:!1,code:p,codeLanguage:y}),a()}},g=()=>a(),h={amount:void 0,totalPayment:void 0,billNo:void 0,note:void 0,dateOfImportToWarehouse:void 0};return[u.isFetching,c,l,g,h]},Wa=()=>{const[e,a,r,s,n]=Va();return t(de,{visible:!0,onOk:r,onCancel:s,okText:o.confirm,cancelText:o.cancel,title:o.import_supplies_to_warehouse,okButtonProps:{disabled:e,loading:e},children:R(F,{layout:"vertical",initialValues:n,form:a,name:"formImport",children:[t(F.Item,{name:"amount",label:o.amount,rules:[{required:!0}],children:t(we,{min:"0",max:Number.MAX_SAFE_INTEGER,placeholder:o.amount})}),t(F.Item,{name:"totalPayment",label:o.total_money,children:t(we,{min:"0",max:Number.MAX_SAFE_INTEGER,formatter:i=>vt(i),placeholder:o.total_money})}),t(F.Item,{name:"billNo",label:o.bill_code,children:t(z,{placeholder:o.bill_code})}),t(F.Item,{name:"dateOfImportToWarehouse",label:o.date_of_importing_to_warehouse,rules:[{required:!0}],children:t(Se,{fluid:!0,format:"DD/MM/YYYY",placeholder:"DD/MM/YYYY"})}),t(F.Item,{name:"warehouseInboundCode",label:o.label.register_code,rules:[{required:!0}],children:t(z,{placeholder:o.label.register_code})}),t(F.Item,{name:"note",label:o.note,children:t(z.TextArea,{placeholder:o.note})})]})})},Ba=async(e,a,r)=>{var s,n;try{const{amount:i,note:d,dateOfExportToWarehouse:c,warehouseInboundCode:u,receiverId:m}=r,l={amount:i??null,note:d??null,type:Pt??null,dateOfExportToWarehouse:c?(n=(s=H(c))==null?void 0:s.startOf("day"))==null?void 0:n.toISOString():null,warehouseInboundCode:u??null,receiverId:m??null},{code:g,codeLanguage:h}=await nt(e,a,l);return{code:g,codeLanguage:h}}catch({code:i,codeLanguage:d}){return{code:i,codeLanguage:d}}},qa=()=>{const{idBuilding:e,hideModalExportSuppliesToWarehouse:a,modalExportSuppliesToWarehouse:r,filter:s,tablePagination:n}=w.useContext(W),{data:i}=r,{changeDataTable:d}=re(),[c]=F.useForm(),[u,m]=w.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[l,g]=w.useState({isFetching:!1,records:[]});w.useEffect(()=>{(async()=>{g({isFetching:!0,records:[]});const{data:p}=await Ie({filter:{name:void 0},idBuilding:e,limit:Y,page:O});g({isFetching:!1,records:p})})()},[]),ne(u.code,u.codeLanguage,{message:o.success,description:o.add_data_success});const h=async()=>{if(await c.validateFields()){const{amount:y}=i,I=c.getFieldsValue();if((I==null?void 0:I.amount)>y){at.error({message:o.label.error,description:o.the_quantity_shipped_must_be_less_than_or_equal_to_the_quantity_in_stock});return}m({isFetching:!0,code:void 0,codeLanguage:void 0});const{code:E,codeLanguage:b}=await Ba(e,i.id,I);xe.includes(E)&&await d({filter:{...s},page:n.current,limit:n.limit}),m({isFetching:!1,code:E,codeLanguage:b}),a()}},S=()=>a(),f={amount:void 0,note:void 0,dateOfExportToWarehouse:void 0};return[u.isFetching,c,h,S,f,l]},Ha=()=>{var d;const[e,a,r,s,n,i]=qa();return t(de,{open:!0,onOk:r,onCancel:s,okText:o.confirm,cancelText:o.cancel,title:o.export_supplies_to_warehouse,okButtonProps:{disabled:e,loading:e},children:R(F,{layout:"vertical",initialValues:n,form:a,name:"formExport",children:[t(F.Item,{name:"amount",label:o.amount,rules:[{required:!0}],children:t(we,{min:"0",max:Number.MAX_SAFE_INTEGER,placeholder:o.amount})}),t(F.Item,{name:"dateOfExportToWarehouse",label:o.date_of_exporting_to_warehouse,rules:[{required:!0}],children:t(Se,{fluid:!0,format:"DD/MM/YYYY",placeholder:"DD/MM/YYYY"})}),t(F.Item,{name:"receiverId",label:o.receiver,rules:[{required:!0}],children:t(k,{fluid:!0,placeholder:o.receiver,optionFilterProp:"children",getPopupContainer:c=>c.parentNode,showSearch:!0,filterOption:(c,u)=>$(u.children).indexOf($(c))>=0,allowClear:!0,children:(d=i==null?void 0:i.records)==null?void 0:d.map(({id:c,name:u})=>t(k.Option,{value:c,children:u},c))})}),t(F.Item,{name:"warehouseInboundCode",label:o.label.register_code,rules:[{required:!0}],children:t(z,{placeholder:o.label.register_code})}),t(F.Item,{name:"note",label:o.note,children:t(z.TextArea,{placeholder:o.note})})]})})},ge=w.createContext({idBuilding:0,filter:{...De},setFilter:()=>{},tableData:{records:[],totalRecord:0},setTableData:()=>{},tablePagination:{current:O,limit:Y},setTablePagination:()=>{},getListHistoryUsage:{isFetching:!1},setGetListHistoryUsage:()=>{},formExportHistoryUsage:void 0,showFormExportHistoryUsage:()=>{},hideFormExportHistoryUsage:()=>{},isShowActionExport:!1}),Be=({children:e})=>{const{getPermissionByModuleCode:a}=ze(),{idBuilding:r}=et(),[s,n]=w.useState({isFetching:!1}),[i,d]=w.useState({...De}),[c,u]=w.useState({records:[],totalRecord:0}),[m,l]=w.useState({current:O,limit:Y}),[g,h,S]=ae(),f=a(Xe),p=(f==null?void 0:f[je])??!1,y={idBuilding:r,filter:i,setFilter:d,tableData:c,setTableData:u,tablePagination:m,setTablePagination:l,getListHistoryUsage:s,setGetListHistoryUsage:n,formExportHistoryUsage:g,showFormExportHistoryUsage:h,hideFormExportHistoryUsage:S,isShowActionExport:p};return t(ge.Provider,{value:y,children:e})};Be.propTypes={children:M.node};Be.defaultProps={children:t("div",{})};const $a=e=>{var a,r,s,n,i,d,c,u,m,l,g,h,S,f;return{id:e==null?void 0:e.id,key:e==null?void 0:e.id,action:((a=Dt[e==null?void 0:e.action])==null?void 0:a.label)??"",actionAt:e!=null&&e.actionDate?H(e==null?void 0:e.actionDate).format("DD/MM/YYYY"):"",supplies:((r=e==null?void 0:e.currentData)==null?void 0:r.name)??"",actionBy:((s=e==null?void 0:e.employee)==null?void 0:s.fullName)??"",amount:((n=e==null?void 0:e.additionalData)==null?void 0:n.amount)??"",totalPayment:((i=e==null?void 0:e.additionalData)==null?void 0:i.price)??"",billNo:((d=e==null?void 0:e.additionalData)==null?void 0:d.billNo)??"",note:((c=e==null?void 0:e.additionalData)==null?void 0:c.note)??"",dateOfImportToWarehouse:(u=e==null?void 0:e.additionalData)!=null&&u.dateOfImportToWarehouse?H((m=e==null?void 0:e.additionalData)==null?void 0:m.dateOfImportToWarehouse).format("DD/MM/YYYY"):"",dateOfExportToWarehouse:(l=e==null?void 0:e.additionalData)!=null&&l.dateOfExportToWarehouse?H((g=e==null?void 0:e.additionalData)==null?void 0:g.dateOfExportToWarehouse).format("DD/MM/YYYY"):"",warehouseInboundCode:((h=e==null?void 0:e.additionalData)==null?void 0:h.warehouseInboundCode)??"",receiver:((f=(S=e==null?void 0:e.additionalData)==null?void 0:S.receiver)==null?void 0:f.name)??""}},rt=async({idBuilding:e,filter:a,page:r,limit:s})=>{try{const{supplies:n,billNo:i,actionBy:d,action:c,actionAt:u,suppliesId:m}=a,l={action:c||void 0,billNo:i||void 0,supplyName:n||void 0,userId:d||void 0,from:u!=null&&u[0]?H(u[0]).startOf("day").toISOString():void 0,to:u!=null&&u[1]?H(u[1]).endOf("day").toISOString():void 0,supplyId:m||void 0},{code:g,codeLanguage:h,data:S,totalRecord:f}=await ea({filter:l,idBuilding:e,limit:s,page:r});return{code:g,codeLanguage:h,data:S.map(p=>$a(p)),totalRecord:f}}catch({code:n,codeLanguage:i}){return{code:n,codeLanguage:i,data:[],totalRecord:0}}},qe=()=>{const{setTableData:e,idBuilding:a,setGetListHistoryUsage:r}=w.useContext(ge),{modalViewHistoryUsage:s}=w.useContext(W),{data:n}=s;return{changeDataTable:async({filter:d,page:c,limit:u})=>{r({isFetching:!0});const m=await rt({filter:{...d,suppliesId:n==null?void 0:n.id},idBuilding:a,limit:u,page:c});e({records:m.data,totalRecord:m.totalRecord}),r({isFetching:!1})}}},Ga=()=>{const{idBuilding:e,setFilter:a,setTablePagination:r}=w.useContext(ge),{changeDataTable:s}=qe(),[n,i]=w.useState({isFetching:!1,records:[]}),d=async u=>{a(u),r({current:O,limit:Y}),await s({filter:{...u},page:O,limit:Y})},c=async u=>{i({...n,isFetching:!0});const{data:m}=await Ie({filter:{name:u},idBuilding:e,limit:Y,page:O});i({isFetching:!1,records:m})};return w.useEffect(()=>{(async()=>await c(""))()},[]),[n.isFetching,n.records,d,c]},za=()=>{const[e,a,r,s]=Ga(),n=w.useMemo(()=>[{label:o.supply_name,key:"supplies",component:t(z,{placeholder:o.supply_name}),visible:!0},{label:o.action_by,key:"actionBy",component:t(k,{allowClear:!0,showSearch:!0,onSearch:s,filterOption:!1,loading:e,dropdownRender:i=>e?t("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:t(tt,{})}):i,fluid:!0,placeholder:o.all_staff,children:a==null?void 0:a.map(({userId:i,name:d})=>t(k.Option,{value:i,children:d},i))}),visible:!0},{label:o.action,key:"action",component:R(k,{fluid:!0,children:[t(k.Option,{value:"",children:o.all_action},"action_0"),Lt.map(({value:i,label:d})=>t(k.Option,{value:i,children:d},i))]}),visible:!0},{label:o.bill_code,key:"billNo",component:t(z,{placeholder:o.bill_code}),visible:!0},{label:o.action_at,key:"actionAt",component:t(Se.RangePicker,{format:["DD/MM/YYYY","DD/MM/YYYY"],placeholder:["DD/MM/YYYY","DD/MM/YYYY"]}),visible:!0}],[a]);return t(gt,{initialValues:De,filters:n,onSearch:r,visibleFilterBox:!0})},Xa=()=>{const{layoutScrollRef:e}=w.useContext(Me),{tablePagination:a,setTablePagination:r,getListHistoryUsage:s,filter:n,tableData:i}=w.useContext(ge),{changeDataTable:d}=qe(),{modalViewHistoryUsage:c}=w.useContext(W),{data:u}=c,m=ve(),l=async(f,p)=>{let{limit:y,current:I}=a;I!==f?I=f:y!==p&&(I=O,y=p),r({limit:y,current:I}),await d({filter:{...n,suppliesId:u==null?void 0:u.id},page:I,limit:y})},g=i.records,h={current:a.current,pageSize:a.limit,total:i.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:l},S={offsetScroll:m.offsetScrollX,getContainer:()=>e.current};return[s.isFetching,g,h,S]};function ja(){const[e,a,r,s]=Xa(),n=[{title:o.supply_name,key:"supplies",dataIndex:"supplies",fixed:"left",width:170,render:(i,d)=>{const c=i;return(c==null?void 0:c.length)>20?t(Ue,{title:c,placement:"topLeft",children:t("div",{style:{width:"170px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:c})}):t("div",{style:{width:"170px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:c})}},{title:o.label.register_code,key:"warehouseInboundCode",dataIndex:"warehouseInboundCode",fixed:"left",width:150},{title:o.receiver,key:"receiver",dataIndex:"receiver",fixed:"left",width:150},{title:o.action_by,key:"actionBy",dataIndex:"actionBy",width:150},{title:o.action,key:"action",dataIndex:"action",width:120},{title:o.quantity,key:"amount",dataIndex:"amount",width:100},{title:o.total_money,key:"totalPayment",dataIndex:"totalPayment",width:120},{title:o.bill_code,key:"billNo",dataIndex:"billNo",width:150},{title:o.action_at,key:"actionAt",dataIndex:"actionAt",width:150},{title:o.date_of_importing_to_warehouse,key:"dateOfImportToWarehouse",dataIndex:"dateOfImportToWarehouse",width:150},{title:o.date_of_exporting_to_warehouse,key:"dateOfExportToWarehouse",dataIndex:"dateOfExportToWarehouse",width:150},{title:o.note,key:"note",dataIndex:"note",width:150,render:(i,d)=>{const c=i;return(c==null?void 0:c.length)>20?t(Ue,{title:c,placement:"topLeft",children:t("div",{style:{width:"150px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:c})}):t("div",{style:{width:"150px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:c})}}];return t(G.Table,{columns:n,dataSource:a,loading:e,pagination:r,scroll:{...scroll,x:n.reduce((i,d)=>i+d.width,0)},sticky:s})}const Ja=()=>{const{isShowActionExport:e,tableData:a,showFormExportHistoryUsage:r}=w.useContext(ge),s=()=>{r()};return{isShowActionExport:e,totalRecord:a.totalRecord,handleExportHistoryUsage:s}};function Qa(){const{isShowActionExport:e,loadingExport:a,totalRecord:r,handleExportHistoryUsage:s}=Ja(),n=[e?t(ce,{loading:a,type:"primary",ghost:!0,icon:t(q,{name:"icon-download-outlined"}),onClick:s,children:o.export},"exportHistoryUsage"):null];return t(G.ActionBox,{actions:n,total:r})}const Oe=100,Ka=()=>{const{idBuilding:e,tableData:a,filter:r,hideFormExportHistoryUsage:s}=w.useContext(ge),[n,i]=w.useState({isFetching:!1}),[d,c]=w.useState(0),u=async()=>{var f,p;i({isFetching:!0}),c(0);const m=[];let l=1;const g=a.totalRecord,h=Math.floor(g/Oe)+1;let S=0;for(await ra({idBuilding:e,filter:{...r,onlyLogging:!0}});l<=h;){const y=await rt({idBuilding:e,filter:r,limit:Oe,page:l});if(((f=y==null?void 0:y.data)==null?void 0:f.length)>0){const I=m.length;for(let b=0;b<((p=y==null?void 0:y.data)==null?void 0:p.length);b+=1){const x=y.data[b],T=[I+b+1];T.push((x==null?void 0:x.supplies)??""),T.push((x==null?void 0:x.warehouseInboundCode)??""),T.push((x==null?void 0:x.receiver)??""),T.push((x==null?void 0:x.actionBy)??""),T.push((x==null?void 0:x.action)??""),T.push((x==null?void 0:x.amount)??0),T.push((x==null?void 0:x.totalPayment)??0),T.push((x==null?void 0:x.billNo)??""),T.push((x==null?void 0:x.actionAt)??""),T.push((x==null?void 0:x.dateOfImportToWarehouse)??""),T.push((x==null?void 0:x.dateOfExportToWarehouse)??""),T.push((x==null?void 0:x.note)??""),m.push(T)}l+=1;const E=Oe/g*100;S+=E,c(Math.round(S))}else{l=0;break}}m.unshift(["#",o.supply_name,o.label.register_code,o.receiver,o.action_by,o.action,o.quantity,o.total_money,o.bill_code,o.action_at,o.date_of_importing_to_warehouse,o.date_of_exporting_to_warehouse,o.note]),kt(m,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8",o.history_usage_info,".xlsx"),i({isFetching:!1}),at.success({message:o.success,description:o.export_data_success}),s()};return w.useEffect(()=>{u()},[]),{isFetchingExport:n.isFetching,percent:d}},Za=()=>{const{isFetchingExport:e,percent:a}=Ka();return t(de,{open:!0,okText:o.export,cancelText:o.cancel,okButtonProps:{isFetchingExport:e,disabled:e},footer:null,closable:!1,children:t(Ot,{strokeColor:{from:"#108ee9",to:"#87d068"},percent:a,status:"active"})})},eo=()=>{const{tablePagination:e,formExportHistoryUsage:a}=w.useContext(ge),{hideModalViewHistoryUsage:r,modalViewHistoryUsage:s}=w.useContext(W),{data:n}=s,{changeDataTable:i}=qe();return w.useEffect(()=>{(async()=>await i({filter:{...De,suppliesId:n==null?void 0:n.id},page:e.current,limit:e.limit}))()},[]),[!(n!=null&&n.id),r,a.isShow]},to=()=>{const[e,a,r]=eo();return t(de,{width:"90%",visible:!0,title:o.history_usage,footer:!1,onCancel:a,children:R(G.Wrapper,{children:[e?t(za,{}):null,R(G.Container,{children:[t(G.Header,{children:e?t(Qa,{}):null}),t(G.Content,{children:t(ja,{})})]}),r?t(Za,{}):null]})})},ao=()=>t(Be,{children:t(to,{})}),oo=()=>{const{hideFormConfirmImportSupplies:e,showModalImportSupplies:a,showModalImportAvailableSupplies:r}=w.useContext(W);return{hideFormConfirmImportSupplies:e,handleImportAvailableSupplies:()=>{r(),e()},handleImportSupplies:()=>{a(),e()}}},no="/assets/images/illustrationUpload.png",ro=()=>{const{handleImportSupplies:e,handleImportAvailableSupplies:a,hideFormConfirmImportSupplies:r}=oo();return t(de,{footer:null,onCancel:r,width:"41%",open:!0,title:o.upload_supply,children:R(F,{layout:"vertical",name:"formConfirmImport",children:[t(he,{style:{justifyContent:"center",marginBottom:"20px"},children:t(Ut,{src:no,alt:"illustration upload image",preview:!1})}),t(he,{style:{marginBottom:"5px",padding:"0 30px"},children:t(be.Text,{strong:!0,children:o.upload_data_supplies})}),t(he,{style:{marginBottom:"40px",padding:"0 30px"},children:t(be.Text,{children:o.confirm_import})}),R(he,{style:{marginBottom:"30px",gap:"20px",padding:"0 30px",justifyContent:"space-between"},children:[t(ce,{type:"primary",onClick:e,style:{width:220},children:t(be.Text,{style:{textTransform:"uppercase",color:"white"},children:o.import_new_supplies})}),t(ce,{type:"primary",onClick:a,ghost:!0,style:{width:220},children:t(be.Text,{style:{textTransform:"uppercase"},children:o.import_available_supplies})})]})]})})},io=()=>{const{idBuilding:e,hideModalImportAvailableSupplies:a,setFilter:r,setTablePagination:s,formFilter:n}=w.useContext(W),{changeDataTable:i}=re(),{rules:d}=Le,{dateImportRule:c}=d,[u,m]=w.useState({isFetching:!1,code:void 0,codeLanguage:void 0,success:0,failed:0,errors:[],data:void 0});return ne(u.code,u.codeLanguage,{message:o.success,description:o.import_data_success}),{headers:[{name:"#",rules:{type:"number",required:!0}},{name:"Mã vật tư",rules:{type:"string",max:50}},{name:"Tên vật tư",rules:{type:"string",required:!0,max:100}},{name:"Trạng thái vật tư",rules:{type:"enum",required:!0,enum:["Sử dụng","Ngưng sử dụng"]}},{name:"Nhà cung cấp",rules:{type:"string",max:50}},{name:"Đơn vị quản lý",rules:{type:"string",max:50,required:!0}},{name:"Nhân viên phụ trách",rules:{type:"string",max:50,required:!0}},{name:"Định mức sử dụng",rules:{type:"number",max:Number.MAX_SAFE_INTEGER,required:!0}},{name:"Đơn vị",rules:{type:"string",max:50,required:!0}},{name:"Ghi chú",rules:{type:"string",max:3e3}},{name:"Mã hoá đơn mua",rules:{type:"string",max:50}},{name:"Ngày nhập kho",rules:c},{name:"Số lượng",rules:{type:"number",max:Number.MAX_SAFE_INTEGER}},{name:"Tổng tiền",rules:{type:"number",max:Number.MAX_SAFE_INTEGER}}],onDownloadTemplateFile:async()=>{const f=await ia({idBuilding:e}),p=(f==null?void 0:f.data)??"";Re(p,document,"mau-thong-tin-vat-tu-co-san.xlsx")},onOk:async f=>{var I,E,b,x;m({isFetching:!0,code:void 0,codeLanguage:void 0,success:0,failed:0,errors:[],data:void 0});const p=await na(e,f),y=((E=(I=p==null?void 0:p.data)==null?void 0:I.errors)==null?void 0:E.map(T=>({index:T==null?void 0:T.index,code:(T==null?void 0:T.code)??xt,message:T.message})))??[];p.success!==0&&(r({...oe}),n.resetFields(),s({current:O,limit:Y}),await i({filter:{...oe},page:O,limit:Y})),m({isFetching:!1,code:p.code,codeLanguage:p.codeLanguage,success:((b=p==null?void 0:p.data)==null?void 0:b.success)??0,failed:y.length,errors:y,data:((x=p==null?void 0:p.data)==null?void 0:x.data)??void 0})},onHide:async()=>{a()},importAvailableSuppliesState:u}},so=()=>{const{headers:e,onDownloadTemplateFile:a,onOk:r,onHide:s,importAvailableSuppliesState:n}=io();return t(Le,{headers:e,onClose:s,onOk:r,visible:!0,code:n==null?void 0:n.code,codeLanguage:n==null?void 0:n.codeLanguage,loading:n==null?void 0:n.isFetching,numberSuccess:n==null?void 0:n.success,numberFail:n==null?void 0:n.failed,problemResponseServerDataSource:n==null?void 0:n.errors,errorFile:n==null?void 0:n.data,onDownloadTemplateFile:a})},lo=async(e,a,r)=>{try{const{supplyCode:s,status:n,inventoryStatus:i,supplyName:d,departmentId:c}=a,u=r!=null&&r.firstDay?H(r.firstDay).startOf("day").toDate():void 0,m=r!=null&&r.lastDay?H(r.lastDay).endOf("day").toDate():void 0,l={from:u,to:m},g={supplyCode:s??null,status:n??null,inventoryStatus:i??"",supplyName:d??"",departmentId:c??null},{code:h,codeLanguage:S,data:f}=await aa(e,g,l);return{code:h,codeLanguage:S,data:f}}catch({code:s,codeLanguage:n}){return{code:s,codeLanguage:n,data:void 0}}},co=()=>{const{hideFormExportInventoryReport:e,idBuilding:a,filter:r}=w.useContext(W),[s]=F.useForm(),[n,i]=w.useState({isFetching:!1,code:void 0,codeLanguage:void 0});return ne(n.code,n.codeLanguage,{message:o.success,description:o.export_data_success}),{hideFormExportInventoryReport:e,handleExportInventoryReport:async()=>{if(await s.validateFields()){const u=s.getFieldsValue();i({isFetching:!0,code:void 0,codeLanguage:void 0});const m=await lo(a,r,u);m.data&&Re(m.data,document,"bao-cao-xuat-nhap-ton.xlsx"),i({isFetching:!1,code:m.code,codeLanguage:m.codeLanguage}),e()}},loadingExport:n.isFetching,formExportInventoryReport:s}},uo=()=>{const{hideFormExportInventoryReport:e,handleExportInventoryReport:a,loadingExport:r,formExportInventoryReport:s}=co(),n=ve();return t(de,{onOk:a,onCancel:e,width:"40%",open:!0,title:o.inventory_report,okText:o.export,okButtonProps:{disabled:r,loadingExport:r},children:t(F,{layout:"vertical",name:"formExportInventoryReport",form:s,children:R(he,{gutter:[n.margin.sm,0],children:[t(V,{span:"12",children:t(F.Item,{dependencies:["lastDay"],rules:[{required:!0},({getFieldValue:i})=>({validator(d,c){return c&&i("lastDay")&&H(c).isAfter(i("lastDay"))?Promise.reject(o.first_day_must_lower_or_equal_than_last_day):Promise.resolve()}})],label:o.first_day,name:"firstDay",children:t(Se,{fluid:"true",placeholder:"DD/MM/YYYY",format:"DD/MM/YYYY",allowClear:!1})})}),t(V,{span:"12",children:t(F.Item,{dependencies:["firstDay"],rules:[{required:!0},({getFieldValue:i})=>({validator(d,c){return c&&i("firstDay")&&H(c).isBefore(i("firstDay"))?Promise.reject(o.last_day_must_greater_or_equal_than_first_day):Promise.resolve()}})],label:o.last_day,name:"lastDay",children:t(Se,{fluid:"true",placeholder:"DD/MM/YYYY",format:"DD/MM/YYYY",allowClear:!1})})})]})})})},po=()=>{const{setTitlePage:e,setVisibleFilterBox:a,setVisibleSearchBox:r}=w.useContext(Me),{modalAddSupplies:s,modalUpdateSupplies:n,modalImportSupplies:i,modalImportAvailableSupplies:d,modalImportSuppliesToWarehouse:c,modalExportSuppliesToWarehouse:u,modalViewHistoryUsage:m,formConfirmImportSupplies:l,formExportInventoryReport:g,filter:h,tablePagination:S}=w.useContext(W),{changeDataTable:f}=re();return w.useEffect(()=>(e(o.supplies),r(!0),(async()=>await f({filter:{...h},page:S.current,limit:S.limit}))(),()=>{e(""),r(!1),a(!1)}),[]),[s.isShow,n.isShow,i.isShow,d.isShow,c.isShow,u.isShow,m.isShow,l.isShow,g.isShow]},mo=()=>{const[e,a,r,s,n,i,d,c,u]=po();return R(G.Wrapper,{children:[t(fa,{}),R(G.Container,{children:[t(G.Header,{children:t(ca,{})}),t(G.Content,{children:t(Ia,{})})]}),e?t(Pa,{}):null,a?t(Aa,{}):null,r?t(ka,{}):null,s?t(so,{}):null,d?t(ao,{}):null,n?t(Wa,{}):null,i?t(Ha,{}):null,c?t(ro,{}):null,u?t(uo,{}):null]})},or=()=>t(Yt,{children:t(mo,{})});export{or as default};
