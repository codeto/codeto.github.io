import{a as U,j as o,c as B,F as he}from"./@emotion-63839449.js";import{r as h}from"./react-4fd50329.js";import{I as j,l as c,g as z,L as H,b0 as Fe,ap as _e,at as Ee,K as X,h as oe,i as ie,A as se,M as ae,X as de,j as be,a1 as Ae,a as ke}from"./index-c2ded735.js";import"./lodash-88fe09e6.js";import"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import{a as re,e as Te,y as Me,P as ye}from"./index-b17d22e5.js";import{P as m}from"./prop-types-1172f4d5.js";import{b as V,B as Ne,a as Ue,R as fe,z as Oe,S as Be,E as K,G as $e}from"./antd-f9eae174.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{u as Ie}from"./react-router-a4308f7b.js";import{d as Ve,g as Re,a as Ge,u as ze}from"./department-807891d3.js";import{F as O,u as Y}from"./index-687ba9e6.js";import{I as G,S as Le}from"./index-43183512.js";import{e as J,p as He}from"./rules-c1d56c23.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./account-86ffff50.js";import"./index-881eef42.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";const Z="Admin",Pe="Admin",ee="REQUEST",te="COMMUNICATION",je=B(V,{target:"eu338194"})("border-right:1px solid ",e=>e.theme.borderColor,";position:relative;display:flex;flex-direction:column;padding-bottom:",e=>e.theme.padding.sm,"px;"),We=B("div",{target:"eu338193"})("padding:",e=>e.theme.padding.sm,"px ",e=>e.theme.padding.xs,"px;border-bottom:1px solid ",e=>e.theme.borderColor,";font-size:",e=>e.theme.heading.four,"px;display:flex;justify-content:space-between;align-items:center;background-color:#ffffff;z-index:1;"),qe=B("div",{target:"eu338192"})({name:"byw84t",styles:"flex:1 0 0;overflow:scroll"}),xe=B(Ne,{target:"eu338191"})({name:"d4o7tm",styles:"&:hover{svg g polygon{fill:#40a9ff;}span{color:#40a9ff!important;}}"}),Ye=B("div",{target:"eu338190"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),Q=({title:e,span:t,saveButton:n,isFetchingSave:s,onClickButton:r,children:a,disabled:d,employeePermissionWrite:l})=>U(je,{span:t,children:[U(We,{children:[o(Ye,{children:e}),n&&l?o(xe,{onClick:r,icon:o(j,{name:"icon-save-outlined"}),loading:s,disabled:d,type:"primary",ghost:!0,children:c.save}):null,!n&&l?o(xe,{type:"primary",ghost:!0,onClick:r,icon:o(j,{name:"icon-plus-outlined"}),children:c.add}):null]}),o(qe,{children:a})]});Q.propTypes={children:m.node,disabled:m.bool,isFetchingSave:m.bool,onClickButton:m.func,saveButton:m.bool,span:m.number,title:m.string,employeePermissionWrite:m.bool};Q.defaultProps={children:o("div",{}),disabled:!1,isFetchingSave:!1,onClickButton:()=>{},saveButton:!1,span:25,title:"",employeePermissionWrite:!1};const Qe=B("div",{target:"eqzv7e0"})({name:"ubdald",styles:"display:flex;justify-content:center;align-items:center;height:400px"}),Xe=B("div",{target:"e8h5gyk0"})(e=>{const t=`
      cursor: pointer;
      padding: ${e.theme.padding.sm}px ${e.theme.padding.xs}px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid ${e.theme.borderColor};
      font-size: ${e.theme.fontSize.md}px;
    `;return e.selected?`
        ${t}
        background-color: ${e.theme.backgroundContent};
        font-weight: ${e.theme.fontWeight.bold};
      `:t},";"),ce=({selected:e,title:t,disabledAction:n,data:s,onClick:r,onClickEdit:a,onClickDelete:d,employeePermissionWrite:l})=>{const u=()=>{r(s)},p=g=>{g.stopPropagation(),d(s)},b=g=>{g.stopPropagation(),a(s)};return U(Xe,{selected:e,onClick:u,children:[o(Ue.Text,{ellipsis:!0,children:t}),U("div",{children:[!n&&l?o(j,{css:g=>({fontSize:g.iconSize+"px",marginRight:g.margin.xs+"px"}),name:"icon-edit-outlined",onClick:b,title:c.update}):null,!n&&l?o(j,{css:g=>({fontSize:g.iconSize+"px",marginRight:g.margin.xs+"px"}),name:"icon-minus-circle-outlined",onClick:p,title:c.delete}):null,o(j,{css:g=>({fontSize:g.iconSize+"px"}),name:"icon-arrow-right-outlined"})]})]})};ce.propTypes={disabledAction:m.bool,data:m.objectOf(m.any),isFetching:m.bool,onClick:m.func,onClickDelete:m.func,onClickEdit:m.func,selected:m.bool,title:m.string,employeePermissionWrite:m.bool};ce.defaultProps={disabledAction:!1,data:{id:0},isFetching:!1,onClick:()=>{},onClickDelete:()=>{},onClickEdit:()=>{},selected:!1,title:"",employeePermissionWrite:!1};const ge=z()===H,R=h.createContext({idBuilding:0,departmentSelected:void 0,setDepartmentSelected:()=>{},positionSelected:void 0,setPositionSelected:()=>{},adminData:void 0,setAdminData:()=>{},departments:[],setDepartments:()=>{},getListDepartmentStatus:{isFetching:!1},setGetListDepartmentStatus:()=>{},employeePermissionWrite:!1}),Se=({children:e})=>{const{getPermissionByModuleCode:t}=Fe(),{idBuilding:n}=Ie(),[s,r]=h.useState(),[a,d]=h.useState(),[l,u]=h.useState(),[p,b]=h.useState([]),[g,i]=h.useState({isFetching:!1}),D=t(_e),P=(D==null?void 0:D[Ee])??!1,F={idBuilding:n,employeePermissionWrite:P,departmentSelected:s,setDepartmentSelected:_=>{r({..._,positions:_.positions.sort((C,L)=>ge?C.enName.localeCompare(L.enName):C.name.localeCompare(L.name))})},positionSelected:a,setPositionSelected:d,adminData:l,setAdminData:u,departments:p,setDepartments:_=>{const C=_.sort((L,f)=>ge?L.enName.localeCompare(f.enName):L.name.localeCompare(f.name)).map(L=>({...L,positions:L.positions.sort((f,E)=>ge?f.enName.localeCompare(E.enName):f.name.localeCompare(E.name))}));b(C)},getListDepartmentStatus:g,setGetListDepartmentStatus:i};return o(R.Provider,{value:F,children:e})};Se.propTypes={children:m.node};Se.defaultProps={children:o("div",{})};const Ke=Se,Je=async(e,t)=>{try{const n=await Ve(e,t);return{code:n.code,codeLanguage:n.codeLanguage}}catch(n){return{code:n.code,codeLanguage:n.codeLanguage}}},q=async e=>{try{return(await Re(e,!0)).data.map(n=>({...n,positions:n.positions.map(s=>({...s,department:s.departmentId}))}))}catch(t){return t}},le=h.createContext({deleteDepartmentStatus:{isFetching:!1,code:void 0,codeLanguage:void 0},setDeleteDepartmentStatus:()=>{},modalAddDepartment:void 0,showModalAddDepartment:()=>{},hideModalAddDepartment:()=>{},modalUpdateDepartment:void 0,showModalUpdateDepartment:()=>{},hideModalUpdateDepartment:()=>{}}),De=({children:e})=>{const[t,n]=h.useState({isFetching:!1}),[s,r,a]=X(),[d,l,u]=X(),p={deleteDepartmentStatus:t,setDeleteDepartmentStatus:n,modalAddDepartment:s,showModalAddDepartment:r,hideModalAddDepartment:a,modalUpdateDepartment:d,showModalUpdateDepartment:l,hideModalUpdateDepartment:u};return o(le.Provider,{value:p,children:e})};De.propTypes={children:m.node};De.defaultProps={children:o("div",{})};const Ze=()=>{const{idBuilding:e,departmentSelected:t,setPositionSelected:n,setDepartmentSelected:s,setAdminData:r,adminData:a,departments:d,setDepartments:l,getListDepartmentStatus:u,setGetListDepartmentStatus:p,employeePermissionWrite:b}=h.useContext(R),{deleteDepartmentStatus:g,setDeleteDepartmentStatus:i,showModalAddDepartment:D,showModalUpdateDepartment:P,modalAddDepartment:F,modalUpdateDepartment:_}=h.useContext(le);h.useEffect(()=>{(async()=>{p({isFetching:!0});const v=await q(e);l(v),p({isFetching:!1});const M=v.length>0?v.find($=>$.name===Z):{},N=(M==null?void 0:M.positions.length)>0?M==null?void 0:M.positions.find($=>$.name===Pe):{};r({department:M,position:N})})()},[]);const C=()=>{D()},L=v=>{P({...v})},f=v=>{s(v),n(void 0)},E=async v=>{i({isFetching:!0,code:void 0,codeLanguage:void 0});const M=await Je(e,v);i({isFetching:!1,code:M.code,codeLanguage:M.codeLanguage}),p({isFetching:!0});const N=await q(e);l(N),p({isFetching:!1}),t.id===+v&&s(N==null?void 0:N[0])};return[u.isFetching,z()===H,g.isFetching,t,d,C,L,f,F,_,E,a,b]},et=B("button",{target:"e6bohgo0"})({name:"eivff4",styles:"display:none"}),pe=({isFetching:e,form:t,initialValues:n,title:s,treeData:r,isAdminDepartment:a,onFinish:d,onClose:l})=>o(re,{title:s,open:!0,onOk:d,onCancel:l,confirmLoading:e,okText:c.confirm,cancelText:c.cancel,children:U(O,{layout:"vertical",name:"form_department_authorization",form:t,onFinish:d,initialValues:n,children:[U(fe,{gutter:16,children:[o(V,{span:24,children:o(O.Item,{name:"name",rules:[{required:!0},J],label:c.label.name,children:o(G,{placeholder:c.label.name,disabled:a})})}),o(V,{span:24,children:o(O.Item,{name:"enName",rules:[{required:!0},J],label:c.label.en_name,children:o(G,{placeholder:c.label.en_name,disabled:a})})}),o(V,{span:24,children:o(O.Item,{name:"phone",label:c.label.phone,rules:[He],children:o(G.Phone,{placeholder:c.label.phone,disabled:a})})}),o(V,{span:24,children:o(O.Item,{name:"description",label:c.label.description,children:o(G.TextArea,{allowClear:!0,autoSize:{minRows:2,maxRows:2},placeholder:c.label.description,disabled:a})})}),o(V,{span:24,children:o(O.Item,{name:"appHiddenConfig",label:c.show_departments_under_the_resident_application,children:o(Oe,{treeData:r,treeCheckable:!0,placeholder:c.show_departments_under_the_resident_application,style:{width:"100%"},showSearch:!1})})})]}),o(et,{type:"submit"})]})});pe.propTypes={form:m.objectOf(m.any),isFetching:m.bool,initialValues:m.objectOf(m.any),treeData:m.arrayOf(m.any),title:m.string,onClose:m.func,onFinish:m.func,isAdminDepartment:m.bool};pe.defaultProps={form:{},isFetching:!1,title:"",initialValues:{},treeData:{},onClose:()=>{},onFinish:()=>{},isAdminDepartment:!1};const tt=async(e,t)=>{const{name:n,enName:s,phone:r,description:a,appHiddenConfig:d}=t,l=r?`${oe}${r}`:null;try{const u=await Ge(e,{name:n||void 0,enName:s||void 0,phone:l,description:a||void 0,appHiddenConfig:d||void 0});return{code:u.code,codeLanguage:u.codeLanguage}}catch(u){return{code:u.code,codeLanguage:u.codeLanguage}}},nt=()=>{const{idBuilding:e,setAdminData:t,setDepartments:n,setGetListDepartmentStatus:s}=h.useContext(R),{hideModalAddDepartment:r}=h.useContext(le),[a]=O.useForm(),[d,l]=h.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),u=[{title:c.hide_in_the_reflections_section,value:ee,key:ee},{title:c.hide_in_the_communication_section,value:te,key:te}];Y(d.code,d.codeLanguage,{message:c.success,description:c.add_data_success},()=>{r()});const p=async()=>{const P=await a.validateFields();if(P){l({isFetching:!0,code:void 0,codeLanguage:void 0});const F=await tt(e,P);l({isFetching:!1,code:F.code,codeLanguage:F.codeLanguage}),s({isFetching:!0});const _=await q(e);n(_),s({isFetching:!1});const C=_.length>0?_.find(f=>f.name===Z):{},L=(C==null?void 0:C.positions.length)>0?C==null?void 0:C.positions.find(f=>f.name===Pe):{};t({department:C,position:L})}},b=()=>r(),g=d.isFetching;return[{name:"",enName:"",phone:"",description:"",appHiddenConfig:[],prefix:oe},g,a,u,!1,b,p]},ot=()=>{const[e,t,n,s,r,a,d]=nt();return o(pe,{form:n,initialValues:e,isAdminDepartment:r,isFetching:t,onClose:a,onFinish:d,title:c.add_department,treeData:s})},it=async(e,t)=>{const{name:n,enName:s,phone:r,description:a,appHiddenConfig:d,id:l}=t,u=r?`${oe}${r}`:null;try{const p=await ze(e,l,{name:n||void 0,enName:s||void 0,phone:u,description:a||void 0,appHiddenConfig:d||void 0});return{code:p.code,codeLanguage:p.codeLanguage}}catch(p){return{code:p.code,codeLanguage:p.codeLanguage}}},st=()=>{const{idBuilding:e,setAdminData:t,setDepartments:n,setGetListDepartmentStatus:s}=h.useContext(R),{hideModalUpdateDepartment:r,modalUpdateDepartment:a}=h.useContext(le),{data:d}=a,[l]=O.useForm(),[u,p]=h.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),b=[{title:c.hide_in_the_reflections_section,value:ee,key:ee},{title:c.hide_in_the_communication_section,value:te,key:te}];Y(u.code,u.codeLanguage,{message:c.success,description:c.update_data_success},()=>{r()});const g=async()=>{const _=await l.validateFields();if(_){p({isFetching:!0,code:void 0,codeLanguage:void 0});const C=await it(e,{..._,id:d.id});p({isFetching:!1,code:C.code,codeLanguage:C.codeLanguage}),s({isFetching:!0});const L=await q(e);n(L),s({isFetching:!1});const f=L.length>0?L.find(v=>v.name===Z):{},E=(f==null?void 0:f.positions.length)>0?f==null?void 0:f.positions.find(v=>v.name===Pe):{};t({department:f,position:E})}},i=()=>r(),D=u.isFetching,P={name:d.name||"",enName:d.enName||"",phone:d.phone?Te(d.phone):"",description:d.description||"",appHiddenConfig:d.appHiddenConfig||[],prefix:oe},F=d.name===Z;return[P,D,l,b,F,i,g]},at=()=>{const[e,t,n,s,r,a,d]=st();return o(pe,{form:n,initialValues:e,isAdminDepartment:r,isFetching:t,onClose:a,onFinish:d,title:c.add_department,treeData:s})},dt=()=>{const[e,t,n,s,r,a,d,l,u,p,b,g,i]=Ze(),D=async P=>{re.confirm({title:c.confirm,content:`${c.confirm_delete} ${P.name} ?`,okText:c.confirm,okType:"danger",cancelText:c.cancel,confirmLoading:n,okBtnProps:{disabled:n,loading:n},onOk:async()=>(await b(P.id),Promise.resolve())})};return U(he,{children:[U(Q,{span:8,title:c.department,onClickButton:a,employeePermissionWrite:i,children:[e&&o(Qe,{children:o(Be,{})}),!e&&(r.length>0?r.map((P,F)=>{var _;return o(ce,{data:P,id:P.id,selected:(s==null?void 0:s.id)===P.id,title:t?P.enName:P.name,isFetching:n,onClick:l,onClickEdit:d,onClickDelete:D,disabledAction:P.id===((_=g==null?void 0:g.department)==null?void 0:_.id),employeePermissionWrite:i},P.id)}):o(K,{image:K.PRESENTED_IMAGE_SIMPLE}))]}),u.isShow?o(ot,{}):null,p.isShow?o(at,{}):null]})},rt=()=>o(De,{children:o(dt,{})}),Ce=`${be}/position`,ct=Ce,lt=e=>`${Ce}/${e}`,pt=e=>`${Ce}/${e}`,mt=async(e,t)=>await ie({type:se,payload:{apiUrl:ct,method:ae.POST,body:{...t},options:{headers:{[de]:e}}}}),ut=async(e,t,n)=>await ie({type:se,payload:{apiUrl:lt(t),method:ae.PUT,body:{...n},options:{headers:{[de]:e}}}}),gt=async(e,t)=>await ie({type:se,payload:{apiUrl:pt(t),method:ae.DELETE,options:{headers:{[de]:e}}}}),ht=async(e,t)=>{try{const n=await gt(e,t);return{code:n.code,codeLanguage:n.codeLanguage}}catch(n){return{code:n.code,codeLanguage:n.codeLanguage}}},me=h.createContext({getListPositionStatus:{isFetching:!1},setGetListPositionStatus:()=>{},deletePositionStatus:{isFetching:!1,code:void 0,codeLanguage:void 0},setDeletePositionStatus:()=>{},positions:[],setPositions:()=>{},modalAddPosition:void 0,showModalAddPosition:()=>{},hideModalAddPosition:()=>{},modalUpdatePosition:void 0,showModalUpdatePosition:()=>{},hideModalUpdatePosition:()=>{}}),ve=({children:e})=>{const[t,n]=h.useState({isFetching:!1}),[s,r,a]=X(),[d,l,u]=X(),p={deletePositionStatus:t,setDeletePositionStatus:n,modalAddPosition:s,showModalAddPosition:r,hideModalAddPosition:a,modalUpdatePosition:d,showModalUpdatePosition:l,hideModalUpdatePosition:u};return o(me.Provider,{value:p,children:e})};ve.propTypes={children:m.node};ve.defaultProps={children:o("div",{})};const ft=()=>{const{idBuilding:e,departmentSelected:t,positionSelected:n,setPositionSelected:s,adminData:r,departments:a,setDepartments:d,employeePermissionWrite:l}=h.useContext(R),{deletePositionStatus:u,setDeletePositionStatus:p,showModalAddPosition:b,showModalUpdatePosition:g,modalAddPosition:i,modalUpdatePosition:D}=h.useContext(me),P=()=>{b()},F=f=>{g({...f})},_=f=>{s(f)},C=async f=>{var M;p({isFetching:!0,code:void 0,codeLanguage:void 0});const E=await ht(e,f.id);p({isFetching:!1,code:E.code,codeLanguage:E.codeLanguage});const v=[...a];for(let N=0;N<v.length;N+=1)if(+f.department===v[N].id){const $=v[N].positions;for(let I=0;I<$.length;I+=1)if($[I].id===f.id){v[N].positions.splice(I,1),n.id===f.id&&s(((M=v[N].positions)==null?void 0:M[0])??void 0);break}break}d(v)},L=h.useMemo(()=>(t==null?void 0:t.positions)??[],[t]);return[z()===H,u.isFetching,n,L,P,F,_,i,D,C,r,l]},{Option:Pt}=Le,St=B("button",{target:"e1ctkv900"})({name:"eivff4",styles:"display:none"}),ue=e=>{const{isFetching:t,form:n,departmentOptions:s,initialValues:r,title:a,isEnLanguage:d,onFinish:l,onClose:u}=e;return o(re,{title:a,open:!0,onOk:l,onCancel:u,confirmLoading:t,okText:c.label.confirm,cancelText:c.label.cancel,children:U(O,{layout:"vertical",name:"form_position_authorization",form:n,onFinish:l,initialValues:r,children:[U(fe,{gutter:16,children:[o(V,{span:24,children:o(O.Item,{name:"name",rules:[{required:!0},J],label:c.label.name,children:o(G,{placeholder:c.label.name})})}),o(V,{span:24,children:o(O.Item,{name:"enName",rules:[{required:!0},J],label:c.label.en_name,children:o(G,{placeholder:c.label.en_name})})}),o(V,{span:24,children:o(O.Item,{name:"department",label:c.label.department,rules:[{required:!0}],children:o(Le,{fluid:"true",placeholder:c.label.department,children:s.map(p=>o(Pt,{value:p.id,children:d?p.enName:p.name},p.id))})})})]}),o(St,{type:"submit"})]})})};ue.propTypes={form:m.objectOf(m.any),isFetching:m.bool,initialValues:m.objectOf(m.any),departmentOptions:m.arrayOf(m.any),onClose:m.func,onFinish:m.func,title:m.string,isEnLanguage:m.bool};ue.defaultProps={form:{},isFetching:!1,initialValues:{},departmentOptions:[],onClose:()=>{},onFinish:()=>{},title:"",isEnLanguage:!1};const Dt=async(e,t)=>{const{name:n,enName:s,department:r}=t;try{const a=await mt(e,{name:n||void 0,enName:s||void 0,departmentId:r||void 0});return{code:a.code,codeLanguage:a.codeLanguage,data:a.data}}catch(a){return{code:a.code,codeLanguage:a.codeLanguage}}},Ct=()=>{const e=z()===H,{idBuilding:t,departments:n,setDepartments:s,setDepartmentSelected:r,setPositionSelected:a}=h.useContext(R),{hideModalAddPosition:d}=h.useContext(me),[l]=O.useForm(),[u,p]=h.useState({isFetching:!1,code:void 0,codeLanguage:void 0});Y(u.code,u.codeLanguage,{message:c.success,description:c.add_data_success},()=>{d()});const b=async()=>{const P=await l.validateFields();if(P){p({isFetching:!0,code:void 0,codeLanguage:void 0});const{code:F,codeLanguage:_,data:C}=await Dt(t,P);p({isFetching:!1,code:F,codeLanguage:_});const L=[...n];for(let f=0;f<L.length;f+=1){const E=L[f];if(E.id===C.departmentId){L[f].positions.push(C),r({...E}),a({...C});break}}s(L)}},g=()=>d();return[u.isFetching,e,{name:"",enName:"",department:void 0},l,n,g,b]},vt=()=>{const[e,t,n,s,r,a,d]=Ct();return o(ue,{form:s,initialValues:n,isFetching:e,onClose:a,onFinish:d,title:c.add_position,departmentOptions:r,isEnLanguage:t})},we=async(e,t)=>{const{name:n,enName:s,department:r,id:a,permissions:d}=t;try{const l=await ut(e,a,{id:a,name:n||void 0,enName:s||void 0,departmentId:r||void 0,permissions:d||void 0});return{code:l.code,codeLanguage:l.codeLanguage}}catch(l){return{code:l.code,codeLanguage:l.codeLanguage}}},yt=()=>{const e=z()===H,{idBuilding:t,departments:n,positionSelected:s,setDepartments:r,setDepartmentSelected:a,setPositionSelected:d}=h.useContext(R),{hideModalUpdatePosition:l,modalUpdatePosition:u}=h.useContext(me),{data:p}=u,[b]=O.useForm(),[g,i]=h.useState({isFetching:!1,code:void 0,codeLanguage:void 0});Y(g.code,g.codeLanguage,{message:c.success,description:c.update_data_success},()=>{l()});const D=async()=>{const C=await b.validateFields();if(C){i({isFetching:!0,code:void 0,codeLanguage:void 0});const{code:L,codeLanguage:f}=await we(t,{...C,id:p.id});i({isFetching:!1,code:L,codeLanguage:f});const E=[...n];for(let v=0;v<E.length;v+=1){const M=E[v];if(M.id===+C.department){const N=M.positions;for(let $=0;$<N.length;$+=1){const I=N[$];if(I.id===p.id){E[v].positions[$]={...I,name:C.name,enName:C.enName,departmentId:C.department},s.id===p.id&&d({...E[v].positions[$]}),a({...E[v]});break}}break}}r(E)}},P=()=>l(),F=g.isFetching,_={name:p.name||"",enName:p.enName||"",department:p.department};return[F,e,_,b,n,P,D]},xt=()=>{const[e,t,n,s,r,a,d]=yt();return o(ue,{form:s,initialValues:n,isFetching:e,onClose:a,onFinish:d,title:c.update_position,departmentOptions:r,isEnLanguage:t})},bt=()=>{const[e,t,n,s,r,a,d,l,u,p,b,g]=ft(),i=async D=>{re.confirm({title:c.confirm,content:`${c.confirm_delete} ${D.name} ?`,okText:c.confirm,okType:"danger",cancelText:c.cancel,confirmLoading:t,okBtnProps:{disabled:t,loading:t},onOk:async()=>(await p(D),Promise.resolve())})};return U(he,{children:[o(Q,{span:8,title:c.position,onClickButton:r,employeePermissionWrite:g,children:s.length>0?s.map((D,P)=>{var F;return o(ce,{data:D,id:D.id,selected:(n==null?void 0:n.id)===D.id,title:e?D.enName:D.name,isFetching:t,onClick:d,onClickEdit:a,onClickDelete:i,disabledAction:D.id===((F=b==null?void 0:b.position)==null?void 0:F.id),employeePermissionWrite:g},D.id)}):o(K,{image:K.PRESENTED_IMAGE_SIMPLE})}),l.isShow?o(vt,{}):null,u.isShow?o(xt,{}):null]})},Lt=()=>o(ve,{children:o(bt,{})}),wt=B("div",{target:"eh90pu12"})("width:100%;border:1px solid #f0f0f0;margin-top:",e=>e.theme.margin.md,"px;font-size:13px;"),Ft=B("div",{target:"eh90pu11"})({name:"ecoahz",styles:"padding:19.5px 8px;background-color:#fafafa;font-weight:bold;display:flex;justify-content:flex-start;align-items:center"}),_t=B("div",{target:"eh90pu10"})({name:"191vy3t",styles:"padding:0;border-top:1px solid #f0f0f0"}),ne=({header:e,isBodyEmpty:t,children:n})=>U(wt,{children:[o(Ft,{children:e}),!t&&o(_t,{children:n})]});ne.propTypes={header:m.node,isBodyEmpty:m.bool,children:m.node};ne.defaultProps={header:o("div",{}),isBodyEmpty:!1,children:o("div",{})};const Et=B("div",{target:"e1h1y8xi0"})("margin-left:",e=>e.theme.margin.xs,"px;font-size:",e=>e.theme.fontSize.md,"px;"),W=({checked:e,title:t,disabled:n,onChange:s})=>U(he,{children:[o($e,{checked:e,disabled:n,onChange:s}),o(Et,{children:t})]});W.propTypes={checked:m.bool,disabled:m.bool,onChange:m.func,title:m.string};W.defaultProps={checked:!1,disabled:!1,onChange:()=>{},title:""};const At=`${be}/group-permission`,kt=`${At}/list`,Tt=async e=>await ie({type:se,payload:{apiUrl:kt,method:ae.GET,options:{headers:{[de]:e}}}}),Mt=async e=>{try{return(await Tt(e)).data}catch(t){return{code:t.code,codeLanguage:t.codeLanguage}}},Nt=()=>{var I;const{departmentSelected:e,positionSelected:t,adminData:n,idBuilding:s,setGetListDepartmentStatus:r,setDepartments:a,setDepartmentSelected:d,setPositionSelected:l,employeePermissionWrite:u}=h.useContext(R),{isUserCs:p}=Ae(),[b,g]=h.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[i,D]=h.useState([]),[P,F]=h.useState([]);Y(b.code,b.codeLanguage,{message:c.success,description:c.update_data_success}),h.useEffect(()=>{(async()=>{const k=await Mt(s),A=[];for(let S=0;S<k.length;S+=1){const y=k[S];A.push({...y,isGroup:!0,totalChild:y.permissions.length});for(let x=0;x<y.permissions.length;x+=1){const T=y.permissions[x];A.push({...T,parent:y.id})}}D(A)})()},[]),h.useEffect(()=>{F([])},[e]),h.useEffect(()=>{var k;if(t){const A=[];(k=t==null?void 0:t.permissions)==null||k.forEach(T=>{p&&!Me.RESIDENT.includes(T.name)&&A.push(T.id),p||A.push(T.id)});let S=0,y=0;const x={};for(let T=0;T<i.length;T+=1){const w=i[T];w.isGroup?(y===i[S].totalChild?x[`group-${i[S].id}`]=w.id:x[`group-${i[S].id}`]=void 0,S=T,y=0):A.includes(w.id)?(x[w.id]=w.id,y+=1):x[w.id]=void 0,T===i.length-1&&(y===i[S].totalChild?x[`group-${i[S].id}`]=i[S].id:x[`group-${i[S].id}`]=void 0)}F({...x})}},[t]);const _=k=>{F({...i.reduce((A,S)=>(S.isGroup?A[`group-${S.id}`]=k?S.id:void 0:A[S.id]=k?S.id:void 0,A),{})})},C=(k,A)=>{const S={...P};for(let y=0;y<i.length;y+=1)if(i[y].id===k&&i[y].isGroup||i[y].parent===k){let x=i[y].id;i[y].isGroup&&(x=`group-${i[y].id}`),S[x]=A?i[y].id:void 0}F(S)},L=(k,A)=>{let S=0,y,x=0;const T={...P};for(let w=0;w<i.length;w+=1)if(i[w].id===k&&!i[w].isGroup){T[i[w].id]=A?i[w].id:void 0,y=i[w].parent;break}for(let w=0;w<i.length;w+=1)i[w].id===y&&i[w].isGroup&&(x=w),i[w].parent===y&&T[i[w].id]&&(S+=1);i[x].totalChild===S?T[`group-${i[x].id}`]=i[x]:T[`group-${i[x].id}`]=void 0,F(T)},f=async()=>{var y;g({isFetching:!0,code:void 0,codeLanguage:void 0});const{code:k,codeLanguage:A}=await we(s,{id:t.id,permissions:Object.keys(P).map(x=>x.indexOf("group")===-1&&P[x]?P[x]:null).filter(Boolean)});g({isFetching:!1,code:k,codeLanguage:A}),r({isFetching:!0});const S=await q(s);if(a(S),S&&S.length){const x=(S==null?void 0:S.find(w=>w.id===e.id))??void 0;d(x);const T=((y=x==null?void 0:x.positions)==null?void 0:y.find(w=>w.id===t.id))??void 0;l(T)}r({isFetching:!1})},E=h.useMemo(()=>{var S;const k=((S=Object.values(P).filter(y=>y))==null?void 0:S.length)??0,A=i.length;return k+A!==0&&k===A},[P,i]),v=z()===H,M=b.isFetching,N=!t||t.id===((I=n==null?void 0:n.position)==null?void 0:I.id);return[u,M,N,v,E,!t,i,P,_,C,L,f]},Ut=B("div",{target:"ek8ljxy0"})("display:flex;justify-content:flex-start;align-items:center;border-bottom:1px solid #f0f0f0;padding:",e=>e.theme.padding.sm,"px ",e=>e.theme.padding.xs,"px;"),Ot=()=>{const[e,t,n,s,r,a,d,l,u,p,b,g]=Nt();return U(Q,{span:8,title:c.label.permission,saveButton:!0,isFetchingSave:t,onClickButton:g,disabled:n,employeePermissionWrite:e,children:[o(ne,{isBodyEmpty:!0,header:o(W,{checked:r,title:c.label.full_permission,disabled:a||n,onChange:u})}),d.map(i=>i.isGroup?o(ne,{header:o(W,{checked:!!l[`group-${i.id}`],title:s?i.enDescription:i.description,disabled:a||n,onChange:D=>p(i.id,D)})},`group-${i.id}`):o(Ut,{children:o(W,{checked:!!l[i.id],title:s?i.enDescription:i.description,disabled:a||n,onChange:D=>b(i.id,D)})},i.id))]})};var Bt={name:"82a6rk",styles:"flex:1"};const $t=()=>{const{setTitlePage:e,setVisibleFilterBox:t,setVisibleSearchBox:n}=h.useContext(ke);return h.useEffect(()=>(e(c.authorization),t(!1),n(!1),()=>{e("")}),[]),o(ye.Wrapper,{children:o(ye.Container,{children:U(fe,{css:Bt,gutter:[0,0],children:[o(rt,{}),o(Lt,{}),o(Ot,{})]})})})},Co=()=>o(Ke,{children:o($t,{})});export{Co as default};
