import{j as l,a as y,u as B}from"./@emotion-63839449.js";import{j as N,D as $,P as h}from"./index-b17d22e5.js";import{r as u}from"./react-4fd50329.js";import"./lodash-88fe09e6.js";import{h as T}from"./moment-a468e1f9.js";import{l as s,by as Y,b0 as G,aK as U,bv as V,i as I,A as X,M as P,X as _,j,e4 as H,a3 as W,dq as q,a5 as J,I as A,a as w,c6 as v}from"./index-c2ded735.js";import"./file-saver-40cf32a9.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{P as K}from"./prop-types-1172f4d5.js";import{u as z}from"./react-router-a4308f7b.js";import{u as Q}from"./index-687ba9e6.js";import{d as Z}from"./downloadFileFromUrl-79614833.js";import{B as ee,D as te,a as m}from"./antd-f9eae174.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./index-43183512.js";import"./index-881eef42.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";const L=[{label:s.default,value:"DEFAULT",fileName:"thong-tin-thu-chi-van-hanh-mau-mac-dinh.xlsx"},{label:s.detail,value:"DETAIL",fileName:"thong-tin-thu-chi-van-hanh-mau-chi-tiet.xlsx"}],ne=Y(L,"value"),b={paymentMonth:T(),labels:[]},R=u.createContext({idBuilding:0,getStatisticsFinancialStatus:{isFetching:!1},setGetStatisticsFinancialStatus:()=>{},filter:{...b},setFilter:()=>{},tableData:{records:[],totalRecord:0},setTableData:()=>{},balanceSheetPermissionExport:!1}),E=({children:e})=>{var g;const{idBuilding:i}=z(),[n,r]=u.useState({isFetching:!1}),[a,o]=u.useState({...b}),[t,c]=u.useState({records:[],totalRecord:0}),{getPermissionByModuleCode:p}=G(),d=((g=p(U))==null?void 0:g[V])??!1,x={idBuilding:i,getStatisticsFinancialStatus:n,setGetStatisticsFinancialStatus:r,filter:a,setFilter:o,tableData:t,setTableData:c,balanceSheetPermissionExport:d};return l(R.Provider,{value:x,children:e})};E.propTypes={children:K.node};E.defaultProps={children:l("div",{})};const oe=E,C=`${j}/report`,re=`${C}/operating`,ie=`${C}/operating/export`;async function ae({idBuilding:e,filter:i,page:n,limit:r}){return await I({type:X,payload:{apiUrl:re,method:P.GET,options:{headers:{[_]:e},params:{...i,page:n,limit:r}}}})}async function le(e,i){return await I({type:H,payload:{apiUrl:ie,method:P.GET,options:{headers:{[_]:e},params:{...i}}}})}const F=(e,i,n,r)=>{const a=e.reduce((o,t)=>t.title?[...o,{key:`${n}-group-${t.id}`,explain:t.title,...t,children:t.labels.map(c=>({key:`${n}-group-${t.id}-label-${c.id}`,explain:c.title,...c}))}]:[...o,...t.labels.map(c=>({key:`${n}-group-${t.id}-label-${c.id}`,explain:c.title,...c}))],[]);return a.push({key:`${n}-other`,explain:r,...i}),a},se=(e,i)=>{const n={};return Object.keys(e).forEach(r=>{n[r]||(n[r]=0),n[r]=e[r]+i[r]}),n},ce=e=>{var c,p,d,x,g,S;const i=((c=e==null?void 0:e.revenue)==null?void 0:c.serviceRevenue)??[],n=((p=e==null?void 0:e.revenue)==null?void 0:p.manuallyRevenue)??[],r=((d=e==null?void 0:e.revenue)==null?void 0:d.otherRevenue)??{},a=((x=e==null?void 0:e.revenue)==null?void 0:x.totalRevenue)??{},o=((g=e==null?void 0:e.revenue)==null?void 0:g.totalServiceRevenue)??{},t=((S=e==null?void 0:e.revenue)==null?void 0:S.totalManuallyRevenue)??{};return{serviceRevenue:i,manuallyRevenue:n,otherRevenue:r,totalRevenue:a,totalServiceRevenue:o,totalManuallyRevenue:t}},pe=e=>{var a,o,t;const i=((a=e==null?void 0:e.expand)==null?void 0:a.dynamicExpand)??[],n=((o=e==null?void 0:e.expand)==null?void 0:o.otherExpand)??{},r=((t=e==null?void 0:e.expand)==null?void 0:t.totalExpand)??{};return{dynamicExpand:i,otherExpand:n,totalExpand:r}},de=e=>(e==null?void 0:e.total)??{},ue=e=>{const{serviceRevenue:i,manuallyRevenue:n,otherRevenue:r,totalRevenue:a,totalServiceRevenue:o,totalManuallyRevenue:t}=ce(e),{dynamicExpand:c,otherExpand:p,totalExpand:d}=pe(e),x=de(e),g={key:"totalRevenueRow",index:"I",explain:s.label.revenues,...a,strong:!0},S={key:"totalServiceRevenueRow",index:"1",explain:s.label.service_revenue,...o,children:i.map(f=>({key:`totalServiceRevenueRow-${f.id}`,explain:f.name,...f})),strong:!0},D={key:"totalManuallyRevenueRow",index:"2",explain:s.label.manually_revenue,...se(t,r),children:F(n,r,"totalManuallyRevenueRow",s.label.other_revenue),strong:!0},M={key:"totalExpandRow",index:"II",explain:s.label.expenses,...d,children:F(c,p,"totalExpandRow",s.label.other_expenses),strong:!0},O={key:"summaryRow",index:"III",explain:`${s.label.summary_of_revenue_and_expenditure} (I - II)`,...x,strong:!0};return[g,S,D,M,O]},k=async(e,i)=>{try{const{paymentMonth:n,labels:r=[]}=i,a=await ae({filter:{month:T(n).toDate(),labelIds:r.length===0?["ALL"]:r},idBuilding:e});return{code:a.code,codeLanguage:a.codeLanguage,data:ue(a.data),totalRecord:a.totalRecord}}catch(n){return{code:n.code,codeLanguage:n.codeLanguage,data:[],totalRecord:0}}},me=()=>{const{idBuilding:e,setGetStatisticsFinancialStatus:i,setFilter:n,setTableData:r}=u.useContext(R),{labelsAccountingData:a}=N();return{labelsAccountingData:a,onSearch:async t=>{i({isFetching:!0}),n(t);const c=await k(e,t);r({records:c.data,totalRecord:c.totalRecord}),i({isFetching:!1})}}},ge=()=>{const{onSearch:e}=me(),i=u.useMemo(()=>[{label:s.payment_month,key:"paymentMonth",component:l($,{allowClear:!1,fluid:"true",picker:"month",format:"MM/YYYY",placeholder:"MM/YYYY",getPopupContainer:n=>n.parentNode}),visible:!0,fixed:!0}],[]);return l(h.FilterBox,{defaultFilter:b,filters:i,onSearch:e})},he=async(e,i)=>{try{const{paymentMonth:n,labels:r,type:a}=i,o=await le(e,{month:T(n).toDate(),labelIds:r.length===0?["ALL"]:r,type:a});return{code:o.code,codeLanguage:o.codeLanguage,data:o.data}}catch(n){return{code:n.code,codeLanguage:n.codeLanguage,data:void 0}}},xe=()=>{const{idBuilding:e,filter:i,balanceSheetPermissionExport:n}=u.useContext(R),[r,a]=u.useState({isFetching:!1,code:void 0,codeLanguage:void 0});Q(r.code,r.codeLanguage,{message:s.success,description:s.export_data_success});const o=(p,d)=>{p&&Z(p,document,ne[d].fileName)},t=async({key:p})=>{a({isFetching:!0,code:void 0,codeLanguage:void 0});const d=await he(e,{...i,type:p});o(d==null?void 0:d.data,p),a({isFetching:!1,code:d.code,codeLanguage:d.codeLanguage})},c=r.isFetching;return[n,c,t]};function ve(){const[e,i,n]=xe(),r=W(),a=Array.from(L.values()).map(({label:t,value:c})=>({key:c,label:t,onClick:({key:p})=>{r({action:q,label:J}),n({key:p})}})),o=[e?l(te,{menu:{items:a},children:y(ee,{type:"primary",ghost:!0,icon:l(A,{name:"icon-download-outlined"}),loading:i,children:[s.export," ",l(A,{name:"icon-arrow-down-outlined"})]})},"export"):null];return l(h.ActionBox,{actions:o})}const ye=()=>{const{layoutScrollRef:e}=u.useContext(w),{tableData:i,getStatisticsFinancialStatus:n}=u.useContext(R),r=B(),a=i.records,o={offsetScroll:r.offsetScrollX,getContainer:()=>e.current},t={scrollToFirstRowOnChange:!0};return[n.isFetching,a,t,o]};function Re(){const[e,i,n,r]=ye(),a=[{dataIndex:"collapse",key:"collapse",width:60},{title:"STT",align:"center",children:[{title:"1",align:"center",dataIndex:"index",key:"index",width:60,render:(o,t)=>l(m.Text,{strong:t.strong,children:o})}]},{title:l("div",{style:{textAlign:"center"},children:s.label.explain}),children:[{title:l("div",{style:{textAlign:"center"},children:"2"}),dataIndex:"explain",key:"explain",render:(o,t)=>l(m.Text,{strong:t.strong,children:o})}]},{title:y("div",{style:{textAlign:"center"},children:[s.label.must_pay," / ",s.label.must_expend]}),children:[{title:l("div",{style:{textAlign:"center"},children:"3"}),dataIndex:"receivableOrPayable",key:"receivableOrPayable",align:"right",render:(o,t)=>l(m.Text,{strong:t.strong,children:v(o)})}]},{title:y("div",{style:{textAlign:"center"},children:[s.label.collected," / ",s.label.spent]}),children:[{title:l("div",{style:{textAlign:"center"},children:"4"}),children:[{title:s.label.cash,dataIndex:"cashPaid",key:"cashPaid",align:"right",render:(o,t)=>l(m.Text,{strong:t.strong,children:v(o)})}]},{title:l("div",{style:{textAlign:"center"},children:"5"}),children:[{title:s.label.transfer,dataIndex:"transferPaid",key:"transferPaid",align:"right",render:(o,t)=>l(m.Text,{strong:t.strong,children:v(o)})}]},{title:l("div",{style:{textAlign:"center"},children:"6"}),children:[{title:s.label.online,dataIndex:"onlinePaid",key:"onlinePaid",align:"right",render:(o,t)=>l(m.Text,{strong:t.strong,children:v(o)})}]},{title:l("div",{style:{textAlign:"center"},children:"7=4+5+6"}),children:[{title:s.label.total1,dataIndex:"collectedOrSpent",key:"collectedOrSpent",align:"right",render:(o,t)=>l(m.Text,{strong:t.strong,children:v(o)})}]}]},{title:y("div",{style:{textAlign:"center"},children:[s.label.receivables," / ",s.label.payable]}),children:[{title:l("div",{style:{textAlign:"center"},children:"8"}),dataIndex:"rest",key:"rest",align:"right",render:(o,t)=>l(m.Text,{strong:t.strong,children:v(o)})}]}];return l(h.Table,{columns:a,dataSource:i,loading:e,pagination:!1,scroll:{...n,x:a.reduce((o,t)=>o+(t==null?void 0:t.width)||0,0)},sticky:r})}const Se=()=>{const{idBuilding:e,setGetStatisticsFinancialStatus:i,setTableData:n}=u.useContext(R),{setTitlePage:r,setVisibleFilterBox:a,setVisibleSearchBox:o}=u.useContext(w);return u.useEffect(()=>(r(s.financial),o(!0),(async()=>{i({isFetching:!0});const t=await k(e,b);n({records:t.data,totalRecord:t.totalRecord}),i({isFetching:!1})})(),()=>{r(""),o(!1),a(!1)}),[]),[]},be=()=>(Se(),y(h.Wrapper,{children:[l(ge,{}),y(h.Container,{children:[l(h.Header,{children:l(ve,{})}),l(h.Content,{children:l(Re,{})})]})]})),en=()=>l(oe,{children:l(be,{})});export{en as default};
