import{_ as Xe,b as xe,c as Y,e as he,d as q,a as Q}from"./@babel-b64fd0f9.js";import{r,R as fe}from"./react-4fd50329.js";import{c as ne}from"./classnames-4ba1ba1a.js";import{i as Ge,e as Qe,D as Ve,K as Ze,f as Ce,E as er}from"./rc-util-0bc219f3.js";import{D as rr}from"./rc-dialog-b1d1f07b.js";import{C as tr}from"./rc-motion-ae889c42.js";import{P as or}from"./@rc-component-5a112e55.js";var nr=["visible","onVisibleChange","getContainer","current","countRender"],Te=r.createContext({previewUrls:new Map,setPreviewUrls:function(){return null},current:null,setCurrent:function(){return null},setShowPreview:function(){return null},setMousePosition:function(){return null},registerImage:function(){return function(){return null}},rootClassName:""}),ar=Te.Provider,ir=function(e){var a=e.previewPrefixCls,g=a===void 0?"rc-image-preview":a,P=e.children,n=e.icons,t=n===void 0?{}:n,c=e.preview,l=Xe(c)==="object"?c:{},L=l.visible,y=L===void 0?void 0:L,S=l.onVisibleChange,w=S===void 0?void 0:S,s=l.getContainer,C=s===void 0?void 0:s,z=l.current,O=z===void 0?0:z,X=l.countRender,G=X===void 0?void 0:X,E=xe(l,nr),$=r.useState(new Map),U=Y($,2),v=U[0],M=U[1],K=r.useState(),R=Y(K,2),A=R[0],Z=R[1],V=Ge(!!y,{value:y,onChange:w}),k=Y(V,2),p=k[0],N=k[1],f=r.useState(null),i=Y(f,2),m=i[0],b=i[1],x=y!==void 0,h=Array.from(v.keys()),F=h[O],W=new Map(Array.from(v).filter(function(I){var T=Y(I,2),J=T[1].canPreview;return!!J}).map(function(I){var T=Y(I,2),J=T[0],ae=T[1].url;return[J,ae]})),ee=function(T,J){var ae=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,re=function(){M(function(ce){var se=new Map(ce),ue=se.delete(T);return ue?se:ce})};return M(function(ie){return new Map(ie).set(T,{url:J,canPreview:ae})}),re},B=function(T){T.stopPropagation(),N(!1),b(null)};return r.useEffect(function(){Z(F)},[F]),r.useEffect(function(){!p&&x&&Z(F)},[F,x,p]),r.createElement(ar,{value:{isPreviewGroup:!0,previewUrls:W,setPreviewUrls:M,current:A,setCurrent:Z,setShowPreview:N,setMousePosition:b,registerImage:ee}},P,r.createElement(We,he({"aria-hidden":!p,visible:p,prefixCls:g,onClose:B,mousePosition:m,src:W.get(A),icons:t,getContainer:C,countRender:G},E)))},Ne=1,be=50,pe=1,sr=.2,lr=function(e){var a,g=e.visible,P=e.maskTransitionName,n=e.getContainer,t=e.prefixCls,c=e.rootClassName,l=e.icons,L=e.countRender,y=e.showSwitch,S=e.showProgress,w=e.current,s=e.count,C=e.scale,z=e.onSwitchLeft,O=e.onSwitchRight,X=e.onClose,G=e.onZoomIn,E=e.onZoomOut,$=e.onRotateRight,U=e.onRotateLeft,v=l.rotateLeft,M=l.rotateRight,K=l.zoomIn,R=l.zoomOut,A=l.close,Z=l.left,V=l.right,k="".concat(t,"-operations-operation"),p="".concat(t,"-operations-icon"),N=[{icon:A,onClick:X,type:"close"},{icon:K,onClick:G,type:"zoomIn",disabled:C===be},{icon:R,onClick:E,type:"zoomOut",disabled:C===Ne},{icon:M,onClick:$,type:"rotateRight"},{icon:v,onClick:U,type:"rotateLeft"}],f=r.createElement(r.Fragment,null,y&&r.createElement(r.Fragment,null,r.createElement("div",{className:ne("".concat(t,"-switch-left"),q({},"".concat(t,"-switch-left-disabled"),w===0)),onClick:z},Z),r.createElement("div",{className:ne("".concat(t,"-switch-right"),q({},"".concat(t,"-switch-right-disabled"),w===s-1)),onClick:O},V)),r.createElement("ul",{className:"".concat(t,"-operations")},S&&r.createElement("li",{className:"".concat(t,"-operations-progress")},(a=L==null?void 0:L(w+1,s))!==null&&a!==void 0?a:"".concat(w+1," / ").concat(s)),N.map(function(i){var m,b=i.icon,x=i.onClick,h=i.type,F=i.disabled;return r.createElement("li",{className:ne(k,(m={},q(m,"".concat(t,"-operations-operation-").concat(h),!0),q(m,"".concat(t,"-operations-operation-disabled"),!!F),m)),onClick:x,key:h},r.isValidElement(b)?r.cloneElement(b,{className:p}):b)})));return r.createElement(tr,{visible:g,motionName:P},function(i){var m=i.className,b=i.style;return r.createElement(or,{open:!0,getContainer:n??document.body},r.createElement("div",{className:ne("".concat(t,"-operations-wrapper"),m,c),style:b},f))})},De={x:0,y:0,rotate:0,scale:1};function cr(d){var e=r.useRef(null),a=r.useRef([]),g=r.useState(De),P=Y(g,2),n=P[0],t=P[1],c=function(){t(De)},l=function(S){e.current===null&&(a.current=[],e.current=Qe(function(){t(function(w){var s=w;return a.current.forEach(function(C){s=Q(Q({},s),C)}),e.current=null,s})})),a.current.push(Q(Q({},n),S))},L=function(S,w,s){var C=d.current,z=C.width,O=C.height,X=C.offsetWidth,G=C.offsetHeight,E=C.offsetLeft,$=C.offsetTop,U=S,v=n.scale*S;v>be?(U=be/n.scale,v=be):v<Ne&&(U=Ne/n.scale,v=Ne);var M=w??innerWidth/2,K=s??innerHeight/2,R=U-1,A=R*z*.5,Z=R*O*.5,V=R*(M-n.x-E),k=R*(K-n.y-$),p=n.x-(V-A),N=n.y-(k-Z);if(S<1&&v===1){var f=X*v,i=G*v,m=Ve(),b=m.width,x=m.height;f<=b&&i<=x&&(p=0,N=0)}l({x:p,y:N,scale:v})};return{transform:n,resetTransform:c,updateTransform:l,dispatchZoonChange:L}}function Ye(d,e,a,g){var P=e+a,n=(a-g)/2;if(a>g){if(e>0)return q({},d,n);if(e<0&&P<g)return q({},d,-n)}else if(e<0||P>g)return q({},d,e<0?n:-n);return{}}function ur(d,e,a,g){var P=Ve(),n=P.width,t=P.height,c=null;return d<=n&&e<=t?c={x:0,y:0}:(d>n||e>t)&&(c=Q(Q({},Ye("x",a,d,n)),Ye("y",g,e,t))),c}var vr=["prefixCls","src","alt","onClose","afterClose","visible","icons","rootClassName","getContainer","countRender","scaleStep","transitionName","maskTransitionName"],We=function(e){var a=e.prefixCls,g=e.src,P=e.alt,n=e.onClose;e.afterClose;var t=e.visible,c=e.icons,l=c===void 0?{}:c,L=e.rootClassName,y=e.getContainer,S=e.countRender,w=e.scaleStep,s=w===void 0?.5:w,C=e.transitionName,z=C===void 0?"zoom":C,O=e.maskTransitionName,X=O===void 0?"fade":O,G=xe(e,vr),E=r.useRef(),$=r.useRef({deltaX:0,deltaY:0,transformX:0,transformY:0}),U=r.useState(!1),v=Y(U,2),M=v[0],K=v[1],R=r.useContext(Te),A=R.previewUrls,Z=R.current,V=R.isPreviewGroup,k=R.setCurrent,p=A.size,N=Array.from(A.keys()),f=N.indexOf(Z),i=V?A.get(Z):g,m=V&&p>1,b=V&&p>=1,x=cr(E),h=x.transform,F=x.resetTransform,W=x.updateTransform,ee=x.dispatchZoonChange,B=h.rotate,I=h.scale,T=ne(q({},"".concat(a,"-moving"),M)),J=function(){F()},ae=function(){ee(pe+s)},re=function(){ee(pe-s)},ie=function(){W({rotate:B+90})},ce=function(){W({rotate:B-90})},se=function(o){o.preventDefault(),o.stopPropagation(),f>0&&k(N[f-1])},ue=function(o){o.preventDefault(),o.stopPropagation(),f<p-1&&k(N[f+1])},me=function(){if(t&&M){K(!1);var o=$.current,te=o.transformX,j=o.transformY,_=h.x!==te&&h.y!==j;if(!_)return;var H=E.current.offsetWidth*I,oe=E.current.offsetHeight*I,Pe=E.current.getBoundingClientRect(),ke=Pe.left,Se=Pe.top,ye=B%180!==0,Re=ur(ye?oe:H,ye?H:oe,ke,Se);Re&&W(Q({},Re))}},Ee=function(o){o.button===0&&(o.preventDefault(),o.stopPropagation(),$.current={deltaX:o.pageX-h.x,deltaY:o.pageY-h.y,transformX:h.x,transformY:h.y},K(!0))},de=function(o){t&&M&&W({x:o.pageX-$.current.deltaX,y:o.pageY-$.current.deltaY})},ge=function(o){if(!(!t||o.deltaY==0)){var te=Math.abs(o.deltaY/100),j=Math.min(te,sr),_=pe+j*s;o.deltaY>0&&(_=pe/_),ee(_,o.clientX,o.clientY)}},le=r.useCallback(function(u){!t||!m||(u.keyCode===Ze.LEFT?f>0&&k(N[f-1]):u.keyCode===Ze.RIGHT&&f<p-1&&k(N[f+1]))},[f,p,N,k,m,t]),Me=function(o){t&&(I!==1?W({x:0,y:0,scale:1}):ee(pe+s,o.clientX,o.clientY))};return r.useEffect(function(){var u,o,te=Ce(window,"mouseup",me,!1),j=Ce(window,"mousemove",de,!1),_=Ce(window,"keydown",le,!1);try{window.top!==window.self&&(u=Ce(window.top,"mouseup",me,!1),o=Ce(window.top,"mousemove",de,!1))}catch{}return function(){var H,oe;te.remove(),j.remove(),_.remove(),(H=u)===null||H===void 0||H.remove(),(oe=o)===null||oe===void 0||oe.remove()}},[t,M,le]),fe.createElement(fe.Fragment,null,fe.createElement(rr,he({transitionName:z,maskTransitionName:X,closable:!1,keyboard:!0,prefixCls:a,onClose:n,afterClose:J,visible:t,wrapClassName:T,rootClassName:L,getContainer:y},G),fe.createElement("div",{className:"".concat(a,"-img-wrapper")},fe.createElement("img",{width:e.width,height:e.height,onWheel:ge,onMouseDown:Ee,onDoubleClick:Me,ref:E,className:"".concat(a,"-img"),src:i,alt:P,style:{transform:"translate3d(".concat(h.x,"px, ").concat(h.y,"px, 0) scale3d(").concat(I,", ").concat(I,", 1) rotate(").concat(B,"deg)")}}))),fe.createElement(lr,{visible:t,maskTransitionName:X,getContainer:y,prefixCls:a,rootClassName:L,icons:l,countRender:S,showSwitch:m,showProgress:b,current:f,count:p,scale:I,onSwitchLeft:se,onSwitchRight:ue,onZoomIn:ae,onZoomOut:re,onRotateRight:ie,onRotateLeft:ce,onClose:n}))},fr=["src","alt","onPreviewClose","prefixCls","previewPrefixCls","placeholder","fallback","width","height","style","preview","className","onClick","onError","wrapperClassName","wrapperStyle","rootClassName","crossOrigin","decoding","loading","referrerPolicy","sizes","srcSet","useMap","draggable"],mr=["src","visible","onVisibleChange","getContainer","mask","maskClassName","icons","scaleStep"],ze=0,He=function(e){var a,g=e.src,P=e.alt,n=e.onPreviewClose,t=e.prefixCls,c=t===void 0?"rc-image":t,l=e.previewPrefixCls,L=l===void 0?"".concat(c,"-preview"):l,y=e.placeholder,S=e.fallback,w=e.width,s=e.height,C=e.style,z=e.preview,O=z===void 0?!0:z,X=e.className,G=e.onClick,E=e.onError,$=e.wrapperClassName,U=e.wrapperStyle,v=e.rootClassName,M=e.crossOrigin,K=e.decoding,R=e.loading,A=e.referrerPolicy,Z=e.sizes,V=e.srcSet,k=e.useMap,p=e.draggable,N=xe(e,fr),f=y&&y!==!0,i=Xe(O)==="object"?O:{},m=i.src,b=i.visible,x=b===void 0?void 0:b,h=i.onVisibleChange,F=h===void 0?n:h,W=i.getContainer,ee=W===void 0?void 0:W,B=i.mask,I=i.maskClassName,T=i.icons,J=i.scaleStep,ae=xe(i,mr),re=m??g,ie=x!==void 0,ce=Ge(!!x,{value:x,onChange:F}),se=Y(ce,2),ue=se[0],me=se[1],Ee=r.useState(f?"loading":"normal"),de=Y(Ee,2),ge=de[0],le=de[1],Me=r.useState(null),u=Y(Me,2),o=u[0],te=u[1],j=ge==="error",_=r.useContext(Te),H=_.isPreviewGroup,oe=_.setCurrent,Pe=_.setShowPreview,ke=_.setMousePosition,Se=_.registerImage,ye=r.useState(function(){return ze+=1,ze}),Re=Y(ye,1),Ie=Re[0],we=!!O,Le=r.useRef(!1),_e=function(){le("normal")},Ke=function(D){E&&E(D),le("error")},Fe=function(D){if(!ie){var $e=er(D.target),Ue=$e.left,Ae=$e.top;H?(oe(Ie),ke({x:Ue,y:Ae})):te({x:Ue,y:Ae})}H?Pe(!0):me(!0),G&&G(D)},je=function(D){D.stopPropagation(),me(!1),ie||te(null)},qe=function(D){Le.current=!1,ge==="loading"&&D!=null&&D.complete&&(D.naturalWidth||D.naturalHeight)&&(Le.current=!0,_e())};r.useEffect(function(){var ve=Se(Ie,re);return ve},[]),r.useEffect(function(){Se(Ie,re,we)},[re,we]),r.useEffect(function(){j&&le("normal"),f&&!Le.current&&le("loading")},[g]);var Be=ne(c,$,v,q({},"".concat(c,"-error"),j)),Je=j&&S?S:re,Oe={crossOrigin:M,decoding:K,draggable:p,loading:R,referrerPolicy:A,sizes:Z,srcSet:V,useMap:k,alt:P,className:ne("".concat(c,"-img"),q({},"".concat(c,"-img-placeholder"),y===!0),X),style:Q({height:s},C)};return r.createElement(r.Fragment,null,r.createElement("div",he({},N,{className:Be,onClick:we?Fe:G,style:Q({width:w,height:s},U)}),r.createElement("img",he({},Oe,{ref:qe},j&&S?{src:S}:{onLoad:_e,onError:Ke,src:g},{width:w,height:s})),ge==="loading"&&r.createElement("div",{"aria-hidden":"true",className:"".concat(c,"-placeholder")},y),B&&we&&r.createElement("div",{className:ne("".concat(c,"-mask"),I),style:{display:((a=Oe.style)===null||a===void 0?void 0:a.display)==="none"?"none":void 0}},B)),!H&&we&&r.createElement(We,he({"aria-hidden":!ue,visible:ue,prefixCls:L,onClose:je,mousePosition:o,src:Je,alt:P,getContainer:ee,icons:T,scaleStep:J,rootClassName:v},ae)))};He.PreviewGroup=ir;He.displayName="Image";export{He as I};
