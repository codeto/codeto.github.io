import{j as n,a as R,u as et,F as k}from"./@emotion-63839449.js";import{l as C,D as ot,P as h}from"./index-b17d22e5.js";import{r as u}from"./react-4fd50329.js";import{P as at}from"./prop-types-1172f4d5.js";import{l as e,a9 as g,s as I,K as st,b0 as it,aJ as ct,bv as nt,al as rt,ag as lt,X as B,i as V,A as pt,M as G,j as H,e4 as ut,a as U,I as W,a3 as mt,dq as _t,a5 as dt}from"./index-c2ded735.js";import"./react-redux-896b353b.js";import"./lodash-88fe09e6.js";import{h as N}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import"./@firebase-43527ee1.js";import{u as Pt}from"./react-router-a4308f7b.js";import{I as y,S as A}from"./index-43183512.js";import{d as ht}from"./downloadFileFromUrl-79614833.js";import{u as Q}from"./index-687ba9e6.js";import{B as gt}from"./antd-f9eae174.js";import{M as Nt}from"./index-6a3b7dc6.js";import{p as Et}from"./printHtml-6274ec45.js";import{g as Tt}from"./receipt-01489128.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./index-881eef42.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./index-f7aef2cc.js";const w=s=>{let t=s,a=!1;Number.isNaN(Number(s))&&(t=0),t<0&&(t*=-1,a=!0);const i=new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"});return a?`(${i.format(t)})`:i.format(t)},L="SUCCESSED",j="IN_PROCESS",X="CANCELLED",x={paymentAt:[N().startOf("months"),N().endOf("months")],apartment:"",orderCodeRef:"",paymentMethod:"",status:L},At=[{value:L,label:e.success},{value:j,label:e.in_progress},{value:X,label:e.canceled}],ft={[L]:e.success,[j]:e.in_progress,[X]:e.canceled},q="VNPAY_GW",$="VNPAY_QR",St="VNPAY_GW_MB_APP",Rt="VNPAY_GW_QR",It="VNPAY_GW_INTCARD",z="MOMO_IN_APP",K="CYHOME_MB_APP",J="SHOPEEPAY_IN_APP",Z="VNPAY_TOKEN",O="VNPAY_SPOS_QRCODE",tt="VNPAY_SPOS_CARD",Mt=[{value:z,label:e.momo_in_app},{value:K,label:e.cyhome_mb_app},{value:q,label:e.vnpay_gw},{value:$,label:e.vnpay_qr},{value:J,label:e.shopee_app},{value:Z,label:e.vnpay_token},{value:O,label:e.spos_qr},{value:tt,label:e.spos_card}],bt={[q]:e.vnpay_gw,[St]:e.vnpay_gw,[Rt]:e.vnpay_gw,[It]:e.vnpay_gw,[$]:e.vnpay_qr,[z]:e.momo_in_app,[K]:e.cyhome_mb_app,[J]:e.shopee_app,[Z]:e.vnpay_token,[O]:e.spos_qr,[tt]:e.spos_card},E=u.createContext({idBuilding:0,filter:{...x},setFilter:()=>{},tableData:{records:[],totalRecord:0},setTableData:()=>{},tablePagination:{current:g,limit:I},setTablePagination:()=>{},getsStatus:{isFetching:!1},setGetsStatus:()=>{}}),F=({children:s})=>{var P;const[t,a,i]=st(),{idBuilding:o}=Pt(),[c,r]=u.useState({...x}),[l,p]=u.useState({records:[],totalRecord:0}),[m,_]=u.useState({current:g,limit:I}),[d,f]=u.useState({isFetching:!1}),{getPermissionByModuleCode:M}=it(),D=((P=M(ct))==null?void 0:P[nt])??!1,S=M(rt),T=(S==null?void 0:S[lt])??!1,b={paymentOnlinePermissionExport:D,fundPermissionRead:T,idBuilding:o,filter:c,setFilter:r,tableData:l,setTableData:p,tablePagination:m,setTablePagination:_,getsStatus:d,setGetsStatus:f,receiptPrintForm:t,showReceiptPrintForm:a,hideReceiptPrintForm:i};return n(E.Provider,{value:b,children:s})};F.propTypes={children:at.node};F.defaultProps={children:n("div",{})};const vt=F,Ct=`${H}/payment-online/histories`,xt=`${H}/payment-online/histories/export-data`;async function Dt({filter:s,limit:t,page:a,idBuilding:i}){try{const o={[B]:i};return await V({type:pt,payload:{apiUrl:Ct,method:G.GET,options:{params:{...s,page:a,limit:t},headers:o}}})}catch(o){return o}}async function wt(s,t){try{const a={[B]:t};return await V({type:ut,payload:{apiUrl:xt,method:G.GET,options:{params:{...s},headers:a}}})}catch(a){return a}}const Lt=s=>s==null?void 0:s.map(t=>{var a,i;return{key:(t==null?void 0:t.id)??"",unit:(t==null?void 0:t.unitName)??"",receiptCode:((a=t==null?void 0:t.receipt)==null?void 0:a.code)??"",paymentCode:(t==null?void 0:t.orderCodeRef)??"",paymentAt:t!=null&&t.receipt?N((i=t==null?void 0:t.receipt)==null?void 0:i.paidAt).format("DD/MM/YYYY HH:mm"):"",paymentMethod:t!=null&&t.paymentMethod?bt[(t==null?void 0:t.paymentMethod)??""]:"",paymentStatus:t!=null&&t.status?ft[t==null?void 0:t.status]:"",receivables:t!=null&&t.amount?w((t==null?void 0:t.amount)??""):"",paymentFee:t!=null&&t.feeAmount?w((t==null?void 0:t.feeAmount)??""):"",totalPayment:t!=null&&t.amount?w(Number(t.amount)+Number(t.feeAmount)):"",contentPayment:(t==null?void 0:t.description)??"",paymentOnlineOrder:t}}),Ft=async({filter:s,limit:t,page:a,idBuilding:i})=>{const{apartment:o="",orderCodeRef:c="",paymentMethod:r=void 0,status:l=void 0,paymentAt:p}=s,m={apartment:o,orderCodeRef:c,paymentMethod:r,status:l};p&&p.length&&(m.from=N(p[0]).startOf("date").toISOString(),m.to=N(p[1]).endOf("date").toISOString());const _=await Dt({filter:{...m},limit:t,page:a,idBuilding:i}),d=Lt((_==null?void 0:_.data)??[]),f=(_==null?void 0:_.totalRecord)??0;return[d,f]},Y=()=>{const{setTableData:s}=u.useContext(E);return[async({filter:a,limit:i,page:o,idBuilding:c})=>{const[r,l]=await Ft({filter:a,limit:i,page:o,idBuilding:c});s({records:r,totalRecord:l})}]},Yt=()=>{const{setGetsStatus:s,setFilter:t,setTablePagination:a,idBuilding:i,fundPermissionRead:o}=u.useContext(E),[c]=Y();return[async l=>{s({isFetching:!0}),t(l),a({current:g,limit:I}),c({filter:{...l},idBuilding:i,limit:I,page:g}),s({isFetching:!1})},x,o]},yt=()=>{const[s,t,a]=Yt(),i=u.useMemo(()=>[{label:e.payment_at,key:"paymentAt",component:n(ot.RangePicker,{fluid:"true",placeholder:[C,C],format:[C,C],getPopupContainer:o=>o.parentNode}),visible:!0,fixed:!0},{label:e.unit,key:"apartment",component:n(y,{placeholder:e.unit}),visible:!0},{label:e.payment_code,key:"orderCodeRef",component:n(y,{placeholder:e.payment_code}),visible:!0},{label:e.payment_method,key:"paymentMethod",component:R(A,{fluid:"true",placeholder:e.payment_method,getPopupContainer:o=>o.parentNode,listHeight:400,children:[n(A.Option,{value:"",children:e.all_payment_method},"payment_method_0"),a?Mt.map(o=>n(A.Option,{value:o.value,children:o.label},o.value)):null]}),visible:!0},{label:e.payment_status,key:"status",component:R(A,{fluid:"true",placeholder:e.payment_status,getPopupContainer:o=>o.parentNode,children:[n(A.Option,{value:"",children:e.all_payment_status},"payment_status_0"),At.map(o=>n(A.Option,{value:o.value,children:o.label},o.value))]}),visible:!0}],[]);return n(h.FilterBox,{defaultFilter:t,filters:i,onSearch:s})},kt=()=>{const{getsStatus:s,setGetsStatus:t,tablePagination:a,setTablePagination:i,tableData:o,filter:c,idBuilding:r,showReceiptPrintForm:l}=u.useContext(E),{layoutScrollRef:p}=u.useContext(U),[m]=Y(),_=et(),d=async(T,b)=>{let{current:P,limit:v}=a;T!==P&&(P=T),b!==v&&(v=b,P=g),t({isFetching:!0}),i({current:P,limit:v}),await m({filter:c,limit:v,page:P,idBuilding:r}),t({isFetching:!1})},f={pageSize:a.limit,defaultCurrent:g,current:a.current,total:o.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:d},M={offsetScroll:_.offsetScrollX,getContainer:()=>p.current},D=T=>{l({paymentOnlineOrder:T})},{isFetching:S}=s;return[M,o.records,f,S,D]},Bt=()=>{const[s,t,a,i,o]=kt(),c=[{title:e.unit,key:"unit",dataIndex:"unit",width:100},{title:e.receipt_code,key:"receiptCode",dataIndex:"receiptCode",width:150},{title:e.payment_code,key:"paymentCode",dataIndex:"paymentCode",width:150},{title:e.content_payment,key:"contentPayment",dataIndex:"contentPayment",width:300,render:l=>n("div",{style:{maxWidth:"300px",width:"100%",whiteSpace:"pre-wrap"},children:l})},{title:e.payment_at,key:"paymentAt",width:150,dataIndex:"paymentAt"},{title:e.receivables,key:"receivables",dataIndex:"receivables",width:150},{title:e.payment_method,key:"paymentMethod",dataIndex:"paymentMethod",width:250},{title:e.payment_status,key:"paymentStatus",dataIndex:"paymentStatus",width:200},{title:e.fee,key:"paymentFee",dataIndex:"paymentFee",width:150},{title:e.total_money,key:"totalPayment",dataIndex:"totalPayment",width:150},{title:e.action,key:"action",dataIndex:"action",width:100,align:"center",fixed:"right",render:(l,p)=>n(W,{onClick:()=>o(p==null?void 0:p.paymentOnlineOrder),name:"icon-print-outlined",title:e.label.print,css:m=>({fontSize:m.iconSize})})}],r={x:c.reduce((l,p)=>p+l.width,0),scrollToFirstRowOnChange:!0};return n(h.Table,{sticky:s,scroll:r,columns:c,dataSource:t,loading:i,pagination:a})},Vt=async(s,t)=>{try{const{apartment:a="",orderCodeRef:i="",paymentMethod:o=void 0,status:c=void 0,paymentAt:r}=s,l={apartment:a,orderCodeRef:i,paymentMethod:o,status:c};return r&&r.length&&(l.from=N(r[0]).startOf("date").toISOString(),l.to=N(r[1]).endOf("date").toISOString()),await wt(l,t)}catch(a){return a}},Gt=()=>{const{filter:s,idBuilding:t,tableData:a,paymentOnlinePermissionExport:i}=u.useContext(E),[o,c]=u.useState({code:void 0,codeLanguage:void 0,isFetching:!1});Q(o.code,o.codeLanguage,{message:e.success,description:e.export_data_success});const r=async()=>{c({code:void 0,codeLanguage:void 0,isFetching:!0});const m=await Vt(s,t);m.data&&ht(m.data,document,"Thanh-toan-online.xlsx"),c({code:m.code,codeLanguage:m.codeLanguage,isFetching:!1})},{totalRecord:l}=a,{isFetching:p}=o;return[l,r,p,i]},Ht=()=>{const[s,t,a,i]=Gt(),o=mt(),c=[i?n(gt,{type:"primary",ghost:!0,loading:a,icon:n(W,{name:"icon-download-outlined"}),onClick:()=>{o({action:_t,label:dt}),t()},css:r=>({marginRight:r.margin.xs}),children:e.export},"export"):null].filter(Boolean);return n(h.ActionBox,{total:n(k,{children:s}),actions:c})},Ut=async(s,t)=>await Tt({idReceipt:s,idBuilding:t});function Wt(){var _;const{hideReceiptPrintForm:s,receiptPrintForm:t,idBuilding:a}=u.useContext(E),{receiptId:i}=(_=t==null?void 0:t.data)==null?void 0:_.paymentOnlineOrder,[o,c]=u.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[r,l]=u.useState();Q(o.code,o.codeLanguage);const p=()=>{s()},m=()=>{Et(r)};return u.useEffect(()=>{(async()=>{c({isFetching:!0});try{const d=await Ut(i,a);l(d.data),c({isFetching:!1,code:d.code,codeLanguage:d.codeLanguage})}catch(d){c({isFetching:!1,code:d.code,codeLanguage:d.codeLanguage})}})()},[]),[o,r,m,p]}function Qt(){const[s,t,a,i]=Wt();return n(Nt,{visible:!0,title:e.label.detail,okText:e.label.print,isLoadingPreview:s.isFetching,html:t||"<div />",onCancel:i,onOk:a})}const jt=()=>{const{setTitlePage:s,setVisibleFilterBox:t,setVisibleSearchBox:a}=u.useContext(U),{idBuilding:i,setGetsStatus:o,receiptPrintForm:c}=u.useContext(E),[r]=Y();return u.useEffect(()=>(s(e.payment_online),a(!0),(async()=>i&&(o({isFetching:!0}),await r({filter:{...x},idBuilding:i,limit:I,page:g}),o({isFetching:!1})))(),()=>{s(""),t(!1),a(!1)}),[]),[c]},Xt=()=>{const[s]=jt();return R(k,{children:[R(h.Wrapper,{children:[n(yt,{}),R(h.Container,{children:[n(h.Header,{children:n(Ht,{})}),n(h.Content,{children:n(Bt,{})})]})]}),s.isShow&&n(Qt,{})]})},Do=()=>n(vt,{children:n(Xt,{})});export{Do as default};
