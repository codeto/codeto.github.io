import{j as e,u as Oe,a as I,F as j}from"./@emotion-63839449.js";import{P as z,a as re,d as _e,w as ie,M as ct}from"./index-b17d22e5.js";import"./lodash-88fe09e6.js";import{h as tt}from"./moment-a468e1f9.js";import{l as t,a9 as oe,s as le,b0 as Ne,K as ge,aM as Y,at as Pe,ge as rt,gf as dt,a as Fe,a3 as ve,I as P,bH as ze,a5 as ae,bI as Ve,bG as Me,gg as ut,gh as mt,dk as pt}from"./index-c2ded735.js";import"./file-saver-40cf32a9.js";import{r as m}from"./react-4fd50329.js";import{P as Ge}from"./prop-types-1172f4d5.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{u as $e}from"./react-router-a4308f7b.js";import{I as N,S as D}from"./index-43183512.js";import{P as We}from"./index-d2c5b7c0.js";import{u as de,F as v}from"./index-687ba9e6.js";import{B as je,b as F,A as Se,R as he,S as it,g as ht}from"./antd-f9eae174.js";import{_ as be}from"./react-fast-marquee-2084ac54.js";import{g as ft}from"./department-807891d3.js";import{D as W}from"./document-96ae7510.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./index-881eef42.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";function nt(n){if(!n&&n!==0)return"";const i=["Bytes","KB","MB","GB","TB"];if(n===0)return"0 Byte";const c=parseInt(Math.floor(Math.log(n)/Math.log(1024)));return`${Math.round(n/Math.pow(1024,c),2)} ${i[c]}`}const ot="CONFIG_DOCUMENT_RESIDENT",lt="CONFIG_DOCUMENT_APARTMENT",qe="CONFIG_DOCUMENT_BUILDING",X={nameFilter:""},gt=[{label:t.building,value:qe},{label:t.unit,value:lt},{label:t.resident,value:ot}],ye="UNIT_GROUP_DOCUMENT",He="UNIT_DOCUMENT",Ie="RESIDENT_DOCUMENT",ne="GROUP",ce="FILE",Le=[{value:ne,label:t.label.group},{value:ce,label:t.label.file}],st="HOUSEHOLDER",_t="RENTER",Ft="MEMBER",vt="EMPOWER",Ue=[{value:st,label:t.label.householder},{value:_t,label:t.label.renter},{value:Ft,label:t.label.member},{value:vt,label:t.empower}],fe="",Ce={id:fe,name:`---${t.label.empty}---`},at="CHILDREN",St="PARENT",ue=m.createContext({idBuilding:0,documentPermissionWrite:!1,filter:{...X},setFilter:()=>{},tableData:{records:[],totalRecord:0},setTableData:()=>{},tablePagination:{current:oe,limit:le},setTablePagination:()=>{},getsStatus:{isFetching:!1},setGetsStatus:()=>{},formAddData:{data:{},isShow:!1},showFormAdd:()=>{},hideFormAdd:()=>{},formUpdateData:{data:{},isShow:!1},showFormUpdate:()=>{},hideFormUpdate:()=>{}}),Ye=({children:n})=>{var A;const{getPermissionByModuleCode:i}=Ne(),{idBuilding:c}=$e(),[l,u]=m.useState({...X}),[a,s]=m.useState({records:[],totalRecord:0}),[r,p]=m.useState({current:oe,limit:le}),[_,S]=m.useState({isFetching:!1}),[h,d,g]=ge(),[w,x,T]=ge(),f=((A=i(Y))==null?void 0:A[Pe])??!1,b={idBuilding:c,documentPermissionWrite:f,filter:l,setFilter:u,tableData:a,setTableData:s,tablePagination:r,setTablePagination:p,getsStatus:_,setGetsStatus:S,formAddData:h,showFormAdd:d,hideFormAdd:g,formUpdateData:w,showFormUpdate:x,hideFormUpdate:T};return e(ue.Provider,{value:b,children:n})};Ye.propTypes={children:Ge.node};Ye.defaultProps={children:e("div",{})};const bt=(n,i)=>{let c;const l=(n==null?void 0:n.filter(u=>u.parentId===i.id))??void 0;return l&&l.length?c=l:i.isFolder&&(c=[]),c},yt=(n,i,c)=>{if([ye,Ie].includes(i)){const l=n.map(r=>{var p;return{...r,key:r.id,creatorName:((p=r==null?void 0:r.creator)==null?void 0:p.fullName)??"",scopeOfUse:r.positions.length>0?r.positions.map(_=>_.name).join(", "):"",createdAt:tt(r.createdAt).format("DD/MM/YYYY"),fileSize:nt(r.size)}}),u=l==null?void 0:l.filter(r=>c?r.name.toLowerCase().indexOf(c.toLowerCase())!==-1&&!r.isFolder:!r.isFolder),a=u.filter(r=>!r.parentId);return l.filter(r=>r.isFolder||!r.isFolder&&!r.DocumentId).map(r=>{const p=bt(u,r);return{...r,children:p,isCollapse:!0}}).filter(r=>r.children&&(!c||r.children.length)).concat(a)}{const l=n.map(a=>{var s;return{...a,key:a.id,creatorName:((s=a==null?void 0:a.creator)==null?void 0:s.fullName)??"",scopeOfUse:a.unitRole&&a.unitRole.length?a.unitRole.split("-").map(r=>{var p;return((p=Ue.find(_=>_.value===r))==null?void 0:p.label)??""}).join(", "):"",createdAt:tt(a.createdAt).format("DD/MM/YYYY"),fileSize:nt(a.size),relationship:at}});let u=[];return l.forEach((a,s)=>{var r;a.unit&&!u.find(p=>p.unitId===a.unitId)&&u.push({name:((r=a==null?void 0:a.unit)==null?void 0:r.name)??"",unitId:a.unitId,key:a.unitId,relationship:St})}),c&&(u=u.filter(a=>a.name.toLowerCase().indexOf(c.toLowerCase())!==-1)),u.map(a=>({...a,children:l.filter(s=>s.unitId===a.unitId),isCollapse:!0}))}},Ke=async(n,i,c)=>{try{const{nameFilter:l=""}=n,u=await rt({type:i},c),a=yt((u==null?void 0:u.data)??[],i,l);return[a,a.length]}catch(l){return l}},De=()=>{const{setTableData:n}=m.useContext(ue);return[async(c,l)=>{const u=ye,[a,s]=await Ke(c,u,l);n({records:a,totalRecord:s})}]},It=()=>{const{setGetsStatus:n,setFilter:i,idBuilding:c}=m.useContext(ue),[l]=De();return[async a=>{n({isFetching:!0}),i(a),l(a,c),n({isFetching:!1})},X]},xt=()=>{const[n,i]=It(),c=m.useMemo(()=>[{label:t.file_name,key:"nameFilter",component:e(N,{placeholder:t.file_name}),visible:!0}],[]);return e(z.FilterBox,{defaultFilter:i,filters:c,onSearch:n})},Xe=async(n,i)=>{try{return await dt(n,i)}catch(c){return c}},wt=()=>{const{getsStatus:n,tableData:i,filter:c,idBuilding:l,showFormUpdate:u,documentPermissionWrite:a}=m.useContext(ue),s=Oe(),{layoutScrollRef:r}=m.useContext(Fe),[p]=De(),[_,S]=m.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),h={offsetScroll:s.offsetScrollX,getContainer:()=>r.current},d=x=>{u({document:x})},g=async x=>{S({code:void 0,codeLanguage:void 0,isFetching:!0});const T=await Xe(x,l);p(c,l),S({code:T.code,codeLanguage:T.codeLanguage,isFetching:!1})};de(_.code,_.codeLanguage,{message:t.success,description:t.delete_data_success});const{isFetching:w}=n;return[a,h,i.records,w,d,g]},Dt=()=>{const[n,i,c,l,u,a,s]=wt(),r=ve(),p=h=>{re.confirm({title:t.confirm,content:`${t.confirm_delete}?`,okText:t.confirm,okType:"danger",cancelText:t.cancel,confirmLoading:s,okBtnProps:{disabled:s,loading:s},onOk:async()=>(await a(h.id),Promise.resolve())})},_=[{title:t.name,key:"name",dataIndex:"name",width:250,fixed:"left"},{title:t.content,key:"content",dataIndex:"content",width:250},{title:t.description,key:"description",dataIndex:"description",width:250},{title:t.scope_of_use,key:"scopeOfUse",width:250,dataIndex:"scopeOfUse"},{title:t.creator,key:"creatorName",dataIndex:"creatorName",width:150},{title:t.file_size,key:"fileSize",dataIndex:"fileSize",width:150},{title:t.created_at,key:"createdAt",dataIndex:"createdAt",width:150},{title:t.action,key:"action",dataIndex:"action",width:100,align:"center",fixed:"right",render:(h,d)=>I(j,{children:[d.isFolder?null:e(P,{onClick:()=>{We.open({url:d.downloadLink})},name:"icon-eye-outlined",css:g=>({fontSize:g.iconSize,marginRight:g.margin.sm}),title:t.detail}),n?I(j,{children:[e(P,{onClick:()=>{r({action:ze,label:ae}),u(d)},name:"icon-edit-outlined",css:g=>({fontSize:g.iconSize,marginRight:g.margin.sm}),title:t.update}),e(P,{onClick:()=>{r({action:Ve,label:ae}),p(d)},name:"icon-minus-circle-outlined",css:g=>({fontSize:g.iconSize}),title:t.delete})]}):null]})}],S={x:_.reduce((h,d)=>d+h.width,0),scrollToFirstRowOnChange:!0};return e(z.Table,{sticky:i,scroll:S,columns:_,dataSource:c,loading:l,pagination:!1})},Tt=()=>{const{tableData:n,showFormAdd:i,documentPermissionWrite:c}=m.useContext(ue),l=()=>{i()},{totalRecord:u}=n;return[c,u,l]},At=()=>{const[n,i,c]=Tt(),l=ve(),u=[n?e(je,{onClick:()=>{l({action:Me,label:ae}),c()},type:"primary",icon:e(P,{name:"plus"}),children:t.add},"add"):null].filter(Boolean);return e(z.ActionBox,{total:e(j,{children:i}),actions:u})},Re=async n=>{try{return await ft(n,!0)}catch(i){return i}},Ze=async(n,i)=>{var c,l,u,a,s,r,p,_,S,h,d,g;try{const{type:w}=n;let{parentId:x}=n,T=!1;[ye,Ie].includes(w)&&!x&&(T=!0),x===fe&&(T=!1,x=null);const f=(n==null?void 0:n.accessRoles)??[],b={name:(n==null?void 0:n.name)??"",enName:(n==null?void 0:n.enName)??"",description:(n==null?void 0:n.description)??"",content:(n==null?void 0:n.content)??"",isFolder:T,positions:(n==null?void 0:n.positions)??[],departments:(n==null?void 0:n.departments)??[],parentId:x??null,size:((l=(c=n==null?void 0:n.file)==null?void 0:c.file)==null?void 0:l.size)??null,enSize:((a=(u=n==null?void 0:n.enFile)==null?void 0:u.file)==null?void 0:a.size)??null,downloadLink:((_=(p=(r=(s=n==null?void 0:n.file)==null?void 0:s.file)==null?void 0:r.response)==null?void 0:p.data)==null?void 0:_.url)??null,enDownloadLink:((g=(d=(h=(S=n==null?void 0:n.enFile)==null?void 0:S.file)==null?void 0:h.response)==null?void 0:d.data)==null?void 0:g.url)??null,unitId:(n==null?void 0:n.unitId)??null,unitRole:f&&f.length&&f.join("-")||null,type:w};return await ut(b,i)}catch(w){return w}},kt=()=>{const[n]=v.useForm(),[i]=De(),{hideFormAdd:c,idBuilding:l,filter:u,tableData:a}=m.useContext(ue),[s,r]=m.useState({data:[],isFetching:!1}),[p,_]=m.useState({data:[],isFetching:!1}),[S,h]=m.useState(ne),[d,g]=m.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),w=m.useMemo(()=>{const b=(a==null?void 0:a.records.filter(A=>A.isFolder))??[];return[Ce,...b]},[a==null?void 0:a.records]);m.useEffect(()=>{(async()=>{r({data:[],isFetching:!0});const b=await Re(l);r({data:b.data,isFetching:!1})})()},[]);const x=b=>{var A,V,K;if(b.departments&&b.departments.length){_({data:[],isFetching:!0});const y=b.departments;let R=[];const{data:E=[]}=s;E==null||E.forEach(G=>{y.includes(G.id)&&(R=[...R,...G.positions])}),n.setFieldsValue({positions:[]}),_({data:R,isFetching:!1})}if(b.file){const y=((A=b==null?void 0:b.file)==null?void 0:A.file.name)??"";n.setFieldsValue({name:y})}if(b.enFile){const y=((K=(V=b==null?void 0:b.enFile)==null?void 0:V.file)==null?void 0:K.name)??"";n.setFieldsValue({enName:y})}b.type===ne&&n.setFieldsValue({file:void 0,enFile:void 0,parentId:void 0})};de(d.code,d.codeLanguage,{message:t.success,description:t.add_data_success});const T=async()=>{if(await n.validateFields()){g({code:void 0,codeLanguage:void 0,isFetching:!0});const A=n.getFieldsValue(),V=await Ze({...A,type:ye},l);g({code:V.code,codeLanguage:V.codeLanguage,isFetching:!1}),i(u,l),c()}},f=b=>{h(b)};return[c,T,n,d.isFetching,s.data,s.isFetching,p.data,p.isFetching,S,f,w,x]},Lt=()=>{const[n,i,c,l,u,a,s,r,p,_,S,h]=kt();return e(re,{title:t.add_document_building,okText:t.add,cancelText:t.cancel,onOk:i,onCancel:n,open:!0,okButtonProps:{disabled:l,loading:l},width:"50%",children:e(v,{initialValues:{type:ne,parentId:fe,name:void 0,downloadLink:void 0,enName:void 0,enDownloadLink:void 0,content:void 0,description:void 0,departments:[],positions:[]},form:c,name:"formAdd",layout:"vertical",onValuesChange:h,children:I(he,{gutter:[12,0],children:[e(F,{span:"12",children:e(v.Item,{rules:[{required:!0}],label:t.type,name:"type",children:e(D,{placeholder:t.type,onSelect:_e(_),fluid:"true",children:Le.map(d=>e(D.Option,{value:d.value,children:d.label},d.value))})})}),p===ce?I(j,{children:[e(F,{span:"12",children:e(v.Item,{label:t.group,name:"parentId",children:e(D,{placeholder:t.group,fluid:"true",children:(S==null?void 0:S.map(d=>e(D.Option,{value:d.id,children:d.name},d.id)))??null})})}),e(F,{span:"12",children:e(v.Item,{rules:[{required:!0}],name:"file",label:t.file_in_vietnamese,children:I(ie.Dragger,{maxCount:1,limitSizeFile:W,module:Y,children:[e(P,{name:"icon-inbox-outlined",css:d=>({fontSize:"48px",color:d.primaryColor})}),e("h3",{children:t.click_or_drag_file_to_this_area_to_upload}),I("p",{css:d=>({color:d.labelColor}),children:[t.file_type,": .doc .docx .pdf .jpg..."]})]})})}),e(F,{span:"12",children:e(v.Item,{name:"enFile",label:t.file_in_english,children:I(ie.Dragger,{maxCount:1,limitSizeFile:W,module:Y,children:[e(P,{name:"icon-inbox-outlined",css:d=>({fontSize:"48px",color:d.primaryColor})}),e("h3",{children:t.click_or_drag_file_to_this_area_to_upload}),I("p",{css:d=>({color:d.labelColor}),children:[t.file_type,": .doc .docx .pdf .jpg..."]})]})})}),e(F,{span:"24",children:e(Se,{message:e(be,{pauseOnHover:!0,gradient:!1,speed:60,loop:1,delay:1,children:t.error.upload_file_size_limit.replace("{limitSize}",W)}),type:"warning",showIcon:!0,closable:!0})})]}):e(F,{span:"12"}),e(F,{span:"12",children:e(v.Item,{rules:[{required:!0}],label:t.name_in_vietnamese,name:"name",children:e(N,{fluid:"true",placeholder:t.name_in_vietnamese})})}),e(F,{span:"12",children:e(v.Item,{label:t.name_in_english,name:"enName",children:e(N,{fluid:"true",placeholder:t.name_in_english})})}),e(F,{span:"12",children:e(v.Item,{label:t.content,name:"content",children:e(N,{fluid:"true",placeholder:t.content})})}),e(F,{span:"12",children:e(v.Item,{label:t.description,name:"description",children:e(N,{fluid:"true",placeholder:t.description})})}),e(F,{span:"12",children:e(v.Item,{label:t.department,name:"departments",children:e(D,{mode:"multiple",placeholder:t.department,loading:a,fluid:"true",children:u==null?void 0:u.map(d=>e(D.Option,{value:d.id,children:d.name},d.id))})})}),e(F,{span:"12",children:e(v.Item,{label:t.position,name:"positions",children:e(D,{mode:"multiple",placeholder:t.position,loading:r,fluid:"true",children:s==null?void 0:s.map(d=>e(D.Option,{value:d.id,children:d.name},d.id))})})})]})})})},Je=async(n,i,c)=>{var l,u,a,s,r,p,_,S,h,d,g,w;try{const{type:x}=i;let{parentId:T}=i,f=!1;[ye,Ie].includes(x)&&!T&&(f=!0),T===fe&&(f=!1,T=null);const b=(i==null?void 0:i.accessRoles)??[],A={name:(i==null?void 0:i.name)??"",enName:(i==null?void 0:i.enName)??"",description:(i==null?void 0:i.description)??"",content:(i==null?void 0:i.content)??"",isFolder:f,positions:(i==null?void 0:i.positions)??[],departments:(i==null?void 0:i.departments)??[],parentId:T||null,size:((u=(l=i==null?void 0:i.file)==null?void 0:l.file)==null?void 0:u.size)??null,enSize:((s=(a=i==null?void 0:i.enFile)==null?void 0:a.file)==null?void 0:s.size)??null,downloadLink:((S=(_=(p=(r=i==null?void 0:i.file)==null?void 0:r.file)==null?void 0:p.response)==null?void 0:_.data)==null?void 0:S.url)??null,enDownloadLink:((w=(g=(d=(h=i==null?void 0:i.enFile)==null?void 0:h.file)==null?void 0:d.response)==null?void 0:g.data)==null?void 0:w.url)??null,unitId:(i==null?void 0:i.unitId)??null,unitRole:b&&b.length&&b.join("-")||null,type:x};return await mt(n,A,c)}catch(x){return x}},Be=n=>{const{isFolder:i=!1,parentId:c=null}=n;let l=null;return c?l=ce:c||(i?l=ne:l=ce),l},Ct=()=>{var H,Z;const[n]=v.useForm(),[i]=De(),{hideFormUpdate:c,idBuilding:l,filter:u,tableData:a,formUpdateData:s}=m.useContext(ue),[r,p]=m.useState({data:[],isFetching:!1}),[_,S]=m.useState({data:[],isFetching:!1}),[h,d]=m.useState(Be((H=s==null?void 0:s.data)==null?void 0:H.document)),[g,w]=m.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),x=m.useMemo(()=>{const o=(a==null?void 0:a.records.filter(L=>L.isFolder))??[];return[Ce,...o]},[a==null?void 0:a.records]),[T,f]=m.useState([]),[b,A]=m.useState([]),V=o=>{o.file.status==="removed"&&f([]),(o.file.status==="done"||o.file.status==="uploading")&&f(o.fileList)},K=o=>{o.file.status==="removed"&&A([]),(o.file.status==="done"||o.file.status==="uploading")&&A(o.fileList)};m.useEffect(()=>{(async()=>{var M,$,J,Q,ee,te,U,xe,we;p({data:[],isFetching:!0}),S({data:[],isFetching:!0});const o=await Re(l),L=((J=($=(M=s==null?void 0:s.data)==null?void 0:M.document)==null?void 0:$.positions)==null?void 0:J.map(q=>q.id))??[];let C=[];L&&L.length&&((Q=o==null?void 0:o.data)==null||Q.forEach((q,se)=>{C=[...C,...q.positions]}),C=C.filter(q=>L.includes(q.id))),S({data:C,isFetching:!1}),p({data:o.data,isFetching:!1});const B=Be((ee=s==null?void 0:s.data)==null?void 0:ee.document);d(B);const k=((U=(te=s==null?void 0:s.data)==null?void 0:te.document)==null?void 0:U.downloadLink)??"";if(k){const se=[{uid:"-1",name:k.substring(k.lastIndexOf("/")+1),status:"done",response:{data:{url:k}}}];f(se)}const O=((we=(xe=s==null?void 0:s.data)==null?void 0:xe.document)==null?void 0:we.enDownloadLink)??"";if(O){const se=[{uid:"-1",name:O.substring(O.lastIndexOf("/")+1),status:"done",response:{data:{url:O}}}];A(se)}})()},[]);const y=m.useMemo(()=>{var Q,ee,te;const o=((Q=s==null?void 0:s.data)==null?void 0:Q.document)??{},L=((ee=o==null?void 0:o.departments)==null?void 0:ee.map(U=>U.id))??[],C=((te=o==null?void 0:o.positions)==null?void 0:te.map(U=>U.id))??[],B=(o==null?void 0:o.downloadLink)??"",k=(o==null?void 0:o.enDownloadLink)??"",O=(o==null?void 0:o.size)??"",M=B.substring(B.lastIndexOf("/")+1),$=B.substring(k.lastIndexOf("/")+1),J=(o==null?void 0:o.enSize)??null;return{type:Be(o),parentId:(o==null?void 0:o.parentId)??fe,name:(o==null?void 0:o.name)??"",file:{file:{name:M,size:O,status:"done",uid:"-1",response:{data:{url:B}}},fileList:[{name:M,size:O,status:"done",uid:"-1",response:{data:{url:B}}}]},enName:(o==null?void 0:o.enName)??"",enFile:{file:{name:$,size:J,status:"done",uid:"-1",response:{data:{url:k}}},fileList:[{name:$,size:J,status:"done",uid:"-1",response:{data:{url:k}}}]},content:(o==null?void 0:o.content)??"",description:(o==null?void 0:o.description)??"",departments:L,positions:C}},[(Z=s==null?void 0:s.data)==null?void 0:Z.document]),R=o=>{var L,C,B;if(o.departments&&o.departments.length){S({data:[],isFetching:!0});const k=o.departments;let O=[];const{data:M=[]}=r;M==null||M.forEach($=>{k.includes($.id)&&(O=[...O,...$.positions])}),n.setFieldsValue({positions:[]}),S({data:O,isFetching:!1})}if(o.file){const k=((L=o==null?void 0:o.file)==null?void 0:L.file.name)??"";n.setFieldsValue({name:k})}if(o.enFile){const k=((B=(C=o==null?void 0:o.enFile)==null?void 0:C.file)==null?void 0:B.name)??"";n.setFieldsValue({enName:k})}o.type===ne&&n.setFieldsValue({file:void 0,enFile:void 0,parentId:void 0})};de(g.code,g.codeLanguage,{message:t.success,description:t.update_data_success});const E=async()=>{var L;if(await n.validateFields()){w({code:void 0,codeLanguage:void 0,isFetching:!0});const C=n.getFieldsValue(),B=(L=s==null?void 0:s.data)==null?void 0:L.document.id,k=await Je(B,{...C,type:ye},l);w({code:k.code,codeLanguage:k.codeLanguage,isFetching:!1}),i(u,l),c()}},G=o=>{d(o)};return[y,c,E,n,g.isFetching,r.data,r.isFetching,_.data,_.isFetching,h,G,x,R,T,V,b,K]},Rt=()=>{const[n,i,c,l,u,a,s,r,p,_,S,h,d,g,w,x,T]=Ct();return e(re,{title:t.update_document_building,okText:t.update,cancelText:t.cancel,onOk:c,onCancel:i,open:!0,okButtonProps:{disabled:u,loading:u},width:"50%",children:e(v,{initialValues:n,form:l,name:"formUpdate",layout:"vertical",onValuesChange:d,children:I(he,{gutter:[12,12],children:[e(F,{span:"12",children:e(v.Item,{rules:[{required:!0}],label:t.type,name:"type",children:e(D,{placeholder:t.type,onSelect:_e(S),fluid:"true",disabled:!0,children:Le.map(f=>e(D.Option,{value:f.value,children:f.label},f.value))})})}),_===ce?I(j,{children:[e(F,{span:"12",children:e(v.Item,{label:t.type,name:"parentId",children:e(D,{placeholder:t.group,fluid:"true",children:(h==null?void 0:h.map(f=>e(D.Option,{value:f.id,children:f.name},f.id)))??null})})}),e(F,{span:"12",children:e(v.Item,{rules:[{required:!0}],name:"file",label:t.file_in_vietnamese,children:I(ie.Dragger,{maxCount:1,fileList:g,onChange:w,limitSizeFile:W,module:Y,children:[e(P,{name:"icon-inbox-outlined",css:f=>({fontSize:"48px",color:f.primaryColor})}),e("h3",{children:t.click_or_drag_file_to_this_area_to_upload}),I("p",{css:f=>({color:f.labelColor}),children:[t.file_type,": .doc .docx .pdf .jpg..."]})]})})}),e(F,{span:"12",children:e(v.Item,{name:"enFile",label:t.file_in_english,children:I(ie.Dragger,{maxCount:1,fileList:x,onChange:T,limitSizeFile:W,module:Y,children:[e(P,{name:"icon-inbox-outlined",css:f=>({fontSize:"48px",color:f.primaryColor})}),e("h3",{children:t.click_or_drag_file_to_this_area_to_upload}),I("p",{css:f=>({color:f.labelColor}),children:[t.file_type,": .doc .docx .pdf .jpg..."]})]})})}),e(F,{span:"24",children:e(Se,{message:e(be,{pauseOnHover:!0,gradient:!1,speed:60,loop:1,delay:1,children:t.error.upload_file_size_limit.replace("{limitSize}",W)}),type:"warning",showIcon:!0,closable:!0})})]}):e(F,{span:"12"}),e(F,{span:"12",children:e(v.Item,{rules:[{required:!0}],label:t.name_in_vietnamese,name:"name",children:e(N,{fluid:"true",placeholder:t.name_in_vietnamese})})}),e(F,{span:"12",children:e(v.Item,{label:t.name_in_english,name:"enName",children:e(N,{fluid:"true",placeholder:t.name_in_english})})}),e(F,{span:"12",children:e(v.Item,{label:t.content,name:"content",children:e(N,{fluid:"true",placeholder:t.content})})}),e(F,{span:"12",children:e(v.Item,{label:t.description,name:"description",children:e(N,{fluid:"true",placeholder:t.description})})}),e(F,{span:"12",children:e(v.Item,{label:t.department,name:"departments",children:e(D,{mode:"multiple",placeholder:t.department,loading:s,fluid:"true",children:a==null?void 0:a.map(f=>e(D.Option,{value:f.id,children:f.name},f.id))})})}),e(F,{span:"12",children:e(v.Item,{label:t.position,name:"positions",children:e(D,{mode:"multiple",placeholder:t.position,loading:p,fluid:"true",children:r==null?void 0:r.map(f=>e(D.Option,{value:f.id,children:f.name},f.id))})})})]})})})},Bt=()=>{const{setTitlePage:n,setVisibleFilterBox:i,setVisibleSearchBox:c}=m.useContext(Fe),{idBuilding:l,setGetsStatus:u,formAddData:a,formUpdateData:s}=m.useContext(ue),[r]=De();return m.useEffect(()=>(n(t.building_document),c(!0),(async()=>l&&(u({isFetching:!0}),await r(X,l),u({isFetching:!1})))(),()=>{n(""),i(!1),c(!1)}),[]),[a,s]},Et=()=>{const[n,i]=Bt();return I(j,{children:[I(z.Wrapper,{children:[e(xt,{}),I(z.Container,{children:[e(z.Header,{children:e(At,{})}),e(z.Content,{children:e(Dt,{})})]})]}),n.isShow?e(Lt,{}):null,i.isShow?e(Rt,{}):null]})},Ot=()=>e(Ye,{children:e(Et,{})}),me=m.createContext({idBuilding:0,documentPermissionWrite:!1,filter:{...X},setFilter:()=>{},tableData:{records:[],totalRecord:0},setTableData:()=>{},tablePagination:{current:oe,limit:le},setTablePagination:()=>{},getsStatus:{isFetching:!1},setGetsStatus:()=>{},formAddData:{data:{},isShow:!1},showFormAdd:()=>{},hideFormAdd:()=>{},formUpdateData:{data:{},isShow:!1},showFormUpdate:()=>{},hideFormUpdate:()=>{}}),Qe=({children:n})=>{var A;const{getPermissionByModuleCode:i}=Ne(),{idBuilding:c}=$e(),[l,u]=m.useState({...X}),[a,s]=m.useState({records:[],totalRecord:0}),[r,p]=m.useState({current:oe,limit:le}),[_,S]=m.useState({isFetching:!1}),[h,d,g]=ge(),[w,x,T]=ge(),f=((A=i(Y))==null?void 0:A[Pe])??!1,b={idBuilding:c,documentPermissionWrite:f,filter:l,setFilter:u,tableData:a,setTableData:s,tablePagination:r,setTablePagination:p,getsStatus:_,setGetsStatus:S,formAddData:h,showFormAdd:d,hideFormAdd:g,formUpdateData:w,showFormUpdate:x,hideFormUpdate:T};return e(me.Provider,{value:b,children:n})};Qe.propTypes={children:Ge.node};Qe.defaultProps={children:e("div",{})};const Te=()=>{const{setTableData:n}=m.useContext(me);return[async(c,l)=>{const u=Ie,[a,s]=await Ke(c,u,l);n({records:a,totalRecord:s})}]},Nt=()=>{const{setGetsStatus:n,setFilter:i,idBuilding:c}=m.useContext(me),[l]=Te();return[async a=>{n({isFetching:!0}),i(a),l(a,c),n({isFetching:!1})},X]},Pt=()=>{const[n,i]=Nt(),c=m.useMemo(()=>[{label:t.file_name,key:"nameFilter",component:e(N,{placeholder:t.file_name}),visible:!0}],[]);return e(z.FilterBox,{defaultFilter:i,filters:c,onSearch:n})},zt=()=>{const{getsStatus:n,tableData:i,filter:c,idBuilding:l,showFormUpdate:u,documentPermissionWrite:a}=m.useContext(me),s=Oe(),{layoutScrollRef:r}=m.useContext(Fe),[p]=Te(),[_,S]=m.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),h={offsetScroll:s.offsetScrollX,getContainer:()=>r.current},d=x=>{u({document:x})},g=async x=>{if(x){S({code:void 0,codeLanguage:void 0,isFetching:!0});const T=await Xe(x,l);S({code:T.code,codeLanguage:T.codeLanguage,isFetching:!1}),p(c,l)}};de(_.code,_.codeLanguage,{message:t.success,description:t.delete_data_success});const{isFetching:w}=n;return[a,h,i.records,w,d,g]},Vt=()=>{const[n,i,c,l,u,a,s]=zt(),r=ve(),p=h=>{re.confirm({title:t.confirm,content:`${t.confirm_delete}?`,okText:t.confirm,okType:"danger",cancelText:t.cancel,confirmLoading:s,okBtnProps:{disabled:s,loading:s},onOk:async()=>(await a(h.id),Promise.resolve())})},_=[{title:t.name,key:"name",dataIndex:"name",width:250,fixed:"left"},{title:t.content,key:"content",dataIndex:"content",width:250},{title:t.description,key:"description",dataIndex:"description",width:250},{title:t.scope_of_use,key:"scopeOfUse",width:250,dataIndex:"scopeOfUse"},{title:t.creator,key:"creatorName",dataIndex:"creatorName",width:150},{title:t.file_size,key:"fileSize",dataIndex:"fileSize",width:150},{title:t.created_at,key:"createdAt",dataIndex:"createdAt",width:150},{title:t.action,key:"action",dataIndex:"action",width:100,align:"center",fixed:"right",render:(h,d)=>I(j,{children:[d.isFolder?null:e(P,{onClick:()=>{We.open({url:d.downloadLink})},name:"icon-eye-outlined",css:g=>({fontSize:g.iconSize,marginRight:g.margin.sm}),title:t.detail}),n?I(j,{children:[e(P,{onClick:()=>{r({action:ze,label:ae}),u(d)},name:"icon-edit-outlined",css:g=>({fontSize:g.iconSize,marginRight:g.margin.sm}),title:t.update}),e(P,{onClick:()=>{r({action:Ve,label:ae}),p(d)},name:"icon-minus-circle-outlined",css:g=>({fontSize:g.iconSize}),title:t.delete})]}):null]})}],S={x:_.reduce((h,d)=>d+h.width,0),scrollToFirstRowOnChange:!0};return e(z.Table,{sticky:i,scroll:S,columns:_,dataSource:c,loading:l,pagination:!1})},Mt=()=>{const{tableData:n,showFormAdd:i,documentPermissionWrite:c}=m.useContext(me),l=()=>{i()},{totalRecord:u}=n;return[c,u,l]},Gt=()=>{const[n,i,c]=Mt(),l=ve(),u=[n?e(je,{onClick:()=>{l({action:Me,label:ae}),c()},type:"primary",icon:e(P,{name:"plus"}),children:t.add},"add"):null].filter(Boolean);return e(z.ActionBox,{total:e(j,{children:i}),actions:u})},$t=()=>{const[n]=v.useForm(),[i]=Te(),{hideFormAdd:c,idBuilding:l,filter:u,tableData:a}=m.useContext(me),[s,r]=m.useState({data:[],isFetching:!1}),[p,_]=m.useState({data:[],isFetching:!1}),[S,h]=m.useState(ne),[d,g]=m.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),w=m.useMemo(()=>{const b=(a==null?void 0:a.records.filter(A=>A.isFolder))??[];return[Ce,...b]},[a==null?void 0:a.records]);m.useEffect(()=>{(async()=>{r({data:[],isFetching:!0});const b=await Re(l);r({data:b.data,isFetching:!1})})()},[]);const x=b=>{var A,V,K;if(b.departments&&b.departments.length){_({data:[],isFetching:!0});const y=b.departments;let R=[];const{data:E=[]}=s;E==null||E.forEach(G=>{y.includes(G.id)&&(R=[...R,...G.positions])}),n.setFieldsValue({positions:[]}),_({data:R,isFetching:!1})}if(b.file){const y=((A=b==null?void 0:b.file)==null?void 0:A.file.name)??"";n.setFieldsValue({name:y})}if(b.enFile){const y=((K=(V=b==null?void 0:b.enFile)==null?void 0:V.file)==null?void 0:K.name)??"";n.setFieldsValue({enName:y})}b.type===ne&&n.setFieldsValue({file:void 0,enFile:void 0,parentId:void 0})};de(d.code,d.codeLanguage,{message:t.success,description:t.add_data_success});const T=async()=>{if(await n.validateFields()){g({code:void 0,codeLanguage:void 0,isFetching:!0});const A=n.getFieldsValue(),V=await Ze({...A,type:Ie},l);g({code:V.code,codeLanguage:V.codeLanguage,isFetching:!1}),i(u,l),c()}},f=b=>{h(b)};return[c,T,n,d.isFetching,s.data,s.isFetching,p.data,p.isFetching,S,f,w,x]},Wt=()=>{const[n,i,c,l,u,a,s,r,p,_,S,h]=$t();return e(re,{title:t.add_document_resident,okText:t.add,cancelText:t.cancel,onOk:i,onCancel:n,open:!0,okButtonProps:{disabled:l,loading:l},width:"50%",children:e(v,{initialValues:{type:ne,parentId:fe,name:void 0,downloadLink:void 0,enName:void 0,enDownloadLink:void 0,content:void 0,description:void 0,departments:[],positions:[]},form:c,name:"formAdd",layout:"vertical",onValuesChange:h,children:I(he,{gutter:[12,12],children:[e(F,{span:"12",children:e(v.Item,{rules:[{required:!0}],label:t.type,name:"type",children:e(D,{placeholder:t.type,onSelect:_e(_),fluid:"true",children:Le.map(d=>e(D.Option,{value:d.value,children:d.label},d.value))})})}),p===ce?I(j,{children:[e(F,{span:"12",children:e(v.Item,{label:t.group,name:"parentId",children:e(D,{placeholder:t.group,fluid:"true",children:(S==null?void 0:S.map(d=>e(D.Option,{value:d.id,children:d.name},d.id)))??null})})}),e(F,{span:"12",children:e(v.Item,{rules:[{required:!0}],name:"file",label:t.file_in_vietnamese,children:I(ie.Dragger,{maxCount:1,limitSizeFile:W,module:Y,children:[e(P,{name:"icon-inbox-outlined",css:d=>({fontSize:"48px",color:d.primaryColor})}),e("h3",{children:t.click_or_drag_file_to_this_area_to_upload}),I("p",{css:d=>({color:d.labelColor}),children:[t.file_type,": .doc .docx .pdf .jpg..."]})]})})}),e(F,{span:"12",children:e(v.Item,{name:"enFile",label:t.file_in_english,children:I(ie.Dragger,{maxCount:1,limitSizeFile:W,module:Y,children:[e(P,{name:"icon-inbox-outlined",css:d=>({fontSize:"48px",color:d.primaryColor})}),e("h3",{children:t.click_or_drag_file_to_this_area_to_upload}),I("p",{css:d=>({color:d.labelColor}),children:[t.file_type,": .doc .docx .pdf .jpg..."]})]})})}),e(F,{span:"24",children:e(Se,{message:e(be,{pauseOnHover:!0,gradient:!1,speed:60,loop:1,delay:1,children:t.error.upload_file_size_limit.replace("{limitSize}",W)}),type:"warning",showIcon:!0,closable:!0})})]}):e(F,{span:"12"}),e(F,{span:"12",children:e(v.Item,{rules:[{required:!0}],label:t.name_in_vietnamese,name:"name",children:e(N,{fluid:"true",placeholder:t.name_in_vietnamese})})}),e(F,{span:"12",children:e(v.Item,{label:t.name_in_english,name:"enName",children:e(N,{fluid:"true",placeholder:t.name_in_english})})}),e(F,{span:"12",children:e(v.Item,{label:t.content,name:"content",children:e(N,{fluid:"true",placeholder:t.content})})}),e(F,{span:"12",children:e(v.Item,{label:t.description,name:"description",children:e(N,{fluid:"true",placeholder:t.description})})}),e(F,{span:"12",children:e(v.Item,{label:t.department,name:"departments",children:e(D,{mode:"multiple",placeholder:t.department,loading:a,fluid:"true",children:u==null?void 0:u.map(d=>e(D.Option,{value:d.id,children:d.name},d.id))})})}),e(F,{span:"12",children:e(v.Item,{label:t.position,name:"positions",children:e(D,{mode:"multiple",placeholder:t.position,loading:r,fluid:"true",children:s==null?void 0:s.map(d=>e(D.Option,{value:d.id,children:d.name},d.id))})})})]})})})},Ee=n=>{const{isFolder:i=!1,parentId:c=null}=n;let l=null;return c?l=ce:c||(i?l=ne:l=ce),l},jt=()=>{var H,Z;const[n]=v.useForm(),[i]=Te(),{hideFormUpdate:c,idBuilding:l,filter:u,tableData:a,formUpdateData:s}=m.useContext(me),[r,p]=m.useState({data:[],isFetching:!1}),[_,S]=m.useState({data:[],isFetching:!1}),[h,d]=m.useState(Ee((H=s==null?void 0:s.data)==null?void 0:H.document)),[g,w]=m.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),x=m.useMemo(()=>{const o=(a==null?void 0:a.records.filter(L=>L.isFolder))??[];return[Ce,...o]},[a==null?void 0:a.records]),[T,f]=m.useState([]),[b,A]=m.useState([]),V=o=>{o.file.status==="removed"&&f([]),(o.file.status==="done"||o.file.status==="uploading")&&f(o.fileList)},K=o=>{o.file.status==="removed"&&A([]),(o.file.status==="done"||o.file.status==="uploading")&&A(o.fileList)};m.useEffect(()=>{(async()=>{var M,$,J,Q,ee,te,U,xe,we;p({data:[],isFetching:!0}),S({data:[],isFetching:!0});const o=await Re(l),L=((J=($=(M=s==null?void 0:s.data)==null?void 0:M.document)==null?void 0:$.positions)==null?void 0:J.map(q=>q.id))??[];let C=[];L&&L.length&&((Q=o==null?void 0:o.data)==null||Q.forEach((q,se)=>{C=[...C,...q.positions]}),C=C.filter(q=>L.includes(q.id))),S({data:C,isFetching:!1}),p({data:o.data,isFetching:!1});const B=Ee((ee=s==null?void 0:s.data)==null?void 0:ee.document);d(B);const k=((U=(te=s==null?void 0:s.data)==null?void 0:te.document)==null?void 0:U.downloadLink)??"";if(k){const se=[{uid:"-1",name:k.substring(k.lastIndexOf("/")+1),status:"done",response:{data:{url:k}}}];f(se)}const O=((we=(xe=s==null?void 0:s.data)==null?void 0:xe.document)==null?void 0:we.enDownloadLink)??"";if(O){const se=[{uid:"-1",name:O.substring(O.lastIndexOf("/")+1),status:"done",response:{data:{url:O}}}];A(se)}})()},[(Z=s==null?void 0:s.data)==null?void 0:Z.document,l]);const y=m.useMemo(()=>{var Q,ee,te;const o=((Q=s==null?void 0:s.data)==null?void 0:Q.document)??{},L=((ee=o==null?void 0:o.departments)==null?void 0:ee.map(U=>U.id))??[],C=((te=o==null?void 0:o.positions)==null?void 0:te.map(U=>U.id))??[],B=(o==null?void 0:o.downloadLink)??"",k=(o==null?void 0:o.enDownloadLink)??"",O=(o==null?void 0:o.size)??"",M=B.substring(B.lastIndexOf("/")+1),$=B.substring(k.lastIndexOf("/")+1),J=(o==null?void 0:o.enSize)??null;return{type:Ee(o),parentId:(o==null?void 0:o.parentId)??fe,name:(o==null?void 0:o.name)??"",file:{file:{name:M,size:O,status:"done",uid:"-1",response:{data:{url:B}}},fileList:[{name:M,size:O,status:"done",uid:"-1",response:{data:{url:B}}}]},enName:(o==null?void 0:o.enName)??"",enFile:{file:{name:$,size:J,status:"done",uid:"-1",response:{data:{url:k}}},fileList:[{name:$,size:J,status:"done",uid:"-1",response:{data:{url:k}}}]},content:(o==null?void 0:o.content)??"",description:(o==null?void 0:o.description)??"",departments:L,positions:C}},[]),R=o=>{var L,C,B;if(o.departments&&o.departments.length){S({data:[],isFetching:!0});const k=o.departments;let O=[];const{data:M=[]}=r;M==null||M.forEach($=>{k.includes($.id)&&(O=[...O,...$.positions])}),n.setFieldsValue({positions:[]}),S({data:O,isFetching:!1})}if(o.file){const k=((L=o==null?void 0:o.file)==null?void 0:L.file.name)??"";n.setFieldsValue({name:k})}if(o.enFile){const k=((B=(C=o==null?void 0:o.enFile)==null?void 0:C.file)==null?void 0:B.name)??"";n.setFieldsValue({enName:k})}o.type===ne&&n.setFieldsValue({file:void 0,enFile:void 0,parentId:void 0})};de(g.code,g.codeLanguage,{message:t.success,description:t.update_data_success});const E=async()=>{var L;if(await n.validateFields()){w({code:void 0,codeLanguage:void 0,isFetching:!0});const C=n.getFieldsValue(),B=(L=s==null?void 0:s.data)==null?void 0:L.document.id,k=await Je(B,{...C,type:Ie},l);w({code:k.code,codeLanguage:k.codeLanguage,isFetching:!1}),i(u,l),c()}},G=o=>{d(o)};return[y,c,E,n,g.isFetching,r.data,r.isFetching,_.data,_.isFetching,h,G,x,R,T,V,b,K]},qt=()=>{const[n,i,c,l,u,a,s,r,p,_,S,h,d,g,w,x,T]=jt();return e(re,{title:t.update_document_resident,okText:t.update,cancelText:t.cancel,onOk:c,onCancel:i,open:!0,okButtonProps:{disabled:u,loading:u},width:"50%",children:e(v,{initialValues:n,form:l,name:"formUpdate",layout:"vertical",onValuesChange:d,children:I(he,{gutter:[12,12],children:[e(F,{span:"12",children:e(v.Item,{rules:[{required:!0}],label:t.type,name:"type",children:e(D,{placeholder:t.type,onSelect:_e(S),fluid:"true",disabled:!0,children:Le.map(f=>e(D.Option,{value:f.value,children:f.label},f.value))})})}),_===ce?I(j,{children:[e(F,{span:"12",children:e(v.Item,{label:t.group,name:"parentId",children:e(D,{placeholder:t.group,fluid:"true",children:(h==null?void 0:h.map(f=>e(D.Option,{value:f.id,children:f.name},f.id)))??null})})}),e(F,{span:"12",children:e(v.Item,{rules:[{required:!0}],name:"file",label:t.file_in_vietnamese,children:I(ie.Dragger,{maxCount:1,fileList:g,onChange:w,limitSizeFile:W,module:Y,children:[e(P,{name:"icon-inbox-outlined",css:f=>({fontSize:"48px",color:f.primaryColor})}),e("h3",{children:t.click_or_drag_file_to_this_area_to_upload}),I("p",{css:f=>({color:f.labelColor}),children:[t.file_type,": .doc .docx .pdf .jpg..."]})]})})}),e(F,{span:"12",children:e(v.Item,{name:"enFile",label:t.file_in_english,children:I(ie.Dragger,{maxCount:1,fileList:x,onChange:T,limitSizeFile:W,module:Y,children:[e(P,{name:"icon-inbox-outlined",css:f=>({fontSize:"48px",color:f.primaryColor})}),e("h3",{children:t.click_or_drag_file_to_this_area_to_upload}),I("p",{css:f=>({color:f.labelColor}),children:[t.file_type,": .doc .docx .pdf .jpg..."]})]})})}),e(F,{span:"24",children:e(Se,{message:e(be,{pauseOnHover:!0,gradient:!1,speed:60,loop:1,delay:1,children:t.error.upload_file_size_limit.replace("{limitSize}",W)}),type:"warning",showIcon:!0,closable:!0})})]}):e(F,{span:"12"}),e(F,{span:"12",children:e(v.Item,{rules:[{required:!0}],label:t.name_in_vietnamese,name:"name",children:e(N,{fluid:"true",placeholder:t.name_in_vietnamese})})}),e(F,{span:"12",children:e(v.Item,{label:t.name_in_english,name:"enName",children:e(N,{fluid:"true",placeholder:t.name_in_english})})}),e(F,{span:"12",children:e(v.Item,{label:t.content,name:"content",children:e(N,{fluid:"true",placeholder:t.content})})}),e(F,{span:"12",children:e(v.Item,{label:t.description,name:"description",children:e(N,{fluid:"true",placeholder:t.description})})}),e(F,{span:"12",children:e(v.Item,{label:t.department,name:"departments",children:e(D,{mode:"multiple",placeholder:t.department,loading:s,fluid:"true",children:a==null?void 0:a.map(f=>e(D.Option,{value:f.id,children:f.name},f.id))})})}),e(F,{span:"12",children:e(v.Item,{label:t.position,name:"positions",children:e(D,{mode:"multiple",placeholder:t.position,loading:p,fluid:"true",children:r==null?void 0:r.map(f=>e(D.Option,{value:f.id,children:f.name},f.id))})})})]})})})},Ht=()=>{const{setTitlePage:n,setVisibleFilterBox:i,setVisibleSearchBox:c}=m.useContext(Fe),{idBuilding:l,setGetsStatus:u,formAddData:a,formUpdateData:s}=m.useContext(me),[r]=Te();return m.useEffect(()=>(n(t.resident_document),c(!0),(async()=>l&&(u({isFetching:!0}),await r(X,l),u({isFetching:!1})))(),()=>{n(""),i(!1),c(!1)}),[]),[a,s]},Ut=()=>{const[n,i]=Ht();return I(j,{children:[I(z.Wrapper,{children:[e(Pt,{}),I(z.Container,{children:[e(z.Header,{children:e(Gt,{})}),e(z.Content,{children:e(Vt,{})})]})]}),n.isShow?e(Wt,{}):null,i.isShow?e(qt,{}):null]})},Yt=()=>e(Qe,{children:e(Ut,{})}),pe=m.createContext({idBuilding:0,documentPermissionWrite:!1,filter:{...X},setFilter:()=>{},tableData:{records:[],totalRecord:0},setTableData:()=>{},tablePagination:{current:oe,limit:le},setTablePagination:()=>{},getsStatus:{isFetching:!1},setGetsStatus:()=>{},formAddData:{data:{},isShow:!1},showFormAdd:()=>{},hideFormAdd:()=>{},formUpdateData:{data:{},isShow:!1},showFormUpdate:()=>{},hideFormUpdate:()=>{}}),et=({children:n})=>{var A;const{getPermissionByModuleCode:i}=Ne(),{idBuilding:c}=$e(),[l,u]=m.useState({...X}),[a,s]=m.useState({records:[],totalRecord:0}),[r,p]=m.useState({current:oe,limit:le}),[_,S]=m.useState({isFetching:!1}),[h,d,g]=ge(),[w,x,T]=ge(),f=((A=i(Y))==null?void 0:A[Pe])??!1,b={idBuilding:c,documentPermissionWrite:f,filter:l,setFilter:u,tableData:a,setTableData:s,tablePagination:r,setTablePagination:p,getsStatus:_,setGetsStatus:S,formAddData:h,showFormAdd:d,hideFormAdd:g,formUpdateData:w,showFormUpdate:x,hideFormUpdate:T};return e(pe.Provider,{value:b,children:n})};et.propTypes={children:Ge.node};et.defaultProps={children:e("div",{})};const Ae=()=>{const{setTableData:n}=m.useContext(pe);return[async(c,l)=>{const u=He,[a,s]=await Ke(c,u,l);n({records:a,totalRecord:s})}]},Kt=()=>{const{setGetsStatus:n,setFilter:i,idBuilding:c}=m.useContext(pe),[l]=Ae();return[async a=>{n({isFetching:!0}),i(a),l(a,c),n({isFetching:!1})},X]},Xt=()=>{const[n,i]=Kt(),c=m.useMemo(()=>[{label:t.unit,key:"nameFilter",component:e(N,{placeholder:t.unit}),visible:!0}]);return e(z.FilterBox,{defaultFilter:i,filters:c,onSearch:n})},Zt=()=>{const{getsStatus:n,tableData:i,filter:c,idBuilding:l,showFormUpdate:u,documentPermissionWrite:a}=m.useContext(pe),{layoutScrollRef:s}=m.useContext(Fe),r=Oe(),[p]=Ae(),[_,S]=m.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),h={offsetScroll:r.offsetScrollX,getContainer:()=>s.current},d=x=>{u({document:x})},g=async x=>{if(x){S({code:void 0,codeLanguage:void 0,isFetching:!0});const T=await Xe(x,l);S({code:T.code,codeLanguage:T.codeLanguage,isFetching:!1}),p(c,l)}};de(_.code,_.codeLanguage,{message:t.success,description:t.delete_data_success});const{isFetching:w}=n;return[a,h,i.records,w,d,g]},Jt=()=>{const[n,i,c,l,u,a,s]=Zt(),r=ve(),p=h=>{re.confirm({title:t.confirm,content:`${t.confirm_delete}?`,okText:t.confirm,okType:"danger",cancelText:t.cancel,confirmLoading:s,okBtnProps:{disabled:s,loading:s},onOk:async()=>(await a(h.id),Promise.resolve())})},_=[{title:t.name,key:"name",dataIndex:"name",width:250,fixed:"left"},{title:t.description,key:"description",dataIndex:"description",width:250},{title:t.scope_of_use,key:"scopeOfUse",width:250,dataIndex:"scopeOfUse"},{title:t.creator,key:"creatorName",dataIndex:"creatorName",width:150},{title:t.file_size,key:"fileSize",dataIndex:"fileSize",width:150},{title:t.created_at,key:"createdAt",dataIndex:"createdAt",width:150},{title:t.action,key:"action",dataIndex:"action",width:100,align:"center",fixed:"right",render:(h,d)=>d.relationship===at?I(j,{children:[e(P,{onClick:()=>{We.open({url:d.downloadLink})},name:"icon-eye-outlined",css:g=>({fontSize:g.iconSize,marginRight:g.margin.sm}),title:t.detail}),n?I(j,{children:[e(P,{onClick:()=>{r({action:ze,label:ae}),u(d)},name:"icon-edit-outlined",css:g=>({fontSize:g.iconSize,marginRight:g.margin.sm}),title:t.update}),e(P,{onClick:()=>{r({action:Ve,label:ae}),p(d)},name:"icon-minus-circle-outlined",css:g=>({fontSize:g.iconSize}),title:t.delete})]}):null]}):null}],S={x:_.reduce((h,d)=>d+h.width,0),scrollToFirstRowOnChange:!0};return e(z.Table,{sticky:i,scroll:S,columns:_,dataSource:c,loading:l,pagination:!1,defaultExpandAllRows:!0})},Qt=()=>{const{tableData:n,showFormAdd:i,documentPermissionWrite:c}=m.useContext(pe),l=()=>{i()},{totalRecord:u}=n;return[c,u,l]},en=()=>{const n=ve(),[i,c,l]=Qt(),u=[i?e(je,{onClick:()=>{n({action:Me,label:ae}),l()},type:"primary",icon:e(P,{name:"plus"}),children:t.add},"add"):null].filter(Boolean);return e(z.ActionBox,{total:e(j,{children:c}),actions:u})},ke=async({filter:n,limit:i,page:c,idBuilding:l})=>{try{return await pt({filter:n,limit:i,page:c,idBuilding:l})}catch(u){return u}},tn=()=>{const[n]=v.useForm(),[i]=Ae(),{hideFormAdd:c,idBuilding:l,filter:u}=m.useContext(pe),[a,s]=m.useState({data:[],isFetching:!1}),[r,p]=m.useState({code:void 0,codeLanguage:void 0,isFetching:!1});m.useEffect(()=>{(async()=>{s({data:[],isFetching:!0});const d=await ke({idBuilding:l,limit:le,page:oe,filter:{name:void 0}});s({data:d.data,isFetching:!1})})()},[]);const _=d=>{var g;if(d.file){const w=((g=d==null?void 0:d.file)==null?void 0:g.file.name)??"";n.setFieldsValue({name:w})}};de(r.code,r.codeLanguage,{message:t.success,description:t.add_data_success});const S=async()=>{if(await n.validateFields()){p({code:void 0,codeLanguage:void 0,isFetching:!0});const g=n.getFieldsValue(),w=await Ze({...g,type:He},l);p({code:w.code,codeLanguage:w.codeLanguage,isFetching:!1}),i(u,l),c()}},h=async d=>{s({...a,isFetching:!0});const g=await ke({idBuilding:l,limit:le,page:oe,filter:{name:d||void 0}});s({data:g.data,isFetching:!1})};return[c,S,n,r.isFetching,_,a.isFetching,h,a.data]},nn=()=>{const[n,i,c,l,u,a,s,r]=tn();return e(re,{title:t.add_document_apartment,okText:t.add,cancelText:t.cancel,onOk:i,onCancel:n,open:!0,okButtonProps:{disabled:l,loading:l},width:"50%",children:e(v,{initialValues:{name:void 0,file:void 0,content:void 0,description:void 0,accessRoles:[st],unitId:void 0},form:c,name:"formAdd",layout:"vertical",onValuesChange:u,children:I(he,{gutter:[12,12],children:[e(F,{span:"12",children:e(v.Item,{label:t.unit,name:"unitId",rules:[{required:!0}],children:e(D,{allowClear:!0,showSearch:!0,placeholder:t.label.select_apartment,filterOption:!1,loading:a,onSearch:_e(s),style:{width:"100%"},dropdownRender:p=>a?e("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:e(it,{})}):p,children:r==null?void 0:r.map(({id:p,name:_})=>e(D.Option,{value:p,children:_},p))})})}),e(F,{span:"12",children:e(v.Item,{name:"accessRoles",label:t.access_role,children:e(D,{mode:"multiple",allowClear:!0,fluid:"true",placeholder:t.access_role,children:Ue.map(p=>e(D.Option,{value:p.value,children:p.label},p.value))})})}),e(F,{span:"24",children:e(v.Item,{rules:[{required:!0}],name:"file",label:t.file_in_vietnamese,children:I(ie.Dragger,{maxCount:1,limitSizeFile:W,module:Y,children:[e(P,{name:"icon-inbox-outlined",css:p=>({fontSize:"48px",color:p.primaryColor})}),e("h3",{children:t.click_or_drag_file_to_this_area_to_upload}),I("p",{css:p=>({color:p.labelColor}),children:[t.file_type,": .doc .docx .pdf .jpg..."]})]})})}),e(F,{span:"24",children:e(Se,{message:e(be,{pauseOnHover:!0,gradient:!1,speed:60,loop:1,delay:1,children:t.error.upload_file_size_limit.replace("{limitSize}",W)}),type:"warning",showIcon:!0,closable:!0})}),e(F,{span:"24",children:e(v.Item,{rules:[{required:!0}],label:t.name_in_vietnamese,name:"name",children:e(N,{fluid:"true",placeholder:t.name_in_vietnamese})})}),e(F,{span:"24",children:e(v.Item,{label:t.description,name:"description",children:e(N,{fluid:"true",placeholder:t.description})})})]})})})},on=()=>{var f,b,A,V,K;const[n]=v.useForm(),[i]=Ae(),[c,l]=m.useState({data:[],isFetching:!1}),{hideFormUpdate:u,idBuilding:a,filter:s,formUpdateData:r}=m.useContext(pe),[p,_]=m.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),[S,h]=m.useState([]),d=y=>{y.file.status==="removed"&&h([]),(y.file.status==="done"||y.file.status==="uploading")&&h(y.fileList)};m.useEffect(()=>{(async()=>{var G,H,Z,o;l({data:[],isFetching:!0});const y=((H=(G=r==null?void 0:r.data)==null?void 0:G.document)==null?void 0:H.unitId)??void 0,R=await ke({idBuilding:a,limit:le,page:oe,filter:{name:void 0,id:y}});l({data:R.data,isFetching:!1});const E=((o=(Z=r==null?void 0:r.data)==null?void 0:Z.document)==null?void 0:o.downloadLink)??"";if(E){const C=[{uid:"-1",name:E.substring(E.lastIndexOf("/")+1),status:"done",response:{data:{url:E}}}];h(C)}})()},[(b=(f=r==null?void 0:r.data)==null?void 0:f.document)==null?void 0:b.downloadLink,(V=(A=r==null?void 0:r.data)==null?void 0:A.document)==null?void 0:V.unitId,a]);const g=m.useMemo(()=>{var H,Z;const y=((H=r==null?void 0:r.data)==null?void 0:H.document)??{},R=(y==null?void 0:y.downloadLink)??"",E=(y==null?void 0:y.size)??"",G=R.substring(R.lastIndexOf("/")+1);return{name:(y==null?void 0:y.name)??"",file:{file:{name:G,size:E,status:"done",uid:"-1",response:{data:{url:R}}},fileList:[{name:G,size:E,status:"done",uid:"-1",response:{data:{url:R}}}]},description:(y==null?void 0:y.description)??"",accessRoles:((Z=y==null?void 0:y.unitRole)==null?void 0:Z.split("-"))??[],unitId:y==null?void 0:y.unitId}},[(K=r==null?void 0:r.data)==null?void 0:K.document]),w=y=>{var R;if(y.file){const E=((R=y==null?void 0:y.file)==null?void 0:R.file.name)??"";n.setFieldsValue({name:E})}};de(p.code,p.codeLanguage,{message:t.success,description:t.update_data_success});const x=async()=>{var R;if(await n.validateFields()){_({code:void 0,codeLanguage:void 0,isFetching:!0});const E=n.getFieldsValue(),G=(R=r==null?void 0:r.data)==null?void 0:R.document.id,H=await Je(G,{...E,type:He},a);_({code:H.code,codeLanguage:H.codeLanguage,isFetching:!1}),i(s,a),u()}},T=async y=>{l({...c,isFetching:!0});const R=await ke({idBuilding:a,limit:le,page:oe,filter:{name:y||void 0}});l({data:R.data,isFetching:!1})};return[g,u,x,n,p.isFetching,w,c.isFetching,T,c.data,S,d]},ln=()=>{const[n,i,c,l,u,a,s,r,p,_,S]=on();return e(re,{title:t.update_document_apartment,okText:t.update,cancelText:t.cancel,onOk:c,onCancel:i,open:!0,okButtonProps:{disabled:u,loading:u},width:"50%",children:e(v,{initialValues:n,form:l,name:"formUpdate",layout:"vertical",onValuesChange:a,children:I(he,{gutter:[12,12],children:[e(F,{span:"12",children:e(v.Item,{label:t.unit,name:"unitId",children:e(D,{disabled:!0,allowClear:!0,showSearch:!0,placeholder:t.label.select_apartment,filterOption:!1,loading:s,onSearch:_e(r),style:{width:"100%"},dropdownRender:h=>s?e("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:e(it,{})}):h,children:p==null?void 0:p.map(({id:h,name:d})=>e(D.Option,{value:h,children:d},h))})})}),e(F,{span:"12",children:e(v.Item,{name:"accessRoles",label:t.access_role,children:e(D,{mode:"multiple",allowClear:!0,fluid:"true",placeholder:t.access_role,children:Ue.map(h=>e(D.Option,{value:h==null?void 0:h.value,children:h==null?void 0:h.label},h==null?void 0:h.value))})})}),e(F,{span:"24",children:e(v.Item,{rules:[{required:!0}],name:"file",label:t.file_in_vietnamese,children:I(ie.Dragger,{maxCount:1,fileList:_,onChange:S,limitSizeFile:W,module:Y,children:[e(P,{name:"icon-inbox-outlined",css:h=>({fontSize:"48px",color:h.primaryColor})}),e("h3",{children:t.click_or_drag_file_to_this_area_to_upload}),I("p",{css:h=>({color:h.labelColor}),children:[t.file_type,": .doc .docx .pdf .jpg..."]})]})})}),e(F,{span:"24",children:e(Se,{message:e(be,{pauseOnHover:!0,gradient:!1,speed:60,loop:1,delay:1,children:t.error.upload_file_size_limit.replace("{limitSize}",W)}),type:"warning",showIcon:!0,closable:!0})}),e(F,{span:"24",children:e(v.Item,{rules:[{required:!0}],label:t.name_in_vietnamese,name:"name",children:e(N,{fluid:"true",placeholder:t.name_in_vietnamese})})}),e(F,{span:"24",children:e(v.Item,{label:t.description,name:"description",children:e(N,{fluid:"true",placeholder:t.description})})})]})})})},sn=()=>{const{setTitlePage:n,setVisibleFilterBox:i,setVisibleSearchBox:c}=m.useContext(Fe),{idBuilding:l,setGetsStatus:u,formAddData:a,formUpdateData:s}=m.useContext(pe),[r]=Ae();return m.useEffect(()=>(n(t.apartment_document),c(!0),(async()=>l&&(u({isFetching:!0}),await r(X,l),u({isFetching:!1})))(),()=>{n(""),i(!1),c(!1)}),[]),[a,s]},an=()=>{const[n,i]=sn();return I(j,{children:[I(z.Wrapper,{children:[e(Xt,{}),I(z.Container,{children:[e(z.Header,{children:e(en,{})}),e(z.Content,{children:e(Jt,{})})]})]}),n.isShow?e(nn,{}):null,i.isShow?e(ln,{}):null]})},cn=()=>e(et,{children:e(an,{})}),rn=()=>{const[n,i]=m.useState(qe);return[n,l=>{i(l)}]},dn=()=>{const[n,i]=rn();return e("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:I(he,{style:{flex:1},gutter:[12,0],children:[e(F,{span:4,children:e(ht,{mode:"inline",css:c=>({height:"100%",padding:c.padding.md,borderRadius:c.borderRadius}),selectedKeys:[n],children:gt.map(c=>e(ct,{onClick:()=>i(c.value),className:n===c.value?"selected":"",children:e("span",{children:c.label})},c.value))})}),I(F,{style:{display:"flex",flexDirection:"column",flex:1},span:20,children:[n===qe?e(Ot,{}):null,n===lt?e(cn,{}):null,n===ot?e(Yt,{}):null]})]})})},Hi=dn;export{Hi as default};
