import{h as w,i as K,j as S,k as R,e as _,d as D,c as U,f as E,a as N,b as j}from"./@babel-b64fd0f9.js";import{r as d}from"./react-4fd50329.js";import{n as O,l as L}from"./rc-util-0bc219f3.js";import{c as x}from"./classnames-4ba1ba1a.js";import{a as W}from"./rc-motion-ae889c42.js";import{R as V}from"./react-dom-40621ea0.js";var g=function(k){w(m,k);var y=K(m);function m(){var e;S(this,m);for(var n=arguments.length,r=new Array(n),t=0;t<n;t++)r[t]=arguments[t];return e=y.call.apply(y,[this].concat(r)),e.closeTimer=null,e.close=function(i){i&&i.stopPropagation(),e.clearCloseTimer();var u=e.props,p=u.onClose,c=u.noticeKey;p&&p(c)},e.startCloseTimer=function(){e.props.duration&&(e.closeTimer=window.setTimeout(function(){e.close()},e.props.duration*1e3))},e.clearCloseTimer=function(){e.closeTimer&&(clearTimeout(e.closeTimer),e.closeTimer=null)},e}return R(m,[{key:"componentDidMount",value:function(){this.startCloseTimer()}},{key:"componentDidUpdate",value:function(n){(this.props.duration!==n.duration||this.props.updateMark!==n.updateMark||this.props.visible!==n.visible&&this.props.visible)&&this.restartCloseTimer()}},{key:"componentWillUnmount",value:function(){this.clearCloseTimer()}},{key:"restartCloseTimer",value:function(){this.clearCloseTimer(),this.startCloseTimer()}},{key:"render",value:function(){var n=this,r=this.props,t=r.prefixCls,i=r.className,u=r.closable,p=r.closeIcon,c=r.style,l=r.onClick,a=r.children,s=r.holder,o="".concat(t,"-notice"),v=Object.keys(this.props).reduce(function(C,f){return(f.substr(0,5)==="data-"||f.substr(0,5)==="aria-"||f==="role")&&(C[f]=n.props[f]),C},{}),h=d.createElement("div",_({className:x(o,i,D({},"".concat(o,"-closable"),u)),style:c,onMouseEnter:this.clearCloseTimer,onMouseLeave:this.startCloseTimer,onClick:l},v),d.createElement("div",{className:"".concat(o,"-content")},a),u?d.createElement("a",{tabIndex:0,onClick:this.close,className:"".concat(o,"-close")},p||d.createElement("span",{className:"".concat(o,"-close-x")})):null);return s?V.createPortal(h,s):h}}]),m}(d.Component);g.defaultProps={onClose:function(){},duration:1.5};function F(k){var y=d.useRef({}),m=d.useState([]),e=U(m,2),n=e[0],r=e[1];function t(i){var u=!0;k.add(i,function(p,c){var l=c.key;if(p&&(!y.current[l]||u)){var a=d.createElement(g,_({},c,{holder:p}));y.current[l]=a,r(function(s){var o=s.findIndex(function(h){return h.key===c.key});if(o===-1)return[].concat(E(s),[a]);var v=E(s);return v[o]=a,v})}u=!1})}return[t,d.createElement(d.Fragment,null,n)]}var q=["getContainer"],I=0,z=Date.now();function $(){var k=I;return I+=1,"rcNotification_".concat(z,"_").concat(k)}var M=function(k){w(m,k);var y=K(m);function m(){var e;S(this,m);for(var n=arguments.length,r=new Array(n),t=0;t<n;t++)r[t]=arguments[t];return e=y.call.apply(y,[this].concat(r)),e.state={notices:[]},e.hookRefs=new Map,e.add=function(i,u){var p,c=(p=i.key)!==null&&p!==void 0?p:$(),l=N(N({},i),{},{key:c}),a=e.props.maxCount;e.setState(function(s){var o=s.notices,v=o.map(function(C){return C.notice.key}).indexOf(c),h=o.concat();return v!==-1?h.splice(v,1,{notice:l,holderCallback:u}):(a&&o.length>=a&&(l.key=h[0].notice.key,l.updateMark=$(),l.userPassKey=c,h.shift()),h.push({notice:l,holderCallback:u})),{notices:h}})},e.remove=function(i){e.setState(function(u){var p=u.notices;return{notices:p.filter(function(c){var l=c.notice,a=l.key,s=l.userPassKey,o=s??a;return o!==i})}})},e.noticePropsMap={},e}return R(m,[{key:"getTransitionName",value:function(){var n=this.props,r=n.prefixCls,t=n.animation,i=this.props.transitionName;return!i&&t&&(i="".concat(r,"-").concat(t)),i}},{key:"render",value:function(){var n=this,r=this.state.notices,t=this.props,i=t.prefixCls,u=t.className,p=t.closeIcon,c=t.style,l=[];return r.forEach(function(a,s){var o=a.notice,v=a.holderCallback,h=s===r.length-1?o.updateMark:void 0,C=o.key,f=o.userPassKey,T=N(N(N({prefixCls:i,closeIcon:p},o),o.props),{},{key:C,noticeKey:f||C,updateMark:h,onClose:function(b){var P;n.remove(b),(P=o.onClose)===null||P===void 0||P.call(o)},onClick:o.onClick,children:o.content});l.push(C),n.noticePropsMap[C]={props:T,holderCallback:v}}),d.createElement("div",{className:x(i,u),style:c},d.createElement(W,{keys:l,motionName:this.getTransitionName(),onVisibleChanged:function(s,o){var v=o.key;s||delete n.noticePropsMap[v]}},function(a){var s=a.key,o=a.className,v=a.style,h=a.visible,C=n.noticePropsMap[s],f=C.props,T=C.holderCallback;return T?d.createElement("div",{key:s,className:x(o,"".concat(i,"-hook-holder")),style:N({},v),ref:function(b){typeof s>"u"||(b?(n.hookRefs.set(s,b),T(b,f)):n.hookRefs.delete(s))}}):d.createElement(g,_({},f,{className:x(o,f==null?void 0:f.className),style:N(N({},v),f==null?void 0:f.style),visible:h}))}))}}]),m}(d.Component);M.newInstance=void 0;M.defaultProps={prefixCls:"rc-notification",animation:"fade",style:{top:65,left:"50%"}};M.newInstance=function(y,m){var e=y||{},n=e.getContainer,r=j(e,q),t=document.createElement("div");if(n){var i=n();i.appendChild(t)}else document.body.appendChild(t);var u=!1;function p(c){u||(u=!0,m({notice:function(a){c.add(a)},removeNotice:function(a){c.remove(a)},component:c,destroy:function(){L(t),t.parentNode&&t.parentNode.removeChild(t)},useNotification:function(){return F(c)}}))}O(d.createElement(M,_({},r,{ref:p})),t)};export{M as N,F as u};
