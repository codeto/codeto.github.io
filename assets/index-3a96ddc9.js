import{j as c,F as y,u as G,a as M}from"./@emotion-63839449.js";import{P as h,l as N,D as V}from"./index-b17d22e5.js";import{a9 as E,s as C,b0 as $,a1 as J,ay as X,l as s,a3 as q,I as z,dq as K,a5 as Q,c6 as W,a as U,g as Z}from"./index-c2ded735.js";import"./lodash-88fe09e6.js";import{h as p}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import{r as u}from"./react-4fd50329.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{d as j}from"./downloadFileFromUrl-79614833.js";import{u as tt}from"./index-687ba9e6.js";import{P as et}from"./prop-types-1172f4d5.js";import{A as F,a as L,b as at,c as w,d as it,e as nt,f as ot,g as rt,h as x,i as O,j as H}from"./constants-be35a268.js";import{u as st}from"./react-router-a4308f7b.js";import{f as ct,h as mt}from"./amenities-1e1bae0f.js";import{B as lt,K as dt}from"./antd-f9eae174.js";import{I}from"./index-43183512.js";import{L as ut}from"./react-router-dom-2a8f5f6d.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./account-86ffff50.js";import"./index-881eef42.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./classnames-4ba1ba1a.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";const A=u.createContext({idBuilding:0,tableData:{records:[],totalRecord:0},setTableData:()=>{},getsStatus:{isFetching:!1},setGetsStatus:()=>{},filter:F,setFilter:()=>{},tablePagination:{current:E,limit:C},setTablePagination:()=>{},status:L,setStatus:()=>{},isUserCs:!1,amenityBookingPermissionExport:!1}),P=({children:e})=>{const a=st(),{idBuilding:t}=a,{getPermissionByModuleCode:r}=$(),[i,n]=u.useState({isFetching:!1}),[m,d]=u.useState(F),[l,o]=u.useState({current:E,limit:C}),[T,g]=u.useState({records:[],totalRecord:0}),[_,f]=u.useState(L),{isUserCs:B}=J(),k=r(X).read??!1,R={idBuilding:t,tableData:T,setTableData:g,getsStatus:i,setGetsStatus:n,filter:m,setFilter:d,tablePagination:l,setTablePagination:o,status:_,setStatus:f,isUserCs:B,amenityBookingPermissionExport:k};return c(A.Provider,{value:R,children:e})};P.propTypes={children:et.node};P.defaultProps={children:c("div",{})};const pt=P,gt=async(e,a)=>{var t,r;try{const i={code:e.code?e.code:"",name:e.name?e.name:"",partnerName:e.partnerName?e.partnerName:"",unitName:e.unitName?e.unitName:"",from:((t=e==null?void 0:e.orderTime)==null?void 0:t.length)>0?p(e.orderTime[0]).startOf("day").toISOString():null,to:((r=e==null?void 0:e.orderTime)==null?void 0:r.length)>0?p(e.orderTime[1]).endOf("day").toISOString():null,status:e.status};return await ct(i,a)}catch(i){return i}},Tt=()=>{const{filter:e,idBuilding:a,tableData:t,status:r,amenityBookingPermissionExport:i}=u.useContext(A),[n,m]=u.useState({code:void 0,codeLanguage:void 0,isFetching:!1});tt(n.code,n.codeLanguage,{message:s.success,description:s.export_data_success});const d=async()=>{m({code:void 0,codeLanguage:void 0,isFetching:!0});const o=await gt({...e,status:r},a);o.data&&j(o.data,document,"Danh-sach-don-dat-tien-ich-doi-tac.xlsx"),m({code:o.code,codeLanguage:o.codeLanguage,isFetching:!1})},{totalRecord:l}=t;return[l,d,n.isFetching,i]},ht=()=>{const[e,a,t,r]=Tt(),i=q(),n=[r?c(lt,{type:"primary",ghost:!0,loading:t,icon:c(z,{name:"icon-download-outlined"}),onClick:()=>{i({action:K,label:Q}),a()},css:m=>({marginRight:m.margin.xs}),children:s.export},"export"):null].filter(Boolean);return c(h.ActionBox,{total:c(y,{children:e}),actions:n})},Et=(e,a)=>e.map(t=>{var n;let r="",i="";return t.cancelAt?(r=p(new Date(t==null?void 0:t.cancelAt)).format("DD/MM/YYYY HH:mm"),i=w[it].label):t.rejectAt&&(r=p(new Date(t==null?void 0:t.rejectAt)).format("DD/MM/YYYY HH:mm"),i=w[nt].label),{id:t.id,key:t.id,code:(t==null?void 0:t.code)??"",amenitiesOrderer:a?"***":(t==null?void 0:t.residentName)??"",amenitiesStatus:at[t.status],amenitiesAmount:(t==null?void 0:t.totalTimeUsage)??0,amenitiesOrderTime:t.createdAt&&p(new Date(t.createdAt)).format("DD/MM/YYYY HH:mm")||"",amenitiesConfirmTime:t.acceptAt&&p(new Date(t.acceptAt)).format("DD/MM/YYYY HH:mm")||"",amenitiesUsageTime:t.startDateUsage&&p(new Date(t.startDateUsage)).format("DD/MM/YYYY HH:mm")||"",amenitiesStartTime:t.startActionTime&&p(new Date(t.startDateUsage)).format("DD/MM/YYYY HH:mm")||"",amenitiesEndTime:t.endActionTime&&p(new Date(t.startDateUsage)).format("DD/MM/YYYY HH:mm")||"",amenitiesTotalPayment:W(t.amount||0),amenitiesApartment:t.unitName,partnerName:t.utilityPartner.name,amenitiesCancelTime:r,amenitiesCancelBy:i,rating:((n=t==null?void 0:t.ratings)==null?void 0:n.point)??0,utility:t.utility}}),At=async({filter:e,limit:a,page:t,idBuilding:r,isUserCs:i})=>{var n,m;try{const d={code:e.code?e.code:"",name:e.name?e.name:"",partnerName:e.partnerName?e.partnerName:"",unitName:e.unitName?e.unitName:"",from:((n=e==null?void 0:e.orderTime)==null?void 0:n.length)>0?p(e.orderTime[0]).startOf("day").toISOString():null,to:((m=e==null?void 0:e.orderTime)==null?void 0:m.length)>0?p(e.orderTime[1]).endOf("day").toISOString():null,status:e.status},l=await mt({filter:d,limit:a,page:t,idBuilding:r}),o=Et((l==null?void 0:l.data)??[],i),T=(l==null?void 0:l.totalRecord)??0;return[o,T]}catch(d){return d}},b=()=>{const{setTableData:e,isUserCs:a,setGetsStatus:t}=u.useContext(A);return[async({filter:i,limit:n,page:m,idBuilding:d})=>{t({isFetching:!0});const[l,o]=await At({filter:i,limit:n,page:m,idBuilding:d,isUserCs:a});e({records:l,totalRecord:o}),t({isFetching:!1})}]},_t=()=>{const{setFilter:e,setTablePagination:a,idBuilding:t,status:r}=u.useContext(A),[i]=b();return[async m=>{e(m),a({current:E,limit:C}),i({filter:{...m,status:r},idBuilding:t,limit:C,page:E})},F]},St=()=>{const[e,a]=_t(),t=u.useMemo(()=>[{label:s.amenities_code,key:"code",component:c(I,{placeholder:s.amenities_code}),visible:!0},{label:s.amenities,key:"name",component:c(I,{placeholder:s.amenities}),visible:!0},{label:s.partner_name,key:"partnerName",component:c(I,{placeholder:s.partner_name}),visible:!0},{label:s.unit,key:"unitName",component:c(I,{placeholder:s.unit}),visible:!0},{label:s.order_time,key:"orderTime",component:c(V.RangePicker,{fluid:"true",placeholder:[N,N],format:[N,N],getPopupContainer:r=>r.parentNode}),visible:!0}],[]);return c(h.FilterBox,{defaultFilter:a,filters:t,onSearch:e})},xt=()=>{const{setGetsStatus:e,tablePagination:a,setTablePagination:t,filter:r,idBuilding:i,setStatus:n,status:m}=u.useContext(A),[d]=b();return[async o=>{o!==m&&(e({isFetching:!0}),n(o),t({current:a.current,limit:a.limit}),await d({filter:{...r,status:o},limit:a.limit,page:a.current,idBuilding:i}),e({isFetching:!1}))},ot,m]},Ct=()=>{const[e,a,t]=xt();return c(h.Tabs,{activeKey:t,onTabChange:e,tabs:a})},Rt=()=>{const{getsStatus:e,setGetsStatus:a,tablePagination:t,setTablePagination:r,tableData:i,filter:n,idBuilding:m,status:d}=u.useContext(A),{layoutScrollRef:l}=u.useContext(U),o=G(),[T]=b(),g=async(R,Y)=>{let{current:S,limit:D}=t;R!==S&&(S=R),Y!==D&&(D=Y,S=E),a({isFetching:!0}),r({current:S,limit:D});const v={filter:{...n,status:d},limit:D,page:S,idBuilding:m};await T(v),a({isFetching:!1})},_={pageSize:t.limit,defaultCurrent:E,current:t.current,total:i.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:g},f={offsetScroll:o.offsetScrollX,getContainer:()=>l.current},B=i.records,{isFetching:k}=e;return[B,k,f,_,m,d]},Dt=()=>{const[e,a,t,r,i,n]=Rt(),m=[{title:s.amenities_merchant_code,key:"code",dataIndex:"code",render:(l,o,T)=>c(ut,{to:`/buildings/${i}/amenities-merchant-orders/${o==null?void 0:o.id}`,children:c("p",{children:o==null?void 0:o.code})}),isFilter:!0,fixed:"left",width:150},{title:s.amenities,key:"amenity",dataIndex:"amenity",render:(l,o,T)=>{var _;const g=o.utility??{};return M("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[c("img",{alt:"avatar",style:{width:"100px",height:"50px",marginRight:"5px"},src:(g==null?void 0:g.coverPhoto)??""}),c("span",{style:{wordBreak:"break-word"},children:((_=g==null?void 0:g.name)==null?void 0:_[Z()])??""})]})},width:300},{title:s.partner_name,key:"partnerName",dataIndex:"partnerName",width:200},{title:s.unit,key:"amenitiesApartment",dataIndex:"amenitiesApartment",width:100},{title:s.orderer,key:"amenitiesOrderer",dataIndex:"amenitiesOrderer",width:200},{title:s.status1,key:"amenitiesStatus",dataIndex:"amenitiesStatus",isFilter:!0,width:150},{title:s.order_time,key:"amenitiesOrderTime",dataIndex:"amenitiesOrderTime",width:150},{title:s.usage_time,key:"amenitiesUsageTime",dataIndex:"amenitiesUsageTime",width:150},[rt,x].includes(n)?{title:s.confirm_time,key:"amenitiesConfirmTime",dataIndex:"amenitiesConfirmTime",width:200}:null,{title:s.start_time,key:"amenitiesStartTime",dataIndex:"amenitiesStartTime",width:200},[O,x].includes(n)?{title:s.end_time,key:"amenitiesEndTime",dataIndex:"amenitiesEndTime",width:200}:null,[H,x].includes(n)?{title:s.cancel_time,key:"amenitiesCancelTime",dataIndex:"amenitiesCancelTime",width:200}:null,[H,x].includes(n)?{title:s.cancel_by,key:"amenitiesCancelBy",dataIndex:"amenitiesCancelBy",width:200}:null,[O,x].includes(n)?{title:s.label.rating,key:"rating",dataIndex:"rating",align:"center",render:(l,o,T)=>c(dt,{disabled:!0,value:o.rating??0}),width:150}:null].filter(Boolean),d={x:m.reduce((l,o)=>o+l.width,0),scrollToFirstRowOnChange:!0};return c(h.Table,{sticky:t,scroll:d,columns:m,dataSource:e,loading:a,pagination:r})},Nt=()=>{const{setTitlePage:e,setVisibleFilterBox:a,setVisibleSearchBox:t}=u.useContext(U),{idBuilding:r,setGetsStatus:i,filter:n,status:m}=u.useContext(A),[d]=b();return u.useEffect(()=>(e(s.amenities_merchant_orders),t(!0),(async()=>r&&(i({isFetching:!0}),await d({filter:{...n,status:m},idBuilding:r,limit:C,page:E}),i({isFetching:!1})))(),()=>{e(""),a(!1),t(!1)}),[]),[]},It=()=>(Nt(),M(h.Wrapper,{children:[c(St,{}),M(h.Container,{children:[c(h.Header,{children:c(ht,{})}),M(h.Content,{children:[c(Ct,{}),c(Dt,{})]})]})]})),sa=()=>c(pt,{children:c(It,{})});export{sa as default};
