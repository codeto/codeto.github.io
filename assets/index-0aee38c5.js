import{j as e,u as he,a as U,c as ge}from"./@emotion-63839449.js";import{o as Se,P as G,D as ee,a as be,e as ye}from"./index-b17d22e5.js";import{a9 as N,s as A,b0 as ve,a1 as we,K as te,ap as _e,at as Le,bv as Ie,cf as se,l as a,S as Fe,dQ as ke,a3 as le,I as j,bI as Ce,a5 as K,dq as Ee,dP as Te,bG as xe,a as de,dG as Re,cP as re,gi as ae,bH as De,G as Ne,gj as Ae,h as J,g as ce,L as me,dB as Pe,w as Me}from"./index-c2ded735.js";import{l as H}from"./lodash-88fe09e6.js";import{h as C}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import{r as v}from"./react-4fd50329.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{F,u as z}from"./index-687ba9e6.js";import{d as Be}from"./downloadFileFromUrl-79614833.js";import{P as D}from"./prop-types-1172f4d5.js";import{u as Ue}from"./useTableCheckbox-753d19b2.js";import{u as Oe}from"./react-router-a4308f7b.js";import{e as We,a as Ve,r as Ye,b as Ge,u as qe,i as $e}from"./staff-2880022d.js";import{B as Q,T as je,w as X,R as Y,b as R,z as Ke}from"./antd-f9eae174.js";import{I as M,S as oe}from"./index-43183512.js";import{p as He}from"./rules-c1d56c23.js";import{g as ze}from"./department-807891d3.js";import{I as ue}from"./index-0335a746.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./index-881eef42.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./classnames-4ba1ba1a.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./regex-deefadac.js";import"./xlsx-0fb7ed70.js";import"./uuid-4a60fe23.js";const B={email:"",name:"",phone:""},V=v.createContext({employeePermissionWrite:!1,employeePermissionExport:!1,idBuilding:0,isUserCs:!1,getListStaffStatus:{isFetching:!1},setGetListStaffStatus:()=>{},filter:{...B},setFilter:()=>{},formFilter:void 0,tableData:{records:[],totalRecord:0},setTableData:()=>{},tablePagination:{current:N,limit:A},setTablePagination:()=>{},tableSelection:{isSelectAllItem:!1,isShowQuestionSelectAll:!1,selectedRowsCache:[],selectedRowKeysCache:[],selectedRowKeys:[],byId:{}},resetDataTableSelection:()=>{},onSelectRow:()=>{},onSelectAllRowOfPage:()=>{},selectAllRowComponent:e("div",{}),modalAddStaff:void 0,showModalAddStaff:()=>{},hideModalAddStaff:()=>{},modalUpdateStaff:void 0,showModalUpdateStaff:()=>{},hideModalUpdateStaff:()=>{},modalImportStaff:void 0,showModalImportStaff:()=>{},hideModalImportStaff:()=>{}}),ne=({children:n})=>{const{getPermissionByModuleCode:r}=ve(),{idBuilding:o}=Oe(),{isUserCs:c}=we(),[d,m]=v.useState({isFetching:!1}),[p,h]=v.useState({...B}),[l,t]=v.useState({records:[],totalRecord:0}),[y,b]=v.useState({current:N,limit:A}),[w,i,s,u,f]=Ue({dataRows:l.records,rowKey:"id",totalRows:l.totalRecord}),[g]=F.useForm(),[L,_,S]=te(),[k,E,O]=te(),[P,T,$]=te(),x=r(_e),I=(x==null?void 0:x[Le])??!1,W=(x==null?void 0:x[Ie])??!1,fe={employeePermissionWrite:I,employeePermissionExport:W,idBuilding:o,isUserCs:c,getListStaffStatus:d,setGetListStaffStatus:m,formFilter:g,filter:p,setFilter:h,tableData:l,setTableData:t,tablePagination:y,setTablePagination:b,tableSelection:w,resetDataTableSelection:i,onSelectRow:s,onSelectAllRowOfPage:u,selectAllRowComponent:f,modalAddStaff:L,showModalAddStaff:_,hideModalAddStaff:S,modalUpdateStaff:k,showModalUpdateStaff:E,hideModalUpdateStaff:O,modalImportStaff:P,showModalImportStaff:T,hideModalImportStaff:$};return e(V.Provider,{value:fe,children:n})};ne.propTypes={children:D.node};ne.defaultProps={children:e("div",{})};const Qe=ne,Xe=async(n,r)=>{try{const{name:o,email:c,phone:d}=r,m=await We(n,{name:o||void 0,email:c||void 0,phone:d||void 0});return{code:m.code,codeLanguage:m.codeLanguage,data:m.data}}catch(o){return{code:o.code,codeLanguage:o.codeLanguage,data:void 0}}},q=async({idBuilding:n,filter:r,page:o,limit:c,isUserCs:d})=>{const{email:m,phone:p,name:h}=r;try{const l=await Ve({filter:{email:m||void 0,phone:p||void 0,name:h||void 0},idBuilding:n,limit:c,page:o});return{code:l.code,codeLanguage:l.codeLanguage,data:l.data.map(({id:t,email:y,fullName:b,displayName:w,phone:i,birthday:s,gender:u,positions:f,cardNumber:g,startWork:L,endWork:_,address:S,note:k,status:E})=>{const O=[];return f&&f.forEach(P=>{var T;O.push({department:(T=P==null?void 0:P.department)==null?void 0:T.name,position:P.name})}),{key:t,id:t,email:d?"***":y,fullName:d?"***":b,phone:d?"***":i,birthday:d?"***":s,gender:u,positions:f,departments:O,cardNumber:g,startWork:L,endWork:_,address:S,note:k,status:E,isDisabled:E===se,displayName:w??""}}),totalRecord:l.totalRecord}}catch(l){return{code:l.code,codeLanguage:l.codeLanguage,data:[],totalRecord:0}}},Je=async(n,r)=>{try{const o=await Ye(n,r);return{code:o.code,codeLanguage:o.codeLanguage}}catch(o){return{code:o.code,codeLanguage:o.codeLanguage}}},Ze=()=>{const{idBuilding:n,filter:r,showModalAddStaff:o,showModalImportStaff:c,tableSelection:d,setGetListStaffStatus:m,setFilter:p,setTablePagination:h,setTableData:l,employeePermissionWrite:t,employeePermissionExport:y,selectAllRowComponent:b,formFilter:w,resetDataTableSelection:i,isUserCs:s}=v.useContext(V),{isSelectAllItem:u,selectedRowKeysCache:f}=d,[g,L]=v.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[_,S]=v.useState({isFetching:!1,code:void 0,codeLanguage:void 0});z(g.code,g.codeLanguage,{message:a.success,description:a.export_data_success}),z(_.code,_.codeLanguage,{message:a.success,description:a.delete_data_success});const k=(I,W)=>{I&&Be(I,document,"thong-tin-nhan-vien.xlsx")},E=()=>{o()},O=()=>{Se({isAll:u,onCancel:()=>{S({code:void 0,codeLanguage:void 0})},onOk:async()=>{S({code:void 0,codeLanguage:void 0});const I=await Je(n,f);if(S({code:I.code,codeLanguage:I.codeLanguage}),Fe.includes(I.code)){i(),m({isFetching:!0});const W=await q({filter:{...B},idBuilding:n,limit:A,page:N,isUserCs:s});return p({...B}),w.resetFields(),h({current:N,limit:A}),l({records:W.data,totalRecord:W.totalRecord}),m({isFetching:!1}),Promise.resolve()}return Promise.reject()},questionText:a.do_you_want_to_remove_staffs,totalItem:f.length,delayTime:ke})},P=async()=>{c()},T=async()=>{L({isFetching:!0,code:void 0,codeLanguage:void 0});const I=await Xe(n,r);k(I.data),L({isFetching:!1,code:I.code,codeLanguage:I.codeLanguage})},$=g.isFetching;return[t&&(d.selectedRowKeys.length>0||d.isSelectAllItem),t,y,$,O,P,T,E,b]};function et(){const[n,r,o,c,d,m,p,h,l]=Ze(),t=le(),y=[r?e(Q,{css:b=>({marginRight:b.margin.xs}),type:"primary",icon:e(j,{name:"icon-minus-circle-outlined"}),onClick:()=>{t({action:Ce,label:K}),d()},disabled:!n,children:a.delete},"delete"):null,o?e(Q,{css:b=>({marginRight:b.margin.xs}),type:"primary",ghost:!0,icon:e(j,{name:"icon-download-outlined"}),loading:c,onClick:()=>{t({action:Ee,label:K}),p()},children:a.export},"export"):null,r?e(Q,{css:b=>({marginRight:b.margin.xs}),type:"primary",icon:e(j,{name:"icon-upload-outlined"}),onClick:()=>{t({action:Te,label:K}),m()},children:a.import},"import"):null,r?e(Q,{type:"primary",icon:e(j,{name:"icon-plus-circle-outlined"}),onClick:()=>{t({action:xe,label:K}),h()},children:a.add},"add"):null].filter(Boolean);return e(G.ActionBox,{actions:y,total:l()})}const tt=()=>{const{idBuilding:n,setGetListStaffStatus:r,setFilter:o,setTableData:c,formFilter:d,setTablePagination:m,isUserCs:p}=v.useContext(V);return[async l=>{r({isFetching:!0});const t=await q({filter:{...l},idBuilding:n,limit:A,page:N,isUserCs:p});o(l),m({current:N,limit:A}),c({records:t.data,totalRecord:t.totalRecord}),r({isFetching:!1})},d]},at=()=>{const[n,r]=tt(),o=v.useMemo(()=>[{label:a.email,key:"email",component:e(M,{placeholder:a.email,fluid:!0}),visible:!0},{label:a.name,key:"name",component:e(M,{placeholder:a.name,fluid:!0}),visible:!0},{label:a.phone,key:"phone",component:e(M,{placeholder:a.phone,fluid:!0}),visible:!0}],[]);return e(G.FilterBox,{defaultFilter:B,filters:o,formData:r,onSearch:n})},ot=()=>{const{layoutScrollRef:n}=v.useContext(de),{tableData:r,tablePagination:o,getListStaffStatus:c,setGetListStaffStatus:d,tableSelection:m,onSelectRow:p,onSelectAllRowOfPage:h,filter:l,idBuilding:t,isUserCs:y,setTablePagination:b,setTableData:w,showModalUpdateStaff:i,employeePermissionWrite:s}=v.useContext(V),u=he(),{selectedRowKeys:f}=m,g=r.records,L=T=>T.isDisabled?"disabled":"",_=async(T,$)=>{let{current:x,limit:I}=o;x!==T&&(x=T),I!==$&&(I=$,x=N),d({isFetching:!0});const W=await q({filter:{...l},idBuilding:t,limit:I,page:x,isUserCs:y});b({current:x,limit:I}),w({records:W.data,totalRecord:W.totalRecord}),d({isFetching:!1})},S=T=>{i({...T})},k={current:o.current,pageSize:o.limit,total:r.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:_},E={offsetScroll:u.offsetScrollX,getContainer:()=>n.current},O={scrollToFirstRowOnChange:!0},P={selectedRowKeys:f,onSelect:p,onSelectAll:h,fixed:!0,columnWidth:65};return[s,c.isFetching,g,L,P,k,O,E,S,y]};function rt(){const[n,r,o,c,d,m,p,h,l,t]=ot(),y=le(),b=ge("div",{target:"ex0jyar0"})({name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"}),w=[{title:a.email,key:"email",dataIndex:"email",width:200},{title:a.name,key:"fullName",dataIndex:"fullName",width:200},{title:a.display_name_in_app_resident,key:"displayName",dataIndex:"displayName",width:200,render:(i,s)=>(i==null?void 0:i.length)>20?e(je,{title:i,placement:"topLeft",children:e(b,{children:i})}):e(b,{children:i})},{title:a.phone,key:"phone",dataIndex:"phone",width:150},{title:a.birthday,key:"birthday",dataIndex:"birthday",width:150,render:i=>t?"***":i?C(i).format("DD/MM/YYYY"):""},{title:a.gender,key:"gender",dataIndex:"gender",width:100,render:i=>{var s;return((s=Re[i])==null?void 0:s.name)??""}},{title:`${a.label.department} - ${a.label.position}`,key:"listDepartments",dataIndex:"listDepartments",width:350,render:(i,{departments:s})=>s.map(u=>e("div",{style:{margin:4},children:U(X,{color:"blue",style:{whiteSpace:"unset",wordBreak:"break-word"},children:[e("strong",{children:u.department})," - ",e("span",{children:u.position})]})},`${u.department}-${u.position}`))},{title:a.card_number,key:"cardNumber",dataIndex:"cardNumber",width:150},{title:a.start_work,key:"startWork",dataIndex:"startWork",width:200,render:i=>i?C(i).format("DD/MM/YYYY"):""},{title:a.end_work,key:"endWork",dataIndex:"endWork",width:200,render:i=>i?C(i).format("DD/MM/YYYY"):""},{title:a.address,key:"address",dataIndex:"address",width:150},{title:a.note,key:"note",dataIndex:"note",width:150},{title:a.status1,key:"status",dataIndex:"status",render:i=>{var s,u,f;return i===re?e(X,{color:"green",children:((s=ae[i])==null?void 0:s.name)??""}):i===se?e(X,{color:"red",children:((u=ae[i])==null?void 0:u.name)??""}):e(X,{children:((f=ae[i])==null?void 0:f.name)??""})},width:150},n?{title:a.actions,key:"action",fixed:"right",align:"center",width:100,render:(i,s)=>e(j,{css:u=>({fontSize:u.iconSize}),onClick:()=>{y({action:De,label:K}),l(s)},name:"icon-edit-outlined",title:a.update})}:null].filter(Boolean);return e(G.Table,{columns:w,dataSource:o,loading:r,pagination:m,rowClassName:c,scroll:{...p,x:w.reduce((i,s)=>i+s.width,0)},sticky:h,rowSelection:n?d:!1})}const{Option:ie}=oe;function Z({title:n,isFetching:r,form:o,initialValues:c,treeData:d,isDisabledEmail:m,onFinish:p,onClose:h,onFieldsChange:l}){return e(be,{title:n,open:!0,onOk:p,onCancel:h,confirmLoading:r,okText:a.confirm,cancelText:a.cancel,okBtnProps:{loading:r,disabled:r},children:U(F,{layout:"vertical",name:"form_staff",form:o,onFinish:p,initialValues:c,onFieldsChange:l,children:[U(Y,{gutter:16,children:[e(R,{span:12,children:e(F.Item,{name:"email",rules:[{type:"email"},{required:!0}],label:a.label.email,children:e(M,{disabled:m,placeholder:a.label.email})})}),e(R,{span:12,children:e(F.Item,{name:"fullName",rules:[{required:!0}],label:a.label.name,children:e(M,{placeholder:a.label.name})})}),e(R,{span:24,children:e(F.Item,{name:"displayName",rules:[{required:!0}],label:a.display_name_in_app_resident,children:e(M,{placeholder:a.display_name_in_app_resident})})})]}),U(Y,{gutter:16,children:[e(R,{span:12,children:e(F.Item,{name:"birthday",rules:[{required:!0}],label:a.label.birthday,children:e(ee,{style:{width:"100%"},placeholder:a.label.birthday,format:"DD/MM/YYYY",disabledDate:t=>!t||t.isAfter(C(new Date))})})}),e(R,{span:12,children:e(F.Item,{name:"gender",label:a.label.gender,children:e(oe,{fluid:"true",placeholder:a.label.gender,getPopupContainer:()=>document.getElementById("form_staff"),children:Ne.map(t=>e(ie,{value:t.id,children:t.name},t.id))})})})]}),U(Y,{gutter:16,children:[e(R,{span:12,children:e(F.Item,{name:"phone",label:a.label.phone,rules:[He],children:e(M.Phone,{placeholder:a.label.phone})})}),e(R,{span:12,children:e(F.Item,{name:"cardNumber",label:a.label.card_number,children:e(M,{placeholder:a.label.card_number})})})]}),e(Y,{gutter:16,children:e(R,{span:24,children:e(F.Item,{name:"positionIds",label:a.label.position,rules:[{required:!0}],children:e(Ke,{treeData:d,treeCheckable:!0,placeholder:a.label.position,style:{width:"100%"},showSearch:!1,getPopupContainer:()=>document.getElementById("form_staff")})})})}),e(Y,{gutter:16,children:e(R,{span:24,children:e(F.Item,{name:"status",label:a.label.status,children:e(oe,{fluid:"true",placeholder:a.label.status,getPopupContainer:()=>document.getElementById("form_staff"),children:H.sortBy(Ae,["name"]).map(t=>e(ie,{value:t.id,disabled:t.id!=="ACTIVE"&&t.id!=="INACTIVE",children:t.name},t.id))})})})}),U(Y,{gutter:16,children:[e(R,{span:12,children:e(F.Item,{name:"address",label:a.label.address,children:e(M,{placeholder:a.label.address})})}),e(R,{span:12,children:e(F.Item,{name:"note",label:a.label.note,children:e(M,{placeholder:a.label.note})})})]}),U(Y,{gutter:16,children:[e(R,{span:12,children:e(F.Item,{name:"startWork",label:a.label.start_work,children:e(ee,{style:{width:"100%"},placeholder:a.label.start_work,format:"DD/MM/YYYY",disabledDate:t=>t>=o.getFieldValue("endWork")})})}),e(R,{span:12,children:e(F.Item,{name:"endWork",label:a.label.end_work,children:e(ee,{style:{width:"100%"},placeholder:a.label.end_work,format:"DD/MM/YYYY",disabledDate:t=>t<=o.getFieldValue("startWork")})})})]})]})})}Z.propTypes={form:D.objectOf(D.any),isFetching:D.bool,initialValues:D.objectOf(D.any),treeData:D.arrayOf(D.any),isDisabledEmail:D.bool,title:D.string,onClose:D.func,onFinish:D.func,onFieldsChange:D.func};Z.defaultProps={form:void 0,isFetching:!1,title:"",treeData:[],isDisabledEmail:!1,initialValues:{},onClose:()=>{},onFinish:()=>{},onFieldsChange:()=>{}};const pe=async n=>{try{const r=await ze(n,!0);return{code:r.code,codeLanguage:r.codeLanguage,data:r.data}}catch(r){return{code:r.code,codeLanguage:r.codeLanguage,data:[]}}},nt=async(n,r)=>{try{const{fullName:o,phone:c,displayName:d,email:m,birthday:p,gender:h,cardNumber:l,positionIds:t,address:y,note:b,startWork:w,endWork:i,status:s}=r,u=await Ge(n,{fullName:o||void 0,email:m||void 0,gender:h||void 0,cardNumber:l||void 0,positionIds:t,address:y||void 0,note:b||void 0,phone:c?`${J}${c}`:null,startWork:w?C(w).toISOString():void 0,endWork:i?C(i).toISOString():void 0,birthday:p?C(p).toISOString():void 0,status:s||void 0,displayName:d});return{code:u.code,codeLanguage:u.codeLanguage}}catch(o){return{code:o.code,codeLanguage:o.codeLanguage}}},it=()=>{const{idBuilding:n,hideModalAddStaff:r,setGetListStaffStatus:o,setFilter:c,setTablePagination:d,setTableData:m,formFilter:p,isUserCs:h}=v.useContext(V),l=ce()===me,t={email:"",fullName:"",birthday:void 0,gender:"MALE",phone:"",positionIds:void 0,status:re,address:"",note:"",startWork:void 0,endWork:void 0,cardNumber:void 0,prefix:J,displayName:""},[y,b]=v.useState([]),[w,i]=v.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[s]=F.useForm();z(w.code,w.codeLanguage,{message:a.success,description:a.add_data_success},()=>{r()}),v.useEffect(()=>{(async()=>{const{data:f}=await pe(n),g=l?H.sortBy(f,["enName"]):H.sortBy(f,["name"]),L=[];g.forEach(_=>{const S=[];_.positions.forEach(k=>{S.push({title:l?k.enName:k.name,value:k.id,key:k.id})}),L.push({title:l?_.enName:_.name,value:`department-${_.id}`,key:`department-${_.id}`,children:S,disabled:!(S.length>0)})}),b(L)})()},[]);const u=async()=>{const f=await s.validateFields();if(f){i({isFetching:!0,code:void 0,codeLanguage:void 0});const g=await nt(n,f);i({isFetching:!1,code:g.code,codeLanguage:g.codeLanguage}),o({isFetching:!0});const L=await q({filter:{...B},idBuilding:n,limit:A,page:N,isUserCs:h});c({...B}),p.resetFields(),d({current:N,limit:A}),m({records:L.data,totalRecord:L.totalRecord}),o({isFetching:!1})}};return[w.isFetching,s,t,u,r,y]},st=()=>{const[n,r,o,c,d,m]=it();return e(Z,{form:r,initialValues:o,isFetching:n,onClose:d,onFinish:c,treeData:m,title:a.add_staff})},lt=async(n,r)=>{try{const{fullName:o,phone:c,displayName:d,email:m,birthday:p,gender:h,cardNumber:l,positionIds:t,address:y,note:b,startWork:w,endWork:i,status:s}=r,u=await qe(n,r.id,{fullName:o||void 0,email:m||void 0,gender:h||void 0,cardNumber:l||void 0,positionIds:t,address:y||void 0,note:b||void 0,phone:c?`${J}${c}`:null,startWork:w?C(w).toISOString():void 0,endWork:i?C(i).toISOString():void 0,birthday:p?C(p).toISOString():void 0,status:s||void 0,displayName:d});return{code:u.code,codeLanguage:u.codeLanguage}}catch(o){return{code:o.code,codeLanguage:o.codeLanguage}}},dt=()=>{const{idBuilding:n,hideModalUpdateStaff:r,setGetListStaffStatus:o,setTableData:c,modalUpdateStaff:d,filter:m,tablePagination:p,isUserCs:h}=v.useContext(V),l=ce()===me,{data:t}=d,y={email:t.email||"",fullName:t.fullName||"",birthday:t.birthday?C(t.birthday):void 0,gender:t.gender||Pe,phone:t.phone?ye(t.phone):"",positionIds:t.positions?t.positions.map(({id:g})=>g):void 0,status:t.status||re,address:t.address||"",note:t.note||"",startWork:t.startWork?C(t.startWork):void 0,endWork:t.endWork?C(t.endWork):void 0,cardNumber:t.cardNumber||void 0,prefix:J,user:t==null?void 0:t.user,displayName:(t==null?void 0:t.displayName)||""},[b,w]=v.useState([]),[i,s]=v.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[u]=F.useForm();z(i.code,i.codeLanguage,{message:a.success,description:a.update_data_success},()=>{r()}),v.useEffect(()=>{(async()=>{const{data:g}=await pe(n),L=l?H.sortBy(g,["enName"]):H.sortBy(g,["name"]),_=[];L.forEach(S=>{const k=[];S.positions.forEach(E=>{k.push({title:l?E.enName:E.name,value:E.id,key:E.id})}),_.push({title:l?S.enName:S.name,value:`department-${S.id}`,key:`department-${S.id}`,children:k,disabled:!(k.length>0)})}),w(_)})()},[]);const f=async()=>{const g=await u.validateFields();if(g){s({isFetching:!0,code:void 0,codeLanguage:void 0});const L=await lt(n,{...g,id:t.id});s({isFetching:!1,code:L.code,codeLanguage:L.codeLanguage}),o({isFetching:!0});const _=await q({filter:{...m},idBuilding:n,limit:p.limit,page:p.current,isUserCs:h});c({records:_.data,totalRecord:_.totalRecord}),o({isFetching:!1})}};return[i.isFetching,u,y,f,r,b]},ct=()=>{const[n,r,o,c,d,m]=dt();return e(Z,{form:r,initialValues:o,isFetching:n,onClose:d,onFinish:c,treeData:m,title:a.update_staff,isDisabledEmail:!0})},mt=async(n,r)=>{try{const o=await $e(n,r);return{code:o.code,codeLanguage:o.codeLanguage,data:o.data}}catch(o){return{code:o.code,codeLanguage:o.codeLanguage}}},{rules:ut}=ue,{dateImportRule:pt,phoneImportRule:ft}=ut,ht=()=>{const{hideModalImportStaff:n,setGetListStaffStatus:r,setFilter:o,setTablePagination:c,setTableData:d,idBuilding:m,formFilter:p,isUserCs:h}=v.useContext(V),[l,t]=v.useState({isFetching:!1,code:void 0,codeLanguage:void 0,success:0,failed:0,errors:[],data:void 0});z(l.code,l.codeLanguage,{message:a.success,description:a.import_data_success},async()=>{if(!l.errors||l.errors&&l.errors.length===0){n(),r({isFetching:!0});const i=await q({filter:{...B},idBuilding:m,limit:A,page:N,isUserCs:h});o({...B}),p.resetFields(),c({current:N,limit:A}),d({records:i.data,totalRecord:i.totalRecord}),r({isFetching:!1})}});const y=async i=>{var f,g,L,_;t({isFetching:!0,code:void 0,codeLanguage:void 0,data:void 0});const s=await mt(m,i),u=((g=(f=s==null?void 0:s.data)==null?void 0:f.errors)==null?void 0:g.map(S=>({index:S==null?void 0:S.index,code:(S==null?void 0:S.code)??500,message:S.message})))??[];t({isFetching:!1,code:s.code,codeLanguage:s.codeLanguage,success:((L=s==null?void 0:s.data)==null?void 0:L.success)??0,failed:u.length,errors:u,data:((_=s==null?void 0:s.data)==null?void 0:_.data)??void 0})},b=()=>n(),w=[{name:"#",rules:{type:"number",required:!0}},{name:"Họ Tên",rules:{type:"string",required:!0,max:50}},{name:"Tên hiển thị trên app cư dân",rules:{type:"string",required:!0,max:50}},{name:"Ngày sinh",rules:{...pt,required:!0}},{name:"Giới tính",rules:{required:!0,type:"enum",enum:["Nam","Nữ","Khác"]}},{name:"Số điện thoại",rules:ft},{name:"Mail",rules:{type:"string",required:!0,max:50}},{name:"Địa chỉ",rules:{type:"string",max:50}},{name:"Ngày bắt đầu làm việc",rules:{validator(i,s,u,f,g){return s&&f["Ngày kết thúc làm việc"]&&C(s).isAfter(f["Ngày kết thúc làm việc"])?new Error(a.start_work_must_lower_or_equal_than_end_work):!0}}},{name:"Ngày kết thúc làm việc",rules:{validator(i,s,u,f,g){return s&&f["Ngày bắt đầu làm việc"]&&C(s).isBefore(f["Ngày bắt đầu làm việc"])?new Error(a.start_work_must_lower_or_equal_than_end_work):!0}}},{name:"Số thẻ",rules:{type:"string",max:50}},{name:"Chức vụ",rules:{type:"string",max:50}},{name:"Phòng ban",rules:{type:"string",max:50}},{name:"Ghi chú",rules:{type:"string",max:255}},{name:"Trạng thái",rules:{type:"enum",enum:["Hoạt động","Ngừng hoạt động","Chờ xử lý","Cấm","Phân công","Vắng mặt"]}}];return[l,w,b,y]},gt=()=>{const[n,r,o,c]=ht();return e(ue,{headers:r,onClose:o,onOk:c,visible:!0,fileNameTemplate:"mau-thong-tin-nhan-vien",templateUrl:Me.document.mau_thong_tin_nhan_vien,code:n.code,codeLanguage:n.codeLanguage,loading:n.isFetching,numberSuccess:n.success,numberFail:n.failed,problemResponseServerDataSource:n.errors,errorFile:n.data})},St=()=>{const{idBuilding:n,setTableData:r,setGetListStaffStatus:o,modalAddStaff:c,modalUpdateStaff:d,modalImportStaff:m,isUserCs:p}=v.useContext(V),{setTitlePage:h,setVisibleFilterBox:l,setVisibleSearchBox:t}=v.useContext(de);return v.useEffect(()=>(h(a.staff),t(!0),(async()=>{o({isFetching:!0});const y=await q({filter:{...B},idBuilding:n,limit:A,page:N,isUserCs:p});r({records:y.data,totalRecord:y.totalRecord}),o({isFetching:!1})})(),()=>{h(""),t(!1),l(!1)}),[]),[c,d,m]},bt=()=>{const[n,r,o]=St();return U(G.Wrapper,{children:[e(at,{}),U(G.Container,{children:[e(G.Header,{children:e(et,{})}),e(G.Content,{children:e(rt,{})})]}),n.isShow?e(st,{}):null,r.isShow?e(ct,{}):null,o.isShow?e(gt,{}):null]})},no=()=>e(Qe,{children:e(bt,{})});export{no as default};
