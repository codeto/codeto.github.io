import{j as t,a as P}from"./@emotion-63839449.js";import{r as c}from"./react-4fd50329.js";import{P as u}from"./prop-types-1172f4d5.js";import{B as _}from"./index-881eef42.js";import{F as R,u as H}from"./index-687ba9e6.js";import{l as x}from"./lodash-88fe09e6.js";import"./moment-a468e1f9.js";import{a as K,l as a,bO as Q,bP as F,bQ as $,bR as W,bS as C,bT as z,bU as v,bV as J,bW as Z,Y as ee,bX as ie,E as re,bY as oe}from"./index-c2ded735.js";import"./file-saver-40cf32a9.js";import{u as te,a as g}from"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{S as se,a as ae,b as me,c as ne,d as pe,e as ce}from"./ServiceFormFormula-574b99c2.js";import{b as le,e as de,f as ue,h as fe}from"./service.actions-6bb0261f.js";import{x as l,B as V,y as ge}from"./antd-f9eae174.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-router-dom-2a8f5f6d.js";import"./react-router-a4308f7b.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./path-to-regexp-ef8d5544.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./index-43183512.js";import"./index-b17d22e5.js";import"./account-86ffff50.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./formatNumberWithPrecision-689b8fea.js";import"./currency-cb786ed8.js";const A=({history:y,match:S,location:T})=>{var I;const{setTitlePage:E}=c.useContext(K),h=te(),m=Number((I=S==null?void 0:S.params)==null?void 0:I.idBuilding)||0,[s]=c.useState(x.get(T,"state.service",{})),[p]=c.useState(x.get(T,"state.isAddFromDefaultService",!1)),[k,f]=c.useState(!0),[d,D]=c.useState(!1),[r]=R.useForm(),[O]=ee(),[b,q,B]=[g(e=>{var i,o;return(o=(i=e==null?void 0:e.configService)==null?void 0:i.add)==null?void 0:o.isLoading}),g(e=>{var i,o;return(o=(i=e==null?void 0:e.configService)==null?void 0:i.add)==null?void 0:o.code}),g(e=>{var i,o;return(o=(i=e==null?void 0:e.configService)==null?void 0:i.add)==null?void 0:o.codeLanguage})],[L,N]=[g(e=>{var i;return(i=e==null?void 0:e.configService)==null?void 0:i.icons.isLoading}),g(e=>{var i;return(i=e==null?void 0:e.configService)==null?void 0:i.icons.data})];H(q,B,{message:a.success,description:a.add_data_success},()=>{h(de()),y.replace(`/buildings/${m}/configs-services`)}),c.useEffect(()=>(E(a.label.create_new_services),h(le()),()=>{E("")}),[]);const w=()=>{y.replace(`/buildings/${m}/configs-services`)},M=async()=>{const e=ie(r);r.setFieldsValue({...e}),r.submit()},U=async()=>{var i,o;r.setFieldsValue({...re(r.getFieldsValue(),{})});const e=await r.validateFields();if(!b&&e){const n=r.getFieldsValue();h(ue({service:{...n,paymentExpiredDate:(i=n==null?void 0:n.paymentExpired)==null?void 0:i.date,paymentExpiredMonth:(o=n==null?void 0:n.paymentExpired)==null?void 0:o.month,isAddFromDefaultService:p},unitGroupId:m}))}},j=(e,i)=>{if(e.serviceType){e.serviceType===C?f(!0):f(!1);const o=["formulas"];r.resetFields(o)}D(i==null?void 0:i.isServiceParking)};c.useEffect(()=>{!p&&d&&(r.setFieldsValue({requiredInfo:Q,serviceType:F,feePeriodType:$,formulas:W,measureUnit:a.vehicle}),f(!1)),!p&&!d&&(r.setFieldsValue({requiredInfo:void 0,serviceType:C,feePeriodType:z,formulas:[],measureUnit:""}),f(!0))},[d,s,p]),c.useEffect(()=>{p&&(s==null?void 0:s.serviceType)===F&&(f((s==null?void 0:s.serviceType)!==F),r.setFieldsValue({requiredInfo:s.requiredInfo,serviceType:F}))},[s==null?void 0:s.serviceType,p]);const G=e=>i=>{const o=r.getFieldValue("formulas");o[e]={formulaType:i,formula:[{from:0}]},r.setFieldsValue({formulas:o})},Y=(e,i,o)=>{const n=oe({remove:i,index:o,description:a.formula_cannot_delete});h(fe({id:e,unitGroupId:m,callback:n}))},X=[t(l.Panel,{header:a.label.general_information,children:t(se,{form:r,idBuilding:m,isParking:s.identifier===v||d,isDefaultService:p,isEdit:!1,isShowCheckbox:k})},"1"),t(l.Panel,{header:a.label.formula,children:t(ae,{isParking:s.identifier===v||d,form:r,idBuilding:m,name:"formulas",onChangeFormulaType:G,onDeleteFormula:Y})},"2"),t(l.Panel,{header:a.label.surcharge,children:t(me,{form:r,idBuilding:m,name:"surcharges"})},"3"),t(l.Panel,{header:a.label.promotion,children:t(ne,{form:r,idBuilding:m,name:"promotions"})},"4"),t(l.Panel,{header:a.label.information_require,children:t(pe,{form:r,idBuilding:m,name:"requiredInfo",isParking:s.identifier===v||d})},"5"),t(l.Panel,{header:a.label.icon,children:t(ce,{form:r,idBuilding:m,name:"icon",isLoading:L,icons:N})},"6")];return P(R,{layout:"vertical",name:"addServiceForm",initialValues:p?J(s):Z,onFinish:U,form:r,requiredMark:!1,onValuesChange:j,scrollToFirstError:!0,children:[t(l,{defaultActiveKey:["1","2","3","4","5","6"],children:X.map(e=>e)}),t(ge,{offsetBottom:0,children:t(_,{style:{background:"white"},children:P(_.Footer,{borderTop:!0,style:{textAlign:"right"},children:[t(V,{onClick:w,style:{marginRight:O.padding},children:a.cancel}),t(V,{loading:b,disabled:b,onClick:M,type:"primary",children:a.confirm})]})})})]})};A.propTypes={history:u.objectOf(u.any),match:u.objectOf(u.any),location:u.objectOf(u.any)};A.defaultProps={history:{},match:{},location:{}};export{A as default};
