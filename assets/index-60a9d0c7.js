import{j as t,a as v,F as ge,u as Fe}from"./@emotion-63839449.js";import{a as fe,i as Oe,h as we,L as re,T as Ee,m as De,n as G,D as he,P as q,j as Pe}from"./index-b17d22e5.js";import{h as P}from"./moment-a468e1f9.js";import{dh as se,l as n,b1 as ve,di as Ae,dj as $,a9 as B,s as W,b0 as be,K as Te,ai as Me,aC as Ye,at as Ie,bv as Le,ag as de,a1 as Ue,g as Ne,L as Be,bw as Qe,a as ye,a3 as Se,I as z,bH as Ge,a5 as Ce,dk as qe,dl as ze,dm as He,bx as xe,dn as We,dp as $e,dq as Ve,dr as Xe,a8 as le,ds as Ke,dt as Je,S as je,du as Ze,n as et,bD as tt}from"./index-c2ded735.js";import{l as Re}from"./lodash-88fe09e6.js";import"./file-saver-40cf32a9.js";import{r as _}from"./react-4fd50329.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{P as K}from"./prop-types-1172f4d5.js";import{p as at}from"./printHtml-6274ec45.js";import{u as oe,a as ot}from"./react-router-a4308f7b.js";import{B as H,w as N,T as _e,G as nt,D as it,g as ae,R as rt,b as ce}from"./antd-f9eae174.js";import{u as st}from"./useTableCheckbox-753d19b2.js";import{F as U,u as J}from"./index-687ba9e6.js";import{I as dt}from"./integrated-84091933.js";import{u as lt}from"./useQuery-d54d310a.js";import{S as w,I as j}from"./index-43183512.js";import{c as ct}from"./compareObject-7b349d22.js";import{u as ke}from"./useFloor-e6fe641c.js";import{B as ut}from"./index-881eef42.js";import{d as ue}from"./downloadFileFromUrl-79614833.js";import{g as pt}from"./getPageByTotalAndLimit-7f60b558.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";const ne=S=>{var C,d;const{qrModal:T,hideQRModal:y}=S,g=((C=T==null?void 0:T.data)==null?void 0:C.id)??"",f=((d=T==null?void 0:T.data)==null?void 0:d.name)??"",{idBuilding:e}=oe(),[o,i]=_.useState({isFetching:!1}),[l,h]=_.useState({code:void 0,text:""});_.useEffect(()=>{(async()=>{i({isFetching:!0});const x=await se({idApartment:g,idBuilding:e});h({code:x.data.qrcode,text:x.data.text}),i({isFetching:!1})})()},[]);const u=async()=>{i({isFetching:!0}),await Ae({idApartments:[g],idBuilding:e,filterObject:{},isAll:!1});const x=await se({idApartment:g,idBuilding:e});h({code:x.data.qrcode,text:x.data.text}),i({isFetching:!1})},p=x=>{const O=x.replace(/400/g,"800").replace(/20px/g,"40px");at(O)},A=_.useRef(null);return t(fe,{title:f,open:T.isShow,onOk:()=>p(A.current.innerHTML),onCancel:y,footer:[t(H,{onClick:y,children:n.cancel},"back"),t(H,{type:"primary",onClick:u,children:n.refresh_code},"refresh_code"),t(H,{type:"primary",onClick:()=>p(A.current.innerHTML),children:n.print},"submit")],children:t("div",{style:{width:"100%",minHeight:"350px"},ref:A,children:t("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:o.isFetching?t(ve,{width:"50px",height:"50px",isLoading:o.isFetching}):v(ge,{children:[t("div",{style:{height:300},children:!o.isFetching&&l.code&&t("img",{src:l.code,alt:"qr-code",style:{width:300,height:300,display:"block",margin:"auto"}})}),t("div",{style:{textAlign:"center",padding:"0px 20%",minWidth:"180px"},children:v("h3",{style:{textAlign:"center",fontSize:"14px",border:"1px solid blue",borderRadius:"4px",padding:"12px 24px"},children:["QR Code - ",l.text]})})]})})})})};ne.propTypes={qrModal:K.objectOf(K.any),hideQRModal:K.func};ne.defaultProps={qrModal:{},hideQRModal:()=>{}};const L=_.createContext({apartmentPermissionWrite:!1,apartmentPermissionExport:!1,apartmentPermissionRead:!1,paymentPermissionRead:!1,idBuilding:0,tableData:{records:[],totalRecord:0},setTableData:()=>{},getsStatus:{isFetching:!1},setGetsStatus:()=>{},filter:{...$},setFilter:()=>{},tablePagination:{current:B,limit:W},setTablePagination:()=>{},onSelectRow:()=>{},onSelectAllRowOfPage:()=>{},tableSelection:()=>{},selectAllRowComponent:()=>{},resetDataTableSelection:()=>{},modalUpdateApartment:void 0,showModalUpdateApartment:()=>{},hideModalUpdateApartment:()=>{},formFilter:void 0,floorData:{isFetching:!1,records:[]},setFloorData:()=>{},isUsedIntercom:!1,labels:[],setLabels:()=>{}}),ie=({children:S})=>{const T=oe(),[y]=U.useForm(),{getPermissionByModuleCode:g}=be(),{idBuilding:f}=T,{checkIsUsedIntegrate:e}=Oe(),[o,i]=_.useState({isFetching:!1}),[l,h]=_.useState({...$}),[u,p]=_.useState({current:B,limit:W}),[A,C]=_.useState({records:[],totalRecord:0}),[d,x]=_.useState({isFetching:!1,records:[]}),[O,R]=_.useState([]),[s,c,r,a,m]=st({dataRows:A.records,rowKey:"id",totalRows:A.totalRecord}),[k,F,M]=Te(),E=g(Me),D=g(Ye),b=(E==null?void 0:E[Ie])??!1,Y=(E==null?void 0:E[Le])??!1,I=(E==null?void 0:E[de])??!1,V=(D==null?void 0:D[de])??!1,X=e(dt),te={apartmentPermissionWrite:b,apartmentPermissionExport:Y,apartmentPermissionRead:I,paymentPermissionRead:V,idBuilding:f,tableData:A,setTableData:C,getsStatus:o,setGetsStatus:i,filter:l,setFilter:h,tablePagination:u,setTablePagination:p,onSelectRow:r,onSelectAllRowOfPage:a,tableSelection:s,selectAllRowComponent:m,resetDataTableSelection:c,modalUpdateApartment:k,showModalUpdateApartment:F,hideModalUpdateApartment:M,formFilter:y,floorData:d,setFloorData:x,isUsedIntercom:X,labels:O,setLabels:R};return t(L.Provider,{value:te,children:S})};ie.propTypes={children:K.node};ie.defaultProps={children:t("div",{})};const mt=ie,gt=S=>{const{isUserCs:T}=Ue(),{apartments:y}=S,g=Ne()===Be;return y.reduce((f,e)=>{var c,r,a,m,k,F,M,E,D,b;const o=(e==null?void 0:e.id)??0,i=((c=e==null?void 0:e.floor)==null?void 0:c.name)??"",l=(e==null?void 0:e.name)??"",h=((r=e==null?void 0:e.residents)==null?void 0:r.length)>0?n.in_use:n.empty,u=T?"***":((a=e==null?void 0:e.owner)==null?void 0:a.fullName)??"",p=g?we(((k=(m=e==null?void 0:e.unitType)==null?void 0:m.id)==null?void 0:k.replace(/_/g," "))??""):((F=e==null?void 0:e.unitType)==null?void 0:F.name)??"",A=((E=(M=Qe)==null?void 0:M[e.buildStatus])==null?void 0:E.name)??"",C=((D=e==null?void 0:e.label)==null?void 0:D.title)??"",d=(e==null?void 0:e.customerCode)??"",x=(e==null?void 0:e.residents.length)??0,O=e==null?void 0:e.dateOfTakingApartment,R=(e==null?void 0:e.isUsedIntercom)??!1,s=(b=e==null?void 0:e.labels)!=null&&b.length?e==null?void 0:e.labels:[];return f.push({id:o,key:o,floor:i,apartmentName:l,status:h,owner:u,apartmentType:p,buildStatus:A,customerCode:C,action:"",apartment:e,codeCustomer:d,resident:x,dateOfTakingApartment:O,isUsedIntercom:R,labels:s}),f},[])},Z=()=>{const{getAllQuery:S,setQuery:T}=lt(),{setTablePagination:y,setFilter:g,formFilter:f,labels:e}=_.useContext(L);return{getQueryParamsApartment:()=>{var k,F,M,E,D,b,Y,I,V,X;const{limit:l,page:h,floorId:u,name:p,apartmentType:A,status:C,owner:d,customerCode:x,buildStatus:O,dateOfTakingApartmentFrom:R,dateOfTakingApartmentTo:s,labels:c}=S(),r=[];c!=null&&c.length&&((k=c==null?void 0:c.split(","))==null||k.forEach(te=>{e==null||e.forEach(Q=>{te===(Q==null?void 0:Q.title)&&r.push(Q==null?void 0:Q.id)})}));const a={pagination:{limit:l&&+l||W,page:h&&+h||B},filter:{floorId:u&&+u||"",apartmentType:A||"",status:C||"",name:p||"",customerCode:x||"",owner:d||"",buildStatus:O||"",dateOfTakingApartment:R&&s&&P(R,"DD/MM/YYYY",!0).isValid()&&P(s,"DD/MM/YYYY",!0).isValid()?[P(R,"DD/MM/YYYY",!0),P(s,"DD/MM/YYYY",!0)]:[],labels:r}};y({limit:a.pagination.limit,current:a.pagination.page}),g({...a.filter}),f.setFieldsValue({...a.filter});const m={limit:a.pagination.limit,page:a.pagination.page,floorId:(F=a.filter)==null?void 0:F.floorId,floorName:(M=a.extraData)==null?void 0:M.floorName,name:(E=a.filter)==null?void 0:E.name,apartmentType:(D=a.filter)==null?void 0:D.apartmentType,status:(b=a.filter)==null?void 0:b.status,owner:(Y=a.filter)==null?void 0:Y.owner,customerCode:(I=a.filter)==null?void 0:I.customerCode,buildStatus:(V=a.filter)==null?void 0:V.buildStatus,dateOfTakingApartmentFrom:"",dateOfTakingApartmentTo:"",labels:(c==null?void 0:c.length)&&((X=c==null?void 0:c.split(","))==null?void 0:X.join(","))||""};return a.filter.dateOfTakingApartment&&Array.isArray(a.filter.dateOfTakingApartment)&&a.filter.dateOfTakingApartment.length&&(m.dateOfTakingApartmentFrom=P(a.filter.dateOfTakingApartment[0]).format("DD/MM/YYYY"),m.dateOfTakingApartmentTo=P(a.filter.dateOfTakingApartment[1]).format("DD/MM/YYYY")),T(m),a},setQueryParamsApartment:({limit:l=W,page:h=B,filter:u=$})=>{const{floorId:p="",name:A="",status:C=null,apartmentType:d="",owner:x="",customerCode:O="",buildStatus:R="",dateOfTakingApartment:s=[],labels:c=""}=u,r=[];c==null||c.forEach(m=>{e==null||e.forEach(k=>{m===(k==null?void 0:k.id)&&r.push(k==null?void 0:k.title)})});const a={limit:l,page:h,floorId:p,name:A,apartmentType:d,status:C,owner:x,customerCode:O,buildStatus:R,dateOfTakingApartmentFrom:"",dateOfTakingApartmentTo:"",labels:Array.isArray(r)&&(r==null?void 0:r.length)>0?r==null?void 0:r.join(","):""};s&&Array.isArray(s)&&s.length&&(a.dateOfTakingApartmentFrom=P(s[0]).format("DD/MM/YYYY"),a.dateOfTakingApartmentTo=P(s[1]).format("DD/MM/YYYY")),T(a)}}},ft=()=>{const{apartmentPermissionRead:S,apartmentPermissionWrite:T,paymentPermissionRead:y,getsStatus:g,idBuilding:f,tablePagination:e,tableData:o,filter:i,onSelectRow:l,onSelectAllRowOfPage:h,tableSelection:u,showModalUpdateApartment:p,isUsedIntercom:A}=_.useContext(L),{layoutScrollRef:C}=_.useContext(ye),{setQueryParamsApartment:d}=Z(),x=Fe(),{selectedRowKeys:O}=u,[R,s,c]=Te(),r=async(D,b)=>{let{current:Y,limit:I}=e;D!==Y?Y=D:b!==I&&(I=b,Y=B),d({limit:I,page:Y,filter:i})},a=D=>{s(D)},m=D=>{p({...D})},k={selectedRowKeys:O,onSelect:l,onSelectAll:h,fixed:!0,columnWidth:65},F={pageSize:e.limit,defaultCurrent:B,current:e.current,total:o.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:r},M=gt({apartments:o.records}),E={offsetScroll:x.offsetScrollX,getContainer:()=>C.current};return{isLoading:g.isFetching,apartmentPermissionRead:S,apartmentPermissionWrite:T,paymentPermissionRead:y,idBuilding:f,onClickBtnShowQRCode:a,onClickBtnUpdateApartment:m,apartmentTablePagination:F,apartmentRowSelection:k,qrModal:R,hideQRModal:c,dataSource:M,sticky:E,isUsedIntercom:A}};var ht={name:"192s9p1",styles:"display:flex;flex-direction:row;justify-content:center;align-items:center"};const At=()=>{const S=Se(),{isLoading:T,idBuilding:y,onClickBtnShowQRCode:g,onClickBtnUpdateApartment:f,apartmentTablePagination:e,apartmentRowSelection:o,qrModal:i,hideQRModal:l,dataSource:h,sticky:u,apartmentPermissionRead:p,apartmentPermissionWrite:A,paymentPermissionRead:C,isUsedIntercom:d}=ft(),x=[{title:n.unit,key:"apartmentName",dataIndex:"apartmentName",isFilter:!0,fixed:"left",width:150},{title:n.qr_code,key:"apartmentCode",dataIndex:"apartmentCode",width:100,render:(R,s,c)=>t(z,{name:"icon-qrcode-outlined",css:r=>({fontSize:r.iconSize}),onClick:()=>g(s==null?void 0:s.apartment)}),align:"center"},{title:n.floor,key:"floor",dataIndex:"floor",width:76},{title:n.apartment_type,key:"apartmentType",dataIndex:"apartmentType",width:200},{title:n.householder,key:"owner",dataIndex:"owner",width:200},{title:n.status1,key:"status",dataIndex:"status",isFilter:!0,width:100,render:(R,s)=>{var c,r;return((r=(c=s==null?void 0:s.apartment)==null?void 0:c.residents)==null?void 0:r.length)>0?t(N,{color:"success",children:R}):t(N,{color:"error",children:R})}},{title:n.label.label,key:"label",dataIndex:"label",width:200,render:(R,s)=>{var c,r;return(c=s==null?void 0:s.labels)!=null&&c.length?(r=s==null?void 0:s.labels)==null?void 0:r.map(a=>{var m;return((m=a==null?void 0:a.title)==null?void 0:m.length)>30?t(_e,{placement:"top",title:a==null?void 0:a.title,children:t("div",{style:{marginBottom:"5px"},children:v(N,{color:(a==null?void 0:a.color)??"default",style:{display:"block"},children:[" ",Re.truncate(a==null?void 0:a.title,{length:30})]})})},a==null?void 0:a.id):t("div",{style:{marginBottom:"5px"},children:t(N,{color:(a==null?void 0:a.color)??"default",style:{display:"block"},children:a==null?void 0:a.title})},a==null?void 0:a.id)}):null}},{title:n.build_status,key:"buildStatus",dataIndex:"buildStatus",isFilter:!0,width:150},{title:n.date_of_taking_apartment,key:"dateOfTakingApartment",dataIndex:"dateOfTakingApartment",width:200,render:R=>R?P(R).format("DD/MM/YYYY"):""},{title:n.residents,key:"resident",dataIndex:"resident",width:100},{title:n.payment_code,key:"codeCustomer",dataIndex:"codeCustomer",width:176},d?{title:n.intercom_usage,width:150,dataIndex:"isUsedIntercom",key:"isUsedIntercom",render:(R,s)=>t(nt,{disabled:!0,checked:R}),ellipsis:!0}:null,{title:n.actions,key:"action",dataIndex:"action",align:"center",fixed:"right",width:110,render:(R,s,c)=>{var a;const r=((a=s==null?void 0:s.apartment)==null?void 0:a.id)??"";return v("div",{css:ht,children:[p?t(re,{css:m=>({marginRight:m.margin.xs}),to:`/buildings/${y}/apartments/${r}`,children:t(z,{title:n.detail,name:"icon-eye-outlined",css:m=>({fontSize:m.iconSize})})}):null,A?t(z,{onClick:()=>{S({action:Ge,label:Ce}),f(s.apartment)},title:n.update,name:"icon-edit-outlined",css:m=>({fontSize:m.iconSize,marginRight:m.margin.xs})}):null,C?t(re,{to:`/buildings/${y}/payment/single-apartment`,children:t(z,{title:n.payment,name:"icon-credit-card-outlined",css:m=>({fontSize:m.iconSize})})}):null]})}}].filter(Boolean),O={x:x.reduce((R,s)=>s+R.width,0),scrollToFirstRowOnChange:!0};return v(ge,{children:[t(Ee,{bordered:!0,columns:x,dataSource:h,loading:T,pagination:e,rowSelection:o,scroll:O,sticky:u}),i.isShow&&t(ne,{qrModal:i,hideQRModal:l})]})},ee=()=>{const{idBuilding:S,setTableData:T,setGetsStatus:y,floorData:g,setFloorData:f}=_.useContext(L);return{changeDataTable:async({filter:i,limit:l,page:h})=>{y({isFetching:!0});const{dateOfTakingApartment:u,apartmentType:p,buildStatus:A,customerCode:C,floorId:d,name:x,owner:O,status:R,labels:s,...c}=i;u&&Array.isArray(u)&&u.length&&(c.dateOfTakingApartmentFrom=P(u[0]).toDate(),c.dateOfTakingApartmentTo=P(u[1]).toDate());const r=await qe({filter:{...c,apartmentType:p||void 0,buildStatus:A||void 0,customerCode:C||void 0,dateOfTakingApartmentFrom:c.dateOfTakingApartmentFrom||void 0,dateOfTakingApartmentTo:c.dateOfTakingApartmentTo||void 0,floorId:d||void 0,name:x||void 0,owner:O||void 0,status:R||void 0,labelIds:s??[]},idBuilding:S,limit:l,page:h});T({records:r.data,totalRecord:r.totalRecord}),y({isFetching:!1})},changeDataFloor:async(i,l=null,h,u,p)=>{var C;if(l&&(((C=g==null?void 0:g.records)==null?void 0:C.find(x=>x.id===l&&x.name===i))??null))return;f({...g,isFetching:!0});const A=await ze({idBuilding:S,filter:h,limit:u,page:p});f({isFetching:!1,records:A.data})}}},Tt=()=>{const{filter:S,formFilter:T,tablePagination:y,labels:g}=_.useContext(L),{setQueryParamsApartment:f}=Z(),{apartmentTypes:e}=De(),{changeDataTable:o}=ee(),{floors:i}=ke();return[i,e,async h=>{const u=ct(h,S);u&&await o({filter:{...h},limit:y.limit,page:y.current}),u||f({limit:W,page:B,filter:{...h}})},T,g]};var yt={name:"4zleql",styles:"display:block"},St={name:"4zleql",styles:"display:block"};const Ct=()=>{const[S,T,y,g,f]=Tt(),e=_.useMemo(()=>[{label:n.floor,key:"floorId",component:v(w,{fluid:"true",placeholder:n.floor,getPopupContainer:o=>o.parentNode,children:[t(w.Option,{value:"",children:n.all_floor},"floor_0"),S.map(o=>t(w.Option,{value:o.id,children:o.name},`floor_${o.id}`))]}),visible:!0},{label:n.unit,key:"name",component:t(j,{fluid:"true",placeholder:n.unit}),visible:!0},{label:n.apartment_type,key:"apartmentType",component:v(w,{fluid:"true",placeholder:n.apartment_type,getPopupContainer:o=>o.parentNode,children:[t(w.Option,{value:"",children:n.all_type},"apartment_type_0"),T.map(o=>t(w.Option,{value:o.id,children:o.name},`apartment_type_${o.id}`))]}),visible:!0},{label:n.status1,key:"status",component:v(w,{fluid:"true",placeholder:n.status1,getPopupContainer:o=>o.parentNode,children:[t(w.Option,{value:"",children:n.all_status},"status_0"),He.map(o=>t(w.Option,{value:o.id,children:o.name},o.id))]}),visible:!0},{label:n.label.label,key:"labels",component:t(w,{showSearch:!0,optionFilterProp:"children",filterOption:(o,i)=>{var l,h,u,p,A,C;return(h=(l=i==null?void 0:i.children)==null?void 0:l.props)!=null&&h.title?G((p=(u=i==null?void 0:i.children)==null?void 0:u.props)==null?void 0:p.title).indexOf(G(o))>=0:G((C=(A=i==null?void 0:i.children)==null?void 0:A.props)==null?void 0:C.children).indexOf(G(o))>=0},getPopupContainer:o=>o.parentNode,placeholder:n.label.label,fluid:"true",mode:"multiple",maxTagCount:"responsive",children:f==null?void 0:f.map(({id:o,title:i,color:l})=>(i==null?void 0:i.length)>40?t(w.Option,{value:o,children:t(_e,{placement:"top",title:i,children:t(N,{color:l??"default",css:yt,children:Re.truncate(i,{length:40})})})},o):t(w.Option,{value:o,children:t(N,{color:l??"default",css:St,children:i})},o))}),visible:!0},{label:n.householder,key:"owner",component:t(j,{placeholder:n.householder}),visible:!0},{label:n.payment_code,key:"customerCode",component:t(j,{placeholder:n.payment_code}),visible:!0},{label:n.build_status,key:"buildStatus",component:v(w,{fluid:"true",placeholder:n.label.build_status,getPopupContainer:o=>o.parentNode,children:[t(w.Option,{value:"",children:n.all_build_status},"build_status_0"),xe.map(o=>t(w.Option,{value:o.id,children:o.name},o.id))]}),visible:!0},{label:n.date_of_taking_apartment,key:"dateOfTakingApartment",component:t(he.RangePicker,{allowClear:!0,fluid:"true",placeholder:["DD/MM/YYYY","DD/MM/YYYY"],format:["DD/MM/YYYY","DD/MM/YYYY"],getPopupContainer:o=>o.parentNode}),visible:!0}],[S,T,f]);return t(q.FilterBox,{defaultFilter:{...$},onSearch:y,layout:"vertical",filters:e,formData:g})},xt="REFRESH_CODE",Rt="EXPORT_CODE",_t=()=>{const{apartmentPermissionExport:S,apartmentPermissionWrite:T,idBuilding:y,filter:g,selectAllRowComponent:f,tableSelection:e,resetDataTableSelection:o,tablePagination:i}=_.useContext(L),{changeDataTable:l}=ee(),{isSelectAllItem:h,selectedRowKeysCache:u}=e,[p,A]=_.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),[C,d]=_.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),[x,O]=_.useState({code:void 0,codeLanguage:void 0,isFetching:!1});J(p.code,p.codeLanguage,{message:n.success,description:n.export_data_success}),J(C.code,C.codeLanguage,{message:n.success,description:n.export_data_success}),J(x.code,x.codeLanguage,{message:n.success,description:n.refresh_apartment_code_success},async()=>{await l({filter:$,limit:i.limit,page:i.current}),o()});const R=async()=>{A({code:void 0,codeLanguage:void 0,isFetching:!0});try{const{dateOfTakingApartment:a,...m}=g;a&&Array.isArray(a)&&a.length&&(m.dateOfTakingApartmentFrom=P(a[0]).toDate(),m.dateOfTakingApartmentTo=P(a[1]).toDate());const k=await We({filter:{...m,labelIds:(m==null?void 0:m.labels)??[]},idBuilding:y});k.data&&ue(k.data,document,"thong-tin-can-ho.xlsx"),A({code:k.code,codeLanguage:k.codeLanguage,isFetching:!1})}catch(a){A({code:a.code,codeLanguage:a.codeLanguage,isFetching:!1})}},s=async({key:a})=>{const m=e.selectedRowKeysCache,k=e.isSelectAllItem;if(a===Rt){d({code:void 0,codeLanguage:void 0,isFetching:!0});try{const F=await $e({idApartments:m,idBuilding:y,filter:g,isAll:m.length===0?!0:k});F.data&&ue(F.data,document,"thong-tin-ma-can-ho.docx"),d({code:F.code,codeLanguage:F.codeLanguage,isFetching:!1})}catch(F){d({code:F.code,codeLanguage:F.codeLanguage,isFetching:!1})}}else if(a===xt){O({code:void 0,codeLanguage:void 0,isFetching:!0});try{const F=await Ae({idApartments:m,idBuilding:y,filter:g,isAll:m.length===0?!0:k});O({code:F.code,codeLanguage:F.codeLanguage,isFetching:!1})}catch(F){O({code:F.code,codeLanguage:F.codeLanguage,isFetching:!1})}}},c=!h&&u.length===0,r=C.isFetching||x.isFetching;return[S,T,c,p.isFetching,r,f,s,R]},pe="REFRESH_CODE",me="EXPORT_CODE",kt=()=>{const[S,T,y,g,f,e,o,i]=_t(),l=Se(),h=()=>t(ut,{rise:!0,children:v(ae,{selectable:!1,onClick:({key:p})=>{p===pe?l({action:Xe,label:le}):p===me&&l({action:Ke,label:le}),o({key:p})},children:[T?t(ae.Item,{children:n.refresh_code},pe):null,t(ae.Item,{children:n.export_code},me)]})}),u=[t(it,{disabled:y,dropdownRender:()=>h(),children:v(H,{loading:f,disabled:f,type:"primary",css:p=>({marginRight:p.margin.xs}),children:[t("span",{children:n.action}),t(z,{name:"icon-arrow-down-outlined"})]})},"action"),S?t(H,{type:"primary",ghost:!0,loading:g,disabled:g,onClick:()=>{l({action:Ve,label:Ce}),i()},icon:t(z,{name:"icon-download-outlined"}),children:n.export},"export"):null].filter(Boolean);return t(q.ActionBox,{actions:u,total:e()})},Ft=()=>{var O,R;const{idBuilding:S}=oe(),{modalUpdateApartment:T,hideModalUpdateApartment:y,filter:g,tablePagination:f,tableData:e,labels:o}=_.useContext(L),{data:i}=T,{setQueryParamsApartment:l}=Z(),{changeDataTable:h}=ee(),[u]=U.useForm(),[p,A]=_.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),C={buildStatus:i.buildStatus,dateOfTakingApartment:i.dateOfTakingApartment?P(i.dateOfTakingApartment):void 0,note:i.note,labelIds:(O=i==null?void 0:i.labels)!=null&&O.length?(R=i==null?void 0:i.labels)==null?void 0:R.map(s=>s==null?void 0:s.id):void 0};J(p.code,p.codeLanguage,{message:n.success,description:n.update_data_success},()=>{y()});const d=async()=>{var c;if(await u.validateFields()){A({isFetching:!0,code:void 0,codeLanguage:void 0});const r=u.getFieldsValue(),a=await Je({apartment:{...i,buildStatus:(r==null?void 0:r.buildStatus)||null,dateOfTakingApartment:(r==null?void 0:r.dateOfTakingApartment)||null,note:(r==null?void 0:r.note)||null,labelIds:(c=r==null?void 0:r.labelIds)!=null&&c.length?r==null?void 0:r.labelIds:void 0},idApartment:i.id,idBuilding:S});if(je.includes(a.code)){const m=pt(e.totalRecord-1,f.limit,f.current),k=f.current===m;k&&await h({limit:f.limit,page:f.current,filter:{...g}}),k||l({limit:f.limit,page:m,filter:{...g}})}A({isFetching:!1,code:a.code,codeLanguage:a.codeLanguage})}},x=()=>{y()};return[p.isFetching,u,C,d,x,o]};var Ot={name:"4zleql",styles:"display:block"};const wt=()=>{const[S,T,y,g,f,e]=Ft();return t(fe,{okButtonProps:{disabled:S,loading:S},open:!0,title:n.update,onOk:g,onCancel:f,okText:n.update,cancelText:n.cancel,width:"50%",children:v(U,{initialValues:y,layout:"vertical",form:T,name:"formUpdate",children:[v(rt,{gutter:[12,0],children:[t(ce,{span:12,children:t(U.Item,{name:"buildStatus",label:n.label.build_status,children:t(w,{fluid:"true",placeholder:n.label.build_status,children:xe.map(o=>t(w.Option,{value:o.id,children:o.name},o.id))})})}),t(ce,{span:12,children:t(U.Item,{name:"dateOfTakingApartment",label:n.date_of_taking_apartment,children:t(he,{fluid:"true",placeholder:"DD/MM/YYYY",format:"DD/MM/YYYY"})})})]}),t(U.Item,{name:"labelIds",label:n.label.label,children:t(w,{showSearch:!0,optionFilterProp:"children",filterOption:(o,i)=>{var l,h;return G((h=(l=i==null?void 0:i.children)==null?void 0:l.props)==null?void 0:h.children).indexOf(G(o))>=0},getPopupContainer:o=>o.parentNode,placeholder:n.label.label,fluid:"true",mode:"multiple",maxTagCount:"responsive",children:e==null?void 0:e.map(({id:o,title:i,color:l})=>t(w.Option,{value:o,children:t(N,{color:l??"default",css:Ot,children:i})},o))})}),t(U.Item,{name:"note",label:n.note,children:t(j.TextArea,{rows:2,fluid:"true",placeholder:n.note})})]})})},Et=()=>{const{setTitlePage:S,setVisibleSearchBox:T,setVisibleFilterBox:y}=_.useContext(ye),{idBuilding:g,modalUpdateApartment:f,setLabels:e}=_.useContext(L),{getQueryParamsApartment:o}=Z(),{changeDataTable:i}=ee(),{getFloors:l}=ke(),{search:h}=ot(),{labelData:u}=Pe();return _.useEffect(()=>(S(n.apartments),T(!0),(async()=>await l({idBuilding:g}))(),()=>{S(""),y(!1),T(!1)}),[]),_.useEffect(()=>{(async()=>{var p,A;if(g){const{pagination:C,filter:d}=o();h&&await i({filter:{floorId:d.floorId?d.floorId:"",apartmentType:d.apartmentType?d.apartmentType:"",status:d.status?d.status===Ze?"0":"1":"",owner:d.owner?d.owner.trim():"",customerCode:d.customerCode?d.customerCode.trim():"",name:d.name?d.name.trim():"",buildStatus:d.buildStatus?d.buildStatus:"",dateOfTakingApartmentFrom:(p=d.dateOfTakingApartment)!=null&&p[0]?P(d.dateOfTakingApartment[0]):"",dateOfTakingApartmentTo:(A=d.dateOfTakingApartment)!=null&&A[1]?P(d.dateOfTakingApartment[1]):"",labels:(d==null?void 0:d.labels)??[]},limit:C.limit,page:C.page})}})()},[h]),_.useEffect(()=>{const p=u==null?void 0:u.filter(A=>[et,tt].includes(A==null?void 0:A.type));e(p)},[u]),[f.isShow]},Dt=()=>{const[S]=Et();return v(q.Wrapper,{children:[t(Ct,{}),v(q.Container,{style:{flex:1},children:[t(q.Header,{children:t(kt,{})}),t(q.Content,{fluid:!0,children:t(At,{})})]}),S?t(wt,{}):null]})},Ao=()=>t(mt,{children:t(Dt,{})});export{Ao as default};
