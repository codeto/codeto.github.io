import{j as t,u as he,a as I,b as te,F as me}from"./@emotion-63839449.js";import{F as T,u as Le}from"./index-687ba9e6.js";import"./lodash-88fe09e6.js";import{h as $}from"./moment-a468e1f9.js";import{bw as Ge,dk as Ne,s as Ae,a9 as Re,ei as je,cP as we,eh as be,K as $e,I as H,l as n,E as Ie,S as We,cd as ze,e2 as He,b1 as Je}from"./index-c2ded735.js";import"./file-saver-40cf32a9.js";import{b as Fe,D as ge,d as Ee,l as de,a as Qe,C as Ce}from"./index-b17d22e5.js";import{S as O,I as W}from"./index-43183512.js";import{B as J}from"./index-881eef42.js";import{r as S}from"./react-4fd50329.js";import{g as Xe,a as Ze}from"./contract-2ad66738.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{P as oe}from"./prop-types-1172f4d5.js";import{u as et,d as tt}from"./react-router-a4308f7b.js";import{R as ae,b as V,S as xe,k as Se,c as Te,f as _e,B as ce}from"./antd-f9eae174.js";import{T as ee,l as K,m as le,n as Z,o as k,p as j,q as ie,r as it,s as z,t as Ve,u as at,v as rt,w as nt,V as st}from"./constants-d0d23bbb.js";import{g as dt}from"./cardWareHouse-505c9ae3.js";import{b as lt}from"./cardRegistrationForm-c181ed24.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./account-86ffff50.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";const ot=e=>({id:e.id,name:(e==null?void 0:e.fullName)??"",email:(e==null?void 0:e.email)??"",phone:(e==null?void 0:e.phone)??""}),ct=e=>{var r,a;return{id:e.id,name:e.name,residents:((r=e==null?void 0:e.residents)==null?void 0:r.map(d=>ot(d)))??[],buildStatus:((a=Ge[e==null?void 0:e.buildStatus])==null?void 0:a.name)??""}},mt=async(e,r)=>{try{const{name:a}=r,d=await Ne({filter:{name:a||void 0},idBuilding:e,limit:Ae,page:Re});return{code:d.code,codeLanguage:d.codeLanguage,data:d.data.map(f=>ct(f))}}catch(a){return{code:a.code,codeLanguage:a.codeLanguage,data:[]}}},ht=e=>({id:e.id,registrationPlate:(e==null?void 0:e.registrationPlate)??"",idCard:e==null?void 0:e.cardId,idContractTemplate:e==null?void 0:e.contractTemplateId}),Oe=async(e,r)=>{var a,d,f;try{const{idService:g,idApartment:u}=r,s=await Xe({idBuilding:e,filter:{serviceType:je,serviceId:g||void 0,unitId:u,status:we,systemCode:be}});return{code:s.code,codeLanguage:s.codeLanguage,data:((f=(d=(a=s==null?void 0:s.data)==null?void 0:a[0])==null?void 0:d.contracts)==null?void 0:f.map(i=>ht(i)))??[]}}catch(g){return{code:g.code,codeLanguage:g.codeLanguage,data:[]}}},re=S.createContext({idBuilding:0,parkingServices:[],setParkingServices:()=>{},formRegister:void 0,listCardSelected:{},setListCardSelected:()=>{},listVehicleSelected:{},setListVehicleSelected:()=>{},listContractTemplate:[],setListContractTemplate:()=>{},listVehicle:[],setListVehicle:()=>{},listResidentOfApartmentSelected:[],setListResidentOfApartmentSelected:()=>{},modalAddVehicle:void 0,showModalAddVehicle:()=>{},hideModalAddVehicle:()=>{}}),fe=({children:e})=>{const{idBuilding:r}=et(),[a,d]=S.useState([]),[f,g]=S.useState({}),[u,s]=S.useState({}),[i,p]=S.useState([]),[y,l]=S.useState([]),[F,v]=S.useState([]),[b]=T.useForm(),[A,L,_]=$e(),D={idBuilding:r,parkingServices:a,setParkingServices:d,formRegister:b,listCardSelected:f,setListCardSelected:g,listVehicleSelected:u,setListVehicleSelected:s,listContractTemplate:i,setListContractTemplate:p,listVehicle:y,setListVehicle:l,listResidentOfApartmentSelected:F,setListResidentOfApartmentSelected:v,modalAddVehicle:A,showModalAddVehicle:L,hideModalAddVehicle:_};return t(re.Provider,{value:D,children:e})};fe.propTypes={children:oe.node};fe.defaultProps={children:t("div",{})};const pt=fe,ut=()=>{const{idBuilding:e,formRegister:r,setListResidentOfApartmentSelected:a,listResidentOfApartmentSelected:d,setListCardSelected:f,setListVehicleSelected:g,setListVehicle:u}=S.useContext(re),[s,i]=S.useState({isFetching:!1,records:[]}),[p,y]=S.useState(!0),l=async b=>{r.setFieldsValue({cards:[],registrant:"",email:void 0,phone:void 0});const A=await Oe(e,{idApartment:b});u(A.data);for(let L=0;L<s.records.length;L+=1)if(s.records[L].id===b){a(s.records[L].residents);break}f({}),g({}),p&&y(!1)},F=async b=>{i({...s,isFetching:!0});const A=await mt(e,{name:b});i({isFetching:!1,records:A.data})},v=b=>{for(let A=0;A<d.length;A+=1)d[A].name===b&&r.setFieldsValue({email:d[A].email,phone:d[A].phone})};return S.useEffect(()=>{(async()=>await F())()},[]),[p,s.isFetching,s.records,d,F,l,v]};var gt={name:"82a6rk",styles:"flex:1"},ft={name:"s5xdrg",styles:"display:flex;align-items:center"};const yt=()=>{const[e,r,a,d,f,g,u]=ut(),s=he();return I(J,{css:gt,children:[I(J.Header,{css:ft,borderBottom:!0,children:[t(H,{name:"icon-info-circle-filled",css:te({fontSize:s.iconSize,marginRight:s.margin.xs,color:s.color.primary},"","")}),t(Fe,{css:te({color:s.color.primary,fontWeight:s.fontWeight.bold},"",""),children:n.general_information})]}),t(J.Content,{children:I(ae,{gutter:[s.margin.xs,0],children:[t(V,{span:"12",children:t(T.Item,{name:"registerAt",label:n.register_at,rules:[{required:!0}],children:t(ge,{fluid:"true",placeholder:"DD/MM/YYYY",format:"DD/MM/YYYY"})})}),t(V,{span:"12"}),t(V,{span:"12",children:t(T.Item,{name:"apartment",label:n.unit,rules:[{required:!0}],children:t(O,{showSearch:!0,placeholder:n.select_apartment,filterOption:!1,loading:r,onSearch:Ee(f),style:{width:"100%"},dropdownRender:i=>r?t("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:t(xe,{})}):i,onChange:g,children:a.map(({id:i,name:p,buildStatus:y})=>I(O.Option,{value:i,children:[p,y?` - ${y}`:""]},i))})})}),t(V,{span:"12",children:t(T.Item,{name:"registrant",label:n.registrant,rules:[{required:!0}],children:t(Se,{disabled:e,filterOption:(i,p)=>{var y,l;return((l=(y=p==null?void 0:p.value)==null?void 0:y.toUpperCase())==null?void 0:l.indexOf(i.toUpperCase()))!==-1},placeholder:n.registrant,style:{width:"100%"},onSelect:u,children:d.map(({id:i,name:p})=>t(Se.Option,{value:p,children:p},`${p}-${i}`))})})}),t(V,{span:"12",children:t(T.Item,{name:"email",label:n.email,children:t(W,{fluid:"true",disabled:e,placeholder:n.email})})}),t(V,{span:"12",children:t(T.Item,{name:"phone",label:n.phone,children:t(W,{fluid:"true",disabled:e,placeholder:n.phone})})}),t(V,{span:"24",children:t(T.Item,{name:"note",label:n.note,children:t(W.TextArea,{placeholder:n.note})})})]})})]})},vt=e=>{var r,a,d,f,g;return{id:e.id,code:e.code,type:e.type,owner:{id:(r=e==null?void 0:e.owner)==null?void 0:r.id,name:((a=e==null?void 0:e.owner)==null?void 0:a.fullName)??"",phone:((d=e==null?void 0:e.owner)==null?void 0:d.phone)??"",email:((f=e==null?void 0:e.owner)==null?void 0:f.email)??""},slots:((g=e==null?void 0:e.slots)==null?void 0:g.map(u=>{var s,i;return{id:u.id,type:u.type,vehicleType:(s=u==null?void 0:u.contract)==null?void 0:s.contractTemplateId,vehicle:(i=u==null?void 0:u.contract)==null?void 0:i.id}}))??[]}},Ct=async(e,r)=>{try{const{code:a,type:d,idApartment:f}=r,g=await dt({filter:{code:a||void 0,type:d&&d.length>0?d:void 0,status:we,unitId:f||void 0},idBuilding:e,limit:Ae,page:Re});return{code:g.code,codeLanguage:g.codeLanguage,data:g.data.map(u=>vt(u))}}catch(a){return{code:a.code,codeLanguage:a.codeLanguage,data:[]}}},St=({index:e})=>{const{idBuilding:r,listContractTemplate:a,setListVehicleSelected:d,listVehicleSelected:f,listCardSelected:g,listResidentOfApartmentSelected:u,setListCardSelected:s,formRegister:i,listVehicle:p,showModalAddVehicle:y}=S.useContext(re),[l,F]=S.useState(),[v,b]=S.useState(),[A,L]=S.useState([]),[_,D]=S.useState({isFetching:!1,records:[]}),[q,R]=S.useState([]),w=async(m,o)=>{let h,C=[Z];o===z?(C=[Z,le,Ve],h=i.getFieldValue("apartment")):o===ie&&(C=[at,le,rt,Ve],h=i.getFieldValue("apartment")),D({isFetching:!0,records:[]});const E=await Ct(r,{code:m,type:C,idApartment:h});D({isFetching:!1,records:E.data})},P=m=>{let o=[];l===K?o=p.filter(h=>h.idContractTemplate===m&&!h.idCard):l===z?v.type===Z||v.type===le?o=p.filter(h=>h.idContractTemplate===m&&!h.idCard):o=p.filter(h=>h.idContractTemplate===m&&h.idCard===v.id):l===ie&&(o=p.filter(h=>h.idContractTemplate===m&&h.idCard===v.id)),R(o)},U=async(m,o)=>{F(m);const h=i.getFieldValue("cards");h[o]={...h[o],cardCode:void 0,cardOwner:void 0,phone:void 0,email:void 0,vehicleType:void 0,vehicle:void 0,target:[]},i.setFieldsValue({cards:h}),b(void 0),L([]);const C={...g};delete C[o],s(C);const E={...f};delete E[o],d(E),w("",m)},pe=(m,o)=>{var E,se,ve;s({...g,[o]:m});const h={...f};delete h[o],d(h);const C=i.getFieldValue("cards");C[o].vehicleType=void 0,C[o].vehicle=void 0;for(let ue=0;ue<_.records.length;ue+=1){const x={..._.records[ue]};if(x.id===+m){b(x),C[o].cardOwner=(E=x==null?void 0:x.owner)==null?void 0:E.id,C[o].phone=(se=x==null?void 0:x.owner)==null?void 0:se.phone,C[o].email=(ve=x==null?void 0:x.owner)==null?void 0:ve.email;let N=[];if(l===K)N=j,L([N]);else if(l===z){if(x.type===Z)N=[j,ee];else for(let B=0;B<k.length;B+=1){const Y=x.slots.find(M=>M.type===k[B]);Y?(N.push(`${Y.type}+${Y.id}`),k[B]===ee&&(C[o].vehicleType=Y.vehicleType,C[o].vehicle=Y.vehicle,R(p.filter(M=>M.idContractTemplate===Y.vehicleType&&M.idCard===+m)))):N.push(k[B])}L(N)}else{for(let B=0;B<k.length;B+=1){const Y=x.slots.find(M=>M.type===k[B]);Y&&k[B]===ee&&(C[o].vehicleType=Y.vehicleType,C[o].vehicle=Y.vehicle,R(p.filter(M=>M.idContractTemplate===Y.vehicleType&&M.idCard===+m)))}L([])}C[o].target=N;break}}i.setFieldsValue({cards:C})},Q=(m,o)=>{const h=u.find(E=>E.id===m),C=i.getFieldValue("cards");C[o].phone=h==null?void 0:h.phone,C[o].email=h==null?void 0:h.email,i.setFieldsValue({cards:C})},G=(m,o)=>{d({...f,[o]:m})},ne=m=>{L(l===K?[m.target.value]:m)},c=async m=>{P(m)},X=m=>{const o={...g};delete o[m],s(o);const h={...f};delete h[m],d(h)},Pe=()=>{y({apartment:i.getFieldValue("apartment")})};S.useEffect(()=>{var o,h;const m=(h=(o=i.getFieldValue("cards"))==null?void 0:o[e])==null?void 0:h.vehicleType;P(m)},[p,e]);const De=!l,Ye=!v,ke=!!v,Be=!!A.find(m=>m.indexOf(ee)!==-1),qe=S.useMemo(()=>!(l===K||v&&[le,Z].includes(v.type)),[l,v]),Me=S.useMemo(()=>{var h;const m=l===z,o=[];for(let C=0;C<k.length;C+=1){const E=(h=v==null?void 0:v.slots)==null?void 0:h.find(se=>se.type===k[C]);E?o.push({id:`${E.type}+${E.id}`,name:E.type===j?n.elevator:n.vehicle,disabled:m}):l!==ie&&o.push({id:k[C],name:k[C]===j?n.elevator:n.vehicle,disabled:m})}return o},[v,l]),Ke=a.filter(m=>m.parkingType!==it&&l===z||l!==z),Ue=S.useMemo(()=>{var o;const m=_.records.find(h=>h.id===(v==null?void 0:v.id));return l===K||!((o=m==null?void 0:m.owner)!=null&&o.id)?u:[{id:m.owner.id,name:m.owner.name}]},[_,u,l,v]);return{isDisabledCardCode:De,isDisabledVehicleForm:qe,isShowVehicleForm:Be,isDisabledCardOwnerInfo:Ye,isShowTargetForm:ke,loadingCard:_.isFetching,listCard:_.records,registerTypeSelected:l,listCardSelected:g,listResidentOfApartmentSelected:Ue,listVehicleType:Ke,listVehicleSelected:f,listVehicle:q,targetList:Me,cardCodeSelected:v,handleSearchCard:w,handleSelectRegisterType:U,handleSelectVehicle:G,handleRemoveCardForm:X,handleSelectCardCode:pe,handleChangeVehicleType:c,handleChangeTarget:ne,handleSelectCardOwner:Q,handleAddVehicle:Pe}};var Tt={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},_t={name:"1408f10",styles:"padding-left:0"};const ye=({field:e,remove:r})=>{var ne;const{isDisabledCardCode:a,isDisabledVehicleForm:d,isShowVehicleForm:f,isDisabledCardOwnerInfo:g,isShowTargetForm:u,handleChangeVehicleType:s,handleRemoveCardForm:i,handleSearchCard:p,handleSelectCardCode:y,handleSelectRegisterType:l,handleSelectVehicle:F,handleSelectCardOwner:v,listCard:b,listCardSelected:A,listVehicle:L,listVehicleSelected:_,listVehicleType:D,listResidentOfApartmentSelected:q,loadingCard:R,registerTypeSelected:w,handleChangeTarget:P,targetList:U,handleAddVehicle:pe,cardCodeSelected:Q}=St({index:e.name}),G=he();return I(J,{css:te({marginTop:G.margin.md},"",""),children:[I(J.Header,{css:Tt,borderBottom:!0,children:[I(Fe,{css:te({color:G.color.primary,fontWeight:G.fontWeight.bold},"",""),children:[n.card," ",+e.name+1]}),t(H,{name:"icon-close-outlined",css:te({fontSize:G.iconSize},"",""),onClick:()=>{i(e.name),r(e.name)}})]}),t(J.Content,{children:I(ae,{gutter:[G.margin.xs,0],children:[t(V,{span:"12",children:t(T.Item,{rules:[{required:!0}],name:[e.name,"registerType"],fieldKey:[e.fieldKey,"registerType"],label:n.register_type,children:t(O,{onChange:c=>l(c,e.name),fluid:"true",placeholder:n.register_type,children:nt.map(c=>t(O.Option,{value:c.value,children:c.label},c.value))})})}),t(V,{span:"12"}),t(V,{span:"12",children:t(T.Item,{rules:[{required:!0}],name:[e.name,"cardCode"],fieldKey:[e.fieldKey,"cardCode"],label:n.card_code,children:t(O,{showSearch:!0,placeholder:n.card,filterOption:!1,loading:R,onSearch:Ee(c=>p(c,w)),style:{width:"100%"},dropdownRender:c=>R?t("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:t(xe,{})}):c,onChange:c=>y(c,e.name),disabled:a,children:b.map(({id:c,code:X})=>t(O.Option,{value:c,disabled:Object.values(A).includes(c),children:X},c))})})}),t(V,{span:"12",children:t(T.Item,{rules:[{required:!0}],name:[e.name,"cardOwner"],fieldKey:[e.fieldKey,"cardOwner"],label:n.card_owner,disabled:(ne=Q==null?void 0:Q.owner)==null?void 0:ne.id,children:t(O,{onChange:c=>v(c,e.name),disabled:g,fluid:"true",placeholder:n.card_owner,children:q.map(c=>t(O.Option,{value:c.id,children:c.name},c.id))})})}),t(V,{span:"12",children:t(T.Item,{name:[e.name,"email"],fieldKey:[e.fieldKey,"email"],label:n.email,children:t(W,{disabled:!0,placeholder:n.email})})}),t(V,{span:"12",children:t(T.Item,{name:[e.name,"phone"],fieldKey:[e.fieldKey,"phone"],label:n.phone,children:t(W,{disabled:!0,placeholder:n.phone})})}),u?I(me,{children:[t(V,{span:"24",children:t(T.Item,{rules:[{required:!0}],name:[e.name,"target"],fieldKey:[e.fieldKey,"target"],label:n.target,children:w!==K?t(Te.Group,{onChange:P,children:U.map(c=>t(Te,{disabled:c.disabled,value:c.id,children:c.name},c.id))}):t(_e.Group,{onChange:P,children:U.map(c=>t(_e,{disabled:c.disabled,value:c.id,children:c.name},c.id))})})}),f?I(me,{children:[t(V,{span:"24",children:t(T.Item,{rules:[{required:!0}],name:[e.name,"vehicleType"],fieldKey:[e.fieldKey,"vehicleType"],label:n.vehicle_type,children:t(O,{disabled:d,onChange:s,fluid:"true",placeholder:n.vehicle_type,children:D.map(c=>t(O.Option,{value:c.id,children:c.name},c.id))})})}),I(V,{span:"24",children:[t(T.Item,{rules:[{required:!0}],name:[e.name,"vehicle"],fieldKey:[e.fieldKey,"vehicle"],label:n.vehicle,children:t(O,{disabled:d,placeholder:n.vehicle,fluid:"true",onChange:c=>F(c,e.name),children:L.map(({id:c,registrationPlate:X})=>t(O.Option,{value:c,disabled:Object.values(_).includes(c),children:X},c))})}),w!==ie?t(ce,{css:_t,onClick:pe,type:"link",icon:t(H,{name:"icon-plus-circle-outlined"}),children:n.add_vehicle}):null]})]}):null]}):null]})})]},e.key)};ye.propTypes={field:oe.objectOf(oe.any),remove:oe.func};ye.defaultProps={field:void 0,remove:()=>{}};const Vt=async(e,r)=>{try{const a=await Ze({contracts:[r],idBuilding:e});return{code:a.code,codeLanguage:a.codeLanguage}}catch(a){return{code:a.code,codeLanguage:a.codeLanguage}}},Lt=()=>{const{listContractTemplate:e,idBuilding:r,hideModalAddVehicle:a,modalAddVehicle:d,parkingServices:f,setListVehicle:g}=S.useContext(re),{apartment:u}=d.data,[s]=T.useForm(),[i,p]=S.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[y,l]=S.useState();Le(i.code,i.codeLanguage,{message:n.success,description:n.add_data_success},()=>{a()});const F=async()=>{var L;if(s.setFieldsValue({...Ie(s.getFieldsValue(),{})}),await s.validateFields()){p({isFetching:!0,code:void 0,codeLanguage:void 0});const _=$(s.getFieldValue("registerDate")).startOf("day").toDate(),D=$(s.getFieldValue("dayStartedUsing")).startOf("day").toDate(),q=$(_).format("YYYYMM"),R={contractTemplateId:s.getFieldValue("contractTemplate"),createdAt:_,createdFor:Number(q),numberPersonQuota:1,requiredInfo:(L=y==null?void 0:y.requiredInfo)==null?void 0:L.map(P=>({...P,value:s.getFieldValue(P.key)})),startDate:D,totalNumberUse:1,unitId:u,contractTemplate:s.getFieldValue("contractTemplate")},w=await Vt(r,R);if(We.includes(w.code)){const P=await Oe(r,{idApartment:u});g(P.data)}p({isFetching:!1,code:w.code,codeLanguage:w.codeLanguage})}},v=()=>{a()},b=A=>{if(A.contractTemplate){const L=e.find(_=>_.id===A.contractTemplate);L&&l(f.find(_=>_.id===L.idService))}};return{loadingAddVehicle:i.isFetching,formAdd:s,listContractTemplate:e,requiredInfo:(y==null?void 0:y.requiredInfo)||[],handleAddVehicle:F,handleCancelAddVehicle:v,onValuesChange:b}},At=()=>{const{loadingAddVehicle:e,formAdd:r,listContractTemplate:a,requiredInfo:d,handleAddVehicle:f,handleCancelAddVehicle:g,onValuesChange:u}=Lt(),s=he();return t(Qe,{confirmLoading:e,okButtonProps:{disabled:e},okText:n.confirm,cancelText:n.cancel,onOk:f,onCancel:g,open:!0,title:n.add_vehicle,children:t(T,{initialValues:{contractTemplate:void 0,totalNumberUse:1,apartment:void 0},layout:"vertical",name:"formAdd",form:r,onValuesChange:u,children:I(ae,{gutter:[s.margin.xs,0],children:[t(V,{span:"12",children:t(T.Item,{rules:[{required:!0}],name:"contractTemplate",label:n.tariff,children:t(O,{fluid:"true",placeholder:n.tariff,children:a.map(i=>t(O.Option,{value:i.id,children:i.name},i.id))})})}),t(V,{span:"12"}),t(V,{span:"12",children:t(T.Item,{dependencies:["dayStartedUsing"],rules:[{required:!0},({getFieldValue:i})=>({validator(p,y){return y&&i("dayStartedUsing")&&$(y).isAfter(i("dayStartedUsing"))?Promise.reject(n.register_date_must_lower_or_equal_than_day_started_using):Promise.resolve()}})],name:"registerDate",label:n.register_date,children:t(ge,{fluid:"true",format:de,placeholder:de})})}),t(V,{span:"12",children:t(T.Item,{dependencies:["registerDate"],rules:[{required:!0},({getFieldValue:i})=>({validator(p,y){return y&&i("registerDate")&&$(y).isBefore(i("registerDate"))?Promise.reject(n.register_date_must_lower_or_equal_than_day_started_using):Promise.resolve()}})],name:"dayStartedUsing",label:n.day_started_using,children:t(ge,{fluid:"true",format:de,placeholder:de})})}),d.map(i=>i.key==="registration_plate"?t(V,{span:"12",children:t(T.Item,{rules:[{required:!0}],name:i.key,label:`${n[i.key]} *`,children:t(W,{placeholder:n[i.key]})})},i.key):i.key==="card"||i.key==="card_owner"?null:t(V,{span:"12",children:t(T.Item,{name:i.key,label:n[i.key],children:t(W,{placeholder:n[i.key]})})},i.key))]})})})},Rt=async(e,r)=>{try{const{registerAt:a,apartment:d,registrant:f,email:g,phone:u,note:s,cards:i}=r,p={createdAt:a?$(a).toDate():void 0,unit:d,register:{name:f,email:g,phone:u},note:s,actions:i.map(l=>({actionType:l.registerType,cardId:+l.cardCode,ownerId:+l.cardOwner,targetType:l.targetType,contractId:+l.vehicle||void 0,cardSlotId:+l.idCardSlot||void 0}))},y=await lt(e,p);return{code:y.code,codeLanguage:y.codeLanguage}}catch(a){return{code:a.code,codeLanguage:a.codeLanguage}}},wt=e=>{var r,a;return{id:e.id,name:e.name,parkingType:((r=e==null?void 0:e.formula)==null?void 0:r.parkingType)??"",idService:(a=e==null?void 0:e.service)==null?void 0:a.id}},bt=async e=>{try{const r=await ze({idBuilding:e});return{code:r.code,codeLanguage:r.codeLanguage,data:r.data.map(a=>wt(a)).filter(a=>{var d;return!!((d=st[a.parkingType])!=null&&d.value)})}}catch(r){return{code:r.code,codeLanguage:r.codeLanguage,data:[]}}},It=e=>({id:e.id,name:(e==null?void 0:e.name)??"",requiredInfo:(e==null?void 0:e.requiredInfo)??[]}),Ft=async e=>{try{const r=await He({idBuilding:e,filter:{systemCode:be}});return{code:r.code,codeLanguage:r.codeLanguage,data:r.data.map(a=>It(a))}}catch(r){return{code:r.code,codeLanguage:r.codeLanguage,data:[]}}},Et=()=>{const e=tt(),{idBuilding:r,formRegister:a,setListContractTemplate:d,setParkingServices:f,modalAddVehicle:g}=S.useContext(re),[u,s]=S.useState({isFetching:!1}),[i,p]=S.useState({isFetching:!1,code:void 0,codeLanguage:void 0});Le(i.code,i.codeLanguage,{message:n.success,description:n.add_data_success},()=>{a.resetFields()});const y=async()=>{if(a.setFieldsValue({...Ie(a.getFieldsValue(),{})}),await a.validateFields()){p({isFetching:!0,code:void 0,codeLanguage:void 0});const b=a.getFieldsValue(),{cards:A,...L}=b,_=[];for(let q=0;q<A.length;q+=1){const R=A[q];if(R.registerType===K)_.push({...R,idCardSlot:void 0,targetType:R.target});else if(R.registerType===ie)for(let w=0;w<R.target.length;w+=1){const U=R.target[w].split("+");_.push({...R,targetType:U[0],idCardSlot:U[1]})}else{const w=R.target.filter(P=>P.indexOf("+")===-1);w.length===1?_.push({...R,targetType:w[0],vehicle:w[0]===j?void 0:R.vehicle,vehicleType:w[0]===j?void 0:R.vehicleType}):w.length===2&&(_.push({...R,registerType:K,targetType:j,vehicle:void 0,vehicleType:void 0}),_.push({...R,targetType:ee}))}}const D=await Rt(r,{...L,cards:_});p({isFetching:!1,code:D.code,codeLanguage:D.codeLanguage})}},l=()=>{e.push(`/buildings/${r}/card-registration-form`)};S.useEffect(()=>{document.title=n.add_registration_form,(async()=>{s({isFetching:!0});const v=await bt(r);d(v.data);const b=await Ft(r);f(b.data||[]),s({isFetching:!1})})()},[]);const F={registerAt:$(),apartment:void 0,registrant:void 0,email:void 0,phone:void 0,note:void 0,cards:[]};return[i.isFetching,u.isFetching,g.isShow,a,F,l,y]};var xt={name:"13udsys",styles:"height:100%"},Ot={name:"13udsys",styles:"height:100%"},Pt={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Dt={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Yt={name:"1pgpjag",styles:"flex:1 0 0;overflow:auto"};const kt=()=>{const[e,r,a,d,f,g,u]=Et(),s=he();return r?t(Je,{isLoading:!0}):I(me,{children:[I(T,{css:xt,layout:"vertical",name:"formRegister",form:d,initialValues:f,children:[I(ae,{style:{paddingBottom:s.padding.xs,alignItems:"center"},gutter:[s.margin.xs,0],children:[t(Ce,{autoWidth:!0,children:t("p",{style:{margin:0,fontWeight:s.fontWeight.bold,fontSize:s.heading.three},children:n.add_registration_form})}),I(Ce,{centerVertical:!0,children:[t(ce,{style:{marginRight:s.margin.xs},icon:t(H,{name:"icon-arrow-Left2-outlined"}),onClick:g,children:n.back}),t(ce,{onClick:u,loading:e,type:"primary",icon:t(H,{name:"icon-check-outlined"}),children:n.register})]})]}),I(ae,{css:Ot,gutter:[s.margin.xs,0],children:[t(V,{css:Pt,span:"12",children:t(yt,{})}),t(V,{css:Dt,span:"12",children:t(T.List,{name:"cards",children:(i,{add:p,remove:y})=>I(me,{children:[t(T.Item,{noStyle:!0,shouldUpdate:(l,F)=>l.apartment!==F.apartment,children:({getFieldValue:l})=>t(ce,{block:!0,onClick:()=>p({registerType:void 0,cardCode:void 0,cardOwner:void 0,email:void 0,phone:void 0,target:[],vehicleType:void 0,vehicle:void 0}),icon:t(H,{name:"icon-plus-outlined"}),type:"primary",disabled:!l("apartment"),children:n.add})}),t("div",{css:Yt,children:i.map(l=>t(ye,{field:l,remove:y},l.fieldKey))})]})})})]})]}),a?t(At,{}):null]})},Ca=()=>t(pt,{children:t(kt,{})});export{Ca as default};
