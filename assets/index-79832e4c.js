import{j as t,c as Le,u as N,a as d,F as W,b as A}from"./@emotion-63839449.js";import{C as T,a as Z,D as Pe,w as qe,P as ye}from"./index-b17d22e5.js";import{K as j,b0 as Ye,aP as Ve,ag as Ne,aN as xe,at as ze,a3 as Je,l as n,bH as Ke,a5 as Oe,I as y,a as Fe,gr as je,i as fe,A as Ae,M as Ce,X as Se,j as He,S as z,gs as Qe,gt as Ge,b1 as Ze}from"./index-c2ded735.js";import"./lodash-88fe09e6.js";import{h as k}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import{B as We}from"./index-881eef42.js";import{r as h}from"./react-4fd50329.js";import{P as Y}from"./prop-types-1172f4d5.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{u as $e}from"./react-router-a4308f7b.js";import{i as U,j as M,h as V,k as Xe,l as et,R as me,f as De,T as tt,m as at}from"./constant-e1099cfb.js";import{B as $,w as X,b as _,R as G,I as st,T as _e,D as it,g as ue,S as nt,Q as Re,A as be}from"./antd-f9eae174.js";import{L as ot}from"./react-router-dom-2a8f5f6d.js";import{_ as ct}from"./react-fast-marquee-2084ac54.js";import{u as J,F as L}from"./index-687ba9e6.js";import{b as ee,c as ke,a as Be,g as rt,u as dt,F as lt}from"./updateRequest-0c593df4.js";import{I as te,S as we}from"./index-43183512.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./account-86ffff50.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./classnames-4ba1ba1a.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./department-807891d3.js";import"./staff-2880022d.js";const B=h.createContext({idBuilding:0,idRequest:0,request:void 0,setRequest:()=>{},tasks:[],setTasks:()=>{},activities:[],setActivities:()=>{},getListTaskStatus:{isFetching:!1},setGetListTaskStatus:()=>{},getListActivityStatus:{isFetching:!1},setGetListActivityStatus:()=>{},modalAddTask:void 0,showModalAddTask:()=>{},hideModalAddTask:()=>{},modalConfirmCompleteRequest:void 0,showModalConfirmCompleteRequest:()=>{},hideModalConfirmCompleteRequest:()=>{},modalConfirmCancelRequest:void 0,showModalConfirmCancelRequest:()=>{},hideModalConfirmCancelRequest:()=>{},modalUpdateTask:void 0,showModalUpdateTask:()=>{},hideModalUpdateTask:()=>{},modalUpdateRequest:void 0,showModalUpdateRequest:()=>{},hideModalUpdateRequest:()=>{},modalConfirmCompleteTask:void 0,showModalConfirmCompleteTask:()=>{},hideModalConfirmCompleteTask:()=>{},modalConfirmCancelTask:void 0,showModalConfirmCancelTask:()=>{},hideModalConfirmCancelTask:()=>{},taskPermissionWrite:!1,helpDeskPermissionRead:!1}),Te=({children:e})=>{const{idBuilding:o,idRequest:i}=$e(),[s,r]=h.useState(),[m,a]=h.useState([]),[g,c]=h.useState([]),[u,l]=h.useState({isFetching:!1}),[p,C]=h.useState({isFetching:!1}),[R,E,x]=j(),[S,f,w]=j(),[v,D,I]=j(),[b,P,ae]=j(),[se,ie,ne]=j(),[oe,ce,re]=j(),[de,Q,q]=j(),{getPermissionByModuleCode:O}=Ye(),le=O(Ve),he=(le==null?void 0:le[Ne])??!1,pe=O(xe),Ie=(pe==null?void 0:pe[ze])??!1,Ue={idBuilding:o,idRequest:i,request:s,setRequest:r,tasks:m,setTasks:a,activities:g,setActivities:c,getListTaskStatus:u,setGetListTaskStatus:l,getListActivityStatus:p,setGetListActivityStatus:C,modalAddTask:R,showModalAddTask:E,hideModalAddTask:x,modalConfirmCompleteRequest:b,showModalConfirmCompleteRequest:P,hideModalConfirmCompleteRequest:ae,modalConfirmCancelRequest:se,showModalConfirmCancelRequest:ie,hideModalConfirmCancelRequest:ne,modalUpdateTask:S,showModalUpdateTask:f,hideModalUpdateTask:w,modalUpdateRequest:v,showModalUpdateRequest:D,hideModalUpdateRequest:I,modalConfirmCompleteTask:de,showModalConfirmCompleteTask:Q,hideModalConfirmCompleteTask:q,modalConfirmCancelTask:oe,showModalConfirmCancelTask:ce,hideModalConfirmCancelTask:re,taskPermissionWrite:Ie,helpDeskPermissionRead:he};return t(B.Provider,{value:Ue,children:e})};Te.propTypes={children:Y.node};Te.defaultProps={children:t("div",{})};const ut=Te,F=Le("span",{target:"e14s5kll1"})("color:",e=>e.theme.labelColor,";"),H=Le("h3",{target:"e14s5kll0"})("font-weight:",e=>e.theme.fontWeight.bold,";margin:0;"),mt=()=>{const{request:e,showModalUpdateRequest:o,taskPermissionWrite:i}=h.useContext(B);return[e,r=>{o(r)},i]},gt=()=>{var m,a;const[e,o,i]=mt(),s=N(),r=Je();return d(G,{gutter:[s.margin.xs,s.margin.xs],align:"middle",children:[d(T,{centerVertical:!0,span:14,children:[d(F,{children:[n.expiry_date,": "]}),[U,M].includes(e.status)?t("span",{style:{paddingRight:"10px"},children:e.expiryDate?k(e.expiryDate).format("DD/MM/YYYY HH:mm"):"-"}):t($,{type:"text",onClick:()=>{r({action:Ke,label:Oe}),o(e)},disabled:!i,children:t("span",{style:{color:"#0530ad"},children:e.expiryDate?k(e.expiryDate).format("DD/MM/YYYY HH:mm"):"-"})}),e.expiryDate&&k(e.expiryDate).isBefore(k())?t(X,{color:"error",children:n.expired}):null]}),t(_,{span:10,children:d(F,{children:[n.status1,":"," ",t(X,{color:((m=V[e.status])==null?void 0:m.color)??"default",children:e.status?(a=V[e.status])==null?void 0:a.label:"-"})]})}),e.status===U?d(W,{children:[d(_,{span:14,children:[d(F,{children:[n.cancel_date,": "]}),e.cancelDate?k(e.cancelDate).format("DD/MM/YYYY"):"-"]}),d(_,{span:10,children:[d(F,{children:[n.cancel_reason,": "]}),e.note]})]}):null,e.status===M?d(W,{children:[d(_,{span:14,children:[d(F,{children:[n.complete_date,": "]}),e.completeDate?k(e.completeDate).format("DD/MM/YYYY"):"-"]}),d(_,{span:10,children:[d(F,{children:[n.result_of_the_task,": "]}),e.note]})]}):null,d(T,{centerVertical:!0,css:A({marginTop:s.margin.lg},"",""),span:24,children:[t(y,{name:"icon-library-books-outlined",css:A({fontSize:s.iconSize,marginRight:s.margin.xs},"","")}),t(H,{children:n.content})]}),d(T,{centerVertical:!0,span:24,children:[t(y,{name:"icon-library-books-outlined",css:A({fontSize:s.iconSize,marginRight:s.margin.xs,visibility:"hidden"},"","")}),t("span",{children:e.content||"-"})]}),e.attachments&&e.attachments.length>0?d(W,{children:[d(T,{centerVertical:!0,span:24,css:A({marginTop:s.margin.lg},"",""),children:[t(y,{name:"icon-attachment-outlined",css:A({fontSize:s.iconSize,marginRight:s.margin.xs},"","")}),t(H,{children:n.attachments})]}),t(T,{centerVertical:!0,span:24,children:t(G,{gutter:[s.margin.xs,s.margin.xs],children:e.attachments.map((g,c)=>t(T,{centerVertical:!0,centerHorizontal:!0,flex:"1 0 150px",style:{height:150},children:t(st,{style:{width:"150px",height:"150px",objectFit:"contain"},src:g,fallback:"data:image/png;base64,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"})},c))})})]}):null]})},ht=()=>{const{currentUser:e}=h.useContext(Fe),{request:o,idBuilding:i,helpDeskPermissionRead:s}=h.useContext(B);return[o,i,s,e==null?void 0:e.fullName]},pt=()=>{var m,a,g,c;const[e,o,i,s]=ht(),r=N();return d(G,{gutter:[0,r.margin.xs],children:[d(T,{centerVertical:!0,span:"24",children:[t(y,{name:"icon-supervised-user-circle-outlined",css:A({fontSize:r.iconSize,marginRight:r.margin.xs},"","")}),t(H,{children:n.members})]}),d(T,{centerVertical:!0,span:"12",children:[t(y,{name:"icon-supervised-user-circle-outlined",css:A({fontSize:r.iconSize,marginRight:r.margin.xs,visibility:"hidden"},"","")}),d(F,{children:[n.employee_name,":"]})]}),t(T,{centerVertical:!0,span:"12",children:t("span",{children:s})}),d(T,{centerVertical:!0,span:"12",children:[t(y,{name:"icon-supervised-user-circle-outlined",css:A({fontSize:r.iconSize,marginRight:r.margin.xs,visibility:"hidden"},"","")}),d(F,{children:[n.assignee,":"]})]}),t(T,{centerVertical:!0,span:"12",children:t("span",{children:`${e.department.name} - ${e.receiver.name}`})}),d(T,{centerVertical:!0,span:"12",children:[t(y,{name:"icon-supervised-user-circle-outlined",css:A({fontSize:r.iconSize,marginRight:r.margin.xs,visibility:"hidden"},"","")}),d(F,{children:[n.creator,":"]})]}),t(T,{centerVertical:!0,span:"12",children:t("span",{children:e.sender.name||"-"})}),d(T,{centerVertical:!0,span:"12",children:[t(y,{name:"icon-supervised-user-circle-outlined",css:A({fontSize:r.iconSize,marginRight:r.margin.xs,visibility:"hidden"},"","")}),d(F,{children:[n.approver,":"]})]}),t(T,{centerVertical:!0,span:"12",children:t("span",{children:e.approver.name||"-"})}),d(T,{centerVertical:!0,css:A({marginTop:r.margin.lg},"",""),span:"24",children:[t(y,{name:"icon-date-range-outlined",css:A({fontSize:r.iconSize,marginRight:r.margin.xs},"","")}),t(H,{children:n.date})]}),d(T,{centerVertical:!0,span:"12",children:[t(y,{name:"icon-date-range-outlined",css:A({fontSize:r.iconSize,visibility:"hidden",marginRight:r.margin.xs},"","")}),d(F,{children:[n.created_at,":"]})]}),t(T,{centerVertical:!0,span:"12",children:t("span",{children:e.requestDate?k(e.requestDate).format("DD/MM/YYYY"):"-"})}),d(T,{centerVertical:!0,span:"12",children:[t(y,{name:"icon-date-range-outlined",css:A({fontSize:r.iconSize,visibility:"hidden",marginRight:r.margin.xs},"","")}),d(F,{children:[n.updated_date,":"]})]}),t(T,{centerVertical:!0,span:"12",children:t("span",{children:e.updatedDate?k(e.updatedDate).format("DD/MM/YYYY"):"-"})}),e!=null&&e.helpDeskId&&i?d(W,{children:[d(T,{centerVertical:!0,span:"24",css:A({marginTop:r.margin.lg},"",""),children:[t(y,{name:"icon-reconciliation-filled",css:A({fontSize:r.iconSize,marginRight:r.margin.xs},"","")}),t(H,{children:n.help_desk})]}),d(T,{centerVertical:!0,span:"12",children:[t(y,{name:"icon-date-range-outlined",css:A({fontSize:r.iconSize,visibility:"hidden",marginRight:r.margin.xs},"","")}),d(F,{children:[n.help_desk_code,":"]})]}),t(T,{centerVertical:!0,span:"12",children:t(ot,{to:`/buildings/${o}/help-desk?helpDeskId=${e==null?void 0:e.helpDeskId}`,target:"_blank",children:(e==null?void 0:e.helpDeskCode)||"-"})}),d(T,{centerVertical:!0,span:"12",children:[t(y,{name:"icon-date-range-outlined",css:A({fontSize:r.iconSize,visibility:"hidden",marginRight:r.margin.xs},"","")}),d(F,{children:[n.apartment,":"]})]}),t(T,{centerVertical:!0,span:"12",children:t("span",{children:(m=e==null?void 0:e.apartment)!=null&&m.name?(a=e==null?void 0:e.apartment)==null?void 0:a.name:"-"})}),d(T,{centerVertical:!0,span:"12",children:[t(y,{name:"icon-date-range-outlined",css:A({fontSize:r.iconSize,visibility:"hidden",marginRight:r.margin.xs},"","")}),d(F,{children:[n.resident,":"]})]}),t(T,{centerVertical:!0,span:"12",children:t("span",{children:(g=e==null?void 0:e.resident)!=null&&g.name?(c=e==null?void 0:e.resident)==null?void 0:c.name:"-"})})]}):null]})},ft=e=>{const o=(e==null?void 0:e.actionBy)??n.label.deleted_account;let i="";if(e.model==="REQUEST"&&e.fieldName==="approvalStatus")switch(e.fieldValue){case et:i=n.activity_task_approved;break;case Xe:i=n.activity_task_rejected;break}if(e.model==="REQUEST"&&e.fieldName==="progressStatus")switch(e.fieldValue){case me:i=n.activity_task_doing;break;case U:i=n.activity_task_cancelled;break;case M:i=n.activity_task_completed;break}if(e.model==="TASK"&&e.fieldName==="progressStatus")switch(e.fieldValue){case De:i=n.activity_subtask_not_start;break;case me:i=n.activity_subtask_doing;break;case U:i=n.activity_subtask_cancelled;break;case M:i=n.activity_subtask_completed;break}return`${o} ${i}`},At=e=>{if(["dueDate","attachments"].includes(e.fieldName))return{icon:"icon-info-circle-outlined",color:"blue"};if(e.model==="REQUEST"&&e.fieldName==="approvalStatus")switch(e.fieldValue){case"APPROVED":return{icon:"icon-check-circle-outlined",color:"blue"};case"REJECTED":return{icon:"icon-close-circle-outlined",color:"red"};default:return{icon:"",color:""}}if(e.model==="TASK"&&e.fieldName==="progressStatus")switch(e.fieldValue){case"NOT_STARTED":return{icon:"icon-plus-circle-outlined",color:"blue"};case"IN_PROGRESS":return{icon:"icon-info-circle-outlined",color:"blue"};case"COMPLETED":return{icon:"icon-check-circle-outlined",color:"green"};case"CANCELLED":return{icon:"icon-close-circle-outlined",color:"red"};default:return{icon:"",color:""}}if(e.model==="REQUEST"&&e.fieldName==="progressStatus")switch(e.fieldValue){case"IN_PROGRESS":return{icon:"icon-info-circle-outlined",color:"blue"};case"COMPLETED":return{icon:"icon-check-circle-outlined",color:"green"};case"CANCELLED":return{icon:"icon-close-circle-outlined",color:"red"};default:return{icon:"",color:""}}return{icon:"icon-info-circle-outlined",color:"blue"}},Ct=e=>({id:e.id,createdAt:e.actionDate,status:At(e),content:ft(e),title:e.description}),K=async(e,o)=>{try{const i=await je(e,o);return{code:i.code,codeLanguage:i.codeLanguage,data:i.data.map(s=>Ct(s))}}catch(i){return{code:i.code,codeLanguage:i.codeLanguage,data:[]}}},Ee=`${He}/task`,St=Ee,kt=e=>`${Ee}/${e}`,Tt=(e,o)=>`${Ee}/${e}/change-progress/${o}`;async function Et(e,o){return await fe({type:Ae,payload:{apiUrl:St,method:Ce.POST,body:{...o},options:{headers:{[Se]:e}}}})}async function vt(e,o,i){return await fe({type:Ae,payload:{apiUrl:kt(o),method:Ce.PUT,body:{...i},options:{headers:{[Se]:e}}}})}async function ve({idBuilding:e,idTask:o,status:i,note:s}){return await fe({type:Ae,payload:{apiUrl:Tt(o,i),method:Ce.PUT,body:{note:s},options:{headers:{[Se]:e}}}})}const yt=async(e,o,i)=>{try{const s=await ve({idBuilding:e,idTask:o,note:i,status:2});return{code:s.code,codeLanguage:s.codeLanguage,data:ee(s.data)}}catch(s){return{code:s.code,codeLanguage:s.codeLanguage,data:void 0}}},_t=()=>{const{tasks:e,request:o,showModalAddTask:i,showModalUpdateTask:s,idBuilding:r,setTasks:m,showModalConfirmCompleteTask:a,showModalConfirmCancelTask:g,setGetListActivityStatus:c,setActivities:u,taskPermissionWrite:l}=h.useContext(B),[p,C]=h.useState({isFetching:!1,code:void 0,codeLanguage:void 0});return J(p.code,p.codeLanguage,{message:n.success,description:n.change_status_task_success}),[e,o,i,s,async(E,x)=>{const{id:S}=x;if(E===me){C({isFetching:!0,code:void 0,codeLanguage:void 0});const f=await yt(r,S,"");if(z.includes(f.code)){const w=[...e];for(let D=0;D<w.length;D+=1)if(w[D].id===S){w[D]={...f.data};break}m(w),c({isFetching:!0});const v=await K(r,o.id);u(v.data),c({isFetching:!1})}C({isFetching:!1,code:f.code,codeLanguage:f.codeLanguage})}else E===M?a(x.id):E===U&&g(x.id)},l]};var Rt={name:"e0dnmk",styles:"cursor:pointer"},wt={name:"17n0tnm",styles:"padding-left:0 !important"};const Lt=()=>{const[e,o,i,s,r,m]=_t(),a=N(),g=(c,u)=>c.status===De?t(ue,{onClick:({key:l})=>u(l,c),children:tt.map(l=>t(ue.Item,{children:t("span",{children:l.label})},l.value))}):c.status===me?t(ue,{onClick:({key:l})=>u(l,c),children:at.map(l=>t(ue.Item,{children:t("span",{children:l.label})},l.value))}):!1;return d("div",{children:[d("div",{css:A({marginTop:a.margin.lg,marginBottom:a.margin.sm,display:"flex",alignItems:"center"},"",""),children:[t(y,{name:"icon-library-add-check-outlined",css:A({fontSize:a.iconSize,marginRight:a.margin.xs},"","")}),t(_e,{title:`${n.completed} / ${n.canceled} / ${n.total}`,children:d(H,{children:[n.tasks," (",o.statistics.completed," / ",o.statistics.cancelled," / ",o.statistics.total,")"]})})]}),t("div",{children:e.map((c,u)=>{var l,p,C,R,E,x;return d("div",{css:A({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderTop:`${u===0?1:0}px solid ${a.borderColor}`,borderBottom:`1px solid ${a.borderColor}`,padding:`${a.padding.xs}px 0`},"",""),children:[t(y,{name:"icon-check-square-outlined",css:A({fontSize:a.iconSize,marginRight:a.margin.xs,visibility:c.status===M?"visible":"hidden"},"","")}),t(_e,{placement:"topLeft",title:n.document,children:d("div",{css:A({borderRight:`1px solid ${a.borderColor}`,paddingRight:a.margin.xss},"",""),children:[t(y,{css:A({marginRight:a.margin.xss},"",""),name:"icon-attachment-outlined"}),t("span",{children:(l=c==null?void 0:c.attachments)==null?void 0:l.length})]})}),d("span",{css:A({marginRight:a.margin.xss,marginLeft:a.margin.xss},"",""),children:[c.expiryDate?k(c.expiryDate).format("DD/MM/YYYY HH:mm"):"-",":"," "]}),t($,{onClick:()=>s(c),type:"link",css:A("font-weight:",a.fontWeight.bold,";padding:0 ",a.padding.sm,"px 0 0;flex:1 0 0;width:50%;display:flex;align-items:center;& span{text-overflow:ellipsis;overflow:hidden;}",""),disabled:!m,children:t(ct,{pauseOnHover:!0,gradient:!1,speed:60,loop:1,delay:1,play:((p=c==null?void 0:c.content)==null?void 0:p.length)>=110,children:c.content})}),[M,U].includes(c.status)?t(X,{color:((C=V[c.status])==null?void 0:C.color)??"default",children:((R=V[c.status])==null?void 0:R.label)??"-"}):t(it,{dropdownRender:()=>g(c,r),disabled:!m,children:d(X,{css:Rt,color:((E=V[c.status])==null?void 0:E.color)??"default",children:[((x=V[c.status])==null?void 0:x.label)??"-"," ",t(y,{name:"icon-arrow-down-outlined"})]})})]},c.id)})}),![M,U].includes(o.status)&&m?d($,{css:wt,type:"link",onClick:i,children:[t(y,{name:"icon-plus-circle-outlined",css:A({fontsize:a.iconSize,marginRight:a.margin.xs},"","")}),t("span",{children:n.create_new_task})]}):null]})},xt=()=>{const{activities:e,getListActivityStatus:o}=h.useContext(B);return[o.isFetching,e]};var Ft={name:"ocklv2",styles:"line-height:1.95"};const Qt=()=>{const[e,o]=xt(),i=N();return d("div",{children:[d("div",{css:A({marginTop:i.margin.lg,marginBottom:i.margin.sm,display:"flex",alignItems:"center"},"",""),children:[t(y,{name:"icon-list-outlined",css:A({fontSize:i.iconSize,marginRight:i.margin.xs},"","")}),t(H,{children:n.activities})]}),e?t(nt,{size:"small"}):null,t(Re,{children:o.map(s=>t(Re.Item,{color:s.status.color,dot:t(y,{css:A({fontSize:i.iconSize},"",""),name:s.status.icon}),children:d("span",{css:Ft,children:[t("b",{children:s.createdAt}),": ",s.content," ",t("b",{children:s.title})]})},s.id))})]})},Dt=async(e,o,i)=>{try{const s=await Qe({idBuilding:e,idRequest:o,note:i,status:1});return{code:s.code,codeLanguage:s.codeLanguage,data:ke(s.data)}}catch(s){return{code:s.code,codeLanguage:s.codeLanguage,data:void 0}}},bt=()=>{const{hideModalConfirmCompleteRequest:e,idBuilding:o,setRequest:i,setActivities:s,setGetListActivityStatus:r,request:m}=h.useContext(B),[a,g]=h.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[c]=L.useForm();J(a.code,a.codeLanguage,{message:n.success,description:n.change_status_request_success},()=>{e()});const u=async()=>{if(await c.validateFields()){g({isFetching:!0,code:void 0,codeLanguage:void 0});const R=await Dt(o,m.id,c.getFieldValue("result"));if(z.includes(R.code)){i({...m,status:M,note:c.getFieldValue("result"),updatedDate:R.data.updatedDate}),r({isFetching:!0});const E=await K(o,m.id);s(E.data),r({isFetching:!1})}g({isFetching:!1,code:R.code,codeLanguage:R.codeLanguage})}},l=()=>e(),p={result:""};return[a.isFetching,c,p,u,l]},Bt=()=>{const[e,o,i,s,r]=bt();return t(Z,{title:n.confirm_complete_request,open:!0,onOk:s,onCancel:r,confirmLoading:e,okText:n.confirm,cancelText:n.cancel,okBtnProps:{loading:e,disabled:e},children:t(L,{layout:"vertical",name:"form_confirm_complete_request",form:o,initialValues:i,children:t(L.Item,{name:"result",label:n.result_of_the_task,rules:[{required:!0}],children:t(te.TextArea,{autoSize:{minRows:3,maxRows:5},placeholder:n.result_of_the_task,maxLength:3e3})})})})},Mt=async(e,o,i)=>{try{const s=await Qe({idBuilding:e,idRequest:o,note:i,status:0});return{code:s.code,codeLanguage:s.codeLanguage,data:ke(s.data)}}catch(s){return{code:s.code,codeLanguage:s.codeLanguage,data:void 0}}},It=()=>{const{hideModalConfirmCancelRequest:e,idBuilding:o,setRequest:i,setActivities:s,setGetListActivityStatus:r,request:m}=h.useContext(B),[a,g]=h.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[c]=L.useForm(),[u,l]=h.useState(5),[p,C]=h.useState(!0);h.useEffect(()=>{u>0?(setTimeout(()=>l(u-1),1e3),C(!0)):(l(""),C(!1))},[u]),J(a.code,a.codeLanguage,{message:n.success,description:n.change_status_request_success},()=>{e()});const R=async()=>{if(await c.validateFields()){g({isFetching:!0,code:void 0,codeLanguage:void 0});const f=await Mt(o,m.id,c.getFieldValue("reason"));if(z.includes(f.code)){i({...m,status:U,note:c.getFieldValue("reason"),updatedDate:f.data.updatedDate}),r({isFetching:!0});const w=await K(o,m.id);s(w.data),r({isFetching:!1})}g({isFetching:!1,code:f.code,codeLanguage:f.codeLanguage})}},E=()=>e(),x={reason:""};return[a.isFetching,c,x,R,E,u,p]},Ut=()=>{const[e,o,i,s,r,m,a]=It();return t(Z,{title:n.confirm_cancel_request,open:!0,onOk:s,onCancel:r,confirmLoading:e,okText:m>0?`(${m}) ${n.confirm}`:`${n.confirm}`,cancelText:n.cancel,okButtonProps:{disabled:a},children:t(L,{layout:"vertical",name:"form_confirm_cancel_request",form:o,initialValues:i,children:t(L.Item,{name:"reason",label:n.reason,rules:[{required:!0}],children:t(te.TextArea,{autoSize:{minRows:3,maxRows:5},placeholder:n.reason,maxLength:3e3})})})})};var Pt={name:"u7j9h",styles:"cursor:pointer;display:flex;justify-content:center;align-items:center;flex-direction:column"};const ge=({maxDueDate:e,receiver:o,disabledItem:i,isShowAttachments:s})=>{var a;const r=N(),m=g=>Array.isArray(g)?g:g&&g.fileList;return d(G,{gutter:[r.margin.xs,0],children:[t(_,{span:24,children:t(L.Item,{name:"expiryDate",rules:[{required:!0,validator:(g,c)=>c?c&&k(c).isBefore(k().subtract(1,"day"))?Promise.reject(new Error(`${n.min_due_date}: ${k().format("DD/MM/YYYY")}`)):e&&c&&k(c).isAfter(k(e).add(1,"day"))?Promise.reject(new Error(`${n.max_due_date}: ${k(e).format("DD/MM/YYYY")}`)):c&&k(c).isBefore(k(),"minutes")?Promise.reject(new Error(`${n.min_due_date}: ${k().format("DD/MM/YYYY HH:mm")}`)):Promise.resolve():Promise.reject(new Error(n.status.data_require))}],label:n.expiry_date,children:t(Pe,{disabledDate:g=>k(g).isBefore(k().subtract(1,"day"))||k(g).isAfter(k(e).add(1,"day")),disabled:i.includes("expiryDate"),fluid:!0,showTime:!0,format:"DD/MM/YYYY HH:mm",placeholder:"DD/MM/YYYY HH:mm",allowClear:!1})})}),t(_,{span:24,children:t(L.Item,{name:"receiver",rules:[{required:!0}],label:n.receiver,children:t(we,{disabled:i.includes("receiver"),loading:o.isFetching,placeholder:n.receiver,fluid:!0,children:((a=o==null?void 0:o.records)==null?void 0:a.map(({id:g,name:c})=>t(we.Option,{value:g,children:c},g)))??[]})})}),t(_,{span:24,children:t(L.Item,{name:"content",rules:[{required:!0}],label:n.content,children:t(te.TextArea,{disabled:i.includes("content"),rows:"3",placeholder:n.content})})}),s?t(_,{span:24,children:t(L.Item,{name:"attachments",label:n.attachments,valuePropName:"fileList",getValueFromEvent:m,children:t(qe,{listType:"picture-card",accept:"image/*",module:xe,children:d("div",{css:Pt,children:[t(y,{name:"icon-plus-circle-outlined",css:A({fontSize:r.iconSize},"","")}),t("span",{children:n.upload})]})})})}):null]})};ge.propTypes={maxDueDate:Y.objectOf(Y.any),receiver:Y.objectOf(Y.any),disabledItem:Y.arrayOf(Y.any),isShowAttachments:Y.bool};ge.defaultProps={maxDueDate:void 0,receiver:{isFetching:!1,records:[]},disabledItem:[],isShowAttachments:!1};const qt=async(e,o,i)=>{var c;const{expiryDate:s,receiver:r,content:m,attachments:a}=i,g={description:m,assignees:[r],dueDate:k(s).toDate(),attachments:((c=a==null?void 0:a.map(u=>{var l,p;return((p=(l=u==null?void 0:u.response)==null?void 0:l.data)==null?void 0:p.url)??null}))==null?void 0:c.filter(Boolean))??[],requestId:o};try{const u=await Et(e,g);return{code:u.code,codeLanguage:u.codeLanguage,data:ee(u.data)}}catch(u){return{code:u.code,codeLanguage:u.codeLanguage,data:void 0}}},Yt=()=>{const{idBuilding:e,hideModalAddTask:o,request:i,tasks:s,setTasks:r,setGetListActivityStatus:m,setActivities:a}=h.useContext(B),[g,c]=h.useState({isFetching:!1,records:[]}),[u,l]=h.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[p]=L.useForm();J(u.code,u.codeLanguage,{message:n.success,description:n.add_data_success},()=>{o()}),h.useEffect(()=>{(async()=>{c({isFetching:!0,records:[]});const f=await Be(e);c({isFetching:!1,records:Array.isArray(f==null?void 0:f.data)?f==null?void 0:f.data:[]})})()},[]);const C=async()=>{if(await p.validateFields()){l({isFetching:!0,code:void 0,codeLanguage:void 0});const w=await qt(e,i.id,p.getFieldsValue());if(z.includes(w.code)){r([...s,{...w.data}]),m({isFetching:!0});const v=await K(e,i.id);a(v.data),m({isFetching:!1})}l({isFetching:!1,code:w.code,codeLanguage:w.codeLanguage})}},R=()=>o(),E=u.isFetching,x={expiryDate:void 0,receiver:void 0,content:void 0,attachments:[]},S=i.expiryDate;return[E,S,p,x,g,C,R]},Vt=()=>{const[e,o,i,s,r,m,a]=Yt();return t(Z,{title:n.add_task,open:!0,onOk:m,onCancel:a,confirmLoading:e,okText:n.confirm,cancelText:n.cancel,okBtnProps:{loading:e,disabled:e},width:"50%",children:t(L,{layout:"vertical",name:"form_add_task",form:i,initialValues:s,children:t(ge,{maxDueDate:o,isShowAttachments:!0,isFetching:e,receiver:r})})})},Nt=async({idBuilding:e,idRequest:o,idTask:i,task:s})=>{var u;const{expiryDate:r,receiver:m,content:a,attachments:g}=s,c={description:a,assignees:[m],dueDate:k(r).toDate(),attachments:((u=g==null?void 0:g.map(l=>{var p,C;return((C=(p=l==null?void 0:l.response)==null?void 0:p.data)==null?void 0:C.url)??null}))==null?void 0:u.filter(Boolean))??[],requestId:o};try{const l=await vt(e,i,c);return{code:l.code,codeLanguage:l.codeLanguage,data:ee(l.data)}}catch(l){return{code:l.code,codeLanguage:l.codeLanguage,data:void 0}}},zt=()=>{const{idBuilding:e,hideModalUpdateTask:o,modalUpdateTask:i,request:s,tasks:r,setTasks:m,setGetListActivityStatus:a,setActivities:g}=h.useContext(B),{data:c}=i,[u,l]=h.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[p]=L.useForm();J(u.code,u.codeLanguage,{message:n.success,description:n.update_data_success},()=>{o()});const C=async()=>{if(await p.validateFields()){l({isFetching:!0,code:void 0,codeLanguage:void 0});const D=await Nt({idBuilding:e,idRequest:s.id,task:p.getFieldsValue(),idTask:c.id});if(z.includes(D.code)){const I=[...r];for(let P=0;P<I.length;P+=1)if(I[P].id===D.data.id){I[P]={...D.data};break}m(I),a({isFetching:!0});const b=await K(e,s.id);g(b.data),a({isFetching:!1})}l({isFetching:!1,code:D.code,codeLanguage:D.codeLanguage})}},R=()=>o(),E=u.isFetching,x={expiryDate:c.expiryDate?k(c.expiryDate):void 0,receiver:c.receiver.id,content:c.content,attachments:c.attachments.map(v=>({response:{data:{url:v}},thumbUrl:v}))},S=h.useMemo(()=>({records:[{id:c.receiver.id,name:c.receiver.name}]}),[c]),f=h.useMemo(()=>{const v=["content","receiver"];return[M,U].includes(c.status)&&v.push("expiryDate"),v},[c]),w=h.useMemo(()=>s.expiryDate,[s]);return[E,w,c,p,x,S,f,C,R]},Jt=()=>{var l,p;const[e,o,i,s,r,m,a,g,c]=zt(),u=N();return d(Z,{title:n.update_task,open:!0,onOk:g,onCancel:c,confirmLoading:e,okText:n.confirm,cancelText:n.cancel,okBtnProps:{loading:e,disabled:e},width:"50%",children:[d(G,{css:A({marginBottom:u.margin.lg},"",""),gutter:[u.margin.xs,u.margin.xs],children:[t(_,{span:6,children:d(F,{children:[n.status1,":"]})}),t(_,{span:6,children:t(X,{color:((l=V[i.status])==null?void 0:l.color)??"default",children:i.status?(p=V[i.status])==null?void 0:p.label:"-"})}),t(_,{span:6}),t(_,{span:6}),i.status===M?d(W,{children:[t(_,{span:6,children:d(F,{children:[n.complete_date,":"]})}),t(_,{span:6,children:t("span",{children:i.completeDate?k(i.completeDate).format("DD/MM/YYYY"):"-"})}),t(_,{span:6,children:d(F,{children:[n.result,":"]})}),t(_,{span:6,children:t("span",{children:i.note||"-"})})]}):null,i.status===U?d(W,{children:[t(_,{span:6,children:d(F,{children:[n.cancel_date,":"]})}),t(_,{span:6,children:t("span",{children:i.cancelDate?k(i.cancelDate).format("DD/MM/YYYY"):"-"})}),t(_,{span:6,children:d(F,{children:[n.cancel_reason,":"]})}),t(_,{span:6,children:t("span",{children:i.note||"-"})})]}):null]}),t(L,{layout:"vertical",name:"form_update_task",form:s,initialValues:r,children:t(ge,{maxDueDate:o,isShowAttachments:!0,disabledItem:a,isFetching:e,receiver:m})}),t(be,{message:n.noted_task_due_date_have_to_lower_or_equal_than_subtask_of_task_due_date,type:"warning",showIcon:!0})]})},Kt=async(e,o,i)=>{try{const s=await ve({idBuilding:e,idTask:o,note:i,status:1});return{code:s.code,codeLanguage:s.codeLanguage,data:ee(s.data)}}catch(s){return{code:s.code,codeLanguage:s.codeLanguage,data:void 0}}},Ot=()=>{const{hideModalConfirmCompleteTask:e,request:o,modalConfirmCompleteTask:i,idBuilding:s,setActivities:r,setGetListActivityStatus:m,setTasks:a,tasks:g}=h.useContext(B),{data:c}=i,[u,l]=h.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[p]=L.useForm();J(u.code,u.codeLanguage,{message:n.success,description:n.change_status_task_success},()=>{e()});const C=async()=>{if(await p.validateFields()){l({isFetching:!0,code:void 0,codeLanguage:void 0});const S=await Kt(s,c,p.getFieldValue("result"));if(z.includes(S.code)){const f=[...g];for(let v=0;v<f.length;v+=1)if(f[v].id===c){f[v]={...S.data};break}a(f),m({isFetching:!0});const w=await K(s,o.id);r(w.data),m({isFetching:!1})}l({isFetching:!1,code:S.code,codeLanguage:S.codeLanguage})}},R=()=>e(),E={result:""};return[u.isFetching,p,E,C,R]},jt=()=>{const[e,o,i,s,r]=Ot();return t(Z,{title:n.confirm_complete_task,open:!0,onOk:s,onCancel:r,confirmLoading:e,okText:n.confirm,cancelText:n.cancel,okBtnProps:{loading:e,disabled:e},children:t(L,{layout:"vertical",name:"form_confirm_complete_task",form:o,initialValues:i,children:t(L.Item,{name:"result",label:n.result_of_the_task,rules:[{required:!0}],children:t(te.TextArea,{autoSize:{minRows:3,maxRows:5},placeholder:n.result_of_the_task,maxLength:3e3})})})})},Ht=async(e,o,i)=>{try{const s=await ve({idBuilding:e,idTask:o,note:i,status:0});return{code:s.code,codeLanguage:s.codeLanguage,data:ee(s.data)}}catch(s){return{code:s.code,codeLanguage:s.codeLanguage,data:void 0}}},Gt=()=>{const{hideModalConfirmCancelTask:e,request:o,modalConfirmCancelTask:i,idBuilding:s,setActivities:r,setGetListActivityStatus:m,tasks:a,setTasks:g}=h.useContext(B),{data:c}=i,[u,l]=h.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[p]=L.useForm();J(u.code,u.codeLanguage,{message:n.success,description:n.change_status_task_success},()=>{e()});const C=async()=>{if(await p.validateFields()){l({isFetching:!0,code:void 0,codeLanguage:void 0});const S=await Ht(s,c,p.getFieldValue("reason"));if(z.includes(S.code)){const f=[...a];for(let v=0;v<f.length;v+=1)if(f[v].id===c){f[v]={...S.data};break}g(f),m({isFetching:!0});const w=await K(s,o.id);r(w.data),m({isFetching:!1})}l({isFetching:!1,code:S.code,codeLanguage:S.codeLanguage})}},R=()=>e(),E={reason:""};return[u.isFetching,p,E,C,R]},Zt=()=>{const[e,o,i,s,r]=Gt();return t(Z,{title:n.confirm_cancel_task,open:!0,onOk:s,onCancel:r,confirmLoading:e,okText:n.confirm,cancelText:n.cancel,okBtnProps:{loading:e,disabled:e},children:t(L,{layout:"vertical",name:"form_confirm_cancel_task",form:o,initialValues:i,children:t(L.Item,{name:"reason",label:n.cancel_reason,rules:[{required:!0}],children:t(te.TextArea,{autoSize:{minRows:3,maxRows:5},placeholder:n.result_of_the_task,maxLength:3e3})})})})},Me=async(e,o)=>{try{const i=await Ge(e,o);return{code:i.code,codeLanguage:i.codeLanguage,data:ke(i.data)}}catch(i){return{code:i.code,codeLanguage:i.codeLanguage,data:void 0}}},Wt=()=>{var b,P,ae,se,ie,ne,oe,ce,re,de;const{idBuilding:e,idRequest:o,setRequest:i,hideModalUpdateRequest:s,setGetListTaskStatus:r,modalUpdateRequest:m}=h.useContext(B),{data:a}=m,[g,c]=h.useState({isFetching:!1,records:[{id:(b=a==null?void 0:a.department)==null?void 0:b.id,name:(P=a==null?void 0:a.department)==null?void 0:P.name}]}),[u,l]=h.useState({isFetching:!1,records:[{id:(ae=a==null?void 0:a.receiver)==null?void 0:ae.id,name:(se=a==null?void 0:a.receiver)==null?void 0:se.name,departments:[(ie=a==null?void 0:a.department)==null?void 0:ie.id]}]}),[p,C]=h.useState(["content","requestByResident","apartment","resident","department","receiver"]),R=h.useMemo(()=>({isFetching:!1,records:[{id:a.apartment.id,name:a.apartment.name,residents:a.apartment.residents}]}),[a]),[E,x]=h.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[S]=L.useForm();J(E.code,E.codeLanguage,{message:n.success,description:n.update_request_success},()=>{s()}),h.useEffect(()=>{(async()=>{c({...g,isFetching:!0});const Q=await rt(e);c({isFetching:!1,records:Q.data})})(),(async()=>{l({...u,isFetching:!0});const Q=await Be(e);l({isFetching:!1,records:Array.isArray(Q==null?void 0:Q.data)?Q==null?void 0:Q.data:[]})})()},[]),h.useEffect(()=>{var q,O;let Q=!1;a.apartment&&(a.resident?Q=!((O=(q=a==null?void 0:a.apartment)==null?void 0:q.residents)==null?void 0:O.find(he=>he.id===a.resident.id)):Q=!0),Q&&(S.setFieldsValue({resident:void 0}),C(["content","requestByResident","apartment","department"]))},[a]);const f=async Q=>{Q.requestByResident?S.setFieldsValue({apartment:void 0,resident:void 0}):Q.department?S.setFieldsValue({receiver:void 0}):Q.apartment&&S.setFieldsValue({resident:void 0})},w=async()=>{if(await S.validateFields()){x({isFetching:!0,code:void 0,codeLanguage:void 0});const q=await dt(e,a.id,S.getFieldsValue());if(z.includes(q.code)){r({isFetching:!0});const O=await Me(e,o);i(O.data),r({isFetching:!1})}x({isFetching:!1,code:q.code,codeLanguage:q.codeLanguage})}},v=()=>s(),D=E.isFetching,I={expiryDate:a!=null&&a.expiryDate?k(a==null?void 0:a.expiryDate):void 0,department:(ne=a==null?void 0:a.department)==null?void 0:ne.id,receiver:(oe=a==null?void 0:a.receiver)==null?void 0:oe.id,content:a==null?void 0:a.content,requestByResident:!!((ce=a==null?void 0:a.apartment)!=null&&ce.id),apartment:(re=a==null?void 0:a.apartment)==null?void 0:re.id,resident:(de=a==null?void 0:a.resident)==null?void 0:de.id};return{loading:D,formUpdateRequest:S,initialValues:I,department:g,receiver:u,apartment:R,disabledItem:p,onFinish:w,onClose:v,onValuesChange:f}},$t=()=>{const{loading:e,formUpdateRequest:o,initialValues:i,department:s,receiver:r,apartment:m,disabledItem:a,onFinish:g,onClose:c,onValuesChange:u}=Wt(),l=N();return t(Z,{title:n.update_task,visible:!0,onOk:g,onCancel:c,confirmLoading:e,okText:n.confirm,cancelText:n.cancel,okBtnProps:{loading:e,disabled:e},width:"50%",children:t(G,{gutter:[l.margin.md],children:d(_,{span:"24",children:[t(L,{layout:"vertical",name:"form_update_detail_task",form:o,initialValues:i,onValuesChange:u,children:t(lt,{isFetching:e,department:s,receiver:r,apartment:m,disabledItem:a})}),t(be,{message:n.noted_task_due_date_have_to_lower_or_equal_than_subtask_of_task_due_date,type:"warning",showIcon:!0})]})})})},Xt=()=>{const{setTitlePage:e,setVisibleFilterBox:o,setVisibleSearchBox:i}=h.useContext(Fe),{idBuilding:s,idRequest:r,setRequest:m,setActivities:a,setTasks:g,setGetListActivityStatus:c,request:u,modalConfirmCompleteRequest:l,modalConfirmCancelRequest:p,modalAddTask:C,modalUpdateTask:R,modalUpdateRequest:E,modalConfirmCancelTask:x,modalConfirmCompleteTask:S,showModalConfirmCompleteRequest:f,showModalConfirmCancelRequest:w,taskPermissionWrite:v}=h.useContext(B),[D,I]=h.useState({isFetching:!1});return h.useEffect(()=>(e(n.task),o(!1),i(!1),(async()=>{I({isFetching:!0});const b=await Me(s,r);b.data&&(e(`${n.task} ${b.data.code}`),m(b.data),g(b.data.tasks)),I({isFetching:!1})})(),(async()=>{c({isFetching:!0});const b=await K(s,r);a(b.data),c({isFetching:!1})})(),()=>{e(""),i(!1),o(!1)}),[]),[D.isFetching,u,f,w,l.isShow,p.isShow,C.isShow,R.isShow,E.isShow,S.isShow,x.isShow,v]},ea=()=>{const[e,o,i,s,r,m,a,g,c,u,l,p]=Xt(),C=N();return t(ye.Wrapper,{children:d(ye.Container,{children:[t(We.Content,{children:e||!o?t(Ze,{isLoading:!0}):d(G,{gutter:[C.margin.lg,C.margin.lg],children:[![M,U].includes(o.status)&&p?d(_,{span:"24",children:[t($,{type:"primary",icon:t(y,{name:"icon-check-outlined"}),css:A({marginRight:C.margin.xs},"",""),onClick:i,children:n.complete}),t($,{icon:t(y,{name:"icon-close-outlined"}),type:"danger",ghost:!0,onClick:s,children:n.cancel})]}):null,d(_,{span:"16",children:[t(gt,{}),t(Lt,{},"task"),t(Qt,{})]}),t(_,{span:"8",children:t(pt,{})})]})}),r?t(Bt,{}):null,m?t(Ut,{}):null,a?t(Vt,{}):null,g?t(Jt,{}):null,c?t($t,{}):null,u?t(jt,{}):null,l?t(Zt,{}):null]})})},Us=()=>t(ut,{children:t(ea,{})});export{Us as default};
