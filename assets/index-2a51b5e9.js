import{j as o,a as m,u as J,c as Z,F as tt}from"./@emotion-63839449.js";import{T as et,D as at,F as ot,P as mt}from"./index-b17d22e5.js";import{B as d}from"./index-881eef42.js";import{l as st}from"./lodash-88fe09e6.js";import{h as b}from"./moment-a468e1f9.js";import{b1 as S,c6 as f,i as R,A as F,M as w,X as P,j as ut,l as s,I as dt,a as gt}from"./index-c2ded735.js";import"./file-saver-40cf32a9.js";import{P as g}from"./prop-types-1172f4d5.js";import{b as C,R as G,o as K}from"./antd-f9eae174.js";import{r as l}from"./react-4fd50329.js";import{u as _}from"./react-router-a4308f7b.js";import{C as H,h as rt,j as nt,B as ht,p as it,k as j,l as q,P as ft,n as bt,o as yt,A as _t}from"./chart.js-33bd684c.js";import{B as xt,L as Dt,P as Ct}from"./react-chartjs-2-6a0331d4.js";import{p as St}from"./chartjs-plugin-datalabels-1bb5a5e4.js";import{F as lt}from"./index-687ba9e6.js";import{S as V}from"./index-43183512.js";import"./react-redux-896b353b.js";import{u as Rt}from"./useService-37d60dc0.js";import"./@firebase-43527ee1.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./@kurkle-b1b89bbc.js";var Ft={name:"13udsys",styles:"height:100%"},wt={name:"13udsys",styles:"height:100%"},Pt={name:"ti75j2",styles:"margin:0"},Tt={name:"ti75j2",styles:"margin:0"},Et={name:"ti75j2",styles:"margin:0"},Ot={name:"ti75j2",styles:"margin:0"};const D=t=>{const{icon:e="",title:a="",firstLabel:r="",firstValue:n=0,secondLabel:i="",secondValue:c=0,isFetching:u=!1,isCurrent:h=!1}=t;return o(d,{css:Ft,children:o(d.Content,{css:p=>({padding:p.padding.xss,height:"100%"}),children:m(G,{css:wt,gutter:[0,0],children:[o(C,{span:"8",css:p=>({background:`linear-gradient(333deg, ${p.linearGradientColor}, ${p.primaryColor})`,width:"30%",display:"flex",alignItems:"center",justifyContent:"center"}),children:e}),m(C,{css:p=>({textAlign:"center",display:"flex",flexDirection:"column",justifyContent:"space-between",padding:`${p.padding.xs}px ${p.padding.xss}px`}),span:"16",children:[o(S,{width:"50px",height:"50px",isLoading:u}),m("div",{children:[o("h2",{css:Pt,children:a}),h&&o("p",{css:Tt,children:m("strong",{children:["(",`${b().format("DD/MM/YYYY")}`,")"]})})]}),m("div",{children:[o("p",{css:Et,children:f(n)}),o("p",{css:p=>({margin:0,color:p.color.error}),children:r}),o("p",{css:Ot,children:f(c)}),o("p",{css:p=>({margin:0,color:p.color.success}),children:i})]})]})]})})})};D.propTypes={icon:g.node,title:g.string,firstLabel:g.string,firstValue:g.number,secondLabel:g.string,secondValue:g.number,isFetching:g.bool,isCurrent:g.bool};D.defaultProps={icon:o("div",{}),title:"",firstLabel:"",firstValue:0,secondLabel:"",secondValue:0,isFetching:!1,isCurrent:!1};const T=`${ut}/dashboard`,vt=`${T}/overview`,Lt=`${T}/revenue`,Yt=`${T}/total-paid-and-unpaid`,kt=`${T}/resident`,Ut=`${T}/parking`;async function Vt(t){return await R({type:F,payload:{apiUrl:vt,method:w.POST,body:{unitGroupIds:t},options:{headers:{[P]:t==null?void 0:t[0]}}}})}async function Bt({idBuildings:t,from:e,to:a,type:r}){return await R({type:F,payload:{apiUrl:Lt,method:w.POST,body:{unitGroupIds:t,from:e,to:a,type:r},options:{headers:{[P]:t==null?void 0:t[0]}}}})}async function It({idBuildings:t,from:e,to:a,type:r,idService:n}){return await R({type:F,payload:{apiUrl:Yt,method:w.POST,body:{unitGroupIds:t,from:e,to:a,type:r,serviceId:n},options:{headers:{[P]:t==null?void 0:t[0]}}}})}async function Mt(t){return await R({type:F,payload:{apiUrl:kt,method:w.POST,body:{unitGroupIds:t},options:{headers:{[P]:t==null?void 0:t[0]}}}})}async function At(t){return await R({type:F,payload:{apiUrl:Ut,method:w.POST,body:{unitGroupIds:t},options:{headers:{[P]:t==null?void 0:t[0]}}}})}const I=t=>({apartment:{empty:(t==null?void 0:t.emptyUnit)??0,inUse:(t==null?void 0:t.inUseUnit)??0},request:{total:(t==null?void 0:t.totalRequest)??0,complete:(t==null?void 0:t.totalCompleteRequest)??0,taskInProgress:(t==null?void 0:t.totalInProgressTask)??0,task:(t==null?void 0:t.totalTask)??0},accounting:{revenue:(t==null?void 0:t.totalRevenue)??0,expense:(t==null?void 0:t.totalExpense)??0},resident:{total:(t==null?void 0:t.totalResident)??0,useApp:(t==null?void 0:t.totalResidentUseApp)??0}}),$t=async t=>{try{const e=await Vt([t]);return{code:e.code,codeLanguage:e.codeLanguage,data:I(e.data)}}catch(e){return{code:e.code,codeLanguage:e.codeLanguage,data:I()}}},Gt=()=>{const[t,e]=l.useState({isFetching:!1}),[a,r]=l.useState({...I()}),{idBuilding:n}=_();return l.useEffect(()=>{(async()=>{e({isFetching:!0});const i=await $t(n);r(i.data),e({isFetching:!1})})()},[]),[t.isFetching,a]},v=Z(dt,{target:"e1rq5qkl1"})({name:"8pq83c",styles:"color:white;font-size:25px"}),L=Z(C,{target:"e1rq5qkl0"})({name:"1joo54w",styles:"height:180px"}),Ht=()=>{const[t,e]=Gt(),a=J();return m(G,{gutter:[a.margin.sm,0],children:[o(L,{span:"6",children:o(D,{icon:o(v,{name:"icomoon icon-buildings-light",title:s.unit}),title:s.unit,firstLabel:s.empty,firstValue:e.apartment.empty,secondLabel:s.using,secondValue:e.apartment.inUse,isFetching:t})}),o(L,{span:"6",children:o(D,{icon:o(v,{name:"icomoon icon-users-light",title:s.resident}),title:s.resident,firstLabel:s.in_building,firstValue:e.resident.total,secondLabel:s.installed_app,secondValue:e.resident.useApp,isFetching:t})}),o(L,{span:"6",children:o(D,{icon:o(v,{name:"icon-calendar-outlined",title:s.task}),title:s.task,firstLabel:s.task,firstValue:e.request.task,secondLabel:s.in_progress,secondValue:e.request.taskInProgress,isFetching:t})}),o(L,{span:"6",children:o(D,{icon:o(v,{name:"icomoon icon-money-light",title:s.finance}),title:s.finance,firstLabel:s.gross_revenue,firstValue:e.accounting.revenue,secondLabel:s.gross_expense,secondValue:e.accounting.expense,isFetching:t,isCurrent:!0})})]})};H.register(rt,nt,ht,it,j,q);H.register(rt,nt,ft,bt,it,j,yt,q);H.register(_t,j,q,St);const Y={Bar:xt,Line:Dt,Pie:Ct},M=t=>({female:{total:(t==null?void 0:t.totalFemale)??0,"0-6":(t==null?void 0:t.totalFemaleUnder6)??0,"6-10":(t==null?void 0:t.totalFemale6To10)??0,"10-20":(t==null?void 0:t.totalFemale10To20)??0,"20-60":(t==null?void 0:t.totalFemale20To60)??0,"60-":(t==null?void 0:t.totalFemaleOver60)??0},male:{total:(t==null?void 0:t.totalMale)??0,"0-6":(t==null?void 0:t.totalMaleUnder6)??0,"6-10":(t==null?void 0:t.totalMale6To10)??0,"10-20":(t==null?void 0:t.totalMale10To20)??0,"20-60":(t==null?void 0:t.totalMale20To60)??0,"60-":(t==null?void 0:t.totalMaleOver60)??0},other:{total:(t==null?void 0:t.totalOther)??0,"0-6":(t==null?void 0:t.totalOtherUnder6)??0,"6-10":(t==null?void 0:t.totalOther6To10)??0,"10-20":(t==null?void 0:t.totalOther10To20)??0,"20-60":(t==null?void 0:t.totalOther20To60)??0,"60-":(t==null?void 0:t.totalOtherOver60)??0}}),jt=async t=>{try{const e=await Mt([t]);return{code:e.code,codeLanguage:e.codeLanguage,data:M(e.data)}}catch(e){return{code:e.code,codeLanguage:e.codeLanguage,data:M()}}},qt=t=>{let e=[],a=[],r=[];return st.isEmpty(t)||(e=[t.male["0-6"],t.male["6-10"],t.male["10-20"],t.male["20-60"],t.male["60-"],t.male.total,"","","",""],a=[t.female["0-6"],t.female["6-10"],t.female["10-20"],t.female["20-60"],t.female["60-"],t.female.total,"","","",""],r=[t.other["0-6"],t.other["6-10"],t.other["10-20"],t.other["20-60"],t.other["60-"],t.other.total,"","","",""]),{labels:[s.label.from_1_to_6,s.label.from_6_to_10,s.label.from_10_to_20,s.label.from_20_to_60,s.label.great_than_60,s.label.sum_total,"","","",""],datasets:[{label:s.label.male,backgroundColor:"#0288D1",data:e},{label:s.label.female,backgroundColor:"#D21243",data:a},{label:s.label.other,backgroundColor:"#DCDCDC",data:r}]}},Nt=()=>{const{idBuilding:t}=_(),[e,a]=l.useState({isFetching:!1,data:M()});return l.useEffect(()=>{(async()=>{a({...e,isFetching:!0});const r=await jt(t);a({data:r.data,isFetching:!1})})()},[]),{loading:e.isFetching,dataRender:qt(e.data)}},Qt=()=>{const{loading:t,dataRender:e}=Nt(),a={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:s.label.chart_of_residents_by_age_and_sex},datalabels:{formatter:(r,n)=>""}}};return m(d,{css:r=>({position:"relative",marginTop:r.margin.sm}),children:[o(d.Header,{borderBottom:!0,children:o("span",{children:s.label.resident})}),m(d.Content,{children:[o(S,{width:"50px",height:"50px",isLoading:t}),o(Y.Bar,{height:120,options:a,data:e})]})]})},A=t=>({activeCar:(t==null?void 0:t.activeCar)??0,activeMotorbike:(t==null?void 0:t.activeMotorbike)??0,totalUnit:(t==null?void 0:t.totalUnit)??0,totalUnitHaveCar:(t==null?void 0:t.totalUnitHaveCar)??0,totalUnitHaveMotor:(t==null?void 0:t.totalUnitHaveMotor)??0,totalVehicle:(t==null?void 0:t.totalVehicle)??0}),zt=async t=>{try{const e=await At([t]);return{code:e.code,codeLanguage:e.codeLanguage,data:A(e.data)}}catch(e){return{code:e.code,codeLanguage:e.codeLanguage,data:A()}}},Kt=t=>({labels:[s.label.motorbike,s.label.car,"","","","","","","",""],datasets:[{label:s.label.number_of_active_vehicles_by_type,data:[t.activeMotorbike,t.activeCar,0,0,0,0,0,0,0,0],backgroundColor:"#0288D1",stack:"Base"},{label:s.label.number_of_active_vehicles,data:[t.totalVehicle,t.totalVehicle,0,0,0,0,0,0,0,0],backgroundColor:"#D21243",stack:"Base"},{label:s.label.number_of_apartments_using_parking_by_type,data:[t.totalUnitHaveMotor,t.totalUnitHaveCar,0,0,0,0,0,0,0,0],backgroundColor:"#66BB6A",stack:"Sensitivity"},{label:s.label.number_of_apartments,data:[t.totalUnit,t.totalUnit,0,0,0,0,0,0,0,0],backgroundColor:"#E5643B",stack:"Sensitivity"}]}),Wt=()=>{const{idBuilding:t}=_(),[e,a]=l.useState({isFetching:!1,data:A()});return l.useEffect(()=>{(async()=>{a({...e,isFetching:!0});const r=await zt(t);a({data:r.data,isFetching:!1})})()},[]),{loading:e.isFetching,dataRender:Kt(e.data)}},Xt=()=>{const{loading:t,dataRender:e}=Wt(),a={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:s.label.chart_of_vehicle_by_type},datalabels:{formatter:(r,n)=>""}}};return m(d,{css:r=>({position:"relative",marginTop:r.margin.sm}),children:[o(d.Header,{borderBottom:!0,children:o("span",{children:s.label.vehicle_statistics})}),m(d.Content,{children:[o(S,{width:"50px",height:"50px",isLoading:t}),o(Y.Bar,{height:120,options:a,data:e})]})]})},y="MONTH",Jt="QUARTER",Zt="YEAR",W=[{value:y,label:s.month},{value:Jt,label:s.quarter},{value:Zt,label:s.year}],k={time:[b(),b()]},U={time:[b(),b()],service:""},E=l.createContext({filterBy:y,getDataStatus:{isFetching:!1},setGetDataStatus:()=>{},filter:{...k},setFilter:()=>{},chartData:[],setChartData:()=>{},tableOverviewData:void 0,setTableOverviewData:()=>{}}),N=({children:t,filterBy:e})=>{const[a,r]=l.useState({isFetching:!1}),[n,i]=l.useState({...k}),[c,u]=l.useState({}),[h,p]=l.useState([]),x={filterBy:e,filter:n,setFilter:i,chartData:h,setChartData:p,tableOverviewData:c,setTableOverviewData:u,getDataStatus:a,setGetDataStatus:r};return o(E.Provider,{value:x,children:t})};N.propTypes={children:g.node,filterBy:g.string};N.defaultProps={children:o("div",{}),filterBy:y};const te=()=>{const{tableOverviewData:t}=l.useContext(E),{openingBalance:e,grossRevenue:a,grossExpense:r,closingBalance:n}=t;return[[{key:1,openingBalance:e,grossRevenue:a,grossExpense:r,closingBalance:n}]]};function ee(){const[t]=te(),e=[{title:s.label.opening_accounting_balance,dataIndex:"openingBalance",key:"openingBalance",align:"right",render:a=>f(a)},{title:s.label.gross_revenue,dataIndex:"grossRevenue",key:"grossRevenue",align:"right",render:a=>f(a)},{title:s.label.gross_expense,dataIndex:"grossExpense",key:"grossExpense",align:"right",render:a=>f(a)},{title:s.label.closing_accounting_balance,dataIndex:"closingBalance",key:"closingBalance",align:"right",render:a=>f(a)}];return o(et,{bordered:!0,pagination:!1,columns:e,dataSource:t})}function B(t){const e=[];for(let a=0;a<t;a+=1)e.push("");return e}const ae=t=>{let e=[],a=[],r=[];return st.isEmpty(t)||(e=t.map(n=>n.name),a=t.map(n=>n.grossRevenue),r=t.map(n=>n.grossExpense)),e.length<10&&(e=[...e,...B(10-e.length)],a=[...a,...B(10-e.length)],a=[...a,...B(10-e.length)]),[e,a,r]};function oe(){const{chartData:t}=l.useContext(E),[e,a,r]=ae(t);return[{labels:e,datasets:[{label:s.gross_revenue,backgroundColor:"#0288D1",data:a},{label:s.gross_expense,backgroundColor:"#D21243",data:r}]}]}const se=()=>{const[t]=oe(),e={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:s.label.chart_of_income_and_expenditure_by_time},datalabels:{formatter:(a,r)=>""}}};return o(Y.Bar,{height:120,options:e,data:t})},re=t=>({grossExpense:(t==null?void 0:t.grossExpense)??0,grossRevenue:(t==null?void 0:t.grossRevenue)??0,name:(t==null?void 0:t.name)??""}),X=t=>{var e;return{overview:{openingBalance:(t==null?void 0:t.openingBalance)??0,grossRevenue:(t==null?void 0:t.grossRevenue)??0,grossExpense:(t==null?void 0:t.grossExpense)??0,closingBalance:(t==null?void 0:t.closeBalance)??0},details:((e=t==null?void 0:t.rows)==null?void 0:e.map(a=>re(a)))??[]}},ct=async({idBuilding:t,filter:e})=>{try{const{time:a,filterBy:r}=e;let n,i;a.length>0&&(n=b(a[0]).startOf(r.toLowerCase()).startOf("day").toISOString(),i=b(a[1]).endOf(r.toLowerCase()).endOf("day").toISOString());const c=await Bt({idBuildings:[t],from:n,to:i,type:r});return{code:c.code,codeLanguage:c.codeLanguage,data:X(c.data)}}catch(a){return{code:a.code,codeLanguage:a.codeLanguage,data:X()}}},ne=()=>{const{idBuilding:t}=_(),{setGetDataStatus:e,setFilter:a,setTableOverviewData:r,setChartData:n,filterBy:i}=l.useContext(E),[c]=lt.useForm(),u=async h=>{e({isFetching:!0}),a(h);const p=await ct({idBuilding:t,filter:{...h,filterBy:i}});r(p.data.overview),n(p.data.details),e({isFetching:!1})};return[i.toLowerCase(),u,c]},ie=()=>{const[t,e,a]=ne(),r=l.useMemo(()=>[{label:s.time,key:"time",component:o(at.RangePicker,{allowClear:!1,picker:t,getPopupContainer:n=>n.parentNode,format:t==="month"?["MM/YYYY","MM/YYYY"]:t==="quarter"?["Q/YYYY","Q/YYYY"]:["YYYY","YYYY"],placeholder:[s.from,s.to],fluid:"true"}),visible:!0}],[t]);return o(ot,{visibleFilterBox:!0,size:"small",initialValues:k,filters:r,formData:a,onSearch:e})},le=()=>{const{idBuilding:t}=_(),{setTableOverviewData:e,setChartData:a,setGetDataStatus:r,getDataStatus:n,filterBy:i}=l.useContext(E);return l.useEffect(()=>{(async()=>{r({isFetching:!0});const c=await ct({idBuilding:t,filter:{...k,filterBy:i}});e(c.data.overview),a(c.data.details),r({isFetching:!1})})()},[]),[n.isFetching]},ce=()=>{const[t]=le();return m(tt,{children:[o(ie,{}),m("div",{children:[o(S,{width:"50px",height:"50px",isLoading:t}),o(ee,{}),o(se,{})]})]})},pe=({filterBy:t})=>o(N,{filterBy:t,children:o(ce,{})}),me=t=>({key:(t==null?void 0:t.name)??"",time:(t==null?void 0:t.name)??"",totalMustPay:(t==null?void 0:t.totalMustPay)??0,totalPaid:(t==null?void 0:t.totalPaid)??0,totalPayment:(t==null?void 0:t.totalPayment)??0,totalUnitUnPaid:(t==null?void 0:t.totalUnitUnPaid)??0,totalUnit:(t==null?void 0:t.totalUnit)??0}),$=t=>{var e;return{details:((e=t==null?void 0:t.rows)==null?void 0:e.map(a=>me(a)))??[],overview:{totalMustPay:(t==null?void 0:t.totalMustPay)??0,totalPaid:(t==null?void 0:t.totalPaid)??0,totalPayment:(t==null?void 0:t.totalPayment)??0,totalApartmentUnPaid:(t==null?void 0:t.totalUnitUnPaid)??0,totalUnit:(t==null?void 0:t.totalUnit)??0}}},O=l.createContext({filterBy:y,getDataStatus:{isFetching:!1},setGetDataStatus:()=>{},filter:{...U},setFilter:()=>{},chartData:[],setChartData:()=>{},tableData:void 0,setTableData:()=>{}}),Q=({children:t,filterBy:e})=>{const[a,r]=l.useState({isFetching:!1}),[n,i]=l.useState({...U}),[c,u]=l.useState([]),[h,p]=l.useState({...$()}),x={filterBy:e,filter:n,setFilter:i,chartData:h,setChartData:p,tableData:c,setTableData:u,getDataStatus:a,setGetDataStatus:r};return o(O.Provider,{value:x,children:t})};Q.propTypes={children:g.node,filterBy:g.string};Q.defaultProps={children:o("div",{}),filterBy:y};const ue=()=>{const{tableData:t,chartData:e}=l.useContext(O);return[t,e.totalUnit]};function de(){const[t,e]=ue(),a=[{title:s.label.number_of_apartments_owned,dataIndex:"totalMustPay",key:"totalMustPay",align:"left",render:(r,n)=>m("span",{children:[n.totalUnitUnPaid," / ",e]})},{title:s.label.time,dataIndex:"time",key:"time",align:"left"},{title:s.label.must_collected,dataIndex:"totalPayment",key:"totalPayment",align:"right",render:r=>f(r)},{title:s.label.collected,dataIndex:"totalPaid",key:"totalPaid",align:"right",render:r=>f(r)},{title:s.label.also_receivable,dataIndex:"totalMustPay",key:"totalMustPay",align:"right",render:r=>f(r)}];return o(et,{bordered:!0,pagination:{pageSize:5},columns:a,dataSource:t})}function ge(){const{chartData:t}=l.useContext(O);return[{datasets:[{data:[t.totalPaid,t.totalMustPay,!t.totalPaid&&!t.totalMustPay?100:0],backgroundColor:["#0288D1","#D21243","#DCDCDC"],active:!0}],labels:[s.label.collected,s.label.also_receivable,s.label.no_data]}]}const he=()=>{const[t]=ge(),e={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:s.label.gross_revenue_chart},datalabels:{formatter:(a,r)=>{let n=0;r.chart.data.datasets[0].data.forEach(u=>{n+=u});const c=`${(a*100/n).toFixed(2)}%`;return a===0?"":c},color:"#fff"}}};return o(Y.Pie,{data:t,options:e})},pt=async({idBuilding:t,filter:e})=>{try{const{time:a,filterBy:r,service:n}=e;let i,c;a.length>0&&(i=b(a[0]).startOf(r.toLowerCase()).startOf("day").toISOString(),c=b(a[1]).endOf(r.toLowerCase()).endOf("day").toISOString());const u=await It({idBuildings:[t],from:i,to:c,type:r,idService:n||void 0});return{code:u.code,codeLanguage:u.codeLanguage,data:$(u.data)}}catch(a){return{code:a.code,codeLanguage:a.codeLanguage,data:$()}}},fe=()=>{const{idBuilding:t}=_(),{setGetDataStatus:e,setFilter:a,setTableData:r,setChartData:n,filterBy:i}=l.useContext(O),[c]=lt.useForm(),{getServiceInUses:u,serviceInUses:h}=Rt();l.useEffect(()=>{(async()=>await u({idBuilding:t}))()},[]);const p=async x=>{e({isFetching:!0}),a(x);const z=await pt({idBuilding:t,filter:{...x,filterBy:i}});r(z.data.details),n(z.data.overview),e({isFetching:!1})};return[i.toLowerCase(),p,c,h]},be=()=>{const[t,e,a,r]=fe(),n=l.useMemo(()=>[{label:s.time,key:"time",component:o(at.RangePicker,{allowClear:!1,picker:t,format:t==="month"?["MM/YYYY","MM/YYYY"]:t==="quarter"?["Q/YYYY","Q/YYYY"]:["YYYY","YYYY"],placeholder:[s.from,s.to],fluid:"true",getPopupContainer:i=>i.parentNode}),visible:!0},{label:s.service,key:"service",component:m(V,{placeholder:s.service,fluid:"true",getPopupContainer:i=>i.parentNode,children:[o(V.Option,{value:"",children:s.all_service},"service_0"),r.map(i=>o(V.Option,{value:i.id,children:i.name},i.id))]}),visible:!0}],[t,r]);return o(ot,{visibleFilterBox:!0,size:"small",initialValues:U,filters:n,formData:a,onSearch:e})},ye=()=>{const{idBuilding:t}=_(),{setTableData:e,setChartData:a,setGetDataStatus:r,getDataStatus:n,filterBy:i}=l.useContext(O);return l.useEffect(()=>{(async()=>{r({isFetching:!0});const c=await pt({idBuilding:t,filter:{...U,filterBy:i}});e(c.data.details),a(c.data.overview),r({isFetching:!1})})()},[]),[n.isFetching]},_e=()=>{const[t]=ye(),e=J();return m(tt,{children:[o(be,{}),m(G,{gutter:[e.margin.xs,0],children:[o(S,{width:"50px",height:"50px",isLoading:t}),o(C,{span:"12",children:o(de,{})}),o(C,{span:"12",style:{height:"380px",display:"flex",justifyContent:"space-around",width:"100%"},children:o(he,{})})]})]})},xe=({filterBy:t})=>o(Q,{filterBy:t,children:o(_e,{})}),De=()=>{const{setVisibleFilterBox:t,setTitlePage:e}=l.useContext(gt);return l.useEffect(()=>(e(s.dashboard),t(!0),()=>{e(""),t(!1)}),[]),[]},Ce=()=>{De();const t=W.map(a=>({key:a.value,label:a.label,children:o(pe,{filterBy:a.value})})),e=W.map(a=>({key:a.value,label:a.label,children:o(xe,{filterBy:a.value})}));return m(mt.Wrapper,{children:[o(Ht,{}),m(d,{css:a=>({marginTop:a.margin.sm}),children:[o(d.Header,{borderBottom:!0,children:o("span",{children:s.income_and_expenditure_statistics})}),o(d.Content,{children:o(K,{defaultActiveKey:y,items:t})})]}),m(d,{css:a=>({marginTop:a.margin.sm}),children:[o(d.Header,{borderBottom:!0,children:o("span",{children:s.gross_revenue_chart})}),o(d.Content,{children:o(K,{defaultActiveKey:y,items:e})})]}),o(Qt,{}),o(Xt,{})]})},ro=Ce;export{ro as default};
