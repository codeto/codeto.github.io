import{j as a,u as Fe,a as x,F as te}from"./@emotion-63839449.js";import{z as Ie,D as _e,l as ne,P as H,F as Oe,a as ce}from"./index-b17d22e5.js";import{r as u}from"./react-4fd50329.js";import{P as B}from"./prop-types-1172f4d5.js";import{a9 as N,s as W,b0 as Le,K as $,aB as Ae,at as Me,fx as A,fy as D,fz as Z,fA as ke,l as i,fB as Te,a as de,I as Y,dw as De,fC as Re,fD as Be,by as Ne,Y as Ve,fE as q,fF as j,dy as we,S as ee}from"./index-c2ded735.js";import"./react-redux-896b353b.js";import{l as Ye}from"./lodash-88fe09e6.js";import{h as X}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import"./@firebase-43527ee1.js";import{D as Q,I as ze,g as He,O as Ue,a as Ge,b as We,c as $e,d as qe,P as ue,S as Xe,e as Qe,f as Je,h as Ke,i as Ze,j as je,u as et}from"./constants-9bef80b2.js";import{u as ye}from"./react-router-a4308f7b.js";import{S as L,I as ve}from"./index-43183512.js";import{F as G,u as se}from"./index-687ba9e6.js";import{g as tt}from"./staff-2880022d.js";import{w as nt,B as U,T as ot,R as at,b as it,P as Ee,n as st,A as rt}from"./antd-f9eae174.js";import{B as oe}from"./index-881eef42.js";import{u as lt}from"./useTableCheckbox-753d19b2.js";import{p as ct}from"./printHtml-6274ec45.js";import{g as dt,a as re,b as le,c as ut}from"./feeNotification-74acc339.js";import{M as mt}from"./index-6a3b7dc6.js";import{e as pt}from"./exportExcel-837be6ed.js";import{u as ht}from"./useQuery-d54d310a.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./index-f7aef2cc.js";import"./xlsx-0fb7ed70.js";const R=u.createContext({idBuilding:0,tableData:{records:[],totalRecord:0},setTableData:()=>{},getsFeeNotificationResult:{isFetching:!1},setGetsFeeNotificationResult:()=>{},tablePagination:{current:N,limit:W},setTablePagination:()=>{},filter:{...Q},setFilter:()=>{},formFeeNotificationGroup:void 0,showFormFeeNotificationGroup:()=>{},hideFormFeeNotificationGroup:()=>{},feeNotificationPermissionWrite:!1}),Ce=e=>{const{children:d}=e,{idBuilding:s}=ye(),{getPermissionByModuleCode:r}=Le(),[o,l]=u.useState({records:[],totalRecord:0}),[c,t]=u.useState({isFetching:!1}),[n,p]=u.useState({current:N,limit:W}),[_,h]=u.useState({...Q}),[g,S,w]=$(),v=r(Ae),y=(v==null?void 0:v[Me])??!1,P={idBuilding:s,tableData:o,setTableData:l,getsFeeNotificationResult:c,setGetsFeeNotificationResult:t,tablePagination:n,setTablePagination:p,filter:_,setFilter:h,formFeeNotificationGroup:g,showFormFeeNotificationGroup:S,hideFormFeeNotificationGroup:w,feeNotificationPermissionWrite:y};return a(R.Provider,{value:P,children:d})};Ce.propTypes={children:B.node.isRequired};const gt=Ce,St=e=>{var s,r,o,l;return{...e,key:e==null?void 0:e.id,operationDate:e!=null&&e.createdAt?X(e==null?void 0:e.createdAt).format("DD/MM/YYYY HH:mm"):void 0,theOperator:((s=e==null?void 0:e.employee)==null?void 0:s.fullName)??"",feeNotificationsType:e!=null&&e.type?((r=ze[e==null?void 0:e.type])==null?void 0:r.name)??"":"",operationType:(e==null?void 0:e.sendMethod)??"",feeNoticePeriod:e!=null&&e.incurredCreatedFor?X(e==null?void 0:e.incurredCreatedFor,"YYYYMM").format("MM/YYYY"):"",sendStatus:[A,D].includes(e==null?void 0:e.sendMethod)?(o=Z)==null?void 0:o[e==null?void 0:e.sendStatus]:((l=Z)==null?void 0:l[(e==null?void 0:e.sendStatus)!==ke?e==null?void 0:e.sendStatus:""])??""}},It=async({idBuilding:e,filter:d,page:s,limit:r})=>{var _,h;const{feeNotificationsType:o,operationDate:l,operationType:c,theOperator:t,feeNoticePeriod:n,sendStatus:p}=d;try{const{code:g,codeLanguage:S,data:w,totalRecord:v}=await He({filter:{employeeIds:t||void 0,sendMethods:c||void 0,types:o||void 0,sendStatus:p||void 0,from:l&&Array.isArray(l)&&l.length?(_=X(l==null?void 0:l[0]))==null?void 0:_.startOf("day").toISOString():void 0,to:l&&Array.isArray(l)&&l.length?(h=X(l==null?void 0:l[1]))==null?void 0:h.endOf("day").toISOString():void 0,incurredCreatedFor:n?X(n).startOf("month").format("YYYYMM"):void 0},idBuilding:e,page:s,limit:r});return{code:g,codeLanguage:S,totalRecord:v,data:w==null?void 0:w.map(y=>St(y))}}catch({code:g,codeLanguage:S}){return{code:g,codeLanguage:S,data:[],totalRecord:0}}},J=()=>{const{idBuilding:e,setTableData:d,setGetsFeeNotificationResult:s}=u.useContext(R);return[async({filter:o,limit:l,page:c})=>{s({isFetching:!0});const t=await It({filter:o,idBuilding:e,limit:l,page:c});d({records:t==null?void 0:t.data,totalRecord:t==null?void 0:t.totalRecord}),s({isFetching:!1})}]},_t=e=>({id:e.id,fullName:e.fullName}),vt=async e=>{try{const{code:d,codeLanguage:s,data:r,totalRecord:o}=await tt(e);return{code:d,codeLanguage:s,totalRecord:o,data:r==null?void 0:r.map(l=>_t(l))}}catch({code:d,codeLanguage:s}){return{code:d,codeLanguage:s,data:[],totalRecord:0}}},Ft=()=>{const[e]=G.useForm(),{setFilter:d,setTablePagination:s,idBuilding:r}=u.useContext(R),[o]=J(),[l,c]=u.useState([]);return u.useEffect(()=>{(async()=>{const n=await vt(r);c((n==null?void 0:n.data)??[])})()},[]),{formFilter:e,onSearch:async n=>{d({...n}),s({current:N,limit:W}),await o({filter:n,page:N,limit:W})},listStaffs:l}},Tt=()=>{const{onSearch:e,formFilter:d,listStaffs:s}=Ft(),r=u.useMemo(()=>[{label:i.invoice_period,key:"feeNoticePeriod",component:a(_e,{placeholder:Ie,fluid:"true",picker:"month",format:Ie,getPopupContainer:o=>o.parentNode}),visible:!0},{label:i.operation_date,key:"operationDate",component:a(_e.RangePicker,{placeholder:[ne,ne],format:ne,fluid:"true",allowClear:!1,getPopupContainer:o=>o.parentNode}),visible:!0},{label:i.operation_type,key:"operationType",component:a(L,{showSearch:!1,mode:"multiple",fluid:"true",placeholder:i.operation_type,getPopupContainer:o=>o.parentNode,children:Ue.map(o=>a(L.Option,{value:o.id,children:o.name},o.id))}),visible:!0},{label:i.the_operator,key:"theOperator",component:a(L,{mode:"multiple",fluid:"true",maxTagCount:1,placeholder:i.the_operator,filterOption:(o,l)=>l.children.toLowerCase().indexOf(o.toLowerCase())>=0,getPopupContainer:o=>o.parentNode,children:s==null?void 0:s.map(o=>a(L.Option,{value:o.id,children:o.fullName},o.id))}),visible:!0},{label:i.invoice_type,key:"feeNotificationsType",component:a(L,{mode:"multiple",showSearch:!1,fluid:"true",maxTagCount:1,placeholder:i.invoice_type,getPopupContainer:o=>o.parentNode,children:Ge.map(o=>a(L.Option,{value:o.id,children:o.name},o.id))}),visible:!0},{label:i.send_status,key:"sendStatus",component:a(L,{fluid:"true",getPopupContainer:o=>o.parentNode,mode:"multiple",placeholder:i.send_status,children:Te.map(o=>a(L.Option,{value:o.id,children:o.name},o.id))}),visible:!0}],[s]);return a(H.FilterBox,{defaultFilter:{...Q},onSearch:e,filters:r,layout:"vertical",formData:d})},wt=()=>{const{tableData:e}=u.useContext(R);return{total:e==null?void 0:e.totalRecord}},yt=()=>{const{total:e}=wt(),d=[];return a(H.ActionBox,{actions:d,total:e})},Et=()=>{const e=Fe(),{layoutScrollRef:d}=u.useContext(de),{tableData:s,tablePagination:r,filter:o,getsFeeNotificationResult:l,showFormFeeNotificationGroup:c,setTablePagination:t}=u.useContext(R),[n]=J(),p=async(v,y)=>{v!==r.current?(t({current:v,limit:r.limit}),await n({filter:o,limit:r.limit,page:v})):y!==r.limit&&(t({current:r.current,limit:y}),await n({filter:o,limit:y,page:r.current}))},_={pageSize:r.limit,defaultCurrent:1,current:r.current,total:s.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:p},h={offsetScroll:e.offsetScrollX,getContainer:()=>d.current},g=s.records;return{loading:l==null?void 0:l.isFetching,dataSource:g,sticky:h,pagination:_,handleShowFormFeeNotificationGroup:v=>{c(v)}}},Ct=()=>{const{loading:e,dataSource:d,pagination:s,sticky:r,handleShowFormFeeNotificationGroup:o}=Et(),l=[{title:i.invoice_period,key:"feeNoticePeriod",dataIndex:"feeNoticePeriod",width:150},{title:i.operation_date,key:"operationDate",dataIndex:"operationDate",width:130},{title:i.operation_type,key:"operationType",dataIndex:"operationType",width:150,render:(c,t)=>(t==null?void 0:t.operationType)===We?x("div",{children:[a(Y,{css:n=>({fontSize:n.iconSize,marginRight:n.margin.xs}),name:"icon-mail-outlined",title:i.email}),i.email]}):(t==null?void 0:t.operationType)===$e?x("div",{children:[a(Y,{css:n=>({fontSize:n.iconSize,marginRight:n.margin.xs}),name:"icon-print-outlined",title:i.print}),i.print]}):(t==null?void 0:t.operationType)===qe?x("div",{children:[a(Y,{css:n=>({fontSize:n.iconSize,marginRight:n.margin.xs}),name:"icon-sms-outlined",title:i.label.sms}),i.label.sms]}):""},{title:i.the_operator,key:"theOperator",dataIndex:"theOperator",width:150},{title:i.receiver,key:"receiver",dataIndex:"receiver",width:150,render:(c,t)=>{var p,_;const n=Ye.orderBy(((_=(p=t==null?void 0:t.receiver)==null?void 0:p.split("-"))==null?void 0:_.map(h=>{var g,S;return(S=(g=De)==null?void 0:g[h])==null?void 0:S.name}).filter(Boolean))||[]);return n!=null&&n.length?a("ul",{style:{paddingLeft:"12px"},children:n==null?void 0:n.map((h,g)=>a("li",{children:h},g))}):null}},{title:i.invoice_type,key:"feeNotificationsType",dataIndex:"feeNotificationsType",width:150},{title:i.label.sending_process,key:"sendStatus",dataIndex:"sendStatus",width:130,align:"center",render:(c,t)=>{var n,p;return t!=null&&t.sendStatus?a(nt,{color:(n=t==null?void 0:t.sendStatus)==null?void 0:n.color,children:(p=t==null?void 0:t.sendStatus)==null?void 0:p.name}):null}},{title:i.send_or_print_result,key:"result",dataIndex:"result",align:"center",width:120,render:(c,t)=>{var p;let n=a(te,{});return[Re,Be].includes((p=t==null?void 0:t.sendStatus)==null?void 0:p.id)&&(n=x(U,{type:"link",onClick:()=>{o(t)},children:[t==null?void 0:t.totalSuccess,"/",t==null?void 0:t.totalInvoice]})),a(ot,{placement:"top",title:`${i.success_sent_to_apartment.replace("{totalSuccess}",t==null?void 0:t.totalSuccess).replace("{totalInvoice}",t==null?void 0:t.totalInvoice)}`,children:n})}}];return a(H.Table,{columns:l,dataSource:d,loading:e,pagination:s,scroll:{x:l.reduce((c,t)=>c+t.width,0),scrollToFirstRowOnChange:!0},sticky:r})},xt="IN_PROGRESS",ft="COMPLETED",Pt="FAILED",bt=[{id:xt,name:i.label.sending},{id:ft,name:i.label.success},{id:Pt,name:i.label.failed}];Ne(bt,"id");const me={unitName:void 0,code:void 0,sendMailStatus:""},z=u.createContext({idBuilding:0,getsStatus:{isFetching:!1},setGetsStatus:()=>{},filter:{...me},setFilter:()=>{},tableData:{records:[],totalRecord:0},setTableData:()=>{},tablePagination:{current:N,limit:ue},setTablePagination:()=>{},formSendEmail:void 0,showFormSendEmail:()=>{},hideFormSendEmail:()=>{},formPrint:void 0,showFormPrint:()=>{},hideFormPrint:()=>{},formPreview:void 0,showFormPreview:()=>{},hideFormPreview:()=>{},totalInvoiceIsSent:0,setTotalInvoiceIsSent:()=>{},formExport:void 0,showFormExport:()=>{},hideFormExport:()=>{},formResendInvoice:void 0,showFormResendInvoice:()=>{},hideFormResendInvoice:()=>{},onSelectRow:()=>{},onSelectAllRowOfPage:()=>{},tableSelection:()=>{},selectAllRowComponent:()=>{},resetDataTableSelection:()=>{}}),pe=({children:e})=>{const d=ye(),{idBuilding:s}=d,[r,o]=u.useState({isFetching:!1}),[l,c]=u.useState({...me}),[t,n]=u.useState({records:[],totalRecord:0}),[p,_]=u.useState({current:N,limit:ue}),[h,g,S,w,v]=lt({dataRows:t.records,rowKey:"key",totalRows:t.totalRecord}),[y,P]=u.useState(0),[b,O,E]=$(),[M,C,m]=$(),[I,F,k]=$(),[T,K,f]=$(),[V,fe,Pe]=$(),be={idBuilding:s,getsStatus:r,setGetsStatus:o,filter:l,setFilter:c,tableData:t,setTableData:n,tablePagination:p,totalInvoiceIsSent:y,setTotalInvoiceIsSent:P,setTablePagination:_,formSendEmail:b,showFormSendEmail:O,hideFormSendEmail:E,formPrint:M,showFormPrint:C,hideFormPrint:m,formPreview:I,showFormPreview:F,hideFormPreview:k,formExport:T,showFormExport:K,hideFormExport:f,formResendInvoice:V,showFormResendInvoice:fe,hideFormResendInvoice:Pe,tableSelection:h,resetDataTableSelection:g,onSelectRow:S,onSelectAllRowOfPage:w,selectAllRowComponent:v};return a(z.Provider,{value:be,children:e})};pe.propTypes={children:B.node};pe.defaultProps={children:a("div",{})};const Ot=e=>{var s,r,o;const d={...e,key:(e==null?void 0:e.id)??"",code:(e==null?void 0:e.code)??"",unit:((s=e==null?void 0:e.unit)==null?void 0:s.name)??"",result:((r=Z[e==null?void 0:e.sendMailStatus])==null?void 0:r.name)||((o=Z[e==null?void 0:e.sendSmsStatus])==null?void 0:o.name)||"",isShowAction:!0,sendResult:i.success};return[Xe,Qe].includes(e.errorMsg)&&(d.isShowAction=!1),e.errorMsg&&d&&d.result!==i.label.success&&(d.sendResult=Je[e.errorMsg]||e.errorMsg),d},he=async({idBuilding:e,filter:d,page:s,limit:r,idFeeNotificationResult:o})=>{try{const{code:l,sendMailStatus:c,unitName:t}=d,{code:n,codeLanguage:p,data:_,totalRecord:h}=await Ke({filter:{sendMailStatus:c||void 0,code:l||void 0,unitName:t||void 0},idFeeNotificationGroup:o,idBuilding:e,limit:r,page:s});return{code:n,codeLanguage:p,totalRecord:h,data:_==null?void 0:_.map(g=>Ot(g))}}catch(l){return{code:l.code,codeLanguage:l.codeLanguage,data:[],totalRecord:0}}},ge=()=>{const{idBuilding:e,formFeeNotificationGroup:d}=u.useContext(R),{setGetsStatus:s,setTablePagination:r,setTableData:o}=u.useContext(z);return[async({filter:c,tablePagination:t})=>{var p;s({isFetching:!0}),r({current:t.current,limit:t.limit});const n=await he({filter:c,idFeeNotificationResult:(p=d==null?void 0:d.data)==null?void 0:p.id,idBuilding:e,limit:t.limit,page:t.current});return o({records:n==null?void 0:n.data,totalRecord:n==null?void 0:n.totalRecord}),s({isFetching:!1}),{records:n==null?void 0:n.data,totalRecord:n==null?void 0:n.totalRecord}}]},Lt=()=>{const{setFilter:e,resetDataTableSelection:d}=u.useContext(z),{formFeeNotificationGroup:s}=u.useContext(R),[r]=ge(),o=async c=>{d(),e(c),await r({filter:c,tablePagination:{current:N,limit:ue}})},l=u.useMemo(()=>{var c;return[{label:i.invoice_code,key:"code",component:a(ve,{placeholder:i.invoice_code,fluid:"true"}),visible:!0},{label:i.unit,key:"unitName",component:a(ve,{placeholder:i.unit,fluid:"true"}),visible:!0},[A,D].includes((c=s==null?void 0:s.data)==null?void 0:c.sendMethod)?{label:i.send_result,key:"sendMailStatus",component:x(L,{fluid:"true",getPopupContainer:t=>t.parentNode,children:[a(L.Option,{value:"",children:i.all_result},"send_result_0"),Te.map(t=>a(L.Option,{value:t.id,children:t.name},t.id))]}),visible:!0}:null].filter(Boolean)},[]);return a(Oe,{initialValues:{...me},onSearch:o,layout:"vertical",filters:l,visibleFilterBox:!0,size:"small"})},At=()=>{var h;const{formFeeNotificationGroup:e,feeNotificationPermissionWrite:d}=u.useContext(R),{selectAllRowComponent:s,showFormExport:r,tableSelection:o,showFormResendInvoice:l}=u.useContext(z),[c]=Ve(),{selectedRowKeysCache:t}=o,n=(t==null?void 0:t.length)>0,p=()=>{r()},_=()=>{l()};return x("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[x("div",{style:{fontWeight:c.fontWeightNormal,color:c.labelColor,display:"flex",gap:"4px"},children:[x("span",{children:[i.total," "]}),a("span",{style:{fontWeight:c.fontWeightBold,verticalAlign:"middle",color:c.blackColor},children:s()})]}),x("div",{children:[d&&[A,D].includes((h=e==null?void 0:e.data)==null?void 0:h.sendMethod)?a(U,{type:"primary",style:{marginRight:c.marginXs},disabled:!n,onClick:()=>{_()},icon:a(Y,{name:"icon-notification-filled"}),children:i.invoice_resend},"send_invoices"):null,a(U,{type:"primary",onClick:()=>{p()},ghost:!0,icon:a(Y,{name:"icon-download-outlined"}),children:i.export},"export")]})]})},Mt=()=>{var E,M,C;const e=Fe(),{layoutScrollRef:d}=u.useContext(de),{formFeeNotificationGroup:s,feeNotificationPermissionWrite:r}=u.useContext(R),{tableData:o,filter:l,tablePagination:c,getsStatus:t,showFormPreview:n,onSelectRow:p,onSelectAllRowOfPage:_,tableSelection:h}=u.useContext(z),[g]=ge(),{selectedRowKeys:S}=h,w=async(m,I)=>{m!==c.current&&await g({filter:l,tablePagination:{current:m,limit:c.limit}}),I!==c.limit&&await g({filter:l,tablePagination:{current:c.current,limit:I}})},v=(m,I)=>{n({feeNotification:m,type:I})},y=[{key:"code",dataIndex:"code",title:i.code,width:130,render:(m,I)=>a(U,{onClick:()=>I.isShowAction&&v(I,j),type:"link",style:{padding:0},children:m})},{key:"unit",dataIndex:"unit",title:i.unit,width:150},[A,D].includes((E=s==null?void 0:s.data)==null?void 0:E.sendMethod)?{key:"result",dataIndex:"result",title:i.send_result,width:150}:null,{title:i.label.note,key:"sendResult",dataIndex:"sendResult",width:300},r?{title:i.actions,key:"action",dataIndex:"action",align:"center",fixed:"right",width:100,render:(m,I,F)=>I.sendMethod===A&&I.isShowAction?x(te,{children:[a(Y,{style:{fontSize:e.iconSize},title:i.label.send_email,name:"icon-mail-outlined",onClick:()=>v(I,A)}),a(Y,{style:{fontSize:e.iconSize,marginLeft:e.margin.xs},title:i.print,name:"icon-print-outlined",onClick:()=>v(I,q)})]}):I.sendMethod===q&&I.isShowAction?a(Y,{style:{fontSize:e.iconSize},title:i.print,name:"icon-print-outlined",onClick:()=>v(I,q)}):I.sendMethod===D&&I.isShowAction?a(Y,{style:{fontSize:e.iconSize},title:i.label.sms,name:"icon-sms-outlined",onClick:()=>v(I,D)}):null}:null].filter(Boolean),P=t==null?void 0:t.isFetching,b=[A,D].includes((M=s==null?void 0:s.data)==null?void 0:M.sendMethod)?{selectedRowKeys:S,onSelect:p,onSelectAll:_,fixed:!0,columnWidth:65,renderCell:(m,I,F,k)=>I.isShowAction?k:null,hideSelectAll:(C=o==null?void 0:o.records)==null?void 0:C.find(m=>!(m!=null&&m.isShowAction))}:!1,O={pageSize:c.limit,defaultCurrent:1,current:c.current,total:o.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:w};return a(H.Table,{columns:y,loading:P,pagination:O,dataSource:o.records,rowSelection:b,sticky:{offsetScroll:e.offsetScrollX,getContainer:()=>d.current},scroll:{x:y.reduce((m,I)=>m+I.width,0),scrollToFirstRowOnChange:!0}})},xe=async({idBuilding:e,invoiceType:d,sendMethod:s,totalInvoice:r,incurredCreatedFor:o,duePayment:l,roles:c=[]})=>{try{const t=await Ze({idBuilding:e,feeNotification:{type:d,sendMethod:s,totalInvoice:r,incurredCreatedFor:o,duePayment:l?X(l).toDate():null,receiver:c!=null&&c.length?c==null?void 0:c.join("-"):null}});return{code:t.code,codeLanguage:t.codeLanguage,data:t.data}}catch({code:t,codeLanguage:n}){return{code:t,codeLanguage:n,data:{}}}},Se=e=>{var C,m,I;const{formFeeNotificationGroup:d}=u.useContext(R),{setTablePagination:s,tablePagination:r}=u.useContext(z),{visible:o,onHide:l,feeNotification:c,idBuilding:t,type:n}=e,[p,_]=u.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[h,g]=u.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[S,w]=u.useState(),[v]=J(),[y]=G.useForm();se(p.code,p.codeLanguage),u.useEffect(()=>{(async()=>{_({code:void 0,codeLanguage:void 0,isFetching:!0});const{code:F,codeLanguage:k,data:T}=await dt(t,c.id,n!==j);w(T),_({code:F,codeLanguage:k,isFetching:!1})})()},[]),se(h.code,h.codeLanguage,{message:i.success,description:i.success});const P=async()=>{var k,T,K;const F=await y.validateFields();if(F){g({isFetching:!0,code:void 0,codeLanguage:void 0});try{const f=await xe({idBuilding:t,invoiceType:c==null?void 0:c.type,sendMethod:n,totalInvoice:1,incurredCreatedFor:c.incurredCreatedFor,duePayment:c.duePayment||null,roles:n===q?[]:F.roles});if(!ee.includes(f.code)){g({isFetching:!1,code:f.code,codeLanguage:f.codeLanguage});return}let V;n===A&&(V=await re({feeNotificationIds:[c.id],idBuilding:t,invoiceGroupId:((k=f==null?void 0:f.data)==null?void 0:k.id)??null})),n===D&&(V=await le({feeNotificationIds:[c.id],idBuilding:t,invoiceGroupId:((T=f==null?void 0:f.data)==null?void 0:T.id)??null})),n===q&&(V=await ut({feeNotificationIds:[c.id],idBuilding:t,invoiceGroupId:((K=f==null?void 0:f.data)==null?void 0:K.id)??null}),ct(V.data)),g({isFetching:!1,code:V.code,codeLanguage:V.codeLanguage}),ee.includes(V.code)&&(s({current:r==null?void 0:r.current,limit:r==null?void 0:r.limit}),await v({filter:{...Q},current:r==null?void 0:r.current,limit:r==null?void 0:r.limit}))}catch(f){g({isFetching:!1,code:f.code,codeLanguage:f.codeLanguage})}}},b=()=>{l()},O=a(G,{form:y,name:"form_print_bill",layout:"vertical",initialValues:{roles:((m=(C=d==null?void 0:d.data)==null?void 0:C.receiver)==null?void 0:m.split("-"))||[]},children:[A,D].includes(n)?a(at,{gutter:8,children:a(it,{span:24,children:a(G.Item,{name:"roles",label:i.receiver,rules:[{required:!0}],children:a(L,{fluid:"true",placeholder:i.receiver,mode:"multiple",children:we.map(F=>a(L.Option,{value:F.id,children:F.name},F.id))})})})}):null}),E=a("div",{}),M=u.useMemo(()=>[A,D].includes(n)?i.invoice_resend:n===q?i.invoice_reprint:i.invoice_detail,[n]);return a(mt,{visible:o,title:M,loading:h.isFetching,footer:n===j?null:x(te,{children:[a(U,{type:"primary",ghost:!0,onClick:b,children:i.cancel}),a(U,{loading:h.isFetching,type:"primary",onClick:P,children:(I=je[n])==null?void 0:I.name})]}),onCancel:b,maskClosable:!h.isFetching,disabledButtonOk:h.isFetching,disabledButtonCancel:h.isFetching,isLoadingPreview:p.isFetching,beforePreview:O,afterPreview:E,html:S||"<div />"})};Se.propTypes={idBuilding:B.instanceOf([B.number,B.string]),visible:B.bool.isRequired,onHide:B.func.isRequired,feeNotification:B.objectOf(B.any),type:B.string};Se.defaultProps={idBuilding:0,feeNotification:void 0,type:j};const ae=100,kt=["#",i.code,i.unit,i.label.note],Dt=()=>{const{formFeeNotificationGroup:e,idBuilding:d}=u.useContext(R),{tableData:s,filter:r,hideFormExport:o}=u.useContext(z),[l,c]=u.useState({isFetching:!1}),[t,n]=u.useState(0),p=async()=>{var y,P,b;c({isFetching:!0}),n(0);const _=[];let h=1;const g=s==null?void 0:s.totalRecord,S=Math.floor(g/ae)+1;let w=0;for(;h<=S;){const O=await he({filter:r,idFeeNotificationResult:(y=e==null?void 0:e.data)==null?void 0:y.id,idBuilding:d,limit:ae,page:h});if(O.data.length>0){const E=_.length;for(let C=0;C<O.data.length;C+=1){const m=O.data[C],I=[E+C+1];I.push((m==null?void 0:m.code)??""),I.push((m==null?void 0:m.unit)??""),[A,D].includes((P=e==null?void 0:e.data)==null?void 0:P.sendMethod)&&I.push(m==null?void 0:m.result),I.push((m==null?void 0:m.sendResult)??""),_.push(I)}h+=1;const M=ae/g*100;w+=M,n(Math.round(w))}else h=0}const v=[...kt];[A,D].includes((b=e==null?void 0:e.data)==null?void 0:b.sendMethod)&&v.splice(3,0,i.send_result),_.unshift(v),pt(_,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8",i.invoice_sending_history,".xlsx"),c({isFetching:!1}),st.success({message:i.success,description:i.export_data_success}),o()};return u.useEffect(()=>{p()},[]),a(ce,{open:!0,okText:i.export,cancelText:i.cancel,okButtonProps:{isFetchingExport:l==null?void 0:l.isFetching,disabled:l==null?void 0:l.isFetching},footer:null,closable:!1,children:a(Ee,{strokeColor:{from:"#108ee9",to:"#87d068"},percent:t,status:"active"})})},Rt=async({idBuilding:e,invoiceGroupId:d,totalInvoice:s})=>{try{const r=await et({idBuilding:e,invoiceGroupId:d,totalInvoice:s});return{code:r.code,codeLanguage:r.codeLanguage,data:r.data}}catch({code:r,codeLanguage:o}){return{code:r,codeLanguage:o,data:{}}}},ie=20,Bt=async({isAll:e,idBuilding:d,invoiceSelectedList:s=[],setPercentResendInvoice:r,totalRecord:o,filter:l,idInvoiceGroupCurrent:c,sendMethod:t,roles:n})=>{var w,v,y,P,b,O,E,M,C;const p=[];s==null||s.forEach(m=>m.isShowAction&&m.id&&p.push(m.id));const _=e?o:p.length;let h=0;const g={code:500,codeLanguage:null},S=await xe({idBuilding:d,invoiceType:(w=s[0])==null?void 0:w.type,sendMethod:t,totalInvoice:_,incurredCreatedFor:(v=s[0])==null?void 0:v.incurredCreatedFor,duePayment:((y=s[0])==null?void 0:y.duePayment)||null,roles:n});if(!ee.includes(S.code))return g.code=S.code,g.codeLanguage=S.codeLanguage,g;if(e){let m=1;const I=Math.ceil(o/ie);for(;m<=I;){const F=await he({filter:l,idFeeNotificationResult:c,idBuilding:d,limit:ie,page:m}),k=[];if((P=F==null?void 0:F.data)==null||P.forEach(T=>(T==null?void 0:T.isShowAction)&&(T==null?void 0:T.id)&&k.push(T==null?void 0:T.id)),k.length){if(h+=k.length,t===A){const T=await re({feeNotificationIds:k,idBuilding:d,invoiceGroupId:((b=S==null?void 0:S.data)==null?void 0:b.id)??null});g.code=T==null?void 0:T.code,g.codeLanguage=T==null?void 0:T.codeLanguage}if(t===D){const T=await le({feeNotificationIds:k,idBuilding:d,invoiceGroupId:((O=S==null?void 0:S.data)==null?void 0:O.id)??null});g.code=T==null?void 0:T.code,g.codeLanguage=T==null?void 0:T.codeLanguage}}r(Math.floor(m*100/I)),m+=1}}if(!e){let m=[];for(let I=0;I<p.length;I+=1)if(m.push(p[I]),m.length===ie||I===p.length-1){if(h+=m.length,t===A){const F=await re({feeNotificationIds:m,idBuilding:d,invoiceGroupId:((E=S==null?void 0:S.data)==null?void 0:E.id)??null});g.code=F==null?void 0:F.code,g.codeLanguage=F==null?void 0:F.codeLanguage}if(t===D){const F=await le({feeNotificationIds:m,idBuilding:d,invoiceGroupId:((M=S==null?void 0:S.data)==null?void 0:M.id)??null});g.code=F==null?void 0:F.code,g.codeLanguage=F==null?void 0:F.codeLanguage}m=[],r(Math.floor(h*100/p.length))}}return _!==h&&Rt({idBuilding:d,invoiceGroupId:((C=S==null?void 0:S.data)==null?void 0:C.id)??null,totalInvoice:h}),g},Nt=()=>{var b,O;const{formFeeNotificationGroup:e,setTablePagination:d}=u.useContext(R),{tableSelection:s,idBuilding:r,tableData:o,hideFormResendInvoice:l,filter:c}=u.useContext(z),[t,n]=u.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[p]=G.useForm(),[_,h]=u.useState(!1),[g,S]=u.useState(0),[w]=J(),{isSelectAllItem:v,selectedRowsCache:y}=s;se(t.code,t.codeLanguage,{message:i.success,description:i.sent_successfully},()=>{n({isFetching:!1,code:void 0,codeLanguage:void 0})});const P=async()=>{var M,C;const E=await p.validateFields();if(E){h(!0),S(0),n({isFetching:!0,code:void 0,codeLanguage:void 0});const{code:m,codeLanguage:I}=await Bt({isAll:v,idBuilding:r,invoiceSelectedList:y,setPercentResendInvoice:S,totalRecord:o==null?void 0:o.totalRecord,filter:c,idInvoiceGroupCurrent:(M=e==null?void 0:e.data)==null?void 0:M.id,sendMethod:(C=e==null?void 0:e.data)==null?void 0:C.sendMethod,roles:E.roles});n({isFetching:!1,code:m,codeLanguage:I}),ee.includes(m)&&(d({current:N,limit:W}),await w({filter:{...Q},limit:W,page:N})),l()}};return a(ce,{open:!0,title:i.invoice_resend,footer:_?null:[a(U,{onClick:l,children:i.cancel},"back"),a(U,{type:"primary",onClick:P,children:i.resend},"submit")],closable:!1,children:a(G,{initialValues:{roles:((O=(b=e==null?void 0:e.data)==null?void 0:b.receiver)==null?void 0:O.split("-"))||[]},form:p,name:"formResend",layout:"vertical",children:_?a(Ee,{strokeColor:{from:"#108ee9",to:"#87d068"},percent:g,status:"active"}):a(G.Item,{rules:[{required:!0}],label:i.receiver,name:"roles",children:a(L,{fluid:"true",placeholder:i.receiver,mode:"multiple",children:we.map(E=>a(L.Option,{value:E.id,children:E.name},E.id))})})})})},Vt=()=>{const{hideFormFeeNotificationGroup:e,formFeeNotificationGroup:d}=u.useContext(R),{formPreview:s,hideFormPreview:r,idBuilding:o,filter:l,tablePagination:c,setTotalInvoiceIsSent:t,getsStatus:n,totalInvoiceIsSent:p,formExport:_,formResendInvoice:h}=u.useContext(z),[g]=ge(),{totalInvoice:S}=d==null?void 0:d.data,w=u.useMemo(()=>S?Number(S||0)-Number(p):0,[S,p]);return u.useEffect(()=>{(async()=>{const v=await g({filter:l,tablePagination:c});t(v==null?void 0:v.totalRecord)})()},[]),x(ce,{width:"80%",open:!0,title:i.invoice_sending_history,footer:null,onCancel:e,children:[x("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[a(Lt,{}),x(oe,{style:{flex:1},children:[a(oe.Header,{children:a(At,{})}),x(oe.Content,{fluid:!0,children:[!(n!=null&&n.isFetching)&&w&&!Number.isNaN(w)?a("div",{style:{margin:"5px"},children:a(rt,{type:"warning",message:i.number_apartments_have_not_been_able_to_generate_fee_notifications_due_to_disruptions_in_the_processing_system.replace("{number}",w),showIcon:!0})}):null,a(Mt,{})]})]}),s.isShow?a(Se,{idBuilding:o,onHide:r,type:s.data.type,feeNotification:s.data.feeNotification,visible:!0}):null]}),_!=null&&_.isShow?a(Dt,{}):null,h!=null&&h.isShow?a(Nt,{}):null]})},Yt=()=>a(pe,{children:a(Vt,{})}),zt=()=>{const{setTitlePage:e,setVisibleFilterBox:d,setVisibleSearchBox:s}=u.useContext(de),{formFeeNotificationGroup:r,showFormFeeNotificationGroup:o}=u.useContext(R),{queryParams:l}=ht(),[c]=J(),t=l.get("invoiceGroupId");return u.useEffect(()=>(e(i.invoice_send_result),s(!0),(async()=>await c({filter:{...Q},limit:W,page:N}))(),()=>{e(""),s(!1),d(!1)}),[]),u.useEffect(()=>{t&&o({id:t,sendMethod:A})},[t]),{isShowFormFeeNotificationGroup:r.isShow}},Ht=()=>{const{isShowFormFeeNotificationGroup:e}=zt();return x(te,{children:[x(H.Wrapper,{children:[a(Tt,{}),x(H.Container,{children:[a(H.Header,{children:a(yt,{})}),a(H.Content,{children:a(Ct,{})})]})]}),e&&a(Yt,{})]})},Ao=()=>a(gt,{children:a(Ht,{})});export{Ao as default};
