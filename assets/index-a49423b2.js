import{j as r,a as j,u as Me,F as me}from"./@emotion-63839449.js";import{r as R}from"./react-4fd50329.js";import{dM as W,dE as V,dN as Ue,a9 as Y,s as X,b0 as ze,K as Ye,as as Ge,at as Qe,bv as $e,dO as Ve,ag as je,au as He,a3 as Ee,l as t,bI as Ce,a5 as ie,I as H,dq as We,dP as Xe,bG as Ke,dQ as Je,a as Pe,bH as Ze,dw as et,dG as tt,dR as it,dS as nt,dy as ot,G as Te,dT as rt,dU as st,dV as lt,dW as at,dX as ct,S as dt}from"./index-c2ded735.js";import"./lodash-88fe09e6.js";import{h as O}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import{a as ne,u as oe}from"./react-redux-896b353b.js";import{P as te}from"./prop-types-1172f4d5.js";import{u as ut}from"./useTableCheckbox-753d19b2.js";import"./@firebase-43527ee1.js";import{F as mt,u as le}from"./index-687ba9e6.js";import{u as ye,d as ke,a as pt}from"./react-router-a4308f7b.js";import{B as pe}from"./index-881eef42.js";import{d as gt}from"./downloadFileFromUrl-79614833.js";import{g as ve}from"./getPageByTotalAndLimit-7f60b558.js";import{P as xe,o as ht,i as yt,l as Q,T as ft,a as _e}from"./index-b17d22e5.js";import{g as K,e as _t,d as Ie,c as Rt,r as St}from"./resident.actions-016d5f51.js";import{u as bt}from"./useQuery-d54d310a.js";import{B as ce,w as Re,G as ge}from"./antd-f9eae174.js";import{I as Et}from"./integrated-84091933.js";import{c as Fe}from"./compareObject-7b349d22.js";import{I as ee,S as L}from"./index-43183512.js";import{I as Ne}from"./index-9ef224b9.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./account-86ffff50.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./exportExcel-837be6ed.js";import"./xlsx-0fb7ed70.js";import"./regex-deefadac.js";import"./uuid-4a60fe23.js";const J=R.createContext({residentPermissionRead:!1,residentPermissionReadEncrypted:!1,residentPermissionWrite:!1,residentPermissionExport:!1,residentPermissionExportEncrypted:!1,idBuilding:void 0,residentState:{isFetching:!1},filterObject:{...W,status:V,appStatus:Ue},setFilterObject:()=>{},tablePage:Y,tablePageSize:X,tableSelection:void 0,resetDataTableSelection:()=>{},onSelectRow:()=>{},onSelectAllRowOfPage:()=>{},selectAllRowComponent:()=>{},totalRecord:0,handleFilterChange:()=>{},handleTablePageChange:()=>{},handleTablePageSizeChange:()=>{},setResidentState:()=>{},formImportResident:void 0,showFormImportResident:()=>{},hideFormImportResident:()=>{},formFilter:{}}),De=o=>{const{children:l}=o,{getPermissionByModuleCode:h}=ze(),[s,a]=R.useState({...W}),[f,u]=R.useState(Y),[E,e]=R.useState(X),[m,k]=R.useState({isFetching:!1}),F=ne(w=>w.resident.residents),n=ne(w=>w.resident.totalResident),[P,v,b,d,N]=ut({dataRows:F,rowKey:"id",totalRows:n}),D=ye(),{idBuilding:p}=D,[A]=mt.useForm(),[c,T,x]=Ye(),_=w=>{a({...w})},B=w=>{u(w)},I=w=>{e(w)},S=h(Ge),M=(S==null?void 0:S[Qe])??!1,q=(S==null?void 0:S[$e])??!1,g=(S==null?void 0:S[Ve])??!1,C=(S==null?void 0:S[je])??!1,U=(S==null?void 0:S[He])??!1,z={residentPermissionRead:C,residentPermissionReadEncrypted:U,residentPermissionWrite:M,residentPermissionExport:q,residentPermissionExportEncrypted:g,idBuilding:p,residentState:m,filterObject:s,setFilterObject:a,tablePage:f,tablePageSize:E,tableSelection:P,resetDataTableSelection:v,onSelectRow:b,onSelectAllRowOfPage:d,selectAllRowComponent:N,totalRecord:n,handleFilterChange:_,handleTablePageChange:B,handleTablePageSizeChange:I,setResidentState:k,formImportResident:c,showFormImportResident:T,hideFormImportResident:x,formFilter:A};return r(J.Provider,{value:z,children:l})};De.propTypes={children:te.node.isRequired};const ae=()=>{const{getAllQuery:o,setQuery:l}=bt(),{handleTablePageChange:h,handleTablePageSizeChange:s,handleFilterChange:a,formFilter:f}=R.useContext(J);return{getQueryParamsResident:()=>{var x,_,B,I,S,M,q,g,C,U,z;const{limit:e,page:m,role:k,status:F,name:n,apartment:P,phone:v,secondaryPhone:b,email:d,secondaryEmail:N,gender:D,age:p,appStatus:A}=o(),c={pagination:{tablePageSize:e&&+e||X,tablePage:m&&+m||Y},filter:{role:k||"",name:n||"",apartment:P||"",phone:v||"",secondaryPhone:b||"",email:d||"",secondaryEmail:N||"",gender:D||"",age:p||"",status:F||V,appStatus:A||""}};h(c.pagination.tablePage),s(+c.pagination.tablePageSize),a({...c.filter}),f.setFieldsValue({...c.filter});const T={limit:c.pagination.tablePageSize,page:c.pagination.tablePage,role:(x=c.filter)==null?void 0:x.role,name:(_=c.filter)==null?void 0:_.name,apartment:(B=c.filter)==null?void 0:B.apartment,phone:(I=c.filter)==null?void 0:I.phone,secondaryPhone:(S=c.filter)==null?void 0:S.secondaryPhone,email:(M=c.filter)==null?void 0:M.email,secondaryEmail:(q=c.filter)==null?void 0:q.secondaryEmail,gender:(g=c.filter)==null?void 0:g.gender,age:(C=c.filter)==null?void 0:C.age,status:(U=c.filter)==null?void 0:U.status,appStatus:(z=c.filter)==null?void 0:z.appStatus};return l(T),c},setQueryParamsResident:({limit:e=X,page:m=Y,filter:k=W})=>{const{role:F="",name:n="",apartment:P="",phone:v="",secondaryPhone:b="",email:d="",secondaryEmail:N="",gender:D="",age:p="",status:A="",appStatus:c=""}=k;l({limit:e,page:m,role:F,name:n,apartment:P,phone:v,secondaryPhone:b,email:d,secondaryEmail:N,gender:D,age:p,status:A,appStatus:c})}}},Ct=()=>{const{residentPermissionWrite:o,residentPermissionExport:l,residentPermissionExportEncrypted:h,filterObject:s,setResidentState:a,tablePage:f,tablePageSize:u,selectAllRowComponent:E,tableSelection:e,resetDataTableSelection:m,showFormImportResident:k}=R.useContext(J),{setQueryParamsResident:F}=ae(),n=Ee(),P=ne(g=>g.resident.residentExportData),v=ne(g=>g.resident.totalResident),b=oe(),d=ke(),N=ye(),{idBuilding:D}=N,{selectedRowKeysCache:p,isSelectAllItem:A}=e,[c,T]=R.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),[x,_]=R.useState({code:void 0,codeLanguage:void 0});le(c.code,c.codeLanguage,{message:t.success,description:t.export_data_success}),le(x.code,x.codeLanguage,{message:t.success,description:t.delete_data_success},()=>{m();const g=A?Y:ve(v-p.length,u,f),C=f===g;C&&(a({isFetching:!0}),b(K({idBuilding:D,filter:{...s},limit:u,page:f,refreshState:()=>{a({isFetching:!1})}}))),C||F({limit:u,page:g,filter:{...s}})}),R.useEffect(()=>{P&&gt(P,document,"thong-tin-cu-dan.xlsx")},[P]);const B=()=>{k()},I=()=>{T({code:void 0,codeLanguage:void 0,isFetching:!0}),b(_t({idBuilding:D,filter:{...s},refreshState:({code:g,codeLanguage:C})=>{T({code:g,codeLanguage:C,isFetching:!1})}}))},S=()=>{ht({isAll:A,onCancel:()=>{_({code:void 0,codeLanguage:void 0})},onOk:g=>(_({code:void 0,codeLanguage:void 0}),new Promise((C,U)=>{b(Ie({idBuilding:D,idResidents:p,isAll:A,filter:{...s},refreshState:({code:z,codeLanguage:w})=>(_({code:z,codeLanguage:w}),z===200&&g(),C)}))})),questionText:`${t.do_you_want_to_delete_resident}?`,totalItem:p.length,delayTime:Je})},M=!A&&p.length===0,q=[o?j(ce,{css:g=>({marginRight:g.margin.xs}),disabled:M,type:"primary",onClick:()=>{n({action:Ce,label:ie}),S()},children:[r(H,{name:"icon-minus-circle-outlined"})," ",t.delete]},"delete"):null,l||h?r(ce,{type:"primary",ghost:!0,onClick:()=>{n({action:We,label:ie}),I()},loading:c.isFetching,disabled:c.isFetching,icon:r(H,{name:"icon-download-outlined"}),css:g=>({marginRight:g.margin.xs}),children:t.export},"export"):null,o?r(ce,{css:g=>({marginRight:g.margin.xs}),type:"primary",icon:r(H,{name:"icon-upload-outlined"}),onClick:()=>{n({action:Xe,label:ie}),B()},children:t.import},"import"):null,o?r(ce,{icon:r(H,{name:"icon-plus-circle-outlined"}),onClick:()=>{n({action:Ke,label:ie}),d.push(`/buildings/${D}/residents/add`)},type:"primary",children:t.add},"add"):null].filter(Boolean);return r(xe.ActionBox,{actions:q,total:E()})},Pt=()=>{const{filterObject:o,residentState:l,setResidentState:h,tablePage:s,tablePageSize:a,tableSelection:f,resetDataTableSelection:u,onSelectRow:E,onSelectAllRowOfPage:e,handleFilterChange:m,handleTablePageChange:k,handleTablePageSizeChange:F,residentPermissionWrite:n,residentPermissionRead:P,residentPermissionReadEncrypted:v}=R.useContext(J),b=Ee(),d=Me(),{layoutScrollRef:N}=R.useContext(Pe),{setQueryParamsResident:D}=ae(),{checkIsUsedIntegrate:p}=yt(),A=p(Et),c=ne(i=>i.resident.residents),T=ne(i=>i.resident.totalResident),x=oe(),_=ke(),B=ye(),{idBuilding:I}=B,{selectedRowKeys:S,isSelectAllItem:M}=f,[q,g]=R.useState({code:void 0,codeLanguage:void 0}),[C,U]=R.useState({code:void 0,codeLanguage:void 0});le(C.code,C.codeLanguage,{message:t.success,description:t.change_usage_app_status_success},()=>{h({isFetching:!0}),F(a),k(s),m(o),u(),x(K({idBuilding:I,filter:o,limit:a,page:s,refreshState:()=>{h({isFetching:!1})}}))}),le(q.code,q.codeLanguage,{message:t.success,description:t.delete_data_success},()=>{u();const i=M?Y:ve(T-1,a,s),y=s===i;y&&(h({isFetching:!0}),x(K({idBuilding:I,filter:{...o},limit:a,page:s,refreshState:()=>{h({isFetching:!1})}}))),y||D({limit:a,page:i,filter:{...o}})});const z=i=>{_e.confirm({cancelText:t.cancel,okText:t.confirm,title:t.confirm,content:`${t.do_you_want_to_delete_this_resident}?`,onOk:y=>(g({code:void 0,codeLanguage:void 0}),new Promise((Z,re)=>{x(Ie({idBuilding:I,idResidents:[i.id],isAll:!1,refreshState:({code:se,codeLanguage:ue})=>(g({code:se,codeLanguage:ue}),se===200&&y(),Z)}))})),afterClose:()=>{g({code:void 0,codeLanguage:void 0})}})},w=i=>{_e.confirm({cancelText:t.cancel,okText:t.confirm,title:t.confirm,content:`${t.do_you_want_to_change_the_usage_status_app_of_this_resident}?`,onOk:y=>(U({code:void 0,codeLanguage:void 0}),new Promise((Z,re)=>{x(Rt({idBuilding:I,idResident:i.id,refreshState:({code:se,codeLanguage:ue})=>(U({code:se,codeLanguage:ue}),se===200?Z():re())}))})),afterClose:()=>{U({code:void 0,codeLanguage:void 0})}})},de=(i,y)=>{y!==a&&D({limit:y,page:s,filter:{...o}})},we=i=>{i.current!==s&&D({limit:a,page:i.current,filter:{...o}})},fe=R.useMemo(()=>[{title:t.name,dataIndex:"fullName",key:"fullName",width:200,fixed:!0,ellipsis:!0},{title:t.unit,dataIndex:"apartment",key:"apartment",width:150,fixed:!0,ellipsis:!0},{title:t.role,dataIndex:"role",key:"role",width:117,ellipsis:!0},{title:t.phone,dataIndex:"phone",key:"phone",width:150,ellipsis:!0},{title:t.secondary_phone,dataIndex:"secondaryPhone",key:"secondaryPhone",width:150,ellipsis:!0},{title:t.email,width:250,dataIndex:"email",key:"email",ellipsis:!0},{title:t.secondary_email,width:250,dataIndex:"secondaryEmail",key:"secondaryEmail",ellipsis:!0},{title:t.birthday,width:131,dataIndex:"birthday",key:"birthday",render:i=>i&&!i.includes("*")?O(i).format(Q):i,ellipsis:!0},{title:t.gender,width:100,dataIndex:"gender",key:"gender",ellipsis:!0},{title:t.id_card_or_pass_port,dataIndex:"identifier",key:"identifier",width:150,ellipsis:!0},{title:t.id_of_temporary_residence,dataIndex:"temporaryRegistrationNumber",key:"temporaryRegistrationNumber",width:150,ellipsis:!0},{title:t.date_of_import_registration,width:131,dataIndex:"addedToFamilyRegisterDay",key:"addedToFamilyRegisterDay",render:i=>i&&O(i).format(Q),ellipsis:!0},{title:t.note,dataIndex:"note",key:"note",width:150,ellipsis:!0},{title:t.status1,width:150,dataIndex:"status",key:"status",render:i=>i===V?r(Re,{color:"green",children:t.active}):r(Re,{color:"red",children:t.deleted}),ellipsis:!0},{title:t.application_usage,width:150,dataIndex:"applicationUsageStatus",key:"applicationUsageStatus",render:(i,y)=>y.status===V?r(ge,{checked:i,disabled:!n||!y.isChangeUsedApp,onChange:()=>w(y.resident)}):r(ge,{disabled:!0,checked:!1}),ellipsis:!0},A?{title:t.intercom_usage,width:150,dataIndex:"isUsedIntercom",key:"isUsedIntercom",render:(i,y)=>r(ge,{disabled:!0,checked:i}),ellipsis:!0}:null,{title:t.actions,key:"action",fixed:"right",align:"center",width:110,render:(i,y)=>j(me,{children:[P||v?r(H,{title:t.detail,style:{fontSize:d.iconSize,marginRight:y.status===V?d.margin.xs:0},name:"icon-eye-outlined",onClick:()=>_.push(`/buildings/${I}/residents/${y.key}`)}):null,y.status===V?j(me,{children:[n&&v?r(H,{title:t.update,style:{marginRight:d.margin.xs,fontSize:d.iconSize},name:"icon-edit-outlined",onClick:()=>{b({action:Ze,label:ie}),_.push(`/buildings/${I}/residents/${y.key}/update`)}}):null,n?r(H,{title:t.delete,style:{fontSize:d.iconSize},name:"icon-minus-circle-outlined",onClick:()=>{b({action:Ce,label:ie}),z(y.resident)}}):null]}):null]})}].filter(Boolean),[]),Oe=R.useMemo(()=>c.map(i=>{var y,Z,re;return{id:i.id,key:i.id,fullName:i.fullName,apartment:((y=i==null?void 0:i.unit)==null?void 0:y.name)??"",role:((Z=et[i.role])==null?void 0:Z.name)??"",phone:i.phone||"",secondaryPhone:i.phoneNotUseApp||"",email:i.email||"",secondaryEmail:i.backupEmail||"",birthday:i.birthday,gender:((re=tt[i.gender])==null?void 0:re.name)??"",addedToFamilyRegisterDay:i.addedToFamilyRegisterDay,identifier:i.identifier||"",temporaryRegistrationNumber:i.temporaryRegistrationNumber,status:i.status||"",applicationUsageStatus:i.isUsedApp||!1,resident:i,note:i.note||"",isUsedIntercom:i.isUsedIntercom||!1,isChangeUsedApp:i.isChangeUsedApp||!1}}),[c]),Le=i=>{var y;return(y=i==null?void 0:i.resident)!=null&&y.deletedAt?"disabled":""},qe=i=>({disabled:(i==null?void 0:i.status)!==V}),Be={pageSize:a,defaultCurrent:1,current:s,total:T,showQuickJumper:!0,showSizeChanger:!0,onShowSizeChange:de};return r(me,{children:r(ft,{bordered:!0,sticky:{offsetScroll:d.offsetScrollX,getContainer:()=>N.current},onChange:we,columns:fe,dataSource:Oe,scroll:{x:fe.reduce((i,y)=>i+y.width,0)},loading:l.isFetching,rowClassName:Le,rowSelection:n?{selectedRowKeys:S,onSelect:E,onSelectAll:e,fixed:!0,getCheckboxProps:qe}:null,pagination:Be})})},Tt=()=>{const{setResidentState:o,resetDataTableSelection:l,idBuilding:h,tablePage:s,tablePageSize:a,formFilter:f,filterObject:u,residentPermissionReadEncrypted:E}=R.useContext(J),e=oe(),{setQueryParamsResident:m}=ae(),k=n=>{const{current:P}=s,{limit:v}=a,b=Fe(n,u);b&&(l(),o({isFetching:!0}),e(K({idBuilding:h,filter:{...n},limit:X,page:Y,refreshState:()=>{o({isFetching:!1})}}))),b||m({limit:v,page:P,filter:{...n}})},F=R.useMemo(()=>[{label:t.unit,key:"apartment",component:r(ee,{placeholder:t.unit}),visible:!0},{label:t.full_name,key:"name",component:r(ee,{placeholder:t.full_name}),visible:!0},E?{label:t.phone,key:"phone",component:r(ee,{placeholder:t.phone}),visible:!0}:null,E?{label:t.secondary_phone,key:"secondaryPhone",component:r(ee,{placeholder:t.secondary_phone}),visible:!0}:null,E?{label:t.email,key:"email",component:r(ee,{placeholder:t.email}),visible:!0}:null,E?{label:t.secondary_email,key:"secondaryEmail",component:r(ee,{placeholder:t.secondary_email}),visible:!0}:null,{label:t.status1,key:"status",component:r(L,{fluid:"true",placeholder:t.status1,getPopupContainer:n=>n.parentNode,children:it.map(n=>r(L.Option,{value:n.id,children:n.name},`status_${n.id}`))}),visible:!0},{label:t.status_used_app,key:"appStatus",component:r(L,{fluid:"true",placeholder:t.status_used_app,getPopupContainer:n=>n.parentNode,children:nt.map(n=>r(L.Option,{value:n.id,children:n.name},`status_${n.id}`))}),visible:!0},{label:t.role,key:"role",component:j(L,{fluid:"true",getPopupContainer:n=>n.parentNode,children:[r(L.Option,{value:"",children:t.all_role},"role_0"),ot.map(n=>r(L.Option,{value:n.id,children:n.name},n.id))]}),visible:!0},{label:t.gender,key:"gender",component:j(L,{fluid:"true",getPopupContainer:n=>n.parentNode,children:[r(L.Option,{value:"",children:t.all_gender},"gender_0"),Te.map(n=>r(L.Option,{value:n.id,children:n.name},n.id))]}),visible:!0},{label:t.age_range,key:"age",component:j(L,{fluid:"true",getPopupContainer:n=>n.parentNode,children:[r(L.Option,{value:"",children:t.all_age_range},"age_range_0"),rt.map(n=>r(L.Option,{value:n.id,children:n.name},n.id))]}),visible:!0}].filter(Boolean),[E]);return r(xe.FilterBox,{defaultFilter:{...W},onSearch:k,layout:"vertical",filters:F,formData:f})},kt=(o,l)=>{var a,f;const h=l==null?void 0:l[o==null?void 0:o.index],s={errorDescription:o!=null&&o.errorDescription&&((a=o==null?void 0:o.errorDescription)!=null&&a.length)?o==null?void 0:o.errorDescription:void 0,...h};if(s!=null&&s.errorDescription&&((f=s==null?void 0:s.errorDescription)!=null&&f.length))return s},vt=async({idBuilding:o,listData:l,isLast:h})=>{var s;try{const a={},f=l==null?void 0:l.map(e=>{var P,v;a[e==null?void 0:e.index]=e;const m=e==null?void 0:e.fullName.split(" "),k=(m==null?void 0:m[0])??"",F=m.length>1?m[m.length-1]:"",n=m.length>2?m.reduce((b,d,N)=>N>0&&N<m.length-1?`${b+d} `:b,"").trim():"";return{...e,lastName:k,firstName:F,middleName:n,gender:e!=null&&e.gender?(P=st[e==null?void 0:e.gender])==null?void 0:P.id:void 0,role:e!=null&&e.role?(v=lt[e==null?void 0:e.role])==null?void 0:v.id:void 0,idDate:e!=null&&e.idDate?O(e==null?void 0:e.idDate,Q).toDate():void 0,birthday:e!=null&&e.birthday?O(e==null?void 0:e.birthday,Q).toDate():void 0,addedToFamilyRegisterDay:e!=null&&e.addedToFamilyRegisterDay?O(e==null?void 0:e.addedToFamilyRegisterDay,Q).toDate():void 0,visaExpiredDay:e!=null&&e.visaExpiredDay?O(e==null?void 0:e.visaExpiredDay,Q).toDate():void 0,temporaryRegistrationDate:e!=null&&e.temporaryRegistrationDate?O(e==null?void 0:e.temporaryRegistrationDate,Q).toDate():void 0,temporaryRegistrationEnd:e!=null&&e.temporaryRegistrationEnd?O(e==null?void 0:e.temporaryRegistrationEnd,Q).toDate():void 0,rentDate:e!=null&&e.rentDate?O(e==null?void 0:e.rentDate,Q).toDate():void 0,rentDuedate:e!=null&&e.rentDuedate?O(e==null?void 0:e.rentDuedate,Q).toDate():void 0,email:(e==null?void 0:e.email)||void 0,backupEmail:(e==null?void 0:e.backupEmail)||void 0,unitName:(e==null?void 0:e.unitName)||void 0,identifier:(e==null?void 0:e.identifier)||void 0,idPlace:(e==null?void 0:e.idPlace)||void 0,address:(e==null?void 0:e.address)||void 0,phoneCode:(e==null?void 0:e.phoneCode)||void 0,phone:(e==null?void 0:e.phone)||void 0,note:(e==null?void 0:e.note)||void 0,relationship:(e==null?void 0:e.relationship)||void 0,temporaryRegistrationNumber:(e==null?void 0:e.temporaryRegistrationNumber)||void 0,visa:(e==null?void 0:e.visa)||void 0,taxCode:(e==null?void 0:e.taxCode)||void 0,company:(e==null?void 0:e.company)||void 0,nationality:(e==null?void 0:e.nationality)||void 0,occupation:(e==null?void 0:e.occupation)||void 0}}),u=await at({idBuilding:o,listData:f,isLast:h}),E=[];return(s=u==null?void 0:u.data)==null||s.forEach(e=>{const m=kt(e,a);m&&m.errorDescription&&E.push(m)}),{code:u==null?void 0:u.code,codeLanguage:u==null?void 0:u.codeLanguage,data:E}}catch(a){return{code:a==null?void 0:a.code,codeLanguage:a==null?void 0:a.codeLanguage,data:[]}}},{rules:xt}=Ne,{dateImportRule:$,stringImportRule:G,phoneImportRule:Se}=xt,he=100;var be;const It=[{name:"#",key:"index",rules:{type:"number",required:!0},isRequiredColumn:!0},{name:t.full_name,key:"fullName",rules:{type:"string",required:!0,max:250},isRequiredColumn:!0},{name:t.gender,key:"gender",rules:{required:!0,type:"enum",enum:(be=Te)==null?void 0:be.map(o=>o==null?void 0:o.name)},isRequiredColumn:!0},{name:t.birthday,key:"birthday",rules:$,isRequiredColumn:!0},{name:t.unit,key:"unitName",rules:{...G,required:!0},isRequiredColumn:!0},{name:t.role,key:"role",rules:{required:!0,type:"enum",enum:ct},isRequiredColumn:!0},{name:t.id_card_or_pass_port,key:"identifier",rules:[{validator:(o,l,h,s)=>{var f,u;return l&&(((f=l==null?void 0:l.toString())==null?void 0:f.length)<8||((u=l==null?void 0:l.toString())==null?void 0:u.length)>15)?new Error(t.identifier_must_be_between_8_and_15_characters):l&&!/^[a-zA-Z0-9]+$/.test(l)?new Error(t.identifier_must_contain_only_alphanumeric_characters):!0}}],isRequiredColumn:!0},{name:t.issue_identifier_at,key:"idPlace",rules:G,isRequiredColumn:!0},{name:t.issue_identifier_date,key:"idDate",rules:$,isRequiredColumn:!0},{name:t.phone_code,key:"phoneCode",rules:{type:"string",max:50},isRequiredColumn:!0},{name:t.phone1,key:"phone",rules:Se,isRequiredColumn:!0},{name:t.sub_phone_code,key:"phoneNotUseAppCode",rules:{type:"string",max:50},isRequiredColumn:!0},{name:t.label.secondary_phone,key:"phoneNotUseApp",rules:Se,isRequiredColumn:!0},{name:t.email,key:"email",rules:{type:"email",max:255},isRequiredColumn:!0},{name:t.label.secondary_email,key:"backupEmail",rules:{type:"email",max:255},isRequiredColumn:!0},{name:t.residential_address,key:"address",rules:G,isRequiredColumn:!0},{name:t.occupation,key:"occupation",rules:G,isRequiredColumn:!0},{name:t.nationality,key:"nationality",rules:G,isRequiredColumn:!0},{name:t.company,key:"company",rules:G,isRequiredColumn:!0},{name:t.tax_code,key:"taxCode",rules:G,isRequiredColumn:!0},{name:t.visa,key:"visa",rules:G,isRequiredColumn:!0},{name:t.issue_date_of_visa,key:"visaExpiredDay",rules:$,isRequiredColumn:!0},{name:t.entry_date_of_registration,key:"addedToFamilyRegisterDay",rules:$,isRequiredColumn:!0},{name:t.temporary_residence_card_no,key:"temporaryRegistrationNumber",rules:G,isRequiredColumn:!0},{name:t.registration_date_of_temporary_residence,key:"temporaryRegistrationDate",rules:[{...$},{validator:(o,l,h,s)=>l&&s[t.expiration_date_of_temporary_residence]&&O(s[t.expiration_date_of_temporary_residence],"DD/MM/YYYY").isBefore(O(l,"DD/MM/YYYY"))?new Error(t.status.registration_date_invalid):!0}],isRequiredColumn:!0},{name:t.expiration_date_of_temporary_residence,key:"temporaryRegistrationEnd",rules:$,isRequiredColumn:!0},{name:t.relation_with_householder,key:"relationship",rules:G,isRequiredColumn:!0},{name:t.label.rent_date,key:"rentDate",rules:[{...$},{validator:(o,l,h,s)=>l&&s[t.label.rent_due_date]&&O(s[t.label.rent_due_date],"DD/MM/YYYY").isBefore(O(l,"DD/MM/YYYY"))?new Error(t.rental_date_invalid):!0}],isRequiredColumn:!0},{name:t.label.rent_due_date,key:"rentDuedate",rules:$,isRequiredColumn:!0},{name:t.note,key:"note",rules:{type:"string",max:3e3},isRequiredColumn:!0}],Ae=o=>{const{handleTablePageSizeChange:l,handleTablePageChange:h,handleFilterChange:s,resetDataTableSelection:a,filterObject:f,tablePage:u,tablePageSize:E,setResidentState:e}=R.useContext(J),{isShow:m,idBuilding:k,onHide:F}=o,{setQueryParamsResident:n}=ae(),P=oe(),[v,b]=R.useState(0),[d,N]=R.useState({isFetching:!1,code:void 0,codeLanguage:void 0,totalSuccess:0,totalFailed:0,errors:[]});return le(d.code,d.codeLanguage,{message:t.success,description:t.import_data_success}),r(Ne,{headers:It,onClose:F,onOk:async p=>{var g;const{current:A}=u,{limit:c}=E;N({isFetching:!0,code:void 0,codeLanguage:void 0,totalSuccess:0,totalFailed:0,errors:[]});let T=[],x=0;const _={code:500,codeLanguage:null,errors:[]};let B=!1;for(let C=0;C<(p==null?void 0:p.length);C+=1){T.push(p[C]);const U=(p==null?void 0:p.length)%he;if((p.length<he||C===p.length-U)&&(B=!0),T.length===he||C===(p==null?void 0:p.length)-1){x+=T==null?void 0:T.length;const{code:z,codeLanguage:w,data:de}=await vt({idBuilding:k,listData:T,isLast:B});_.code=z,_.codeLanguage=w,_.errors=[..._.errors,...de],T=[],b(Math.floor(x*100/(p==null?void 0:p.length)))}}b(0),dt.includes(_.code)&&(l(X),h(1),s({...W}),a(),P(K({idBuilding:k,filter:W,limit:X,page:1,refreshState:()=>{}})));const I=(g=_==null?void 0:_.errors)==null?void 0:g.length,S=x-I;N({isFetching:!1,code:_.code,codeLanguage:_.codeLanguage,totalFailed:I,totalSuccess:S,errors:_==null?void 0:_.errors});const M={...W,status:V},q=Fe(M,f);a(),q&&A===Y&&(e({isFetching:!0}),P(K({idBuilding:k,limit:c,filter:{...f},page:Y,refreshState:()=>{e({isFetching:!1})}}))),(!q||A!==Y)&&n({limit:c,page:Y,filter:{...M}})},visible:m,fileNameTemplate:t.resident_info_template,code:d.code,codeLanguage:d.codeLanguage,loading:d.isFetching,numberSuccess:d==null?void 0:d.totalSuccess,numberFail:d==null?void 0:d.totalFailed,problemResponseServerDataSource:d==null?void 0:d.errors,percentImport:v})};Ae.propTypes={isShow:te.bool.isRequired,idBuilding:te.oneOfType([te.number,te.string]).isRequired,onHide:te.func.isRequired};const Ft=()=>{const{formImportResident:o,hideFormImportResident:l,idBuilding:h,setResidentState:s}=R.useContext(J),{getQueryParamsResident:a}=ae(),{search:f}=pt(),u=oe();return R.useEffect(()=>{(async()=>{if(h){const{pagination:E,filter:e}=a();f&&(s({isFetching:!0}),u(K({idBuilding:h,filter:e,limit:E.tablePageSize,page:E.tablePage,refreshState:()=>{s({isFetching:!1})}})))}})()},[f]),j("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[r(Tt,{}),j(pe,{style:{flex:1},children:[r(pe.Header,{children:r(Ct,{})}),r(pe.Content,{fluid:!0,children:r(Pt,{})})]}),o.isShow&&r(Ae,{onHide:l,isShow:o.isShow,idBuilding:h})]})},bn=()=>{const{setVisibleSearchBox:o,setTitlePage:l,setVisibleFilterBox:h}=R.useContext(Pe),s=oe();return R.useEffect(()=>(o(!0),l(t.resident),()=>{o(!1),h(!1),l(""),s(St())}),[]),r(De,{children:r(Ft,{})})};export{bn as default};
