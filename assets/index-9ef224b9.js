import{j as c,a as _,F as T,c as X}from"./@emotion-63839449.js";import{P as a}from"./prop-types-1172f4d5.js";import{r as g}from"./react-4fd50329.js";import{l as U,a as le,f as ae,b as H,u as se,e as ie,o as ce}from"./lodash-88fe09e6.js";import"./moment-a468e1f9.js";import{g as me,l as s,b5 as K,S as pe}from"./index-c2ded735.js";import{e as Q}from"./exportExcel-837be6ed.js";import{S as ue}from"./async-validator-dee29e8b.js";import{v as j}from"./index-687ba9e6.js";import"./file-saver-40cf32a9.js";import{T as W,a as de}from"./index-b17d22e5.js";import{r as ge,R as fe,a as be,b as he}from"./regex-deefadac.js";import{v as Y}from"./uuid-4a60fe23.js";import{a as F,j as M,A as L,B as S,P as ye,U as ve}from"./antd-f9eae174.js";const $={email:{vi:["quangvm@cyfeer.com","sangnl@cyfeer.com","longnh@cyfeer.com"],en:["quangvm@cyfeer.com","sangnl@cyfeer.com","longnh@cyfeer.com"]},phone:{vi:["0372992668","0372168488","0372168489"],en:["0372992668","0372168488","0372168489"]},unitName:{vi:["Căn hộ 101","Căn hộ 102","Căn hộ 103"],en:["Gorgeous Apartment","Loving Apartment","Polite Apartment"]},birthday:{vi:["09/05/2001","27/11/1997","28/03/2003"],en:["09/05/2001","27/11/1997","28/03/2003"]},fullName:{vi:["Vũ Minh Quang","Nguyễn Lâm Sang","Nguyễn Lâm Long"],en:["Peter Parker","Tommy Xiaomi","Adam Smith"]},occupation:{vi:["Giáo viên","Bác sĩ","Doanh nhân"],en:["Teacher","Doctor","Businessmen"]},nationality:{vi:["Việt Nam","Anh","Phần Lan"],en:["Vietnam","England","Finland"]},phoneCode:{vi:["+84","+44","+32"],en:["+84","+44","+32"]},code:{vi:["CODE-0001","CODE-0002","CODE-0003"],en:["CODE-0001","CODE-0002","CODE-0003"]},createdAt:{vi:["18/10/2023","27/11/2019","28/03/2023"],en:["18/10/2023","27/11/2019","28/03/2023"]},floor:{vi:["Tầng 1","Tầng 2","Tầng 3"],en:["1st Floor","2nd Floor","3rd Floor"]},serviceName:{vi:["Dịch vụ điện","Dịch vụ nước","Dịch vụ gửi xe","Dịch vụ dọn nhà"],en:["Electricity service","Water service","Parking service","Cleaning service"]},totalPayment:{vi:[2e5,3e5,4e5],en:[2e5,3e5,4e5]},adjustmentCreatedFor:{vi:["06/2023","07/2023","08/2023"],en:["06/2023","07/2023","08/2023"]},incurredCreatedFor:{vi:["10/2023","11/2023","12/2023"],en:["10/2023","11/2023","12/2023"]},reason:{vi:["Lý do A","Lý do B","Lý do C"],en:["Reason A","Reason B","Reason C"]},total:{vi:["500000","600000","700000"],en:["500000","600000","700000"]},note:{vi:["Cập nhật thông tin phí dịch vụ","Giá tiền gốc không còn phù hợp","Thay đổi gía tiền cho phù hợp hơn"],en:["Update information service fee","The original price is no longer suitable","Change the price to be more suitable"]},labels:{vi:["Nhãn A","Nhãn B","Nhãn C","Nhãn D"],en:["Label A","Label B","Label C","Label D"]}},_e=3,De=n=>{const o=[],i=me();for(let e=0;e<_e;e+=1){const r={};n.forEach(l=>{var b;const{key:m,rules:t}=l,{type:p}=t,u=(b=$==null?void 0:$[m])==null?void 0:b[i];switch(p){case"enum":{const f=t==null?void 0:t.enum;r[m]=f&&(f!=null&&f.length)?U.sample(f):"";break}case"date":case"string":case"email":case"number":{r[m]=u&&(u!=null&&u.length)?U.sample(u):"";break}default:{r[m]="";break}}}),o.push({...r,index:e+1})}return o},Te={...j,enum:s.validate.enum_file,types:{...j.types,email:s.validate.email_file}},xe=(n,o,i,e)=>{const r=Object.keys(o).map(l=>({name:l,errors:o[l].map(m=>{var p,u;let{message:t}=m;if(e[l].pattern&&(t=e[l].message,t=t.replace("${min}",((p=e[l])==null?void 0:p.min)||"").replace("${max}",((u=e[l])==null?void 0:u.max)||"")),e[l].type==="enum"){const b=e[l].enum.reduce((f,h,y)=>y===0?`${f}${h}`:`${f}, ${h}`,"");t=t.replace(/{enum}/,b)}return["number","string"].includes(e[l].type)&&(t=t.replace("${min}",e[l].min).replace("${max}",e[l].max)),t})}));return{row:i["#"],columns:r}},Fe=async(n,o)=>{const i=new ue(o);return i.messages(Te),(await Promise.all(n.map(async r=>{try{return await i.validate(r),null}catch({errors:l,fields:m}){return xe(l,m,r,o)}}))).filter(Boolean)},G=({headers:n,data:o,isErrorFile:i=!1})=>{const e=[],r=[];if((o==null?void 0:o.length)>0)for(let l=0;l<(o==null?void 0:o.length);l+=1){const m=[],t=o==null?void 0:o[l];n==null||n.forEach(p=>{r!=null&&r.includes(p==null?void 0:p.name)||r.push(p==null?void 0:p.name),m.push((t==null?void 0:t[p==null?void 0:p.key])??"")}),i&&m.push((t==null?void 0:t.errorDescriptions)??""),e.push(m)}return i&&r.push(s.label.problem),e.unshift([...r]),e},Ce=n=>{var i,e;const o=(e=(i=n==null?void 0:n.errorDescription)==null?void 0:i.map(r=>K[r]||s.error.data_invalid))==null?void 0:e.join(", ");return{...n,errorDescriptions:o}},w=g.createContext(null),A=n=>{const{visible:o,children:i,headers:e,code:r,codeLanguage:l,loading:m,numberSuccess:t,numberFail:p,onClose:u,onOk:b,fileNameTemplate:f,onDownloadTemplateFile:h,problemResponseServerDataSource:y,templateFileData:d,percentImport:v,loadingTemplateFile:C}=n,[E,N]=g.useState([]),[x,P]=g.useState([]),[k,I]=g.useState([]),[Z,z]=g.useState(!1),[q,O]=g.useState(!1),J=D=>N(D),ee=D=>P(D),R=y==null?void 0:y.map(D=>Ce(D)),ne=g.useMemo(()=>G({headers:e,data:R,isErrorFile:!0}),[R]),te=d!=null&&d.length?d:De(e),oe=g.useMemo(()=>C||q,[C,q]),re={visible:o,headers:e,problemClientDataSource:E,changeProblemClientDataSource:J,code:r,codeLanguage:l,loading:m,numberSuccess:t,numberFail:p,fileList:x,changeFileList:ee,onClose:u,onUpload:()=>{x.length>0&&(b(k),z(!0))},onDownloadTemplateFile:()=>{if(O(!0),h){h(),O(!1);return}Q(G({headers:(e==null?void 0:e.filter(({isRequiredColumn:D})=>D))||[],data:te??[]}),"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8",f||"file-mau",".xlsx"),O(!1)},isUploaded:Z,dataInExcel:k,setDataInExcel:I,problemResponseServerDataSource:R,errorFileData:ne,percentImport:v,loadingDownloadTemplateFile:oe};return c(w.Provider,{value:re,children:i})};A.propTypes={visible:a.bool.isRequired,onClose:a.func.isRequired,onOk:a.func.isRequired,children:a.node,headers:a.arrayOf(a.any).isRequired,code:a.number,codeLanguage:a.string,loading:a.bool,numberSuccess:a.number,numberFail:a.number,fileNameTemplate:a.string,onDownloadTemplateFile:a.func,problemResponseServerDataSource:a.arrayOf(a.any),templateFileData:a.arrayOf(a.any),percentImport:a.number,loadingTemplateFile:a.bool};A.defaultProps={children:null,loading:!1,code:null,codeLanguage:null,numberSuccess:0,numberFail:0,fileNameTemplate:"",onDownloadTemplateFile:void 0,problemResponseServerDataSource:[],templateFileData:[],percentImport:0,loadingTemplateFile:!1};const Se=()=>{const{problemClientDataSource:n}=g.useContext(w),o=[{title:s.label.row,dataIndex:"row",key:"row",width:150},{title:s.label.column,dataIndex:"column",key:"column",width:"30%"},{title:s.label.problem,dataIndex:"problem",key:"problem"}],i=g.useMemo(()=>n.map(e=>{const r=e.row||Y();return{...e,key:r,columns:e.columns.map(l=>({key:`${r}-${l.name}`,column:l.name,problem:l.errors.map((m,t)=>_("div",{children:[_(F.Text,{children:[t+1,". ",m]}),c("br",{})]},Y()))}))}}),[n]);return c(T,{children:n.length>0&&c(W,{bordered:!0,columns:o,dataSource:i,expandable:{childrenColumnName:["columns"]}})})},we=X(S,{target:"e14r8ec00"})({name:"plcayk",styles:"padding-left:3px;padding-right:3px"}),Ee=[{title:s.label.row,width:150,dataIndex:"row",key:"row"},{title:s.label.problem,dataIndex:"problem",key:"problem"}],ke=()=>{const{code:n,codeLanguage:o,numberSuccess:i,numberFail:e,errorFileData:r,problemResponseServerDataSource:l}=g.useContext(w),[m,t]=g.useState(""),[p,u]=g.useState(!1),b=g.useMemo(()=>l==null?void 0:l.map(h=>({key:h.index,row:h.index,problem:h==null?void 0:h.errorDescriptions})),[l]);g.useEffect(()=>{n?(u(!0),pe.includes(n)?t(""):t(K[o||"FAIL"])):u(!1)},[n]);const f=()=>{r&&Q(r,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8","file-error",".xlsx")};return c(T,{children:p&&c(T,{children:m?_(T,{children:[c(M,{orientation:"left",children:c(F.Title,{level:4,children:s.label.server_response})}),c(L,{type:"error",message:m})]}):_(T,{children:[c(M,{orientation:"left",children:c(F.Title,{level:4,children:s.label.server_response})}),e===0?c(L,{type:"success",message:s.alert_response_server_import_file1.replace("{numberSuccess}",i)}):_(T,{children:[c(L,{type:"warning",message:s.alert_response_server_import_file.replace("{numberSuccess}",i).replace("{numberFail}",e)}),c(M,{orientation:"left",children:c(F.Title,{level:4,children:s.label.solution})}),_(F.Paragraph,{children:["1.",c(we,{type:"link",onClick:f,children:s.label.click_here}),s.label.to_download_a_list_not_imported.toLowerCase()]}),_(F.Paragraph,{children:["2. ",s.label.solve_the_problem_table_below_based_on_the_downloaded_file]}),c(W,{columns:Ee,dataSource:b,bordered:!0})]})]})})})},{Dragger:Le}=ve,Ne=X(Le,{target:"e88yt8l0"})({name:"prl6hc",styles:"height:15vh!important"}),Pe=n=>{const o=n.type==="application/vnd.ms-excel"||n.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";if(!o)throw"You can only upload XLS/XLSX file!";return o},Ie=(n,o)=>{const i=[];n.forEach(r=>{(r==null?void 0:r.isRequiredColumn)!==!1&&i.push(r.name)});const e=le.difference(i,o);if(e.length>0)throw`${s.status.file_missing_or_wrong_column} <strong>${e.join(", ")}</strong>`},Oe=(n,o)=>{const i=ae(n,e=>{var r;return(r=e==null?void 0:e.rules)==null?void 0:r.unique}).map(e=>e.name);H(i,e=>{if(se(o,e).length!==o.length){let r=ie.groupBy(o,e);r=ce.pickBy(r,(m,t)=>m.length>1&&t!=="undefined");const l=Object.keys(r);if(l.length)throw`${s.label.column} <strong>${e}</strong>: ${s.status.data_duplicate} 
            <strong>${l.join(", ")}</strong>`}})},Re=n=>{if((n==null?void 0:n.length)>5e3)throw`<b>${s.status.the_file_is_limited_to_a_maximum_of_5000_rows}</b>`},V=(n,o)=>{if(n!=null)switch(o){case"number":return Number(n);case"string":return String(n).trim();case"date":return String(n);default:return Number.isNaN(n)&&typeof n=="string"?String(n).trim():!Number.isNaN(n)&&typeof n=="number"?Number(n):n}},Me=(n,o)=>{const i=[],e=[];return o==null||o.forEach(r=>{const l={...r},m={...l};H(n,t=>{var p,u;m[t.name]=V(r[t.name],(p=t==null?void 0:t.rules)==null?void 0:p.type),l[t.key]=l[t.name],l[t.key]=V(r[t.name],(u=t==null?void 0:t.rules)==null?void 0:u.type),delete l[t.name]}),i.push(m),e.push(l)}),[i,e]},$e=()=>{const{headers:n,changeProblemClientDataSource:o,fileList:i,changeFileList:e,onDownloadTemplateFile:r,isUploaded:l,setDataInExcel:m,percentImport:t,loadingDownloadTemplateFile:p}=g.useContext(w),[u,b]=g.useState(""),f=g.useMemo(()=>n.reduce((d,v)=>({...d,[v.name]:v.rules}),{}),[n]),h=async d=>{var v,C;try{if(((v=d==null?void 0:d.file)==null?void 0:v.status)!=="removed"){if(Pe(d.file))if(((C=d==null?void 0:d.fileList)==null?void 0:C.length)>0){const{headers:N,data:x}=await ge(d.file);Re(x),Ie(n,N),Oe(n,x);const[P,k]=Me(n,x);m(k);const I=await Fe(P,f);o(I),e([d.file])}else o([]),e([]);b("")}else o([]),e([])}catch(E){b(E)}},y=()=>!1;return _(T,{children:[p?c("div",{css:d=>({marginTop:d.margin.xs,marginBottom:d.margin.xs}),children:s.the_system_is_downloading_data_please_wait_until_the_file_is_downloaded_successfully}):c(S,{type:"link",onClick:r,children:s.label.download_template_file}),_(Ne,{accept:".xlsx,.xls",name:"file",onChange:h,beforeUpload:y,fileList:i,disabled:l,children:[c("p",{className:"ant-upload-text",children:s.label.click_or_drag_file_to_this_area_to_upload}),c("p",{className:"ant-upload-hint",children:s.support_file_import_data})]}),t?c(ye,{strokeColor:{from:"#108ee9",to:"#87d068"},percent:t,status:"active",style:{marginTop:"12px"}}):null,u&&c(L,{type:"error",message:c("div",{dangerouslySetInnerHTML:{__html:u}}),style:{marginTop:"12px"}}),c(Se,{}),c(ke,{})]})},Ae=()=>{const{onClose:n,onUpload:o,fileList:i,loading:e,code:r,numberFail:l,problemClientDataSource:m,problemResponseServerDataSource:t,isUploaded:p}=g.useContext(w),u=g.useMemo(()=>i.length===0||m.length||t.length?!0:r&&l===0,[i,r,l,m,t]),b=g.useMemo(()=>p?[c(S,{onClick:n,type:"primary",loading:e,disabled:e,children:s.complete},"complete")]:[c(S,{onClick:n,children:s.cancel},"cancel"),c(S,{type:"primary",loading:e,onClick:o,disabled:u,children:s.import},"submit")],[p,u,e]);return c(de,{title:s.label.import_data,open:!0,onOk:o,onCancel:!e&&n,okText:s.import,cancelText:s.cancel,okButtonProps:{disabled:u},width:"60%",maskClosable:!1,bodyStyle:{paddingTop:0},confirmLoading:e,footer:b,children:c($e,{})})},Be={type:"string",pattern:fe,message:`${s.status.date_invalid} (${s.label.valid}: DD/MM/YYYY)`},qe={type:"string",pattern:be,message:`${s.status.date_invalid} (${s.label.valid}: MM/YYYY)`},Ue={type:"string",pattern:he,message:s.label.invalid,max:15},je={type:"string",max:255},Ye={dateImportRule:Be,stringImportRule:je,phoneImportRule:Ue,monthImportRule:qe},B=n=>{const{visible:o,onClose:i,onOk:e,headers:r,code:l,codeLanguage:m,loading:t,numberSuccess:p,numberFail:u,problemResponseServerDataSource:b,fileNameTemplate:f,onDownloadTemplateFile:h,percentImport:y,templateFileData:d,loadingTemplateFile:v}=n;return c(A,{visible:o,onClose:i,onOk:e,headers:r,code:l,codeLanguage:m,loading:t,numberSuccess:p,numberFail:u,problemResponseServerDataSource:b,fileNameTemplate:f,onDownloadTemplateFile:h,percentImport:y,templateFileData:d,loadingTemplateFile:v,children:c(Ae,{})})};B.propTypes={visible:a.bool.isRequired,onClose:a.func.isRequired,onOk:a.func.isRequired,headers:a.arrayOf(a.any).isRequired,code:a.number,codeLanguage:a.string,loading:a.bool,numberSuccess:a.number,numberFail:a.number,problemResponseServerDataSource:a.arrayOf(a.any),fileNameTemplate:a.string,onDownloadTemplateFile:a.func,templateFileData:a.arrayOf(a.any),percentImport:a.number,loadingTemplateFile:a.bool};B.defaultProps={loading:!1,code:null,codeLanguage:null,numberSuccess:0,numberFail:0,problemResponseServerDataSource:[],fileNameTemplate:"",onDownloadTemplateFile:void 0,templateFileData:[],percentImport:0,loadingTemplateFile:!1};B.rules=Ye;export{B as I};
