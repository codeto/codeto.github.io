import{j as e,F as Te,a as h,u as qe,c as Ee,b as q}from"./@emotion-63839449.js";import{P as ce,N as Z,l as pe,D as be,k as Ie,a as le,d as xt,w as tt,T as Ot,e as Yt}from"./index-b17d22e5.js";import{l as t,by as at,a9 as G,s as J,cP as je,b0 as kt,K as de,aY as ut,at as Lt,bv as Bt,ax as Mt,f_ as Ut,h7 as Vt,I as z,h8 as Dt,a1 as pt,a as ht,h9 as Ht,ha as zt,hb as jt,hc as $t,hd as Gt,he as qt,hf as Qt,a0 as Ue,S as Qe,c6 as ie,hg as Wt,dk as Jt,hh as Xt,hi as Kt,h as ze,gb as gt,cf as ft,hj as Zt,b1 as ea,hk as ta}from"./index-c2ded735.js";import"./lodash-88fe09e6.js";import{h as _}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import{r as E}from"./react-4fd50329.js";import{d as aa}from"./downloadFileFromUrl-79614833.js";import"./react-redux-896b353b.js";import{F as f,u as Ae}from"./index-687ba9e6.js";import"./@firebase-43527ee1.js";import{P as ge}from"./prop-types-1172f4d5.js";import{u as Pe,a as ia}from"./react-router-a4308f7b.js";import{B as se,T as oe,w as na,a as D,b as v,A as _t,R as H,I as dt,j as oa,n as We,S as St,c as yt}from"./antd-f9eae174.js";import{I as te,S as ne}from"./index-43183512.js";import{c as it}from"./compareObject-7b349d22.js";import{u as sa}from"./useQuery-d54d310a.js";import{g as ra}from"./getPageByTotalAndLimit-7f60b558.js";import{P as Ce}from"./index-d2c5b7c0.js";import{F as la}from"./file-8888dc2a.js";import{T as da}from"./index-dac0556c.js";import{u as ca,g as ma,a as ua}from"./buildingConfig-5e834703.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./index-881eef42.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./classnames-4ba1ba1a.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./@tinymce-4731cc9d.js";const pa="NO_DEPOSIT",Tt="WAIT_FOR_DEPOSIT",nt="DEPOSITED",ha="REFUNDED",Ct=[{label:t.no_deposit_yet,value:pa,color:"default"},{label:t.wait_for_deposit,value:Tt,color:"orange"},{label:t.deposited,value:nt,color:"green"},{label:t.refunded,value:ha,color:"blue"}],Ke=at(Ct,"value"),re="WAITING_FOR_APPROVED",me="APPROVED",Fe="IN_PROGRESS",xe="COMPLETED",fe="CANCELLED",$e="REJECTED",ot="ALL",Ze=[{label:t.waiting_for_approved,value:re},{label:t.approved,value:me},{label:t.constructing,value:Fe},{label:t.completed,value:xe},{label:t.canceled,value:fe},{label:t.rejected,value:$e},{label:t.all,value:ot}],Ne=at(Ze,"value"),_e={estimatedStartTime:[],actualStartTime:[],unitName:"",code:"",constructorName:"",depositStatus:""},ct="EMPLOYEE",mt="RESIDENT",Xe={[ct]:{label:t.employee,value:ct},[mt]:{label:t.resident,value:mt}},Oe="APPROVE",Ye="REJECT",ke="IN_PROGRESS",Le="COMPLETED",Be="DEPOSIT",Me="REFUND",ga="ACCEPTANCE",Ge="REMOVE",st="CONSTRUCTION_REGISTRATION",fa="create",_a="update",Sa="approved",ya="in_progress",Ta="completed",Ca="cancelled",wa=[{label:t.add,value:fa},{label:t.update,value:_a},{label:t.approve,value:Sa},{label:t.in_progress,value:ya},{label:t.complete,value:Ta},{label:t.button.cancel,value:Ca}],va=at(wa,"value"),K=E.createContext({idBuilding:void 0,tableData:{records:[],totalRecord:0},setTableData:()=>{},getsStatus:{isFetching:!1},setGetsStatus:()=>{},filter:{..._e},setFilter:()=>{},tablePagination:{current:G,limit:J},setTablePagination:()=>{},tableSelection:()=>{},formDetailData:{isShow:!1,data:{}},hideFormDetail:()=>{},showFormDetail:()=>{},showFormAdd:()=>{},hideFormAdd:()=>{},showFormUpdateStatus:()=>{},formUpdateStatusData:{isShow:!1,data:{}},hideFormUpdateStatus:()=>{},status:re,setStatus:()=>{},constructionSetting:{autoApprove:!1,status:je,id:null},setConstructionSetting:()=>{},formConfigData:{isShow:!1,data:{}},showFormConfig:()=>{},hideFormConfig:()=>{},formAgreeTermsData:{isShow:!1,data:{}},showAgreeTerms:()=>{},hideAgreeTerms:()=>{},formUpdateData:{isShow:!1,data:{}},showFormUpdate:()=>{},hideFormUpdate:()=>{},constructionPermissionWrite:!1,constructionPermissionApprove:!1,constructionPermissionUpdateStatus:!1,formFilter:void 0,formShowRegulation:{isShow:!1,data:{}},hideFormRegulation:()=>{},showFormRegulation:()=>{},formHistoryConstruction:{isShow:!1,data:{}},showFormHistoryConstruction:()=>{},hideFormHistoryConstruction:()=>{},dataHistory:[],setDataHistory:()=>{},formUpdateConstruction:{isShow:!1,data:{}},showFormUpdateConstruction:()=>{},hideFormUpdateConstruction:()=>{},formConfirmExit:!1,setFormConfirmExit:()=>{}}),rt=({children:a})=>{const s=Pe(),{idBuilding:i}=s,{getPermissionByModuleCode:r}=kt(),[n]=f.useForm(),[l,o]=E.useState({isFetching:!1}),[c,p]=E.useState({..._e}),[w,y]=E.useState({current:G,limit:J}),[S,b]=E.useState({records:[],totalRecord:0}),[T,C]=E.useState(re),[P,F,m]=de(),[I,d,u]=de(),[g,j,$]=de(),[U,Q,X]=de(),[N,Y,O]=de(),[M,k,A]=de(),[V,L,x]=de(),[R,B]=E.useState({autoApprove:!1,status:!0,id:null,regulation:""}),[W,Se]=E.useState([]),[Ve,ee]=E.useState(!1),[ue,ve,De]=de(),[He,bt,Et]=de(),ae=r(ut),At=(ae==null?void 0:ae[Lt])??!1,Pt=(ae==null?void 0:ae[Bt])??!1,Rt=(ae==null?void 0:ae[Mt])??!1,Nt=(ae==null?void 0:ae[Ut])??!1,It={idBuilding:i,tableData:S,setTableData:b,getsStatus:l,setGetsStatus:o,filter:c,setFilter:p,tablePagination:w,setTablePagination:y,constructionSetting:R,setConstructionSetting:B,formDetailData:I,showFormDetail:d,hideFormDetail:u,formUpdateStatusData:g,showFormUpdateStatus:j,hideFormUpdateStatus:$,status:T,setStatus:C,formAddData:P,showFormAdd:F,hideFormAdd:m,formConfigData:U,showFormConfig:Q,hideFormConfig:X,formAgreeTermsData:N,showFormAgreeTerms:Y,hideFormAgreeTerms:O,formUpdateData:M,showFormUpdate:k,hideFormUpdate:A,formFilter:n,constructionPermissionExport:Pt,constructionPermissionWrite:At,constructionPermissionApprove:Rt,constructionPermissionUpdateStatus:Nt,formShowRegulation:V,showFormRegulation:L,hideFormRegulation:x,dataHistory:W,setDataHistory:Se,formHistoryConstruction:ue,showFormHistoryConstruction:ve,hideFormHistoryConstruction:De,formUpdateConstruction:He,showFormUpdateConstruction:bt,hideFormUpdateConstruction:Et,formConfirmExit:Ve,setFormConfirmExit:ee};return e(K.Provider,{value:It,children:a})};rt.propTypes={children:ge.node};rt.defaultProps={children:e("div",{})};const Fa=rt,ba=async(a,s)=>{const{estimatedStartTime:i=void 0,actualStartTime:r=void 0,unitName:n=void 0,code:l=void 0,constructorName:o=void 0,depositStatus:c=void 0,status:p=void 0}=a,w={unitName:n||void 0,code:l||void 0,constructorName:o||void 0,depositStatus:c||void 0,status:p===ot?void 0:p};i&&i.length>1&&(w.estimatedStartTime=_(i[0]).startOf("day").toDate(),w.estimatedEndTime=_(i[1]).endOf("day").toDate()),r&&r.length>1&&(w.actualStartTime=_(r[0]).startOf("day").toDate(),w.actualEndTime=_(r[1]).endOf("day").toDate());const y=await Vt(w,s);return{data:y.data,code:y.code}},Ea=()=>{const a=Pe(),{idBuilding:s}=a,{filter:i,tableData:r,status:n,showFormAdd:l,showFormConfig:o,constructionPermissionWrite:c,constructionPermissionExport:p,constructionPermissionApprove:w}=E.useContext(K),[y,S]=E.useState({code:void 0,codeLanguage:void 0,isFetching:!1});Ae(y.code,y.codeLanguage,{message:t.success,description:t.export_data_success});const b=async()=>{S({code:void 0,codeLanguage:void 0,isFetching:!0});const F=await ba({...i,status:n},s);F.data&&aa(F.data,document,"Don-dang-ky-thi-cong.xlsx"),S({code:F.code,codeLanguage:F.codeLanguage,isFetching:!1})},{totalRecord:T}=r;return{onClickBtnExportDataConstruction:b,totalRecord:T,constructionExportState:y,onClickBtnAdd:()=>{l()},onClickBtnConfig:()=>{o()},constructionPermissionWrite:c,constructionPermissionExport:p,constructionPermissionApprove:w}},Aa=()=>{const{onClickBtnExportDataConstruction:a,totalRecord:s,constructionExportState:i,onClickBtnAdd:r,onClickBtnConfig:n,constructionPermissionWrite:l,constructionPermissionExport:o,constructionPermissionApprove:c}=Ea(),p=[c?e(se,{onClick:n,type:"primary",ghost:!0,icon:e(z,{name:"icon-setting-outlined"}),css:w=>({marginRight:w.margin.xs}),children:t.setting},"setting"):null,o?e(se,{type:"primary",ghost:!0,loading:i.isFetching,icon:e(z,{name:"icon-download-outlined"}),onClick:a,css:w=>({marginRight:w.margin.xs}),children:t.export},"export"):null,l?e(se,{onClick:r,type:"primary",icon:e(z,{name:"icon-plus-circle-outlined"}),children:t.add},"add"):null].filter(Boolean);return e(ce.ActionBox,{total:e(Te,{children:s}),actions:p})},we=()=>{const{getAllQuery:a,setQuery:s}=sa(),{setTablePagination:i,setStatus:r,setFilter:n,formFilter:l}=E.useContext(K);return{getQueryParamsConstruction:()=>{var g,j,$,U;const{limit:p,page:w,status:y,depositStatus:S,code:b,unitName:T,constructorName:C,estimatedStartTimeFrom:P,estimatedStartTimeTo:F,actualStartTimeFrom:m,actualStartTimeTo:I}=a(),d={pagination:{limit:p&&+p||J,page:w&&+w||G},status:y||re,filter:{code:b||"",unitName:T||"",constructorName:C||"",estimatedStartTime:P&&F&&_(P,"DD/MM/YYYY",!0).isValid()&&_(F,"DD/MM/YYYY",!0).isValid()?[_(P,"DD/MM/YYYY"),_(F,"DD/MM/YYYY")]:[],actualStartTime:m&&I&&_(m,"DD/MM/YYYY",!0).isValid()&&_(I,"DD/MM/YYYY",!0).isValid()?[_(m,"DD/MM/YYYY"),_(I,"DD/MM/YYYY")]:[],depositStatus:S||""}};i({limit:d.pagination.limit,current:d.pagination.page}),r(d.status),n({...d.filter}),l.setFieldsValue({...d.filter});const u={limit:d.pagination.limit,page:d.pagination.page,status:d.status,code:(g=d.filter)==null?void 0:g.code,unitName:(j=d.filter)==null?void 0:j.unitName,constructorName:($=d.filter)==null?void 0:$.constructorName,depositStatus:(U=d.filter)==null?void 0:U.depositStatus,estimatedStartTimeFrom:"",estimatedStartTimeTo:"",actualStartTimeFrom:"",actualStartTimeTo:""};return Array.isArray(d.filter.estimatedStartTime)&&d.filter.estimatedStartTime.length&&(u.estimatedStartTimeFrom=_(d.filter.estimatedStartTime[0]).format("DD/MM/YYYY"),u.estimatedStartTimeTo=_(d.filter.estimatedStartTime[1]).format("DD/MM/YYYY")),Array.isArray(d.filter.actualStartTime)&&d.filter.actualStartTime.length&&(u.actualStartTimeFrom=_(d.filter.actualStartTime[0]).format("DD/MM/YYYY"),u.actualStartTimeTo=_(d.filter.actualStartTime[1]).format("DD/MM/YYYY")),s(u),d},setQueryParamsConstruction:({limit:p=J,page:w=G,status:y=re,filter:S=_e})=>{const{code:b="",unitName:T="",constructorName:C="",estimatedStartTime:P=null,actualStartTime:F=null,depositStatus:m=""}=S,I={limit:p,page:w,status:y,code:b,unitName:T,constructorName:C,depositStatus:m,estimatedStartTimeFrom:"",estimatedStartTimeTo:"",actualStartTimeFrom:"",actualStartTimeTo:""};Array.isArray(P)&&P.length&&(I.estimatedStartTimeFrom=_(P[0]).format("DD/MM/YYYY"),I.estimatedStartTimeTo=_(P[1]).format("DD/MM/YYYY")),Array.isArray(F)&&F.length&&(I.actualStartTimeFrom=_(F[0]).format("DD/MM/YYYY"),I.actualStartTimeTo=_(F[1]).format("DD/MM/YYYY")),s(I)}}},Pa=(a,s)=>{var S,b,T,C,P,F,m,I,d,u,g,j,$,U;const{createdAt:i,estimatedStartTime:r,estimatedEndTime:n,actualStartTime:l,actualEndTime:o}=a,c=(b=(S=a==null?void 0:a.changeStatusBy)==null?void 0:S[me])==null?void 0:b.time,p=(C=(T=a==null?void 0:a.changeStatusBy)==null?void 0:T[fe])==null?void 0:C.time,w=(m=Xe==null?void 0:Xe[(F=(P=a==null?void 0:a.changeStatusBy)==null?void 0:P[fe])==null?void 0:F.type])==null?void 0:m.label,y=s?"***":(d=(I=a==null?void 0:a.changeStatusBy)==null?void 0:I[fe])==null?void 0:d.name;return{key:a.id,id:a.id,code:a==null?void 0:a.code,status:a==null?void 0:a.status,type:((u=Ke[a==null?void 0:a.depositStatus])==null?void 0:u.label)??"",estimatedStartTimeOrigin:r??"",estimatedEndTimeOrigin:n??"",estimatedStartTime:`${r?_(r).format(Z):""}`,estimatedEndTime:`${n?_(n).format(Z):""}`,actualStartTime:`${l?_(l).format(Z):""}`,actualEndTime:`${o?_(o).format(Z):""}`,createdAt:i?_(i).format(Z):"-",approvedAt:c?_(c).format(Z):"-",canceledAt:p?_(p).format(Z):"-",cancelBy:w,canceler:y,registrantFullName:s?"***":((g=a==null?void 0:a.resident)==null?void 0:g.fullName)??"",changeStatus:a==null?void 0:a.changeStatus,constructorName:s?"***":a==null?void 0:a.constructorName,constructorPhone:s?"***":a==null?void 0:a.constructorPhone,deletedAt:a==null?void 0:a.deletedAt,depositStatus:a==null?void 0:a.depositStatus,depositValue:(a==null?void 0:a.depositValue)??0,depositColor:((j=Ke[a==null?void 0:a.depositStatus])==null?void 0:j.color)??"",description:a==null?void 0:a.description,employee:a==null?void 0:a.employee,employeeFiles:(a==null?void 0:a.employeeFiles)??[],employeeId:a==null?void 0:a.employeeId,employeeNote:a==null?void 0:a.employeeNote,reason:a==null?void 0:a.reason,refundValue:(a==null?void 0:a.refundValue)??0,rejectedAt:a==null?void 0:a.rejectedAt,resident:($=a==null?void 0:a.fullName)==null?void 0:$.resident,residentFiles:(a==null?void 0:a.residentFiles)??[],residentId:a==null?void 0:a.residentId,residentNote:a==null?void 0:a.residentNote,unit:a==null?void 0:a.unit,unitGroup:a==null?void 0:a.unitGroup,unitGroupId:a==null?void 0:a.unitGroupId,unitId:(a==null?void 0:a.unitId)??"",unitName:((U=a==null?void 0:a.unit)==null?void 0:U.name)??"",updatedAt:a==null?void 0:a.updatedAt,userId:a==null?void 0:a.userId}},Ra=async({filter:a,limit:s,page:i,idBuilding:r,isUserCs:n})=>{const{estimatedStartTime:l=void 0,actualStartTime:o=void 0,unitName:c=void 0,code:p=void 0,constructorName:w=void 0,depositStatus:y=void 0,status:S=void 0}=a,b={unitName:c||void 0,code:p||void 0,constructorName:w||void 0,depositStatus:y||void 0,status:S===ot?void 0:S};(l==null?void 0:l.length)>1&&(b.estimatedStartTime=_(l[0]).startOf("day").toDate(),b.estimatedEndTime=_(l[1]).endOf("day").toDate()),(o==null?void 0:o.length)>1&&(b.actualStartTime=_(o[0]).startOf("day").toDate(),b.actualEndTime=_(o[1]).endOf("day").toDate());const T=await Dt({filter:b,limit:s,page:i,idBuilding:r}),C=T.data.map(F=>Pa(F,n)),P=(T==null?void 0:T.totalRecord)??0;return[C,P]},Re=()=>{const{setTableData:a,idBuilding:s,setGetsStatus:i}=E.useContext(K),{isUserCs:r}=pt();return[async({filter:l,limit:o,page:c})=>{i({isFetching:!0});const[p,w]=await Ra({filter:l,limit:o,page:c,idBuilding:s,isUserCs:r});a({records:p,totalRecord:w}),i({isFetching:!1})}]},Na=()=>{const{filter:a,status:s,formFilter:i,tablePagination:r}=E.useContext(K),{setQueryParamsConstruction:n}=we(),[l]=Re();return{onSearch:async c=>{const p=it(c,a);p&&await l({filter:{...c,status:s},limit:r.limit,page:r.current}),p||n({limit:J,page:G,filter:{...c},status:s})},defaultFilter:_e,formFilter:i}},Ia=()=>{const{onSearch:a,defaultFilter:s,formFilter:i}=Na(),r=E.useMemo(()=>[{label:t.registration_code,key:"code",component:e(te,{placeholder:t.registration_code,allowClear:!0}),visible:!0},{label:t.unit,key:"unitName",component:e(te,{placeholder:t.unit,allowClear:!0}),visible:!0},{label:t.constructor_name,key:"constructorName",component:e(te,{placeholder:t.constructor_name,allowClear:!0}),visible:!0},{label:t.deposit_status,key:"depositStatus",component:h(ne,{fluid:"true",placeholder:t.deposit_status,children:[e(ne.Option,{value:"",children:t.all_deposit_status},"deposit_status_0"),Ct.map(n=>e(ne.Option,{value:n.value,children:n.label},n.value))]}),visible:!0},{label:t.estimated_start_time,key:"estimatedStartTime",component:e(be.RangePicker,{fluid:"true",placeholder:[pe,pe],format:[pe,pe],getPopupContainer:n=>n.parentNode}),visible:!0},{label:t.construction_start_time,key:"actualStartTime",component:e(be.RangePicker,{fluid:"true",placeholder:[pe,pe],format:[pe,pe],getPopupContainer:n=>n.parentNode}),visible:!0}],[]);return e(ce.FilterBox,{defaultFilter:s,filters:r,onSearch:a,formData:i})},xa=()=>{const{setTablePagination:a,filter:s,constructionSetting:i,setStatus:r,status:n}=E.useContext(K),{setQueryParamsConstruction:l}=we(),o=async p=>{p!==n&&(r(p),a({current:G,limit:J}),l({limit:J,page:G,status:p,filter:s}))},c=E.useMemo(()=>i!=null&&i.autoApprove?Ze.filter(p=>p.value!==re):Ze,[i]);return[o,c,n]},Oa=()=>{const[a,s,i]=xa();return e(ce.Tabs,{activeKey:i,onTabChange:a,tabs:s})},Ya=()=>{const{getsStatus:a,tablePagination:s,setTablePagination:i,tableData:r,filter:n,showFormDetail:l,showFormUpdate:o,showFormUpdateStatus:c,constructionPermissionWrite:p,constructionPermissionApprove:w,constructionPermissionUpdateStatus:y,status:S,showFormHistoryConstruction:b,showFormUpdateConstruction:T}=E.useContext(K),{layoutScrollRef:C}=E.useContext(ht),P=qe(),{setQueryParamsConstruction:F}=we(),m=async(k,A)=>{let{current:V,limit:L}=s;k!==V&&(V=k),A!==L&&(L=A,V=G),i({current:V,limit:L}),F({limit:L,page:V,status:S,filter:n})},I=k=>{l({construction:k})},d=k=>{o({construction:k,type:ga})},u=k=>{c({construction:k,type:Oe})},g=k=>{c({construction:k,type:Ye})},j=k=>{c({construction:k,type:ke})},$=k=>{c({construction:k,type:Le})},U=k=>{c({construction:k,type:Be})},Q=k=>{c({construction:k,type:Me})},X=k=>{b({construction:k})},N=k=>{T({construction:k})},Y={pageSize:s.limit,defaultCurrent:G,current:s.current,total:r.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:m},O={offsetScroll:P.offsetScrollX,getContainer:()=>C.current},M=E.useMemo(()=>![re,me].includes(S),[S]);return{onClickBtnDetail:I,onClickBtnApprove:u,onClickBtnReject:g,onClickBtnInprogress:j,onClickBtnCompleted:$,onClickDeposit:U,onClickRefund:Q,onClickUpdate:d,sticky:O,dataSource:r.records,constructionTablePagination:Y,loading:a.isFetching,isShowRealTime:M,constructionPermissionWrite:p,constructionPermissionApprove:w,constructionPermissionUpdateStatus:y,onClickBtnHistory:X,onClickBtnUpdate:N}},ka=()=>{const{onClickBtnDetail:a,onClickBtnApprove:s,onClickBtnReject:i,onClickBtnInprogress:r,onClickBtnCompleted:n,onClickDeposit:l,onClickRefund:o,sticky:c,dataSource:p,constructionTablePagination:w,loading:y,constructionPermissionWrite:S,constructionPermissionApprove:b,constructionPermissionUpdateStatus:T,onClickBtnHistory:C,onClickBtnUpdate:P}=Ya(),F=Ee("div",{target:"e1gxhe260"})({name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"}),m=[{title:t.registration_code,key:"code",dataIndex:"code",fixed:"left",width:120},{title:t.constructor_name,key:"constructorName",dataIndex:"constructorName",width:150,render:(d,u)=>(d==null?void 0:d.length)>20?e(oe,{title:d,placement:"topLeft",children:e(F,{children:d})}):e(F,{children:d})},{title:t.unit,key:"unitName",dataIndex:"unitName",width:250,render:(d,u)=>(d==null?void 0:d.length)>20?e(oe,{title:d,placement:"topLeft",children:e(F,{children:d})}):e(F,{children:d})},{title:t.phone,key:"constructorPhone",dataIndex:"constructorPhone",width:120},{title:t.label.resident,key:"registrantFullName",dataIndex:"registrantFullName",width:250,render:(d,u)=>(d==null?void 0:d.length)>20?e(oe,{title:d,placement:"topLeft",children:e(F,{children:d})}):e(F,{children:d})},{title:t.deposit_status,key:"depositStatus",dataIndex:"depositStatus",width:120,render:(d,u)=>u!=null&&u.type?e(na,{color:u==null?void 0:u.depositColor,children:u==null?void 0:u.type}):null},{title:t.description,key:"description",dataIndex:"description",width:150,render:(d,u)=>(d==null?void 0:d.length)>20?e(oe,{title:d,placement:"topLeft",children:e(F,{children:d})}):e(F,{children:d})},{title:t.estimated_start_time,key:"estimatedStartTime",dataIndex:"estimatedStartTime",width:200},{title:t.estimated_end_time,key:"estimatedEndTime",dataIndex:"estimatedEndTime",width:200},{title:t.construction_start_time,key:"actualStartTime",dataIndex:"actualStartTime",width:200},{title:t.construction_finish_time,key:"actualEndTime",dataIndex:"actualEndTime",width:200},{title:t.action,key:"action",dataIndex:"action",width:180,align:"center",fixed:"right",render:(d,u)=>h(Te,{children:[e(z,{title:t.detail_construction,onClick:()=>a(u),name:"icon-eye-outlined",css:g=>({fontSize:g.iconSize})}),e(z,{title:t.history,css:g=>({fontSize:g.iconSize,marginLeft:g.margin.xs,marginRight:g.marginXs}),name:"icon-history-filled",onClick:()=>C(u)}),S&&![re,xe,fe].includes(u==null?void 0:u.status)?e(z,{title:t.update_construction,onClick:()=>{P(u)},name:"icon-edit-outlined",css:g=>({fontSize:g.iconSize,marginLeft:g.margin.xs,marginRight:g.marginXs})}):null,(u==null?void 0:u.status)===re&&b?h(Te,{children:[e(z,{title:t.approve_construction,css:g=>({marginLeft:g.margin.xs,fontSize:g.iconSize}),onClick:()=>s(u),name:"icon-check-outlined"}),e(z,{title:t.reject_construction,onClick:()=>i(u),name:"icon-close-circle-outlined",css:g=>({marginLeft:g.margin.xs,fontSize:g.iconSize})})]}):null,(u==null?void 0:u.status)===me&&T?e(z,{title:t.confirm_in_progress_construction,css:g=>({marginLeft:g.margin.xs,fontSize:g.iconSize}),onClick:()=>r(u),name:"icon-exit-to-app-outlined"}):null,[Fe,xe,$e,fe].includes(u==null?void 0:u.status)&&(u==null?void 0:u.depositStatus)===nt&&S?e(z,{title:t.refund_construction,onClick:()=>o(u),name:"icon-attach-money-filled",css:g=>({marginLeft:g.margin.xs,fontSize:g.iconSize})}):null,[Fe,xe,me].includes(u==null?void 0:u.status)&&(u==null?void 0:u.depositStatus)===Tt&&S?e(z,{title:t.deposit_construction,onClick:()=>l(u),name:"icon-attach-money-filled",css:g=>({marginLeft:g.margin.xs,fontSize:g.iconSize})}):null,(u==null?void 0:u.status)===me&&b?e(z,{title:t.reject_construction,css:g=>({marginLeft:g.margin.xs,fontSize:g.iconSize}),onClick:()=>i(u),name:"icon-close-circle-outlined"}):null,(u==null?void 0:u.status)===Fe&&T?e(z,{title:t.confirm_complete_construction,css:g=>({marginLeft:g.margin.xs,fontSize:g.iconSize}),onClick:()=>n(u),name:"icon-export-outlined"}):null]})}].filter(Boolean),I={x:m.reduce((d,u)=>u+d.width,0),scrollToFirstRowOnChange:!0};return e(ce.Table,{sticky:c,scroll:I,columns:m,dataSource:p,loading:y,pagination:w})},ye=async({id:a,body:s={},type:i,idBuilding:r})=>{try{let n=null;switch(i){case Oe:n=await Qt(a,s,r);break;case Ye:n=await qt(a,s,r);break;case ke:n=await Gt(a,s,r);break;case Le:n=await $t(a,s,r);break;case Ge:n=await jt(a,s,r);break;case Be:n=await zt(a,s,r);break;case Me:n=await Ht(a,s,r);break;default:break}return n}catch(n){return n}},La=()=>{var U,Q,X;const{getConstructionBadges:a}=Ue(),{formUpdateStatusData:s,hideFormUpdateStatus:i,filter:r,status:n,tablePagination:l,idBuilding:o,tableData:c}=E.useContext(K),{setQueryParamsConstruction:p}=we(),[w,y]=E.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),[S]=f.useForm(),[b]=Re(),T={id:(Q=(U=s==null?void 0:s.data)==null?void 0:U.construction)==null?void 0:Q.id,idBuilding:o};Ae(w.code,w.codeLanguage,{message:t.success,description:t.update_data_success});const C=N=>{var Y,O;Ce.open({url:(O=(Y=N==null?void 0:N.response)==null?void 0:Y.data)==null?void 0:O.url})},P=async()=>{if(await S.validateFields())return T.type=Oe,T.body={depositValue:S.getFieldValue("depositValue")??0},await ye(T)},F=async()=>{if(await S.validateFields())return T.type=Ye,T.body={reason:S.getFieldValue("reason")},await ye(T)},m=async()=>{if(await S.validateFields())return T.type=Be,T.body={depositCollection:S.getFieldValue("depositCollection")},await ye(T)},I=async()=>(T.type=Me,T.body={refundValue:S.getFieldValue("refundValue")},await ye(T)),d=async()=>{var O;const N=S.getFieldValue("employeeFiles")??[],Y=((O=N.map(M=>{var k,A;return((A=(k=M==null?void 0:M.response)==null?void 0:k.data)==null?void 0:A.url)??void 0}))==null?void 0:O.filter(Boolean))??[];if(N.length===0||Y.length>0&&Y.length===N.length)return T.type=ke,T.body={},await ye(T)},u=async()=>(T.type=Le,T.body={},await ye(T)),g=async()=>(T.type=Ge,T.body={},await ye(T)),j={[Oe]:P,[Ye]:F,[Be]:m,[Me]:I,[ke]:d,[Le]:u,[Ge]:g};return{handleConfirmUpdate:async()=>{if(await S.validateFields()){y({code:void 0,codeLanguage:void 0,isFetching:!0});const Y=await j[s.data.type]();if(y({code:Y.code,codeLanguage:Y.codeLanguage,isFetching:!1}),Qe.includes(Y.code)){const O=ra(c.totalRecord-1,l.limit,l.current),M=l.current===O;M&&await b({limit:l.limit,page:l.current,filter:{...r,status:n}}),M||p({limit:l.limit,page:O,status:n,filter:{...r}}),await a(o),i()}}},formUpdate:S,isFetching:w.isFetching,type:s.data.type,construction:(X=s==null?void 0:s.data)==null?void 0:X.construction,handlePreviewAttachment:C,hideFormUpdateStatus:i}},Ba=()=>{const{hideFormUpdateStatus:a,handleConfirmUpdate:s,formUpdate:i,isFetching:r,type:n,construction:l}=La();return h(le,{title:t.confirm,open:!0,loading:r,okText:t.confirm,cancelText:t.cancel,onOk:s,onCancel:a,okButtonProps:{disabled:r,loading:r},children:[n===Oe&&h(f,{initialValues:{depositValue:void 0},form:i,name:"formUpdate",layout:"vertical",children:[e("div",{style:{marginBottom:12},children:h("span",{children:[t.do_you_want_to_approve_this_registration_form,"?"]})}),e(f.Item,{name:"depositValue",label:`${t.deposit_type} (${t.vnd})`,children:e(Ie,{placeholder:`${t.deposit_value} ${t.vnd}`,min:0,onKeyPress:o=>{/[0-9]/.test(o.key)||o.preventDefault()},formatter:o=>ie(o)})})]}),n===Ye&&h(f,{initialValues:{reason:""},form:i,name:"formUpdate",layout:"vertical",children:[e("div",{style:{marginBottom:12},children:h("span",{children:[t.do_you_want_to_reject_this_registration_form,"?"]})}),e(f.Item,{rules:[{required:!0}],name:"reason",label:t.reason,children:e(te.TextArea,{maxLength:"255",placeholder:t.reason,rows:"4"})})]}),n===ke&&e(f,{form:i,name:"formUpdate",layout:"vertical",children:e("div",{style:{marginBottom:12},children:h("span",{children:[t.constructing,"?"]})})}),n===Le&&e(f,{form:i,name:"formUpdate",layout:"vertical",children:e("div",{style:{marginBottom:12},children:(l==null?void 0:l.depositStatus)===nt&&(l==null?void 0:l.status)===Fe?h("div",{children:[e(D.Text,{children:t.the_construction_contract_has_an_outstanding_deposit_do_you_want_to_terminate_the_contract_without_refunding_the_deposit}),h(D.Text,{strong:!0,children:[" ",t.finish_construction.toLowerCase()," "]}),e(D.Text,{children:t.but.toLowerCase()}),h(D.Text,{strong:!0,children:[" ",t.not_refund.toLowerCase(),"? "]})]}):h(D.Text,{children:[t.completed,"?"]})})}),n===Be&&h(f,{initialValues:{note:"",images:[]},form:i,name:"formUpdate",layout:"vertical",children:[e("div",{style:{marginBottom:12},children:h("span",{children:[t.deposit_confirm_collection,"?"]})}),(l==null?void 0:l.depositValue)>0?h(D,{children:[t.deposit_value,": ",e("strong",{style:{margin:"0 5px"},children:ie(`${l==null?void 0:l.depositValue}`)}),t.vnd]}):e(v,{span:"24",children:e(f.Item,{name:"depositCollection",label:`${t.deposit_type} (${t.vnd})`,children:e(Ie,{placeholder:t.deposit_type,min:0,onKeyPress:o=>{/[0-9]/.test(o.key)||o.preventDefault()},formatter:o=>ie(o)})})})]}),n===Me&&h(f,{initialValues:{note:"",images:[],refundValue:l==null?void 0:l.depositValue},form:i,name:"formUpdate",layout:"vertical",children:[e("div",{style:{marginBottom:12},children:h("span",{children:[t.refund_confirm_deposit,"?"]})}),h(v,{span:"24",children:[h(D,{style:{marginBottom:"15px"},children:[t.deposit_value,": ",e("strong",{style:{margin:"0 5px"},children:ie(`${l==null?void 0:l.depositValue}`)}),t.vnd]}),e(f.Item,{name:"refundValue",rules:[{required:!0},{validator:async(o,c)=>l!=null&&l.depositValue&&c>(l==null?void 0:l.depositValue)?Promise.reject(t.refund_amount_must_be_less_than_deposit_amount):Promise.resolve()}],label:`${t.refund_type} (${t.vnd})`,children:e(Ie,{placeholder:t.refund_type,min:0,onKeyPress:o=>{/[0-9]/.test(o.key)||o.preventDefault()},formatter:o=>ie(o)})}),e(v,{span:"24",children:e(_t,{message:t.refund_amount_must_be_less_than_deposit_amount,type:"warning",showIcon:!0,closable:!0})})]})]}),n===Ge&&h("p",{children:[t.do_you_want_to_remove_this_access_history,"?"]})]})},Ma=async(a,s)=>{try{return await Wt(a,s)}catch(i){return i}},Ua=()=>{var m;const{formDetailData:a,hideFormDetail:s,showFormRegulation:i}=E.useContext(K),{isUserCs:r}=pt(),[n]=f.useForm(),l=Pe(),{idBuilding:o}=l,[c,p]=E.useState({}),w=(m=a==null?void 0:a.data)==null?void 0:m.construction,{id:y,employeeFiles:S,residentFiles:b}=w;E.useEffect(()=>{(async()=>{const I=await Ma(y,o);p(I.data)})()},[]);const T=I=>{i({constructionInfo:I})},C=I=>I==null?void 0:I.map(d=>{var g;return{url:d,fileName:d.substring(d.lastIndexOf("/")+1),fileType:d.split(".").pop().toLowerCase(),icon:((g=la)==null?void 0:g[d.split(".").pop().toLowerCase()])??d}}),P=C(S),F=C(b);return{hideFormDetail:s,formDetail:n,constructionDetail:c,isUserCs:r,showRegulationConstruction:T,attachFilesEmployee:P,attachFilesResident:F}},Va=()=>{var p,w,y,S,b,T,C,P,F,m,I,d,u,g,j,$,U,Q,X,N,Y;const{hideFormDetail:a,formDetail:s,constructionDetail:i,isUserCs:r,showRegulationConstruction:n,attachFilesEmployee:l,attachFilesResident:o}=Ua(),c=qe();return e(le,{open:!0,title:t.detail_construction,onCancel:a,footer:null,width:"65%",style:{zIndex:"0"},children:h(f,{form:s,layout:"vertical",name:"detail",style:{height:"530px",overflowY:"scroll"},children:[h(H,{style:{background:"#f7f7f7",padding:"10px 10px 0 10px"},children:[e(v,{span:"8",css:q({marginBottom:c.margin.sm},"",""),children:h(D.Text,{strong:t.status_construction,children:[t.status_construction,": "]})}),e(v,{span:"8",children:h(D.Text,{strong:((p=Ne[(i==null?void 0:i.status)??""])==null?void 0:p.label)??"-",css:q({fontSize:c.fontSize.md},"",""),children:[[Fe,me,re].includes(i==null?void 0:i.status)?h("span",{style:{color:"orange"},children:[((w=Ne[(i==null?void 0:i.status)??""])==null?void 0:w.label)??"-"," "]}):"",(i==null?void 0:i.status)===xe&&h("span",{style:{color:"green"},children:[((y=Ne[(i==null?void 0:i.status)??""])==null?void 0:y.label)??"-"," "]}),[fe,$e].includes(i==null?void 0:i.status)?h("span",{style:{color:"red"},children:[((S=Ne[(i==null?void 0:i.status)??""])==null?void 0:S.label)??"-"," "]}):""]})})]}),h(H,{style:{background:"#f7f7f7",padding:"0 10px 10px 10px",marginBottom:"20px"},children:[e(v,{span:"8",children:h(D.Text,{children:[t.registration_code,": "]})}),e(v,{span:"8",children:e(D.Text,{children:(i==null?void 0:i.code)??"-"})})]}),h(H,{style:{background:"#f7f7f7",padding:"10px 10px 0 10px",marginBottom:"20px"},children:[e(v,{span:"24",css:q({marginBottom:c.margin.sm},"",""),children:e(D.Text,{strong:t.creator_info,children:t.creator_info})}),e(v,{span:"8",children:e(f.Item,{label:t.unit,children:((b=i==null?void 0:i.unit)==null?void 0:b.name)??"-"})}),e(v,{span:"8",children:e(f.Item,{label:t.subscribers,children:r?"***":((T=i==null?void 0:i.resident)==null?void 0:T.fullName)??"-"})}),e(v,{span:"8",children:e(f.Item,{label:t.registration_date,children:_(i.createdAt).format(Z)})}),i!=null&&i.approvedAt?e(v,{span:"8",children:e(f.Item,{label:t.approved_at,children:_(i.approvedAt).format(Z)})}):null]}),h(H,{style:{background:"#f7f7f7",padding:"10px 10px 0 10px",marginBottom:"20px"},children:[e(v,{span:"24",css:q({marginBottom:c.margin.sm},"",""),children:h(D.Text,{strong:t.construction_info,children:[t.construction_info," "]})}),e(v,{span:"24",children:e(f.Item,{label:t.constructor_name,children:r?"***":(i==null?void 0:i.constructorName)??"-"})}),e(v,{span:"8",children:e(f.Item,{label:t.phone,children:r?"***":(i==null?void 0:i.constructorPhone)??"-"})})]}),h(H,{style:{background:"#f7f7f7",padding:"10px 10px 0 10px",marginBottom:"20px"},children:[e(v,{span:"24",css:q({marginBottom:c.margin.sm},"",""),children:h(D.Text,{strong:t.registration_info,children:[t.registration_info," "]})}),e(v,{span:"8",children:e(f.Item,{label:t.estimated_start_time,children:_(i==null?void 0:i.estimatedStartTime).format(Z)??"-"})}),e(v,{span:"8",children:e(f.Item,{label:t.estimated_end_time,children:_(i==null?void 0:i.estimatedEndTime).format(Z)??"-"})}),e(v,{span:"24",children:e(f.Item,{label:t.content,children:(i==null?void 0:i.description)??"-"})}),e(v,{span:"24",children:e(f.Item,{label:t.resident_note,children:i!=null&&i.residentNote?i==null?void 0:i.residentNote:"-"})}),e(v,{span:"16",children:h(f.Item,{label:t.construction_regulations,children:[t.agreed,e(D.Text,{strong:!0,onClick:()=>n(i),css:q({marginLeft:c.margin.xs,color:c.color.primary,cursor:"pointer"},"",""),children:t.construction_regulations})]})})]}),h(H,{style:{background:"#f7f7f7",padding:"10px 10px 0 10px",marginBottom:"20px"},children:[e(v,{span:"24",css:q({marginBottom:c.margin.sm},"",""),children:h(D.Text,{strong:t.deposit_info,children:[t.deposit_info," "]})}),e(v,{span:"8",children:e(f.Item,{label:t.deposit_status,children:((C=Ke[(i==null?void 0:i.depositStatus)??""])==null?void 0:C.label)??"-"})}),e(v,{span:"8",children:h(f.Item,{label:t.deposit_value,children:[i!=null&&i.depositValue?ie(i==null?void 0:i.depositValue):0," "," ",t.vnd]})}),e(v,{span:"8",children:h(f.Item,{label:t.refund_value,children:[i!=null&&i.refundValue?ie(i==null?void 0:i.refundValue):0," "," ",t.vnd]})})]}),h(H,{style:{background:"#f7f7f7",padding:"10px 10px 0 10px",marginBottom:"20px"},children:[((P=i==null?void 0:i.residentFiles)==null?void 0:P.length)>0?h(Te,{children:[h(H,{style:{background:"#f7f7f7",width:"100%"},children:[e(v,{span:"24",css:q({marginBottom:c.margin.sm},"",""),children:h(D.Text,{strong:t.attached_files,children:[t.attached_files," "]})}),h(v,{span:"24",children:[e(D,{css:q({marginBottom:c.margin.sm},"",""),children:t.attached_files_resident}),e(H,{gutter:[c.margin.md,c.margin.md],style:{width:"100%"},children:o==null?void 0:o.map((O,M)=>e(v,{style:{width:"10%"},children:e(oe,{title:O.fileName,children:h("figure",{className:"upload__item",style:{margin:"15px 0px"},children:[e(dt,{title:O.fileName,src:O.icon,width:"100%",height:"80px",preview:!1,alt:O.fileName,style:{cursor:"pointer",objectFit:"cover"}}),e("div",{className:"upload__item__action",style:{zIndex:1e6,width:"100%"},children:e(z,{name:"icon-eye-outlined",style:{fontSize:"20px"},onClick:()=>{Ce.open({url:O.url})}})})]})})},M))})]})]}),e(oa,{})]}):null,h(H,{style:{width:"100%"},children:[e(v,{span:"24",css:q({marginBottom:c.margin.sm},"",""),children:h(D.Text,{strong:t.confirm_employee,children:[t.confirm_employee,": "]})}),e(v,{span:"8",children:e(f.Item,{label:t.construction_start_time,children:i!=null&&i.actualStartTime?_(i==null?void 0:i.actualStartTime).format(Z):"-"})}),e(v,{span:"8",children:e(f.Item,{label:t.construction_finish_time,children:i!=null&&i.actualEndTime?_(i==null?void 0:i.actualEndTime).format(Z):"-"})}),e(v,{span:"24",children:e(f.Item,{label:t.management_note,children:i.employeeNote?i.employeeNote:"-"})}),(i==null?void 0:i.status)===fe?h(Te,{children:[e(v,{span:"24",css:q({marginBottom:c.margin.sm},"",""),children:e(D,{children:e("b",{children:t.content_cancel})})}),e(v,{span:"5",children:e(f.Item,{label:t.canceler,children:(m=(F=i==null?void 0:i.changeStatusBy)==null?void 0:F.CANCELLED)==null?void 0:m.name})}),e(v,{span:"5",children:e(f.Item,{label:t.cancel_at,children:(d=(I=i==null?void 0:i.changeStatusBy)==null?void 0:I.CANCELLED)!=null&&d.time?_((g=(u=i==null?void 0:i.changeStatusBy)==null?void 0:u.CANCELLED)==null?void 0:g.time).format("DD/MM/YYYY"):"-"})}),e(v,{span:"24",children:e(f.Item,{label:t.reason,children:i.reason??"-"})})]}):null,(i==null?void 0:i.status)===$e?h(Te,{children:[e(v,{span:"24",css:q({marginBottom:c.margin.sm},"",""),children:e(D,{children:e("b",{children:t.content_cancel})})}),e(v,{span:"5",children:e(f.Item,{label:t.canceler,children:($=(j=i==null?void 0:i.changeStatusBy)==null?void 0:j.REJECTED)==null?void 0:$.name})}),e(v,{span:"5",children:e(f.Item,{label:t.cancel_at,children:(Q=(U=i==null?void 0:i.changeStatusBy)==null?void 0:U.REJECTED)!=null&&Q.time?_((N=(X=i==null?void 0:i.changeStatusBy)==null?void 0:X.REJECTED)==null?void 0:N.time).format("DD/MM/YYYY"):"-"})}),e(v,{span:"24",children:e(f.Item,{label:t.reason,children:i.reason??"-"})})]}):null,((Y=i==null?void 0:i.employeeFiles)==null?void 0:Y.length)>0?h(v,{span:"24",children:[e(D,{css:q({marginBottom:c.margin.sm},"",""),children:t.attached_files_employee}),e(H,{gutter:[c.margin.md,c.margin.md],css:q({marginBottom:c.margin.md,padding:"10px",width:"100%"},"",""),children:l==null?void 0:l.map((O,M)=>e(v,{style:{width:"10%"},children:e(oe,{title:O.fileName,children:h("figure",{className:"upload__item",style:{margin:"15px 0px"},children:[e(dt,{title:O.fileName,src:O.icon,width:"100%",height:"80px",preview:!1,alt:O.fileName,style:{cursor:"pointer",objectFit:"cover"}}),e("div",{className:"upload__item__action",style:{zIndex:1e6,width:"100%"},children:e(z,{name:"icon-eye-outlined",style:{fontSize:"20px"},onClick:()=>{Ce.open({url:O.url})}})})]})})},M))})]}):null]})]})]})})};var Da={name:"99halj",styles:"color:#2424f3"};const Ha=Ee("span",{target:"e1obam920"})("cursor:pointer;width:85%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;",a=>a.isUploaded&&Da,";"),lt=({file:a,handlePreviewAttachment:s})=>e(Ha,{title:a.name,onClick:()=>s(a),children:a.name});lt.propTypes={file:ge.objectOf(ge.any),handlePreviewAttachment:ge.func};lt.defaultProps={file:{},handlePreviewAttachment:()=>{}};const za=Ee("div",{target:"e14xlf3h0"})({name:"seoft9",styles:"display:flex;justify-content:space-between;margin:10px;&:hover{background:#f7f7f7;}"}),Je=({file:a,handlePreviewAttachment:s,handleRemoveFile:i})=>{const r=qe();return h(za,{children:[h(H,{style:{flexFlow:"row"},children:[e(z,{name:"icon-attachment-outlined",css:q({fontsize:r.iconSize,marginRight:r.margin.xs},"","")}),e(lt,{file:a,handlePreviewAttachment:s})]}),e(z,{name:"icon-delete-outlined",css:q({fontsize:r.iconSize,marginLeft:r.margin.xs},"",""),onClick:()=>{i(a==null?void 0:a.uid)}})]},a)};Je.propTypes={file:ge.objectOf(ge.any),handlePreviewAttachment:ge.func,handleRemoveFile:ge.func};Je.defaultProps={file:{},handlePreviewAttachment:()=>{},handleRemoveFile:()=>{}};const et=async({filter:a,limit:s,page:i,idBuilding:r})=>{try{return await Jt({filter:a,limit:s,page:i,idBuilding:r})}catch(n){return n}},wt=async({filter:a,limit:s,page:i,idBuilding:r})=>{try{return await Xt({filter:a,limit:s,page:i,idBuilding:r})}catch(n){return n}},ja=async(a,s)=>{try{const{estimatedStartTime:i,estimatedEndTime:r,residentFiles:n,unitId:l,residentId:o}=a,c={constructorName:(a==null?void 0:a.constructorName)??"",constructorPhone:(a==null?void 0:a.constructorPhone)??void 0,description:(a==null?void 0:a.description)??"",estimatedStartTime:i?_(i).toDate():void 0,estimatedEndTime:r?_(r).toDate():void 0,employeeNote:a==null?void 0:a.employeeNote,unitId:l||null,residentId:o||null,depositValue:(a==null?void 0:a.depositValue)??0,residentFiles:n};return await Kt(c,s)}catch(i){return i}},vt=()=>{const a=Pe(),{idBuilding:s}=a,[i]=f.useForm(),{getConstructionBadges:r}=Ue(),{setQueryParamsConstruction:n}=we(),[l]=Re(),{hideFormAdd:o,showFormAgreeTerms:c,hideFormAgreeTerms:p,tablePagination:w,filter:y,status:S,formConfirmExit:b,setFormConfirmExit:T}=E.useContext(K),[C,P]=E.useState({data:[],isFetching:!1}),[F,m]=E.useState({data:[],isFetching:!1}),[I,d]=E.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),[u,g]=E.useState(""),[j,$]=E.useState(!1),[U,Q]=E.useState([]),X=({file:x,fileList:R})=>{let B=R;x.status==="removed"&&(B=R),(x.status==="done"||x.status==="uploading")&&(B=R),x.status||(B=R.filter(W=>W.uid!==x.uid)),Q(B.filter(W=>["done","uploading"].includes(W.status)))},N=x=>{var R,B;Ce.open({url:(B=(R=x==null?void 0:x.response)==null?void 0:R.data)==null?void 0:B.url})},Y=x=>{const R=U.filter(B=>B.uid!==x);Q(R)};E.useEffect(()=>{(async()=>{P({data:[],isFetching:!0});const x=await et({idBuilding:s,limit:J,page:G,filter:{name:void 0}});P({data:x.data,isFetching:!1})})()},[]),E.useEffect(()=>{(async()=>{const x=await wt({idBuilding:s,limit:J,page:G,filter:{name:void 0}});g(x==null?void 0:x.data)})()},[]);const O=async x=>{P({...C,isFetching:!0});const R=await et({idBuilding:s,limit:J,page:G,filter:{name:x||void 0}});P({data:R.data,isFetching:!1})};Ae(I.code,I.codeLanguage,{message:t.success,description:t.add_data_success});const M=(x,R)=>{if(T(!0),x!=null&&x.unitId){m({...F,isFetching:!0});const B=C.data.find(W=>W.id===x.unitId);m({data:(B==null?void 0:B.residents)??[],isFetching:!1}),i.setFieldsValue({residentId:void 0})}$(!!R.agreeRegulation)},k=async()=>{var Se,Ve;await i.validateFields()||We.error({message:t.error1,description:t.data_invalid});const R=i.getFieldsValue(),B=i.getFieldValue("residentFiles");let W=[];if(U!=null&&U.length?W=(U==null?void 0:U.map(ee=>{var ue,ve;return((ve=(ue=ee==null?void 0:ee.response)==null?void 0:ue.data)==null?void 0:ve.url)??(ee==null?void 0:ee.url)}))??[]:W=((Se=B==null?void 0:B.map(ee=>(ee==null?void 0:ee.url)??null))==null?void 0:Se.filter(Boolean))??[],R){d({code:void 0,codeLanguage:void 0,isFetching:!0});const ee={constructorName:R==null?void 0:R.constructorName,constructorPhone:R.constructorPhone&&R.constructorPhone.phoneNumber?`${((Ve=R==null?void 0:R.constructorPhone)==null?void 0:Ve.countryCode)??ze}${R.constructorPhone.phoneNumber}`:null,description:R==null?void 0:R.description,estimatedStartTime:R==null?void 0:R.estimatedStartTime,estimatedEndTime:R==null?void 0:R.estimatedEndTime,employeeNote:R==null?void 0:R.employeeNote,unitId:R==null?void 0:R.unitId,residentId:R==null?void 0:R.residentId,depositValue:R==null?void 0:R.depositValue,residentFiles:W},ue=await ja(ee,s);if(d({code:ue.code,codeLanguage:ue.codeLanguage,isFetching:!1}),Qe.includes(ue.code)){const ve={limit:w.limit,page:w.current,filter:{...y},status:S},De={limit:J,page:G,filter:{..._e},status:me},He=it(De,ve);He&&await l({limit:J,page:G,filter:{..._e,status:me}}),He||n({...De}),await r(s),o()}}},A=()=>{c()},V=()=>{b?le.confirm({cancelText:t.cancel,okText:t.confirm,title:t.confirm,content:t.the_content_you_enter_has_not_been_saved_are_you_sure_you_want_to_exit_this_screen,onOk:()=>{T(!1),o()}}):o()},L={constructorName:void 0,constructorPhone:void 0,description:void 0,estimatedStartTime:void 0,estimatedEndTime:void 0,employeeNote:void 0,unitId:void 0,residentId:void 0,depositValue:void 0,residentFiles:[],agreeRegulation:!1};return{onCancelConstruction:V,handleAddConstruction:k,formAdd:i,isFetchingAdd:I.isFetching,initialValues:L,isFetchingApartment:C.isFetching,apartmentData:C.data,handleSearchApartment:O,residentData:F.data,isFetchingResident:F.isFetching,onValuesChange:M,handlePreviewAttachment:N,onClickBtnAgreeTerms:A,hideFormAgreeTerms:p,regulation:u,fileList:U,handleChange:X,agreeTerms:j,handleRemoveFile:Y}};var $a={name:"1kevbid",styles:"& .ant-upload{width:100%;}"};const Ga=()=>{const{onCancelConstruction:a,handleAddConstruction:s,formAdd:i,isFetchingAdd:r,initialValues:n,isFetchingApartment:l,apartmentData:o,handleSearchApartment:c,residentData:p,isFetchingResident:w,onValuesChange:y,handlePreviewAttachment:S,onClickBtnAgreeTerms:b,fileList:T,handleChange:C,agreeTerms:P,handleRemoveFile:F}=vt(),m=h(H,{style:{justifyContent:"space-between",alignItems:"center"},children:[e(D.Text,{children:t.add_construction_registration_form}),h(H,{children:[e(se,{onClick:a,style:{marginRight:10},children:t.cancel}),e(se,{type:"primary",onClick:s,disabled:r||!P,loading:r,children:t.register})]})]}),I=e(v,{span:"24",style:{textAlign:"left"},children:e(_t,{message:t.after_create_construction_will_show_in_tab_verified,type:"warning",showIcon:!0,closable:!0})});return e(le,{title:m,onCancel:a,open:!0,width:"55%",bodyStyle:{maxHeight:"450px",overflowY:"scroll"},footer:I,closable:!1,closeIcon:null,children:e(f,{initialValues:n,form:i,name:"formAdd",layout:"vertical",onValuesChange:y,children:h(H,{gutter:[12,12],children:[e(v,{span:"12",children:e(f.Item,{rules:[{required:!0}],label:t.constructor_name,name:"constructorName",children:e(te,{maxLength:255,placeholder:t.constructor_name,allowClear:!0})})}),e(v,{span:"12",children:e(f.Item,{name:"constructorPhone",label:t.label.phone,rules:[{required:!0},{validator:async(d,u)=>u&&u.phoneNumber&&!gt(u.phoneNumber)?Promise.reject(t.status.phone_invalid):Promise.resolve()}],children:e(te.PhoneInput,{placeholder:t.label.phone})})}),e(v,{span:"12",children:e(f.Item,{dependencies:["estimatedEndTime"],rules:[{required:!0},({getFieldValue:d})=>({validator(u,g){return g&&_(g).startOf("day").isBefore(_().startOf("day"))?Promise.reject(t.expected_incoming_construction_at_must_greater_or_equal_than_current_date):g&&d("estimatedEndTime")&&_(g).isAfter(d("estimatedEndTime"))?Promise.reject(t.expected_incoming_construction_at_must_lower_or_equal_than_expected_leaving_at):g&&_(g).isBefore(_().subtract(1,"day"))?Promise.reject(new Error(`${t.min_estimated_date_construction}: ${_().format("DD/MM/YYYY")}`)):g&&_(g).isBefore(_(),"minutes")?Promise.reject(new Error(`${t.min_estimated_date_construction}: ${_().format(" HH:mm DD/MM/YYYY")}`)):Promise.resolve()}})],label:t.estimated_start_time,name:"estimatedStartTime",children:e(be,{fluid:"true",placeholder:"HH:mm DD/MM/YYYY",format:"HH:mm DD/MM/YYYY",showTime:{format:"HH:mm DD/MM/YYYY"},disabledDate:d=>_(d).isBefore(_().subtract(1,"day")),allowClear:!1})})}),e(v,{span:"12",children:e(f.Item,{dependencies:["estimatedStartTime"],rules:[{required:!0},({getFieldValue:d})=>({validator(u,g){return g&&_(g).startOf("day").isBefore(_().startOf("day"))?Promise.reject(t.expected_incoming_construction_end_must_greater_or_equal_than_current_date):g&&d("estimatedStartTime")&&_(g).isBefore(d("estimatedStartTime"))?Promise.reject(t.expected_incoming_construction_at_must_lower_or_equal_than_expected_leaving_at):g&&_(g).isBefore(_().subtract(1,"day"))?Promise.reject(new Error(`${t.min_estimated_date_construction}: ${_().format("DD/MM/YYYY")}`)):g&&_(g).isBefore(_(),"minutes")?Promise.reject(new Error(`${t.min_estimated_date_construction}: ${_().format(" HH:mm DD/MM/YYYY")}`)):Promise.resolve()}})],label:t.estimated_end_time,name:"estimatedEndTime",children:e(be,{fluid:"true",placeholder:"HH:mm DD/MM/YYYY",format:"HH:mm DD/MM/YYYY",showTime:{format:"HH:mm DD/MM/YYYY"},disabledDate:d=>_(d).isBefore(_().subtract(1,"day")),allowClear:!1})})}),e(v,{span:"12",children:e(f.Item,{rules:[{required:!0}],label:t.unit,name:"unitId",children:e(ne,{allowClear:!0,showSearch:!0,placeholder:t.label.select_apartment,filterOption:!1,loading:l,onSearch:xt(c),getPopupContainer:d=>d.parentNode,style:{width:"100%"},dropdownRender:d=>l?e("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:e(St,{})}):d,children:o==null?void 0:o.map(({id:d,name:u})=>e(ne.Option,{value:d,children:u},d))})})}),e(v,{span:"12",children:e(f.Item,{rules:[{required:!0}],label:t.resident,name:"residentId",children:e(ne,{allowClear:!0,showSearch:!0,placeholder:t.label.select_resident,filterOption:!1,loading:w,getPopupContainer:d=>d.parentNode,style:{width:"100%"},children:p==null?void 0:p.map(({id:d,fullName:u})=>e(ne.Option,{value:d,children:u},d))})})}),e(v,{span:"24",children:e(f.Item,{label:`${t.deposit_value} (${t.vnd})`,name:"depositValue",children:e(Ie,{placeholder:t.deposit_value,formatter:d=>ie(d),fluid:"true",min:0})})}),e(v,{span:"24",children:e(f.Item,{label:t.content,name:"description",rules:[{required:!0}],children:e(te.TextArea,{maxLength:"3000",fluid:"true",placeholder:t.description,rows:"5",allowClear:!0})})}),e(v,{span:"24",children:e(f.Item,{label:t.note,name:"employeeNote",children:e(te.TextArea,{maxLength:"255",fluid:"true",placeholder:t.note,rows:"2",allowClear:!0})})}),h(v,{span:"24",children:[e(f.Item,{name:"residentFiles",label:t.attached_files,children:e(tt,{multiple:!0,maxCount:"10",css:$a,onPreview:S,limitSizeFile:5,isUploadAllFile:!0,fileList:T,onChange:C,showUploadList:!1,children:e(se,{icon:e(z,{name:"icon-attachment-outlined",css:d=>({fontsize:d.iconSize})}),type:"primary",ghost:!0,block:!0,size:"default",children:t.attachments})})}),T==null?void 0:T.map(d=>e(Je,{file:d,handlePreviewAttachment:S,handleRemoveFile:F})),h("i",{css:d=>({fontSize:d.fontSize.sm,color:d.labelColor}),children:["* ",t.file_format]})]}),e(v,{span:"24",children:e(f.Item,{name:"agreeRegulation",valuePropName:"checked",children:h(yt,{children:[t.agree_terms,e(D.Text,{strong:t.construction_regulations,style:{color:"rgb(59 93 191)",margin:"0 5px"},onClick:b,children:t.construction_regulations}),t.of_house]})})})]})})})},qa=async(a,s,i)=>{const r={type:st,status:s.status?je:ft,autoApprove:s.autoApprove,regulation:s.regulation},{code:n,codeLanguage:l}=await ca(a,r,i);return[n,l]},Qa=()=>{const{getConstructionBadges:a}=Ue(),{constructionSetting:s,setConstructionSetting:i,hideFormConfig:r,idBuilding:n}=E.useContext(K),[l,o]=E.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),[c]=f.useForm();Ae(l.code,l.codeLanguage,{message:t.success,description:t.update_data_success});const p=async()=>{o({code:void 0,codeLanguage:void 0,isFetching:!0});try{const y={autoApprove:!1,status:c.getFieldValue("status"),regulation:c.getFieldValue("regulation")};if(y.status&&!y.regulation){We.error({message:t.error1,description:t.please_input_regulation_goods_construction}),o({code:void 0,codeLanguage:void 0,isFetching:!1});return}const[S,b]=await qa(s==null?void 0:s.id,y,n);i({id:s.id,...y}),o({code:S,codeLanguage:b,isFetching:!1}),await a(n),r()}catch(y){o({code:y.code,codeLanguage:y.codeLanguage,isFetching:!1})}},w=E.useMemo(()=>({autoApprove:(s==null?void 0:s.autoApprove)??!1,status:(s==null?void 0:s.status)??!0,regulation:(s==null?void 0:s.regulation)??"<p></p>"}),[s]);return{hideFormConfig:r,formConfigView:c,handleSubmit:p,initialValues:w,loadingSaveConfig:l.isFetching}},Wa=()=>{const{hideFormConfig:a,formConfigView:s,handleSubmit:i,initialValues:r,loadingSaveConfig:n}=Qa();return e(le,{title:t.setting,open:!0,onOk:i,okText:t.confirm,onCancel:a,cancelText:t.cancel,okButtonProps:{disabled:n,loading:n},width:"70%",children:e(f,{initialValues:r,layout:"vertical",form:s,name:"form_config_data",children:h(H,{gutter:[12,12],children:[e(v,{span:"12",children:e(f.Item,{noStyle:!0,name:"status",valuePropName:"checked",children:e(yt,{children:t.active})})}),e(v,{span:"24",children:e(f.Item,{name:"regulation",label:t.regulation,rules:[{required:!0}],children:e(da,{height:"400",placeholder:t.regulation,initialContent:r.regulation})})})]})})})},Ja=()=>{const{hideFormAgreeTerms:a,regulation:s}=vt();return e(le,{title:t.construction_regulations,cancelText:t.close,onCancel:a,onClose:!1,footer:null,open:!0,width:"55%",style:{zIndex:1e6},children:e(H,{gutter:[0,0],dangerouslySetInnerHTML:{__html:s}})})},Ft=async(a,s,i)=>{const{constructorName:r,depositValue:n,employeeNote:l,constructorPhone:o,description:c,estimatedStartTime:p,estimatedEndTime:w,files:y,unitId:S,residentId:b}=a,T={constructorName:r??"",constructorPhone:`${o.countryCode}${o.phoneNumber}`,description:c??"",estimatedStartTime:p?_(p).toDate():void 0,estimatedEndTime:w?_(w).toDate():void 0,employeeNote:l,unitId:S||null,residentId:b||null,depositValue:n??0,residentFiles:y};return Zt(T,s,i)},Xa=()=>{var $,U,Q,X,N,Y,O,M,k;const{formUpdateData:a,hideFormUpdate:s,filter:i,status:r,tablePagination:n}=E.useContext(K),[l]=f.useForm(),o=Pe(),{idBuilding:c}=o,[p]=Re(),{getConstructionBadges:w}=Ue(),[y,S]=E.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),[b,T]=E.useState(!1),C=a==null?void 0:a.data,P=($=C==null?void 0:C.construction)==null?void 0:$.id,[F,m]=E.useState(((X=(Q=(U=a==null?void 0:a.data)==null?void 0:U.construction)==null?void 0:Q.employeeFiles)==null?void 0:X.map(A=>({url:A,status:"done",name:A,isUploaded:!0})))??[]),I=({file:A,fileList:V})=>{let L=V;A.status==="removed"&&(L=V),(A.status==="done"||A.status==="uploading")&&(L=V),A.status||(L=V.filter(x=>x.uid!==A.uid)),T(!0),L!=null&&L.every(x=>x.status==="done")&&T(!1),m(L.filter(x=>["done","uploading"].includes(x.status)))};Ae(y.code,y.codeLanguage,{message:t.success,description:t.update_success});const d=A=>{var V,L,x,R;(L=(V=A==null?void 0:A.response)==null?void 0:V.data)!=null&&L.url?Ce.open({url:(R=(x=A==null?void 0:A.response)==null?void 0:x.data)==null?void 0:R.url}):A!=null&&A.url&&Ce.open(A!=null&&A.url?{url:A==null?void 0:A.url}:"")},u=A=>{const V=F.filter(L=>L.uid!==A);m(V)},g=async()=>{var R;const A=await l.validateFields();if(!A){We.error({message:t.error1,description:t.data_invalid});return}const V=l.getFieldsValue(),L=l.getFieldValue("employeeFiles");let x=[];if(F!=null&&F.length?x=(F==null?void 0:F.map(B=>{var W,Se;return((Se=(W=B==null?void 0:B.response)==null?void 0:W.data)==null?void 0:Se.url)??(B==null?void 0:B.url)}))??[]:x=((R=L==null?void 0:L.map(B=>(B==null?void 0:B.url)??null))==null?void 0:R.filter(Boolean))??[],V||A&&(L.length===0||x.length>0&&x.length===L.length)){S({code:void 0,codeLanguage:void 0,isFetching:!0});const B={employeeNote:V==null?void 0:V.employeeNote,employeeFiles:x},W=await Ft(P,B,c);S({code:W.code,codeLanguage:W.codeLanguage,isFetching:!1}),Qe.includes(W.code)&&(await p({limit:n.limit,page:n.current,filter:{...i,status:r}}),await w(c),s())}},j={employeeNote:(Y=(N=a==null?void 0:a.data)==null?void 0:N.construction)==null?void 0:Y.employeeNote,employeeFiles:(k=(M=(O=a==null?void 0:a.data)==null?void 0:O.construction)==null?void 0:M.employeeFiles)==null?void 0:k.map(A=>({url:A,status:"done",name:A}))};return{hideFormUpdate:s,formUpdate:l,construction:(a==null?void 0:a.data.construction)??{},handleUpdate:g,initialValues:j,handlePreviewAttachment:d,fileList:F,setFileList:m,handleChange:I,handleRemoveFile:u,isFetchingAdd:y.isFetching,isProcessUploadFile:b}},Ka=Ee("div",{target:"e19vkva11"})({name:"seoft9",styles:"display:flex;justify-content:space-between;margin:10px;&:hover{background:#f7f7f7;}"});var Za={name:"99halj",styles:"color:#2424f3"};const ei=Ee("span",{target:"e19vkva10"})("cursor:pointer;width:85%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;",a=>a.isUploaded&&Za,";");var ti={name:"1kevbid",styles:"& .ant-upload{width:100%;}"};const ai=()=>{const{hideFormUpdate:a,formUpdate:s,handleUpdate:i,initialValues:r,handlePreviewAttachment:n,fileList:l,handleRemoveFile:o,handleChange:c,isFetchingAdd:p,isProcessUploadFile:w}=Xa(),y=qe(),S=5;return e(le,{open:!0,title:t.update_construction,onCancel:a,width:"35%",style:{zIndex:"0"},okText:t.update,cancelText:t.cancel,onOk:i,okButtonProps:{disabled:w||p,loading:w||p},children:h(f,{form:s,layout:"vertical",name:"updateConstruction",initialValues:r,children:[e(f.Item,{name:"employeeNote",label:t.management_note,children:e(te.TextArea,{maxLength:"255",placeholder:t.note,rows:"3"})}),e(f.Item,{name:"employeeFiles",label:t.attached_files_employee,children:e(tt,{multiple:!0,css:ti,limitSizeFile:S,onPreview:n,isUploadAllFile:!0,fileList:l,onChange:c,showUploadList:!1,module:ut,children:e(se,{icon:e(z,{name:"icon-attachment-outlined",css:q({fontsize:y.iconSize},"","")}),type:"primary",ghost:!0,block:!0,size:"default",children:t.attachments})})}),l.map(b=>h(Ka,{children:[h(H,{style:{flexFlow:"row"},children:[e(z,{name:"icon-attachment-outlined",css:q({fontsize:y.iconSize,marginRight:y.margin.xs},"","")}),e(ei,{title:b.name,onClick:()=>n(b),isUploaded:b.isUploaded,children:b.name})]}),b.isUploaded?null:e(z,{name:"icon-delete-outlined",css:q({fontsize:y.iconSize,marginLeft:y.margin.xs},"",""),onClick:()=>{o(b==null?void 0:b.uid)}})]},b))]})})},ii=()=>{const{idBuilding:a,hideFormRegulation:s}=E.useContext(K),[i]=f.useForm(),[r,n]=E.useState(""),[l,o]=E.useState(!1);return E.useEffect(()=>{(async()=>{o(!0);const c=await wt({idBuilding:a,limit:J,page:G,filter:{name:void 0}});n(c==null?void 0:c.data),o(!1)})()},[]),[s,r,l,i]},ni=()=>{const[a,s,i,r]=ii();return e(le,{title:t.construction_regulations,cancelText:t.close,onCancel:a,onClose:!1,footer:null,open:!0,width:"60%",style:{zIndex:1e6},children:e(f,{form:r,name:"formRegulation",layout:"vertical",children:i?e(ea,{isLoading:i}):e(H,{gutter:[0,0],dangerouslySetInnerHTML:{__html:s}})})})},oi=a=>{var c,p,w,y,S;const{id:s,employee:i,action:r,currentData:n,actionDate:l}=a;return{...a,id:s??"",creator:(i==null?void 0:i.fullName)??"",actionName:r!=null&&r.toLowerCase()?(c=va[r==null?void 0:r.toLowerCase()])==null?void 0:c.label:"",time:l?(p=_(l))==null?void 0:p.format(Z):"",status:((w=Ne[n==null?void 0:n.status])==null?void 0:w.label)??"",constructorName:(n==null?void 0:n.constructorName)??"",phone:(n==null?void 0:n.constructorPhone)??"",estimatedStartTime:n!=null&&n.estimatedStartTime?(y=_(n==null?void 0:n.estimatedStartTime))==null?void 0:y.format(Z):"",estimatedEndTime:n!=null&&n.estimatedEndTime?(S=_(n==null?void 0:n.estimatedEndTime))==null?void 0:S.format(Z):"",description:(n==null?void 0:n.description)??"",note:(n==null?void 0:n.employeeNote)??"",depositValue:n!=null&&n.depositValue?ie(n==null?void 0:n.depositValue):"",refundValue:n!=null&&n.refundValue?ie(n==null?void 0:n.refundValue):""}},si=async({idBuilding:a,constructionId:s,filter:i,limit:r,page:n})=>{try{const{code:l,data:o,codeLanguage:c}=await ta({idBuilding:a,constructionId:s,filter:i,limit:r,page:n});return{code:l,codeLanguage:c,data:o==null?void 0:o.map(p=>oi(p))}}catch({code:l,codeLanguage:o}){return{code:l,codeLanguage:o,data:[]}}},ri=()=>{var S;const{formHistoryConstruction:a,hideFormHistoryConstruction:s,idBuilding:i,dataHistory:r,setDataHistory:n}=E.useContext(K),[l,o]=E.useState({current:G,limit:J}),[c,p]=E.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),w=(S=a==null?void 0:a.data)==null?void 0:S.construction;E.useEffect(()=>{(async()=>{p({code:void 0,codeLanguage:void 0,isFetching:!0});const b=await si({idBuilding:i,constructionId:w==null?void 0:w.id,limit:l.limit,page:l.current});n((b==null?void 0:b.data)??[]),o({current:G,limit:J}),p({code:b.code,codeLanguage:b.codeLanguage,isFetching:!1})})()},[]);const y={scrollToFirstRowOnChange:!0};return{dataSource:r,totalRecord:r==null?void 0:r.length,hideFormHistoryConstruction:s,loading:c.isFetching,scroll:y}},he=Ee("div",{target:"euiy1u20"})({name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"}),li=()=>{const{dataSource:a,totalRecord:s,hideFormHistoryConstruction:i,loading:r,scroll:n}=ri(),l=[{title:t.the_operator,key:"creator",dataIndex:"creator",width:180,align:"left",fixed:"left",render:(o,c)=>(o==null?void 0:o.length)>20?e(oe,{title:o,placement:"topLeft",children:e(he,{children:o})}):e(he,{children:o})},{title:t.operation,key:"actionName",dataIndex:"actionName",width:100,align:"left"},{title:t.time,key:"time",dataIndex:"time",width:150,align:"left"},{title:t.status1,key:"status",dataIndex:"status",width:150,align:"left"},{title:t.constructor_name,key:"constructorName",dataIndex:"constructorName",width:180,align:"left",render:(o,c)=>(o==null?void 0:o.length)>20?e(oe,{title:o,placement:"topLeft",children:e(he,{children:o})}):e(he,{children:o})},{title:t.phone,key:"phone",dataIndex:"phone",width:120,align:"left"},{title:t.estimated_start_time,key:"estimatedStartTime",dataIndex:"estimatedStartTime",width:200},{title:t.estimated_end_time,key:"estimatedEndTime",dataIndex:"estimatedEndTime",width:200},{title:t.content,key:"description",dataIndex:"description",width:120,align:"left",render:(o,c)=>(o==null?void 0:o.length)>10?e(oe,{title:o,placement:"topLeft",children:e(he,{children:o})}):e(he,{children:o})},{title:t.note,key:"note",dataIndex:"note",width:120,align:"left",render:(o,c)=>(o==null?void 0:o.length)>10?e(oe,{title:o,placement:"topLeft",children:e(he,{children:o})}):e(he,{children:o})},{title:t.deposit_value,key:"depositValue",dataIndex:"depositValue",width:120,align:"center",fixed:"right"},{title:t.refund_value,key:"refundValue",dataIndex:"refundValue",width:120,align:"center",fixed:"right"}];return h(le,{title:t.history_registration_construction,footer:null,open:!0,onCancel:i,width:"80%",children:[e(ce.ActionBox,{total:s}),e(Ot,{loading:r,columns:l,dataSource:a,bordered:!0,pagination:!1,scroll:{...n,x:l.reduce((o,c)=>o+ +((c==null?void 0:c.width)??0),0)}})]})},di=()=>{var Q,X;const a=Pe(),{idBuilding:s}=a,[i]=f.useForm(),{getConstructionBadges:r}=Ue(),{setQueryParamsConstruction:n}=we(),[l]=Re(),{formUpdateConstruction:o,hideFormUpdateConstruction:c,tablePagination:p,filter:w,status:y}=E.useContext(K),[S,b]=E.useState({data:[],isFetching:!1}),[T,C]=E.useState({data:[],isFetching:!1}),[P,F]=E.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),m=(Q=o==null?void 0:o.data)==null?void 0:Q.construction,[I,d]=E.useState(((X=m==null?void 0:m.residentFiles)==null?void 0:X.map(N=>({url:N,status:"done",name:N,isUploaded:!0})))??[]),u=({file:N,fileList:Y})=>{let O=Y;N.status==="removed"&&(O=Y),(N.status==="done"||N.status==="uploading")&&(O=Y),N.status||(O=Y.filter(M=>M.uid!==N.uid)),d(O.filter(M=>["done","uploading"].includes(M.status)))},g=N=>{var O,M;const Y=((M=(O=N==null?void 0:N.response)==null?void 0:O.data)==null?void 0:M.url)||(N==null?void 0:N.url);Ce.open(Y?{url:Y}:"")},j=N=>{const Y=I.filter(O=>O.uid!==N);d(Y)};E.useEffect(()=>{(async()=>{b({data:[],isFetching:!0});const N=await et({idBuilding:s,limit:J,page:G,filter:{id:m==null?void 0:m.unitId}});b({data:N.data,isFetching:!1})})()},[]),E.useEffect(()=>{(async()=>{C({...T,isFetching:!0});const N=S==null?void 0:S.data.find(Y=>Y.id===m.unitId);C({data:(N==null?void 0:N.residents)??[],isFetching:!1})})()},[S]),Ae(P.code,P.codeLanguage,{message:t.success,description:t.update_data_success});const $=async()=>{var k;const N=await i.validateFields(),Y=i.getFieldsValue(),O=i.getFieldValue("residentFiles");let M=[];if(I!=null&&I.length?M=(I==null?void 0:I.map(A=>{var V,L;return((L=(V=A==null?void 0:A.response)==null?void 0:V.data)==null?void 0:L.url)??(A==null?void 0:A.url)}))??[]:M=((k=O==null?void 0:O.map(A=>(A==null?void 0:A.url)??null))==null?void 0:k.filter(Boolean))??[],N||We.error({message:t.error1,description:t.data_invalid}),Y){F({code:void 0,codeLanguage:void 0,isFetching:!0});const A=await Ft({...Y,files:M},m==null?void 0:m.id,s);if(F({code:A.code,codeLanguage:A.codeLanguage,isFetching:!1}),Qe.includes(A.code)){const V={limit:p.limit,page:p.current,filter:{...w},status:y},L={limit:J,page:G,filter:{..._e},status:y},x=it(L,V);x&&await l({limit:J,page:G,filter:{..._e,status:y}}),x||n({...L}),await r(s),c()}}},U={constructorName:(m==null?void 0:m.constructorName)??"",constructorPhone:{countryCode:(m==null?void 0:m.countryCode)??ze,phoneCode:(m==null?void 0:m.phoneCode)??ze,phoneNumber:Yt(m==null?void 0:m.constructorPhone,ze)},description:(m==null?void 0:m.description)??"",estimatedStartTime:m!=null&&m.estimatedStartTimeOrigin?_(m==null?void 0:m.estimatedStartTimeOrigin):void 0,estimatedEndTime:m!=null&&m.estimatedEndTimeOrigin?_(m==null?void 0:m.estimatedEndTimeOrigin):void 0,employeeNote:(m==null?void 0:m.employeeNote)??"",unitId:(m==null?void 0:m.unitId)??"",residentId:m==null?void 0:m.residentId,depositValue:(m==null?void 0:m.depositValue)??"",residentFiles:(m==null?void 0:m.residentFiles)??[]};return{hideFormUpdateConstruction:c,handleUpdateConstruction:$,formUpdate:i,isFetchingUpdate:P.isFetching,initialValues:U,isFetchingApartment:S.isFetching,apartmentData:S.data,residentData:T.data,isFetchingResident:S.isFetching,handlePreviewAttachment:g,fileList:I,handleChange:u,handleRemoveFile:j}};var ci={name:"1kevbid",styles:"& .ant-upload{width:100%;}"};const mi=()=>{const{hideFormUpdateConstruction:a,handleUpdateConstruction:s,formUpdate:i,isFetchingUpdate:r,initialValues:n,isFetchingApartment:l,apartmentData:o,residentData:c,isFetchingResident:p,handlePreviewAttachment:w,fileList:y,handleChange:S,handleRemoveFile:b}=di(),T=h(H,{style:{justifyContent:"space-between",alignItems:"center"},children:[e(D.Text,{children:t.update_construction}),h(H,{children:[e(se,{onClick:a,style:{marginRight:10},children:t.cancel}),e(se,{type:"primary",onClick:s,disabled:r,loading:r,children:t.confirm})]})]});return e(le,{title:T,onCancel:a,open:!0,width:"55%",bodyStyle:{maxHeight:"500px",overflowY:"scroll"},footer:null,closable:!1,closeIcon:null,children:e(f,{initialValues:n,form:i,name:"formUpdate",layout:"vertical",children:h(H,{gutter:[12,12],children:[e(v,{span:"12",children:e(f.Item,{rules:[{required:!0}],label:t.constructor_name,name:"constructorName",children:e(te,{maxLength:255,placeholder:t.constructor_name,allowClear:!0})})}),e(v,{span:"12",children:e(f.Item,{name:"constructorPhone",label:t.label.phone,rules:[{required:!0},{validator:async(C,P)=>P!=null&&P.phoneNumber&&!gt(P.phoneNumber)?Promise.reject(t.status.phone_invalid):Promise.resolve()}],children:e(te.PhoneInput,{placeholder:t.label.phone})})}),e(v,{span:"12",children:e(f.Item,{dependencies:["estimatedEndTime"],rules:[{required:!0},({getFieldValue:C})=>({validator(P,F){return F&&C("estimatedEndTime")&&_(F).isAfter(C("estimatedEndTime"))?Promise.reject(t.expected_incoming_construction_at_must_lower_or_equal_than_expected_leaving_at):Promise.resolve()}})],label:t.estimated_start_time,name:"estimatedStartTime",children:e(be,{fluid:"true",placeholder:"HH:mm DD/MM/YYYY",format:"HH:mm DD/MM/YYYY",showTime:{format:"HH:mm DD/MM/YYYY"},allowClear:!1})})}),e(v,{span:"12",children:e(f.Item,{dependencies:["estimatedStartTime"],rules:[{required:!0},({getFieldValue:C})=>({validator(P,F){return F&&C("estimatedStartTime")&&_(F).isBefore(C("estimatedStartTime"))?Promise.reject(t.expected_leaving_construction_at_must_greater_or_equal_than_expected_incoming_at):Promise.resolve()}})],label:t.estimated_end_time,name:"estimatedEndTime",children:e(be,{fluid:"true",placeholder:"HH:mm DD/MM/YYYY",format:"HH:mm DD/MM/YYYY",showTime:{format:"HH:mm DD/MM/YYYY"},allowClear:!1})})}),e(v,{span:"12",children:e(f.Item,{rules:[{required:!0}],label:t.unit,name:"unitId",children:e(ne,{allowClear:!0,disabled:!0,showSearch:!0,placeholder:t.label.select_apartment,filterOption:!1,loading:l,getPopupContainer:C=>C.parentNode,style:{width:"100%"},dropdownRender:C=>l?e("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:e(St,{})}):C,children:o==null?void 0:o.map(({id:C,name:P})=>e(ne.Option,{value:C,children:P},C))})})}),e(v,{span:"12",children:e(f.Item,{rules:[{required:!0}],label:t.resident,name:"residentId",children:e(ne,{allowClear:!0,showSearch:!0,placeholder:t.label.select_resident,filterOption:!1,loading:p,getPopupContainer:C=>C.parentNode,style:{width:"100%"},children:c==null?void 0:c.map(({id:C,fullName:P})=>e(ne.Option,{value:C,children:P},C))})})}),e(v,{span:"24",children:e(f.Item,{label:`${t.deposit_value} (${t.vnd})`,name:"depositValue",children:e(Ie,{placeholder:t.deposit_value,formatter:C=>ie(C),fluid:"true",min:0})})}),e(v,{span:"24",children:e(f.Item,{label:t.content,name:"description",rules:[{required:!0}],children:e(te.TextArea,{maxLength:"3000",fluid:"true",placeholder:t.description,rows:"4",allowClear:!0})})}),e(v,{span:"24",children:e(f.Item,{label:t.note,name:"employeeNote",children:e(te.TextArea,{maxLength:"255",fluid:"true",placeholder:t.note,rows:"2",allowClear:!0})})}),h(v,{span:"24",children:[e(f.Item,{name:"residentFiles",label:t.attached_files,children:e(tt,{multiple:!0,maxCount:"10",css:ci,onPreview:w,limitSizeFile:5,isUploadAllFile:!0,fileList:y,onChange:S,showUploadList:!1,children:e(se,{icon:e(z,{name:"icon-attachment-outlined",css:C=>({fontsize:C.iconSize})}),type:"primary",ghost:!0,block:!0,size:"default",children:t.attachments})})}),y==null?void 0:y.map(C=>e(Je,{file:C,handlePreviewAttachment:w,handleRemoveFile:b})),h("i",{css:C=>({fontSize:C.fontSize.sm,color:C.labelColor}),children:["* ",t.file_format]})]})]})})})},ui=async a=>(await ma({type:st},a)).data,pi=async a=>{const s={type:st,status:ft,autoApprove:!1,regulation:""},{data:i,code:r,codeLanguage:n}=await ua(s,a);return[i,r,n]},hi=()=>{const{setConstructionSetting:a,constructionSetting:s,idBuilding:i}=E.useContext(K);return[async()=>{const n={...s},l=await ui(i);if(l&&l.length){const o=l[0];n.autoApprove=!1,n.status=o.status===je,n.id=o.id,n.regulation=o.regulation,a(n)}else{const[o]=await pi(i);n.autoApprove=!1,n.status=o.status===je,n.id=o.id,n.regulation=o.regulation,a(n)}return n}]},gi=()=>{const{setTitlePage:a,setVisibleFilterBox:s,setVisibleSearchBox:i}=E.useContext(ht),{search:r}=ia(),{formUpdateStatusData:n,formDetailData:l,formAddData:o,formConfigData:c,formAgreeTermsData:p,formUpdateData:w,idBuilding:y,formShowRegulation:S,formHistoryConstruction:b,formUpdateConstruction:T}=E.useContext(K),{getQueryParamsConstruction:C}=we(),[P]=Re(),[F]=hi();return E.useEffect(()=>(a(t.construction_management),i(!0),(async()=>await F())(),()=>{a(""),s(!1),i(!1)}),[]),E.useEffect(()=>{(async()=>{if(y){const{pagination:m,filter:I,status:d}=C();r&&await P({filter:{...I,status:d},limit:m.limit,page:m.page})}})()},[r]),[n,l,o,c,p,w,S,b,T]},fi=()=>{const[a,s,i,r,n,l,o,c,p]=gi();return h(Te,{children:[h(ce.Wrapper,{children:[e(Ia,{}),h(ce.Container,{children:[e(ce.Header,{children:e(Aa,{})}),h(ce.Content,{children:[e(Oa,{}),e(ka,{})]})]})]}),a.isShow&&e(Ba,{}),s.isShow&&e(Va,{}),l.isShow&&e(ai,{}),i.isShow&&e(Ga,{}),r.isShow&&e(Wa,{}),n.isShow&&e(Ja,{}),o.isShow&&e(ni,{}),c.isShow&&e(li,{}),p.isShow&&e(mi,{})]})},no=()=>e(Fa,{children:e(fi,{})});export{no as default};
