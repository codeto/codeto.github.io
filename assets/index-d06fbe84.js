import{j as e,a as _,u as we,b as He,F as te,c as Se}from"./@emotion-63839449.js";import{r as Ie,j as le,l as be,D as ae,P as $,u as Xe,d as Te,k as je,a as ie,T as Qe}from"./index-b17d22e5.js";import{r as b}from"./react-4fd50329.js";import{e as Je}from"./lodash-88fe09e6.js";import{h as S}from"./moment-a468e1f9.js";import{a9 as ne,s as J,a1 as Ke,K as H,b0 as Ze,aF as et,al as tt,bv as at,at as it,eV as nt,ag as ot,fN as Pe,l as t,fO as rt,fP as lt,co as ct,fQ as _e,a3 as st,I as Y,bG as dt,a5 as Re,dq as pt,a as ce,fR as ut,cp as De,c6 as j,dk as mt,X as ht,fM as ft,cs as xe}from"./index-c2ded735.js";import"./file-saver-40cf32a9.js";import{I as V,S as w}from"./index-43183512.js";import"./react-redux-896b353b.js";import{u as gt}from"./useService-37d60dc0.js";import"./@firebase-43527ee1.js";import{c as ye,d as bt,e as Rt,f as yt,g as vt,u as Ct,h as Ft}from"./receipt-01489128.js";import{b as wt}from"./buildDetailBills-28b155ef.js";import{P as Ee}from"./prop-types-1172f4d5.js";import{F as U,u as K}from"./index-687ba9e6.js";import{u as St}from"./react-router-a4308f7b.js";import{B as It}from"./index-881eef42.js";import{d as Tt}from"./downloadFileFromUrl-79614833.js";import{B as ve,D as Pt,g as Oe,w as X,b as O,k as Ce,S as _t,z as Le,R as Dt,a as xt,O as q}from"./antd-f9eae174.js";import{b as ke}from"./buildLabelTree-54b4bf58.js";import{e as Fe}from"./rules-c1d56c23.js";import{M as Et}from"./currency-cb786ed8.js";import{M as Ot}from"./index-6a3b7dc6.js";import{p as Lt}from"./printHtml-6274ec45.js";import{u as Ue}from"./useQuery-d54d310a.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./index-f7aef2cc.js";const Q={code:void 0,unitName:void 0,cashier:void 0,service:"",receiptType:"",fund:"",label:"",status:"",paymentMethod:"",paymentAt:[S().startOf("months"),S().endOf("months")]},L=b.createContext({receiptPermissionExport:!1,receiptPermissionWrite:!1,receiptPermissionDelete:!1,fundPermissionRead:!1,idBuilding:0,formFilter:void 0,receiptGetsStatus:{isFetching:!1},setReceiptGetsStatus:()=>{},filter:{...Q},setFilter:()=>{},tableDataTotalRow:{totalUnitAccountPayment:0,totalPayment:0},setTableDataTotalRow:()=>{},tableData:{records:[],totalRecord:0},setTableData:()=>{},tablePagination:{current:ne,limit:J},setTablePagination:()=>{},receiptCreateForm:void 0,showReceiptCreateForm:()=>{},hideReceiptCreateForm:()=>{},receiptUpdateForm:void 0,showReceiptUpdateForm:()=>{},hideReceiptUpdateForm:()=>{},receiptCancelForm:void 0,showReceiptCancelForm:()=>{},hideReceiptCancelForm:()=>{},receiptPrintForm:void 0,showReceiptPrintForm:()=>{},hideReceiptPrintForm:()=>{},receiptBillListForm:void 0,showReceiptBillListForm:()=>{},hideReceiptBillListForm:()=>{}}),se=({children:l})=>{const{idBuilding:s}=St(),{isUserCs:o}=Ke(),[m,g]=b.useState({isFetching:!1}),[d,u]=b.useState({...Q}),[h,i]=b.useState({records:[],totalRecord:0}),[a,y]=b.useState({totalUnitAccountPayment:0,totalPayment:0}),[R,r]=b.useState({current:ne,limit:J}),[p,C,v]=H(),[n,c,F]=H(),[x,N,D]=H(),[E,A,T]=H(),[M,P,W]=H(),[z]=U.useForm(),{getPermissionByModuleCode:ee}=Ze(),f=ee(et),k=ee(tt),Be=(f==null?void 0:f[at])??!1,Ne=(f==null?void 0:f[it])??!1,Ae=(f==null?void 0:f[nt])??!1,Ye=(k==null?void 0:k[ot])??!1,Ve={receiptPermissionExport:Be,receiptPermissionWrite:Ne,receiptPermissionDelete:Ae,fundPermissionRead:Ye,idBuilding:s,formFilter:z,receiptGetsStatus:m,setReceiptGetsStatus:g,filter:d,setFilter:u,tableDataTotalRow:a,setTableDataTotalRow:y,tableData:h,setTableData:({records:Ge,totalRecord:qe})=>{i({records:Ge.map(G=>{var de;const $e=G.bills.map(I=>{var pe,ue,me,he,fe,ge;const{content:ze,note:We}=wt({createdFor:I.createdFor,serviceName:((ue=(pe=I==null?void 0:I.contract)==null?void 0:pe.service)==null?void 0:ue.name)??((me=I==null?void 0:I.service)==null?void 0:me.name)??"",contractTemplateName:((fe=(he=I==null?void 0:I.contract)==null?void 0:he.contractTemplate)==null?void 0:fe.name)??"",totalNumberUse:I.totalNumberUse,registrationPlate:((ge=I==null?void 0:I.contract)==null?void 0:ge.registrationPlate)??"",parentId:I.parentId,type:I.type,contentBill:I.content});return{...I,key:I.id,note:We,content:ze}});return{...G,payer:o?"***":G.payer,deletedBy:((de=G==null?void 0:G.deletedBy)==null?void 0:de.fullName)??"",key:G.id,bills:Je.sortBy($e,["serviceId","createdFor"])}}),totalRecord:qe})},tablePagination:R,setTablePagination:r,receiptCreateForm:n,showReceiptCreateForm:c,hideReceiptCreateForm:F,receiptUpdateForm:x,showReceiptUpdateForm:N,hideReceiptUpdateForm:D,receiptCancelForm:E,showReceiptCancelForm:A,hideReceiptCancelForm:T,receiptPrintForm:p,showReceiptPrintForm:C,hideReceiptPrintForm:v,receiptBillListForm:M,showReceiptBillListForm:P,hideReceiptBillListForm:W};return e(L.Provider,{value:Ve,children:l})};se.propTypes={children:Ee.node};se.defaultProps={children:e("div",{})};const kt=se,Z=()=>{const{idBuilding:l,setTablePagination:s,setTableData:o,setTableDataTotalRow:m,setReceiptGetsStatus:g}=b.useContext(L);return[async({filter:u,tablePaginationInp:h,isChangeTotalRow:i})=>{const{paymentAt:a,service:y,fund:R,receiptType:r,paymentMethod:p,label:C,status:v,unitName:n,code:c,cashier:F}=u;if(g({isFetching:!0}),s({current:h.current,limit:h.limit}),!i){const x=await ye({filter:{code:c||void 0,unitName:n||void 0,serviceId:y||void 0,fundId:R||void 0,receiptType:r||void 0,paymentMethod:p||void 0,labelId:C||void 0,status:v||void 0,from:a!=null&&a[0]?S(a==null?void 0:a[0]).startOf("day").toISOString():void 0,to:a!=null&&a[1]?S(a==null?void 0:a[1]).endOf("day").toISOString():void 0,cashier:F||void 0},idBuilding:l,limit:h.limit,page:h.current});o({records:x.data,totalRecord:x.totalRecord})}if(i){const[x,N]=await Promise.all([ye({filter:{code:c||void 0,unitName:n||void 0,serviceId:y||void 0,fundId:R||void 0,receiptType:r||void 0,paymentMethod:p||void 0,labelId:C||void 0,status:v||void 0,from:a!=null&&a[0]?S(a==null?void 0:a[0]).startOf("day").toISOString():void 0,to:a!=null&&a[1]?S(a==null?void 0:a[1]).endOf("day").toISOString():void 0,cashier:F||void 0},idBuilding:l,limit:h.limit,page:h.current}),bt({filter:{code:c||void 0,unitName:n||void 0,serviceId:y||void 0,fundId:R||void 0,receiptType:r||void 0,paymentMethod:p||void 0,labelId:C||void 0,status:v||void 0,from:a!=null&&a[0]?S(a==null?void 0:a[0]).startOf("day").toISOString():void 0,to:a!=null&&a[1]?S(a==null?void 0:a[1]).endOf("day").toISOString():void 0,cashier:F||void 0},idBuilding:l})]);o({records:x.data,totalRecord:x.totalRecord}),m({totalUnitAccountPayment:N.data.unitAccountPayment||0,totalPayment:N.data.sum||0})}g({isFetching:!1})}]},Ut=()=>{const{idBuilding:l,filter:s,setFilter:o,formFilter:m,fundPermissionRead:g}=b.useContext(L),{serviceInUses:d,getServiceInUses:u}=gt(),{fundData:h}=Ie(),{labelsAccountingData:i}=le(),[a]=Z();return b.useEffect(()=>{(async()=>await u({idBuilding:l}))()},[]),[s,d,h,i,async R=>{const r={...R};r.receiptType!==Pe&&(r.service=""),o(r),m.setFieldsValue(r),await a({filter:r,isChangeTotalRow:!0,tablePaginationInp:{current:1,limit:J}})},m,g]},Mt=()=>{const[l,s,o,m,g,d,u]=Ut(),h=b.useMemo(()=>[{label:t.unit,key:"unitName",component:e(V,{placeholder:t.unit,fluid:!0}),visible:!0},{label:t.label.receipt_code,key:"code",component:e(V,{placeholder:t.label.receipt_code,fluid:!0}),visible:!0},{label:t.label.receipt_type,key:"receiptType",component:_(w,{fluid:"true",getPopupContainer:i=>i.parentNode,children:[e(w.Option,{value:"",children:t.all_type},"receipt_type_0"),rt.map(({id:i,name:a})=>e(w.Option,{value:i,children:a},i))]}),visible:!0,fixed:!0},{label:t.label.service,key:"service",component:_(w,{showSearch:!0,fluid:"true",filterOption:(i,a)=>a.children.toLowerCase().includes(i.toLowerCase()),disabled:l.receiptType!==Pe,getPopupContainer:i=>i.parentNode,children:[e(w.Option,{value:"",children:t.all_service},"service_0"),s.map(({id:i,name:a})=>e(w.Option,{value:i,children:a},i))]}),visible:!0},{label:t.label.date_of_payment,key:"paymentAt",component:e(ae.RangePicker,{placeholder:[t.label.from_date,t.label.to_date],fluid:"true",format:[be,be],getPopupContainer:i=>i.parentNode}),visible:!0,fixed:!0},{label:t.status1,key:"status",component:_(w,{fluid:"true",getPopupContainer:i=>i.parentNode,children:[e(w.Option,{value:"",children:t.all_status},"status_0"),lt.map(({id:i,name:a})=>e(w.Option,{value:i,children:a},i))]}),visible:!0},{label:t.label.fund,key:"fund",component:_(w,{fluid:"true",getPopupContainer:i=>i.parentNode,children:[e(w.Option,{value:"",children:t.all_fund},"fund_0"),o.map(({id:i,name:a})=>e(w.Option,{value:i,children:a},i))]}),visible:!0},{label:t.label.payment_method,key:"paymentMethod",component:_(w,{fluid:"true",getPopupContainer:i=>i.parentNode,children:[e(w.Option,{value:"",children:t.all_method},"payment_method_0"),u?ct.map(({label:i,value:a})=>e(w.Option,{value:a,children:i},a)):null]}),visible:!0},{label:t.label.cashier,key:"cashier",component:e(V,{placeholder:t.label.cashier,fluid:!0}),visible:!0},{label:t.label.label,key:"label",component:_(w,{showSearch:!0,filterOption:(i,a)=>a.children.toLowerCase().includes(i.toLowerCase()),placeholder:t.label.label,fluid:"true",getPopupContainer:i=>i.parentNode,children:[e(w.Option,{value:"",children:t.all_label},"label_0"),m.map(({id:i,title:a})=>e(w.Option,{value:i,children:a},i))]}),visible:!0}],[l.receiptType,s,o,u,m]);return e($.FilterBox,{defaultFilter:Q,filters:h,formData:d,onSearch:g})},Bt=()=>{const{idBuilding:l,filter:s,showReceiptCreateForm:o,tableData:m,receiptPermissionWrite:g,receiptPermissionExport:d}=b.useContext(L),[u,h]=b.useState({isFetching:!1,code:void 0,codeLanguage:void 0});K(u.code,u.codeLanguage,{message:t.success,description:t.export_data_success});const i=async(r,p)=>{var C,v;try{const{paymentAt:n,code:c,unitName:F,service:x,fund:N,receiptType:D,paymentMethod:E,label:A,status:T,cashier:M}=p;return await Rt({filter:{code:c||void 0,unitName:F||void 0,serviceId:x||void 0,fundId:N||void 0,receiptType:D||void 0,paymentMethod:E||void 0,labelId:A||void 0,status:T||void 0,cashier:M||void 0,type:r,from:(C=n==null?void 0:n[0])==null?void 0:C.startOf("day").toISOString(),to:(v=n==null?void 0:n[1])==null?void 0:v.endOf("day").toISOString()},idBuilding:l})}catch(n){return n}},a=(r,p)=>{r&&Tt(r,document,_e.get(p).fileName)},y=async({key:r})=>{h({isFetching:!0,code:void 0,codeLanguage:void 0});const p=await i(r,s);a(p==null?void 0:p.data,r),h({isFetching:!1,code:p.code,codeLanguage:p.codeLanguage})},{totalRecord:R}=m;return[g,d,u.isFetching,R,y,o]},{Item:Nt}=Oe;Ee.func;function At(){const[l,s,o,m,g,d]=Bt(),u=st(),h=({onSelectExportType:a})=>e(It,{children:e(Oe,{onClick:({key:y})=>{u({action:pt,label:Re}),a({key:y})},children:Array.from(_e.values()).map(({id:y,name:R})=>e(Nt,{children:R},y))})}),i=[s?e(Pt,{dropdownRender:()=>h({onSelectExportType:g}),children:_(ve,{css:a=>({marginRight:a.margin.xs}),type:"primary",ghost:!0,icon:e(Y,{name:"icon-download-outlined"}),loading:o,children:[t.export," ",e(Y,{name:"icon-arrow-down-outlined"})]})},"export"):null,l?e(ve,{type:"primary",icon:e(Y,{name:"icon-plus-circle-outlined"}),onClick:()=>{u({action:dt,label:Re}),d()},children:t.label.create_receipt},"create_receipt"):null];return e($.ActionBox,{actions:i,total:m})}const Yt=()=>{const{layoutScrollRef:l}=b.useContext(ce),{filter:s,showReceiptBillListForm:o,showReceiptUpdateForm:m,showReceiptCancelForm:g,showReceiptPrintForm:d,tableData:u,tableDataTotalRow:h,tablePagination:i,receiptGetsStatus:a,receiptPermissionWrite:y,receiptPermissionDelete:R}=b.useContext(L),[r]=Z(),p=we(),C="15/04/2024",{currentBuilding:v}=Xe(),{lockDataAt:n}=v;b.useEffect(()=>{(async()=>await r({filter:s,isChangeTotalRow:!0,tablePaginationInp:i}))()},[]);const c=u.records,F=f=>f.deletedAt?"disabled":"",x=f=>y&&!f.deletedAt,N=f=>{let k=R&&!f.deletedAt&&(f==null?void 0:f.paySlipId)===null;return k&&f.unitAccountPayment&&S(C,"DD/MM/YYYY").isAfter(S(f.createdAt),"days")&&(k=!1),(f==null?void 0:f.paymentMethod)===ut&&(k=!1),k},D=f=>{o({...f})},E=f=>{m({...f})},A=f=>{g({...f})},T=f=>{d({...f})},M=async(f,k)=>{i.current!==f?await r({filter:s,isChangeTableDataTotal:!1,tablePaginationInp:{current:f,limit:i.limit}}):i.limit!==k&&await r({filter:s,isChangeTableDataTotal:!1,tablePaginationInp:{current:i.current,limit:k}})},P={current:i.current,pageSize:i.limit,total:u.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:M},W={offsetScroll:p.offsetScrollX,getContainer:()=>l.current},z={scrollToFirstRowOnChange:!0},ee=f=>!!(n&&f&&S(f).isBefore(n));return[x,N,a.isFetching,c,F,P,z,W,h,D,E,A,T,ee]};var Vt={name:"s5xdrg",styles:"display:flex;align-items:center"};function Gt(){const[l,s,o,m,g,d,u,h,i,a,y,R,r,p]=Yt(),C=we(),v=[{title:t.label.receipt_code,key:"receiptCode",dataIndex:"code",fixed:"left",width:180,render:(n,c)=>_("div",{css:Vt,children:[e("span",{css:He({marginRight:C.margin.xs},"",""),children:n}),p(c==null?void 0:c.createdAt)?e(Y,{name:"icon-lock-outlined"}):null]})},{title:t.label.apartment,key:"apartment",dataIndex:"unit",fixed:"left",width:120,render:n=>n==null?void 0:n.name},{title:t.label.address,key:"address",dataIndex:"address",fixed:"left",width:120,render:(n,c)=>{var F;return(F=c==null?void 0:c.unit)!=null&&F.name?"":(c==null?void 0:c.address)||""}},{title:t.label.date_of_payment,key:"dateOfPayment",dataIndex:"paidAt",width:150,render:n=>n?S(n).format("DD/MM/YYYY"):""},{title:t.label.content,key:"detail",dataIndex:"content",width:240,ellipsis:!0,render:(n,c)=>c!=null&&c.bills[0]?e(Y,{css:F=>({marginRight:F.margin.sm,fontSize:F.iconSize}),onClick:()=>a(c),name:"icon-eye-outlined",title:t.label.content}):n},{title:t.label.cashier,key:"cashier",dataIndex:"cashier",width:180},{title:t.label.payer,key:"payer",dataIndex:"payer",width:180},{title:t.label.note,key:"note",dataIndex:"note",width:200,ellipsis:!0},{title:t.label.fund,key:"fund",dataIndex:"fund",width:180,render:n=>n==null?void 0:n.name},{title:t.label.payment_method,key:"paymentMethod",dataIndex:"paymentMethod",width:210,render:n=>{var c;return(c=De[n])==null?void 0:c.label}},{title:t.type,key:"type",dataIndex:"unitAccount",width:140,render:n=>_(te,{children:[n==="REVENUE"&&e(X,{color:"success",children:t.label.revenue}),n==="EXPENSE"&&e(X,{color:"error",children:t.label.expense})]})},{title:t.label.voucher_day,key:"voucherDay",dataIndex:"voucherDay",width:120,render:n=>n?S(n).format("DD/MM/YYYY"):""},{title:t.label.label,key:"label",width:180,ellipsis:!0,render:(n,c)=>{var F,x;return c.label?e(X,{color:(F=c.label)==null?void 0:F.color,children:(x=c.label)==null?void 0:x.title}):null}},{title:t.label.status,key:"status",dataIndex:"deletedAt",width:150,render:n=>n?e(X,{color:"error",children:t.label.canceled}):e(X,{color:"success",children:t.label.not_canceled})},{title:t.label.deleted_at,key:"deletedAt",dataIndex:"deletedAt",width:120,render:n=>n?S(n).format("DD/MM/YYYY"):""},{title:t.label.deleted_by,key:"deletedBy",dataIndex:"deletedBy",width:180},{title:t.label.total_service_advance_payment,key:"unitAccountPayment",fixed:"right",align:"right",width:120,children:[{title:j(Math.round(i.totalUnitAccountPayment)),key:"totalUnitAccountPayment",fixed:"right",align:"right",width:120,dataIndex:"unitAccountPayment",render:n=>j(Math.round(n))}]},{title:t.label.total_charge,key:"netRevenue",fixed:"right",align:"right",width:120,children:[{title:j(Math.round(i.totalPayment)),key:"totalNetRevenue",fixed:"right",align:"right",width:120,dataIndex:"netRevenue",render:n=>j(Math.round(n))}]},{title:t.actions,key:"action",fixed:"right",align:"center",width:110,render:(n,c)=>_(te,{children:[e(Y,{css:F=>({fontSize:F.iconSize}),onClick:()=>r(c),name:"icon-print-outlined",title:t.label.print}),p(c==null?void 0:c.createdAt)?null:_(te,{children:[l(c)?e(Y,{css:F=>({marginLeft:F.margin.sm,fontSize:F.iconSize}),onClick:()=>y(c),name:"icon-edit-outlined",title:t.update}):null,s(c)?e(Y,{css:F=>({fontSize:F.iconSize,marginLeft:F.margin.sm}),onClick:()=>R(c),name:"icon-minus-circle-outlined",title:t.button.cancel}):null]})]})}];return e($.Table,{columns:v,dataSource:m,loading:o,pagination:d,rowClassName:g,scroll:{...u,x:v.reduce((n,c)=>n+c.width,0)},sticky:h,bordered:!0})}const qt=()=>{const{setFilter:l,formFilter:s}=b.useContext(L),[o]=Z();return[async()=>{s.resetFields(),l({...Q}),await o({filter:{...Q},isChangeTotalRow:!0,tablePaginationInp:{current:ne,limit:J}})}]},{useForm:$t}=U;function zt(){const{idBuilding:l,showReceiptPrintForm:s,hideReceiptCreateForm:o}=b.useContext(L),[m]=qt(),{currentUser:g}=b.useContext(ce),[d]=$t(),[u,h]=b.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[i,a]=b.useState({isFetching:!1}),[y,R]=b.useState([]),[r,p]=b.useState([]),{fundData:C}=Ie(),{labelTreeData:v}=le();K(u.code,u.codeLanguage,{message:t.success,description:t.create_data_success});const n=async D=>{a({isFetching:!0});const E=await mt({idBuilding:l,page:ne,limit:J,filter:{name:D}});R(E.data),a({isFetching:!1})},c=Te(async D=>{await n(D)});return b.useEffect(()=>{(async()=>await n())()},[]),[u,i,r,y,C,v,d,g,c,D=>{var E,A,T,M;if((A=(E=D[0])==null?void 0:E.name)!=null&&A.includes("paymentMethod"))d.setFieldsValue({fundId:void 0});else if((M=(T=D[0])==null?void 0:T.name)!=null&&M.includes("unitId")){const P=y.find(W=>{var z;return W.id===Number((z=D[0])==null?void 0:z.value)});d.getFieldValue("address")||d.setFieldsValue({address:P==null?void 0:P.name}),d.setFieldsValue({payer:""}),p((P==null?void 0:P.residents)??[])}},async()=>{var D,E;if(!u.isFetching&&await d.validateFields()){h({isFetching:!0,code:void 0,codeLanguage:void 0});const T=d.getFieldsValue(),M={...T,type:"",createdAt:T.createdAt.toISOString(),voucherDay:T.voucherDay?(D=T==null?void 0:T.voucherDay)==null?void 0:D.toISOString():void 0,labelId:((E=T==null?void 0:T.labelId)==null?void 0:E.value)||void 0};try{const P=await yt({body:M,headers:{[ht]:l}});h({isFetching:!1,code:P.code,codeLanguage:P.codeLanguage}),await m(),o(),s({...P.data})}catch(P){h({isFetching:!1,code:P.code,codeLanguage:P.codeLanguage})}}},()=>o()]}const{Item:B}=U,{Option:oe}=w,{TextArea:Wt}=V,re=Se(B,{target:"ei0e4zs0"})({name:"1annwmx",styles:"& .ant-form-item-control-input-content{width:100%;}"});function Ht(){const[l,s,o,m,g,d,u,h,i,a,y,R]=zt();return e(ie,{title:t.label.create_receipt,open:!0,width:"70%",confirmLoading:l.isFetching,okText:t.label.confirm,cancelText:t.label.cancel,onOk:y,okButtonProps:{disabled:l.isFetching,loading:l.isFetching},onCancel:R,children:e(U,{name:"receiptCreateForm",layout:"vertical",scrollToFirstError:!0,form:u,initialValues:{cashier:h.fullName,createdAt:S(new Date)},onFieldsChange:a,children:_(Dt,{gutter:[8,0],children:[e(O,{span:12,children:e(B,{name:"cashier",label:t.label.cashier,rules:[{required:!0},Fe],children:e(V,{placeholder:t.label.cashier})})}),e(O,{span:12,children:e(B,{name:"payer",label:t.label.payer,rules:[{required:!0},Fe],children:e(Ce,{filterOption:(r,p)=>{var C,v;return((v=(C=p==null?void 0:p.value)==null?void 0:C.toUpperCase())==null?void 0:v.indexOf(r.toUpperCase()))!==-1},placeholder:t.label.payer,style:{width:"100%"},children:o.map(({id:r,fullName:p})=>e(Ce.Option,{value:p,children:p},`${p}-${r}`))})})}),e(O,{span:12,children:e(re,{name:"unitId",label:t.label.apartment,children:e(w,{allowClear:!0,showSearch:!0,placeholder:t.select_apartment,filterOption:!1,loading:s.isFetching,onSearch:Te(i),style:{width:"100%"},dropdownRender:r=>s.isFetching?e("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:e(_t,{})}):r,children:m.map(({id:r,name:p})=>e(oe,{value:r,children:p},r))})})}),e(O,{span:12,children:e(B,{name:"address",label:t.label.address,children:e(V,{placeholder:t.label.address})})}),e(O,{span:12,children:e(re,{name:"paymentMethod",label:t.label.payment_method,required:!0,rules:[{required:!0}],children:e(w,{placeholder:t.label.select_payment_method,style:{width:"100%"},getPopupContainer:()=>document.getElementById("receiptCreateForm"),children:ft.map(({id:r,name:p})=>e(oe,{value:r,children:p},r))})})}),e(O,{span:12,children:e(B,{noStyle:!0,shouldUpdate:(r,p)=>r.paymentMethod!==p.paymentMethod,children:({getFieldValue:r})=>e(re,{name:"fundId",label:t.label.fund,required:!0,rules:[{required:!0}],children:e(w,{placeholder:t.label.select_fund,style:{width:"100%"},getPopupContainer:()=>document.getElementById("receiptCreateForm"),children:g.filter(p=>p.method===r("paymentMethod")).map(({id:p,name:C})=>e(oe,{value:p,children:C},p))})})})}),e(O,{span:12,children:e(B,{name:"totalPayment",label:`${t.label.total_money} (VNĐ)`,required:!0,rules:[{required:!0,type:"integer",max:Et,min:1}],children:e(je,{formatter:r=>j(r),placeholder:t.label.total_money})})}),e(O,{span:12,children:e(B,{name:"createdAt",label:t.label.date_of_payment,required:!0,rules:[{required:!0}],children:e(ae,{allowClear:!1,style:{width:"100%"},format:"DD/MM/YYYY",disabledDate:r=>!r||r.isAfter(S(new Date))})})}),e(O,{span:12,children:e(B,{name:"voucherDay",label:t.label.voucher_day,children:e(ae,{style:{width:"100%"},format:"DD/MM/YYYY"})})}),e(O,{span:12,children:e(U.Item,{name:"labelId",label:t.label.label,children:e(Le,{placeholder:t.label.label,style:{width:"100%"},treeDefaultExpandAll:!0,allowClear:!0,treeLine:!0,treeIcon:!0,virtual:"false",getPopupContainer:()=>document.getElementById("receiptCreateForm"),treeData:ke(d),labelInValue:!0})})}),e(O,{span:24,children:e(B,{name:"content",label:t.label.content,children:e(Wt,{maxLength:255,placeholder:t.label.content})})}),e(O,{span:24,children:e(B,{name:"note",label:t.label.note,children:e(V,{placeholder:t.label.note})})})]})})})}function Xt(){const{hideReceiptBillListForm:l,receiptBillListForm:s}=b.useContext(L),{bills:o}=s.data,m=[{title:t.label.content,key:"content",dataIndex:"content"},{title:t.label.actually_revenue,key:"netRevenue",align:"right",width:140,dataIndex:"netRevenue",render:g=>e(xt.NegativeNumber,{children:g||0})}];return e(ie,{title:`${t.label.detail} (${o.length} ${t.bill})`,open:!0,onCancel:l,footer:null,children:e(Qe,{bordered:!0,columns:m,dataSource:o,pagination:!1})})}function jt(){const{hideReceiptPrintForm:l,receiptPrintForm:s,idBuilding:o}=b.useContext(L),{id:m}=s.data,{removeQuery:g}=Ue(),[d,u]=b.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[h,i]=b.useState();K(d.code,d.codeLanguage);const a=()=>{g("receiptId"),l()},y=()=>{Lt(h)};return b.useEffect(()=>{(async()=>{u({isFetching:!0});try{const R=await vt({idBuilding:o,idReceipt:m});i(R.data),u({isFetching:!1,code:R.code,codeLanguage:R.codeLanguage})}catch(R){u({isFetching:!1,code:R.code,codeLanguage:R.codeLanguage})}})()},[]),[d,h,y,a]}function Qt(){const[l,s,o,m]=jt();return e(Ot,{visible:!0,title:t.label.detail,okText:t.label.print,isLoadingPreview:l.isFetching,html:s||"<div />",onCancel:m,onOk:o})}const{useForm:Jt}=U;function Kt(){const{hideReceiptUpdateForm:l,idBuilding:s,filter:o,tablePagination:m,receiptUpdateForm:g}=b.useContext(L),d=g.data,{labelTreeDataStatistics:u}=le(),[h]=Z(),[i,a]=b.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[y]=Jt(),R=async()=>{if(await y.validateFields()){a({isFetching:!0,code:void 0,codeLanguage:void 0});try{const{createdAt:C,label:v}=y.getFieldsValue(),n=await Ct({receipt:{createdAt:d.paymentMethod!==xe?S(d.createdAt).toDate():S(C).toDate(),labelId:(v==null?void 0:v.value)??null,id:d.id},idBuilding:s});a({isFetching:!1,code:n.code,codeLanguage:n.codeLanguage}),await h({filter:o,isChangeTotalRow:!1,tablePaginationInp:m}),l()}catch(C){a({isFetching:!1,code:C.code,codeLanguage:C.codeLanguage})}}},r=()=>l();return K(i.code,i.codeLanguage,{message:t.success,description:t.update_data_success}),[i,y,d,u,R,r]}const{Item:Me}=U,Zt=Se(Me,{target:"e1wluak60"})({name:"1annwmx",styles:"& .ant-form-item-control-input-content{width:100%;}"});function ea(){var a,y,R;const[l,s,o,m,g,d]=Kt(),u={label:o.labelId?{value:o.labelId}:void 0,createdAt:S(o.paidAt)},h=S(o.paidAt).startOf("months").startOf("days"),i=S(o.paidAt).endOf("months").endOf("days");return e(ie,{title:t.label.update_receipt,open:!0,confirmLoading:l.isFetching,okText:t.label.confirm,cancelText:t.label.cancel,onOk:g,onCancel:d,children:_(U,{name:"receiptUpdateForm",layout:"vertical",scrollToFirstError:!0,form:s,initialValues:u,requiredMark:!1,children:[_(q,{size:"middle",column:2,layout:"horizontal",children:[e(q.Item,{span:2,label:t.label.receipt_code,children:o.code},"receipt_code"),e(q.Item,{label:t.label.apartment,children:((a=o.unit)==null?void 0:a.name)??""},"apartment"),e(q.Item,{label:t.label.address,children:(y=o.unit)!=null&&y.name?"":(o==null?void 0:o.address)??""},"addresss"),e(q.Item,{span:2,label:t.label.payment_method,children:((R=De[o.paymentMethod])==null?void 0:R.label)??""},"paymentMethod"),e(q.Item,{label:t.label.cashier,children:o.cashier},"cashier"),e(q.Item,{label:t.label.payer,children:o.payer},"payer")]}),e(Me,{name:"createdAt",label:`${t.label.date_of_payment} *`,rules:[{required:!0}],children:e(ae,{disabled:o.paymentMethod!==xe,fluid:"true",placeholder:t.label.date_of_payment,format:"DD/MM/YYYY",disabledDate:r=>r<h||r>i})}),e(Zt,{name:"label",label:t.label.label,children:e(Le,{placeholder:t.label.label,style:{width:"100%"},treeDefaultExpandAll:!0,allowClear:!0,labelInValue:!0,treeIcon:!0,treeLine:!0,treeData:ke(m)})})]})})}const{useForm:ta}=U;function aa(){const{hideReceiptCancelForm:l,receiptCancelForm:s,idBuilding:o,filter:m,tablePagination:g}=b.useContext(L),d=s.data,[u]=ta(),[h]=Z(),[i,a]=b.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),y=async()=>{var C;if(await u.validateFields()){a({isFetching:!0,code:void 0,codeLanguage:void 0});try{const{reason:v}=u.getFieldsValue(),n=await Ft({idReceipt:d.id,reason:v==null?void 0:v.trim(),bills:(C=d.bills)==null?void 0:C.map(c=>c.id),isAllBill:!0,idBuilding:o});a({isFetching:!1,code:n.code,codeLanguage:n.codeLanguage}),await h({filter:m,isChangeTotalRow:!0,tablePaginationInp:g}),l()}catch(v){a({isFetching:!1,code:v.code,codeLanguage:v.codeLanguage})}}},R=()=>l(),r={type:"CREATE_PAY_SLIP"};return K(i.code,i.codeLanguage,{description:t.status.receipt_delete_success,message:t.success}),[i,d,u,r,y,R]}const{Item:ia}=U;function na(){const[l,s,o,m,g,d]=aa();return e(ie,{title:t.label.confirm,open:!0,confirmLoading:l.isFetching,okText:t.label.confirm,cancelText:t.label.cancel,onOk:g,onCancel:d,children:_(te,{children:[_("h5",{children:[t.description.confirm_delete_receipt," ",e("strong",{children:s==null?void 0:s.code})," ?"]}),e(U,{layout:"vertical",form:o,name:"cancelReceiptForm",initialValues:m,children:e(ia,{name:"reason",label:t.label.reason,required:!0,rules:[{required:!0,whitespace:!0}],children:e(V,{placeholder:t.label.reason})})})]})})}const oa=()=>{const{queryParams:l}=Ue(),{receiptPrintForm:s,receiptBillListForm:o,receiptCreateForm:m,receiptUpdateForm:g,receiptCancelForm:d,showReceiptPrintForm:u}=b.useContext(L),{setTitlePage:h,setVisibleFilterBox:i,setVisibleSearchBox:a}=b.useContext(ce);return b.useEffect(()=>(h(t.receipt),a(!0),()=>{h(""),a(!1),i(!1)}),[]),b.useEffect(()=>{l.get("receiptId")&&u({id:l.get("receiptId")})},[l.get("receiptId")]),[m.isShow,o.isShow,s.isShow,g.isShow,d.isShow]},ra=()=>{const[l,s,o,m,g]=oa();return _($.Wrapper,{children:[e(Mt,{}),_($.Container,{children:[e($.Header,{children:e(At,{})}),e($.Content,{children:e(Gt,{})}),l&&e(Ht,{}),s&&e(Xt,{}),o&&e(Qt,{}),m&&e(ea,{}),g&&e(na,{})]})]})},ji=()=>e(kt,{children:e(ra,{})});export{ji as default};
