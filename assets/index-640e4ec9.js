import{j as t,a as S,u as Me,F as wt}from"./@emotion-63839449.js";import{r as f}from"./react-4fd50329.js";import{a as Tt,P as Y,j as uo,D as $e,u as jt,d as Vo,z as Rt,M as pt}from"./index-b17d22e5.js";import"./lodash-88fe09e6.js";import{h as F}from"./moment-a468e1f9.js";import{a9 as A,s as L,K as bt,b0 as vt,aH as Pt,bv as yt,i as X,A as se,M as z,X as W,j as mo,l as c,e4 as xt,eT as go,a3 as fo,dq as To,a5 as bo,I as ye,a as de,by as Gt,dk as Ko,b1 as Pe,cd as jo,fX as ut,fY as ve,fZ as ho}from"./index-c2ded735.js";import"./file-saver-40cf32a9.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{P as ke}from"./prop-types-1172f4d5.js";import{u as Fe}from"./useService-37d60dc0.js";import{u as be}from"./react-router-a4308f7b.js";import{F as Kt,u as Ht}from"./index-687ba9e6.js";import{I as Ae,S as V}from"./index-43183512.js";import{d as vo}from"./downloadFileFromUrl-79614833.js";import{g as Ce,B as Le,D as Xt,a as w,n as Yt,P as Ct,S as Go,b as po,R as Ho}from"./antd-f9eae174.js";import{c as Po}from"./convertPeriodTimeToMonths-e9a83362.js";import{u as zt,a as Wt}from"./xlsx-0fb7ed70.js";import{e as Xo}from"./exportExcel-837be6ed.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./classnames-4ba1ba1a.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./index-881eef42.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";const zo="SERVICE_DEBT_BY_MONTH",Mt={unitName:"",serviceId:"",time:[F(),F()],customerCode:""},yo="DEFAULT",Wo="INVESTOR",Ee=f.createContext({idBuilding:0,debtGetsStatus:{isFetching:!1},setDebtGetsStatus:()=>{},serviceInUses:[],getServiceInUses:()=>{},filter:{...Mt},setFilter:()=>{},tableData:{records:[],totalRecord:0},setTableData:()=>{},tableDataTotalRow:{},setTableDataTotalRow:()=>{},tablePagination:{current:A,limit:L},setTablePagination:()=>{},modalDataSaveReport:void 0,showModalSaveReport:()=>{},hideModalSaveReport:()=>{},accountsReceivableReportPermissionExport:!1}),Jt=({children:e})=>{var B;const{idBuilding:s}=be(),[i,o]=f.useState({isFetching:!1}),[n,l]=f.useState({...Mt}),[r,d]=f.useState({records:[],totalRecord:0}),[a,p]=f.useState(),[h,g]=f.useState({current:A,limit:L+1}),{serviceInUses:T,getServiceInUses:P}=Fe(),[u,m,v]=bt(),{getPermissionByModuleCode:y}=vt(),O=((B=y(Pt))==null?void 0:B[yt])??!1,N={idBuilding:s,debtGetsStatus:i,setDebtGetsStatus:o,serviceInUses:T,getServiceInUses:P,filter:n,setFilter:l,tableData:r,setTableData:d,tableDataTotalRow:a,setTableDataTotalRow:p,tablePagination:h,setTablePagination:g,modalDataSaveReport:u,showModalSaveReport:m,hideModalSaveReport:v,accountsReceivableReportPermissionExport:O};return t(Ee.Provider,{value:N,children:e})};Jt.propTypes={children:ke.node};Jt.defaultProps={children:t("div",{})};const Jo=`${mo}/cashbook`,Qo=`${Jo}/saved-report`;async function qo({idBuilding:e,name:s,type:i,from:o,to:n}){return await X({type:se,payload:{apiUrl:Qo,method:z.POST,body:{from:o,to:n,name:s,type:i},options:{headers:{[W]:e}}}})}const Zo=async({name:e,type:s,from:i,to:o,idBuilding:n})=>{try{const l=await qo({idBuilding:n,name:e,type:s,from:i,to:o});return{code:l.code,data:l.data}}catch(l){return{code:l.code,codeLanguage:l.codeLanguage}}},en=()=>{const[e]=Kt.useForm(),[s,i]=f.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),{hideModalSaveReport:o,idBuilding:n,modalDataSaveReport:l}=f.useContext(Ee),r=async()=>{if(i({isFetching:!0,code:void 0,codeLanguage:void 0}),await e.validateFields()){const{name:p}=e.getFieldsValue(),{from:h,to:g}=l.data,T=await Zo({from:h,to:g,idBuilding:n,name:p,type:zo});i({isFetching:!1,code:T.code,codeLanguage:T.codeLanguage})}},d=()=>o();return Ht(s.code,s.codeLanguage,{message:c.status.success,description:c.status.save_data_success},()=>{d()}),[r,d,s.isFetching,e]},tn=()=>{const[e,s,i,o]=en();return t(Tt,{title:c.label.save_report,open:!0,onOk:e,onCancel:s,okText:c.button.save,okButtonProps:{loading:i,htmlType:"submit",form:"form_save_report"},children:S(Kt,{form:o,layout:"vertical",name:"form_save_report",id:"form_save_report",children:[c.description.save_report,t(Kt.Item,{label:c.label.report_name,name:"name",rules:[{required:!0}],children:t(Ae,{placeholder:c.label.report_name})})]})})},on=`${go}/bills-service/v1`,nn=`${go}/bills-service/v2`,Ue=`${on}/statistic`,xo=`${nn}/statistic`,an=`${Ue}/report-service-by-month`,rn=`${Ue}/report-month-debt-by-month`,sn=`${xo}/report-service-by-month`,dn=`${Ue}/accounts-receivable-aging-report`,cn=`${Ue}/report-service-by-month/sum-payment`,ln=`${Ue}/report-month-debt-by-month/sum-payment`,hn=`${xo}/report-service-by-month/sum-payment`,pn=`${Ue}/accounts-receivable-aging-report/sum-payment`,xe=`${mo}/cashbook`,un=`${xe}/report-service-by-month`,mn=`${xe}/report-service-by-month/sum-payment`,gn=`${xe}/report-service-by-month/export-data`,fn=`${xe}/report-service-update-until-current-time`,Tn=`${xe}/report-service-update-until-current-time/sum-payment`,bn=`${xe}/report-service-update-until-current-time/export-data`,vn=`${xe}/report-service-update-until-current-time/export-revenue-service-data`,Pn=`${xe}/report-service-update-until-current-time/export-with-paid-before-data-investor-temp`,yn=`${xe}/report-service-update-until-current-time/export-data-investor-temp`;async function xn({filter:e,idBuilding:s,page:i,limit:o}){return await X({type:se,payload:{apiUrl:an,method:z.GET,options:{headers:{[W]:s},params:{...e,page:i,limit:o}}}})}async function _n({filter:e,idBuilding:s,page:i,limit:o}){return await X({type:se,payload:{apiUrl:rn,method:z.GET,options:{headers:{[W]:s},params:{...e,page:i,limit:o}}}})}async function wn({filter:e,idBuilding:s,page:i,limit:o}){return await X({type:se,payload:{apiUrl:sn,method:z.GET,options:{headers:{[W]:s},params:{...e,page:i,limit:o}}}})}async function Rn({filter:e,idBuilding:s,page:i,limit:o}){return await X({type:se,payload:{apiUrl:dn,method:z.GET,options:{headers:{[W]:s},params:{...e,page:i,limit:o}}}})}async function On(e,s){return await X({type:se,payload:{apiUrl:cn,method:z.GET,options:{headers:{[W]:s},params:{...e}}}})}async function En(e,s){return await X({type:se,payload:{apiUrl:ln,method:z.GET,options:{headers:{[W]:s},params:{...e}}}})}async function Sn(e,s){return await X({type:se,payload:{apiUrl:hn,method:z.GET,options:{headers:{[W]:s},params:{...e}}}})}async function Nn(e,s){return await X({type:se,payload:{apiUrl:pn,method:z.GET,options:{headers:{[W]:s},params:{...e}}}})}async function Bn({filter:e,idBuilding:s,page:i,limit:o}){return await X({type:se,payload:{apiUrl:un,method:z.GET,options:{headers:{[W]:s},params:{...e,page:i,limit:o}}}})}async function In(e,s){return await X({type:se,payload:{apiUrl:mn,method:z.GET,options:{headers:{[W]:s},params:{...e}}}})}async function Yn(e,s){return await X({type:xt,payload:{apiUrl:gn,method:z.GET,options:{headers:{[W]:s},params:{...e}}}})}async function Cn({filter:e,idBuilding:s,page:i,limit:o}){return await X({type:se,payload:{apiUrl:fn,method:z.GET,options:{headers:{[W]:s},params:{...e,page:i,limit:o}}}})}async function Mn(e,s){return await X({type:se,payload:{apiUrl:Tn,method:z.GET,options:{headers:{[W]:s},params:{...e}}}})}async function $n(e,s){return await X({type:xt,payload:{apiUrl:bn,method:z.GET,options:{headers:{[W]:s},params:{...e}}}})}async function kn(e,s){return await X({type:xt,payload:{apiUrl:vn,method:z.GET,options:{headers:{[W]:s},params:{...e}}}})}async function Fn(e,s){return await X({type:xt,payload:{apiUrl:Pn,method:z.GET,options:{headers:{[W]:s},params:{...e}}}})}async function An(e,s){return await X({type:xt,payload:{apiUrl:yn,method:z.GET,options:{headers:{[W]:s},params:{...e}}}})}const Ln=async({filter:e,idBuilding:s,type:i})=>{const{time:o,service:n,customerCode:l,unit:r}=e;try{const d=await Yn({unit:r||void 0,service:n||void 0,label:l||void 0,from:o==null?void 0:o[0].format("MM/YYYY"),to:o==null?void 0:o[1].format("MM/YYYY"),type:i,isShowService:!0},s);return{code:d.code,data:d.data}}catch(d){return{code:d.code,codeLanguage:d.codeLanguage}}},Un=()=>{const{tableData:e,filter:s,idBuilding:i,showModalSaveReport:o,accountsReceivableReportPermissionExport:n}=f.useContext(Ee),[l,r]=f.useState({code:void 0,codeLanguage:void 0,isFetching:!1});return Ht(l.code,l.codeLanguage,{message:c.success,description:c.export_data_success}),{handleSaveReport:()=>{var p,h,g,T;o({from:(h=(p=s==null?void 0:s.time)==null?void 0:p[0])==null?void 0:h.format("MM/YYYY"),to:(T=(g=s==null?void 0:s.time)==null?void 0:g[1])==null?void 0:T.format("MM/YYYY")})},handleMenuClick:async({key:p})=>{r({code:void 0,codeLanguage:void 0,isFetching:!0});try{const h=await Ln({filter:s,idBuilding:i,type:p});r({code:h.code,codeLanguage:h.codeLanguage,isFetching:!1}),h.data&&vo(h.data,document,p===yo?"thong-tin-cong-no-phat-sinh-theo-thang.xlsx":"thong-tin-cong-no-phat-sinh-theo-thang-mau-chu-dau-tu.xlsx")}catch(h){r({code:h.code,codeLanguage:h.codeLanguage,isFetching:!1})}},loading:l.isFetching,totalRecord:e.totalRecord,accountsReceivableReportPermissionExport:n}},Dn=()=>{const{handleMenuClick:e,loading:s,totalRecord:i,accountsReceivableReportPermissionExport:o}=Un(),n=fo(),l=S(Ce,{onClick:({key:d})=>{n({action:To,label:bo}),e({key:d})},children:[t(Ce.Item,{children:c.label.default},yo),t(Ce.Item,{children:c.label.investor1},Wo)]}),r=[o?t(Xt,{dropdownRender:()=>l,children:S(Le,{loading:s,type:"primary",ghost:!0,icon:t(ye,{name:"icon-download-outlined"}),children:[c.export," ",t(ye,{name:"icon-arrow-down-outlined"})]})},"export"):null].filter(Boolean);return t(Y.ActionBox,{actions:r,total:i})},_o=e=>{let s=[];return e.time&&e.time.length>0&&e.time[0]&&e.time[1]&&(s=Po({from:F(e.time[0]),to:F(e.time[1])})),s.unshift("TOTAL"),s},Vn=(e,s,i)=>{var n,l,r,d,a,p,h,g,T,P,u,m,v,y,O,N,B,I,E,M,R,_,k,C,$,K,H,ee,ne,ie,ce,le,q,x,he,pe,ue,te,j,Q,G,me,ge,fe,ae,Z,re,Te,Re,Ve,Ke,je,Ge,He,Xe,ze,We,Je,Qe,qe,Ze,et,tt,ot,nt,it,at,rt,st,dt,ct,lt,Oe,U,ht,Ye,J,_t;const o=[];for(let Lt=0;Lt<e.length;Lt+=1){const b=e[Lt],co={key:(n=b==null?void 0:b.unit)==null?void 0:n.id,customerCode:((r=(l=b==null?void 0:b.unit)==null?void 0:l.label)==null?void 0:r.title)??"",apartment:((d=b==null?void 0:b.unit)==null?void 0:d.name)??"",service:"",openingDebt:((p=(a=b==null?void 0:b.TOTAL)==null?void 0:a.openingDebt)==null?void 0:p.TOTAL)??0,openingPaidBefore:((g=(h=b==null?void 0:b.TOTAL)==null?void 0:h.openingPaidBefore)==null?void 0:g.TOTAL)??0,receivables:((P=(T=b==null?void 0:b.TOTAL)==null?void 0:T.inPeriodMustPay)==null?void 0:P.TOTAL)??0,adjust:((m=(u=b==null?void 0:b.TOTAL)==null?void 0:u.inPeriodAdjust)==null?void 0:m.TOTAL)??0,deduct:((y=(v=b==null?void 0:b.TOTAL)==null?void 0:v.inPeriodDeductPaidBefore)==null?void 0:y.TOTAL)??0,paidInPeriod:((N=(O=b==null?void 0:b.TOTAL)==null?void 0:O.inPeriodPaid)==null?void 0:N.TOTAL)??0,paidDebt:((I=(B=b==null?void 0:b.TOTAL)==null?void 0:B.inPeriodPaidDebt)==null?void 0:I.TOTAL)??0,paidBefore:((M=(E=b==null?void 0:b.TOTAL)==null?void 0:E.inPeriodPaidBefore)==null?void 0:M.TOTAL)??0,total:((_=(R=b==null?void 0:b.TOTAL)==null?void 0:R.inPeriodPaidTotal)==null?void 0:_.TOTAL)??0,remainingReceivables:((C=(k=b==null?void 0:b.TOTAL)==null?void 0:k.inPeriodRest)==null?void 0:C.TOTAL)??0,closingDebt:((K=($=b==null?void 0:b.TOTAL)==null?void 0:$.closingDebt)==null?void 0:K.TOTAL)??0,closingPaidBefore:((ee=(H=b==null?void 0:b.TOTAL)==null?void 0:H.closingPaidBefore)==null?void 0:ee.TOTAL)??0,children:[]};for(let Ut=0;Ut<i.length;Ut+=1){const D=i[Ut],lo={key:`${(ne=b==null?void 0:b.unit)==null?void 0:ne.id}.${D}`,customerCode:"",apartment:D==="TOTAL"?c.total:F(D,"YYYYMM").format("MM/YYYY"),service:"",openingDebt:((ce=(ie=b==null?void 0:b[D])==null?void 0:ie.openingDebt)==null?void 0:ce.TOTAL)??0,openingPaidBefore:((q=(le=b==null?void 0:b[D])==null?void 0:le.openingPaidBefore)==null?void 0:q.TOTAL)??0,receivables:((he=(x=b==null?void 0:b[D])==null?void 0:x.inPeriodMustPay)==null?void 0:he.TOTAL)??0,adjust:((ue=(pe=b==null?void 0:b[D])==null?void 0:pe.inPeriodAdjust)==null?void 0:ue.TOTAL)??0,deduct:((j=(te=b==null?void 0:b[D])==null?void 0:te.inPeriodDeductPaidBefore)==null?void 0:j.TOTAL)??0,paidInPeriod:((G=(Q=b==null?void 0:b[D])==null?void 0:Q.inPeriodPaid)==null?void 0:G.TOTAL)??0,paidDebt:((ge=(me=b==null?void 0:b[D])==null?void 0:me.inPeriodPaidDebt)==null?void 0:ge.TOTAL)??0,paidBefore:((ae=(fe=b==null?void 0:b[D])==null?void 0:fe.inPeriodPaidBefore)==null?void 0:ae.TOTAL)??0,total:((re=(Z=b==null?void 0:b[D])==null?void 0:Z.inPeriodPaidTotal)==null?void 0:re.TOTAL)??0,remainingReceivables:((Re=(Te=b==null?void 0:b[D])==null?void 0:Te.inPeriodRest)==null?void 0:Re.TOTAL)??0,closingDebt:((Ke=(Ve=b==null?void 0:b[D])==null?void 0:Ve.closingDebt)==null?void 0:Ke.TOTAL)??0,closingPaidBefore:((Ge=(je=b==null?void 0:b[D])==null?void 0:je.closingPaidBefore)==null?void 0:Ge.TOTAL)??0,children:[]};for(let Dt=0;Dt<s.length;Dt+=1){const oe=s[Dt],Do={key:`${(He=b==null?void 0:b.unit)==null?void 0:He.id}.${D}.${oe.id}`,customerCode:"",apartment:"",service:oe.name,openingDebt:(ze=(Xe=b==null?void 0:b[D])==null?void 0:Xe.openingDebt)==null?void 0:ze[oe.id],openingPaidBefore:((Je=(We=b==null?void 0:b[D])==null?void 0:We.openingPaidBefore)==null?void 0:Je[oe.id])??0,receivables:((qe=(Qe=b==null?void 0:b[D])==null?void 0:Qe.inPeriodMustPay)==null?void 0:qe[oe.id])??0,adjust:((et=(Ze=b==null?void 0:b[D])==null?void 0:Ze.inPeriodAdjust)==null?void 0:et[oe.id])??0,deduct:((ot=(tt=b==null?void 0:b[D])==null?void 0:tt.inPeriodDeductPaidBefore)==null?void 0:ot[oe.id])??0,paidInPeriod:((it=(nt=b==null?void 0:b[D])==null?void 0:nt.inPeriodPaid)==null?void 0:it[oe.id])??0,paidDebt:((rt=(at=b==null?void 0:b[D])==null?void 0:at.inPeriodPaidDebt)==null?void 0:rt[oe.id])??0,paidBefore:((dt=(st=b==null?void 0:b[D])==null?void 0:st.inPeriodPaidBefore)==null?void 0:dt[oe.id])??0,total:((lt=(ct=b==null?void 0:b[D])==null?void 0:ct.inPeriodPaidTotal)==null?void 0:lt[oe.id])??0,remainingReceivables:((U=(Oe=b==null?void 0:b[D])==null?void 0:Oe.inPeriodRest)==null?void 0:U[oe.id])??0,closingDebt:((Ye=(ht=b==null?void 0:b[D])==null?void 0:ht.closingDebt)==null?void 0:Ye[oe.id])??0,closingPaidBefore:((_t=(J=b==null?void 0:b[D])==null?void 0:J.closingPaidBefore)==null?void 0:_t[oe.id])??0};lo.children.push(Do)}co.children.push(lo)}o.push(co)}return o},Kn=async({filter:e,pagination:s,idBuilding:i})=>{var u,m;const{current:o,limit:n}=s,{time:l,service:r,customerCode:d,unit:a}=e,p=await Bn({filter:{unit:a||void 0,service:r||void 0,label:d||void 0,from:l==null?void 0:l[0].format("MM/YYYY"),to:l==null?void 0:l[1].format("MM/YYYY"),isShowService:!0},idBuilding:i,limit:n-1,page:o}),h=_o(e),g=((u=p==null?void 0:p.data)==null?void 0:u.services)??[],T=((m=p==null?void 0:p.data)==null?void 0:m.units)??[];return[Vn(T,g,h),g,p.totalRecord]},jn=(e,s,i)=>{var n,l,r,d,a,p,h,g,T,P,u,m,v,y,O,N,B,I,E,M,R,_,k,C,$,K,H,ee,ne,ie,ce,le,q,x,he,pe,ue,te,j,Q,G,me,ge,fe,ae,Z,re,Te,Re,Ve,Ke,je,Ge,He,Xe,ze,We,Je,Qe,qe,Ze,et,tt,ot,nt,it,at,rt,st,dt,ct,lt;const o={key:"total",customerCode:"",apartment:c.total,service:"",openingDebt:((l=(n=e==null?void 0:e.TOTAL)==null?void 0:n.openingDebt)==null?void 0:l.TOTAL)??0,openingPaidBefore:((d=(r=e==null?void 0:e.TOTAL)==null?void 0:r.openingPaidBefore)==null?void 0:d.TOTAL)??0,receivables:((p=(a=e==null?void 0:e.TOTAL)==null?void 0:a.inPeriodMustPay)==null?void 0:p.TOTAL)??0,adjust:((g=(h=e==null?void 0:e.TOTAL)==null?void 0:h.inPeriodAdjust)==null?void 0:g.TOTAL)??0,deduct:((P=(T=e==null?void 0:e.TOTAL)==null?void 0:T.inPeriodDeductPaidBefore)==null?void 0:P.TOTAL)??0,paidInPeriod:((m=(u=e==null?void 0:e.TOTAL)==null?void 0:u.inPeriodPaid)==null?void 0:m.TOTAL)??0,paidDebt:((y=(v=e==null?void 0:e.TOTAL)==null?void 0:v.inPeriodPaidDebt)==null?void 0:y.TOTAL)??0,paidBefore:((N=(O=e==null?void 0:e.TOTAL)==null?void 0:O.inPeriodPaidBefore)==null?void 0:N.TOTAL)??0,total:((I=(B=e==null?void 0:e.TOTAL)==null?void 0:B.inPeriodPaidTotal)==null?void 0:I.TOTAL)??0,remainingReceivables:((M=(E=e==null?void 0:e.TOTAL)==null?void 0:E.inPeriodRest)==null?void 0:M.TOTAL)??0,closingDebt:((_=(R=e==null?void 0:e.TOTAL)==null?void 0:R.closingDebt)==null?void 0:_.TOTAL)??0,closingPaidBefore:((C=(k=e==null?void 0:e.TOTAL)==null?void 0:k.closingPaidBefore)==null?void 0:C.TOTAL)??0,children:[]};for(let Oe=0;Oe<i.length;Oe+=1){const U=i[Oe],ht={key:`total.${Oe}`,customerCode:"",apartment:U==="TOTAL"?c.total:F(U,"YYYYMM").format("MM/YYYY"),service:"",openingDebt:((K=($=e==null?void 0:e[U])==null?void 0:$.openingDebt)==null?void 0:K.TOTAL)??0,openingPaidBefore:((ee=(H=e==null?void 0:e[U])==null?void 0:H.openingPaidBefore)==null?void 0:ee.TOTAL)??0,receivables:((ie=(ne=e==null?void 0:e[U])==null?void 0:ne.inPeriodMustPay)==null?void 0:ie.TOTAL)??0,adjust:((le=(ce=e==null?void 0:e[U])==null?void 0:ce.adjust)==null?void 0:le.TOTAL)??0,deduct:((x=(q=e==null?void 0:e[U])==null?void 0:q.inPeriodDeductPaidBefore)==null?void 0:x.TOTAL)??0,paidInPeriod:((pe=(he=e==null?void 0:e[U])==null?void 0:he.inPeriodPaid)==null?void 0:pe.TOTAL)??0,paidDebt:((te=(ue=e==null?void 0:e[U])==null?void 0:ue.inPeriodPaidDebt)==null?void 0:te.TOTAL)??0,paidBefore:((Q=(j=e==null?void 0:e[U])==null?void 0:j.inPeriodPaidBefore)==null?void 0:Q.TOTAL)??0,total:((me=(G=e==null?void 0:e[U])==null?void 0:G.inPeriodPaidTotal)==null?void 0:me.TOTAL)??0,remainingReceivables:((fe=(ge=e==null?void 0:e[U])==null?void 0:ge.inPeriodRest)==null?void 0:fe.TOTAL)??0,closingDebt:((Z=(ae=e==null?void 0:e[U])==null?void 0:ae.closingDebt)==null?void 0:Z.TOTAL)??0,closingPaidBefore:((Te=(re=e==null?void 0:e[U])==null?void 0:re.closingPaidBefore)==null?void 0:Te.TOTAL)??0,children:[]};for(let Ye=0;Ye<s.length;Ye+=1){const J=s[Ye],_t={key:`total.${U}.${J.id}`,customerCode:"",apartment:"",service:J.name,openingDebt:(Ve=(Re=e==null?void 0:e[U])==null?void 0:Re.openingDebt)==null?void 0:Ve[J.id],openingPaidBefore:((je=(Ke=e==null?void 0:e[U])==null?void 0:Ke.openingPaidBefore)==null?void 0:je[J.id])??0,receivables:((He=(Ge=e==null?void 0:e[U])==null?void 0:Ge.inPeriodMustPay)==null?void 0:He[J.id])??0,adjust:((ze=(Xe=e==null?void 0:e[U])==null?void 0:Xe.inPeriodAdjust)==null?void 0:ze[J.id])??0,deduct:((Je=(We=e==null?void 0:e[U])==null?void 0:We.inPeriodDeductPaidBefore)==null?void 0:Je[J.id])??0,paidInPeriod:((qe=(Qe=e==null?void 0:e[U])==null?void 0:Qe.inPeriodPaid)==null?void 0:qe[J.id])??0,paidDebt:((et=(Ze=e==null?void 0:e[U])==null?void 0:Ze.inPeriodPaidDebt)==null?void 0:et[J.id])??0,paidBefore:((ot=(tt=e==null?void 0:e[U])==null?void 0:tt.inPeriodPaidBefore)==null?void 0:ot[J.id])??0,total:((it=(nt=e==null?void 0:e[U])==null?void 0:nt.inPeriodPaidTotal)==null?void 0:it[J.id])??0,remainingReceivables:((rt=(at=e==null?void 0:e[U])==null?void 0:at.inPeriodRest)==null?void 0:rt[J.id])??0,closingDebt:((dt=(st=e==null?void 0:e[U])==null?void 0:st.closingDebt)==null?void 0:dt[J.id])??0,closingPaidBefore:((lt=(ct=e==null?void 0:e[U])==null?void 0:ct.closingPaidBefore)==null?void 0:lt[J.id])??0};ht.children.push(_t)}o.children.push(ht)}return o},Gn=(e,s)=>e.filter(i=>!s.service||s.service&&i.id===s.service),Hn=async({filter:e,idBuilding:s,services:i})=>{const{time:o,service:n,customerCode:l,unit:r}=e;try{const d=await In({unit:r||void 0,service:n||void 0,label:l||void 0,from:o==null?void 0:o[0].format("MM/YYYY"),to:o==null?void 0:o[1].format("MM/YYYY"),isShowService:!0},s),a=_o(e),p=Gn(i,e);return jn(d.data,p,a)}catch(d){return{code:d.code,codeLanguage:d.codeLanguage}}},Qt=()=>{const{idBuilding:e,setTablePagination:s,setTableData:i,setTableDataTotalRow:o,setDebtGetsStatus:n}=f.useContext(Ee);return[async({filter:r,pagination:d,isChangeTotalRow:a})=>{const{current:p,limit:h}=d;n({isFetching:!0,code:void 0,codeLanguage:void 0}),s({current:p,limit:h});const[g,T,P]=await Kn({filter:r,idBuilding:e,pagination:d});if(i({records:g,totalRecord:P}),a){const u=await Hn({filter:r,idBuilding:e,services:T});o(u)}n({isFetching:!1})}]},Xn=()=>{const{setFilter:e,serviceInUses:s}=f.useContext(Ee),{labelsCustomerCodeData:i}=uo(),[o]=Qt();return[async l=>{e(l),await o({filter:{...l},pagination:{current:A,limit:L},isChangeTotalRow:!0})},s,i]},zn=()=>{const[e,s,i]=Xn(),o=f.useMemo(()=>[{label:c.unit,key:"unit",component:t(Ae,{placeholder:c.unit}),visible:!0},{label:c.service,key:"service",component:S(V,{placeholder:c.service,fluid:"true",getPopupContainer:n=>n.parentNode,children:[t(V.Option,{value:"",children:c.all_service},"service_0"),s.map(n=>t(V.Option,{value:n.id,children:n.name},n.id))]}),visible:!0},{label:c.month,key:"time",component:t($e.RangePicker,{placeholder:[c.from,c.to],fluid:"true",picker:"month",format:"MM/YYYY",allowClear:!1,getPopupContainer:n=>n.parentNode}),visible:!0,fixed:!0},{label:c.customer_code,key:"customerCode",component:S(V,{fluid:"true",placeholder:c.customer_code,getPopupContainer:n=>n.parentNode,children:[t(V.Option,{value:"",children:c.all_label},"label_0"),i.map(n=>t(V.Option,{value:n.id,children:n.title},n.id))]}),visible:!0}],[i,s]);return t(Y.FilterBox,{defaultFilter:Mt,filters:o,onSearch:e})},Wn=()=>{const{filter:e,debtGetsStatus:s,tableData:i,tableDataTotalRow:o,tablePagination:n}=f.useContext(Ee),{layoutScrollRef:l}=f.useContext(de),{currentBuilding:r}=jt(),[d]=Qt(),a=Me(),p=async(m,v)=>{n.current!==m?await d({filter:{...e},pagination:{current:m,limit:n.limit},isChangeTotalRow:!1}):n.limit!==v&&await d({filter:{...e},pagination:{current:n.current,limit:v},isChangeTotalRow:!1})},h=f.useMemo(()=>({defaultPageSize:L,defaultCurrent:A,pageSize:n.limit,current:n.current,total:i.totalRecord+Math.ceil(i.totalRecord/n.limit),showQuickJumper:!0,showSizeChanger:!0,onChange:p}),[n,i.totalRecord]),g=[o,...i.records],T=!!r.lockDataAt,P={offsetScroll:a.offsetScrollX,getContainer:()=>l.current},u={scrollToFirstRowOnChange:!0};return[T,g,s.isFetching,h,P,u]},Jn=()=>{const[e,s,i,o,n,l]=Wn(),r=f.useMemo(()=>{const d=[{key:"collapse",dataIndex:"collapse",title:"",width:60,fixed:"left",children:[]},{key:"customerCode",dataIndex:"customerCode",title:c.customer_code,width:120,fixed:"left"},{key:"apartment",dataIndex:"apartment",title:c.unit,width:120,fixed:"left"},{key:"service",dataIndex:"service",title:c.service,width:150,fixed:"left"},{key:"",dataIndex:"",title:c.opening_debt,width:150,fixed:"left",children:[{key:"openingDebt",dataIndex:"openingDebt",title:"1",width:150,align:"right",render:a=>t(w.NegativeNumber,{children:a})}]},{key:"",dataIndex:"",title:c.opening_paid_before,width:150,fixed:"left",children:[{key:"openingPaidBefore",dataIndex:"openingPaidBefore",title:"2",width:150,align:"right",render:a=>t(w.NegativeNumber,{children:a})}]}];return e&&d.push({key:"",dataIndex:"",title:c.adjust,width:150,fixed:"left",children:[{key:"adjust",dataIndex:"adjust",title:"3",width:150,align:"right",render:a=>t(w.NegativeNumber,{children:a})}]}),d.push({key:"",dataIndex:"",title:c.receivables,width:150,fixed:"left",children:[{key:"receivables",dataIndex:"receivables",title:e?"4":"3",width:150,align:"right",render:a=>t(w.NegativeNumber,{children:a})}]},{key:"",dataIndex:"",title:c.deduct,width:150,fixed:"left",children:[{key:"deduct",dataIndex:"deduct",title:e?"5":"4",width:150,align:"right",render:a=>t(w.NegativeNumber,{children:a})}]},{key:"",dataIndex:"",title:c.paid_in_period,width:150,fixed:"left",children:[{key:"paidInPeriod",dataIndex:"paidInPeriod",title:e?"6":"5",width:150,align:"right",render:a=>t(w.NegativeNumber,{children:a})}]},{key:"",dataIndex:"",title:c.paid_debt,width:150,fixed:"left",children:[{key:"paidDebt",dataIndex:"paidDebt",title:e?"7":"6",width:150,align:"right",render:a=>t(w.NegativeNumber,{children:a})}]},{key:"",dataIndex:"",title:c.paid_before,width:150,fixed:"left",children:[{key:"paidBefore",dataIndex:"paidBefore",title:e?"8":"7",width:150,align:"right",render:a=>t(w.NegativeNumber,{children:a})}]},{key:"",dataIndex:"",title:c.total,width:150,fixed:"left",children:[{key:"total",dataIndex:"total",title:e?"9=6+7+8":"8=5+6+7",width:150,align:"right",render:a=>t(w.NegativeNumber,{children:a})}]},{key:"",dataIndex:"",title:c.remaining_receivables,width:150,fixed:"left",children:[{key:"remainingReceivables",dataIndex:"remainingReceivables",title:e?"10=3+4-5-6":"9=3-4-5",width:150,align:"right",render:a=>t(w.NegativeNumber,{children:a})}]},{key:"",dataIndex:"",title:c.closing_debt,width:150,fixed:"left",children:[{key:"closingDebt",dataIndex:"closingDebt",title:e?"11=1-7+10":"10=1-6+9",width:150,align:"right",render:a=>t(w.NegativeNumber,{children:a})}]},{key:"closingPaidBefore",dataIndex:"closingPaidBefore",title:c.closing_paid_before,width:150,fixed:"left",children:[{key:"closingPaidBefore",dataIndex:"closingPaidBefore",title:e?"12=2-5+8":"11=2-4+7",width:150,align:"right",render:a=>t(w.NegativeNumber,{children:a})}]}),d},[e]);return t(Y.Table,{columns:r,dataSource:s,loading:i,pagination:o,sticky:n,scroll:{...l,x:r.reduce((d,a)=>d+a.width,0)}})},Qn=()=>{const{getServiceInUses:e,idBuilding:s,modalDataSaveReport:i}=f.useContext(Ee),{setVisibleFilterBox:o}=f.useContext(de),[n]=Qt();return f.useEffect(()=>(o(!1),(async()=>await Promise.all([e({idBuilding:s}),n({filter:{...Mt},pagination:{current:A,limit:L},isChangeTotalRow:!0})]))(),()=>{o(!1)}),[]),[i.isShow]},qn=()=>{const[e]=Qn();return S(Y.Wrapper,{children:[t(zn,{}),S(Y.Container,{children:[t(Y.Header,{children:t(Dn,{})}),t(Y.Content,{children:t(Jn,{})})]}),e?t(tn,{}):null]})},Zn=()=>t(Jt,{children:t(qn,{})}),$t={unitName:"",serviceId:"",monthSelected:F()},Se=f.createContext({idBuilding:0,debtGetsStatus:{isFetching:!1},setDebtGetsStatus:()=>{},filter:{...$t},setFilter:()=>{},tableData:{records:[],totalRecord:0,services:[],totalRow:{}},setTableData:()=>{},tablePagination:{current:A,limit:L},setTablePagination:()=>{},serviceInUses:[],getServiceInUses:()=>{},formExport:void 0,showFormExport:()=>{},hideFormExport:()=>{}}),qt=({children:e})=>{var O;const{idBuilding:s}=be(),[i,o]=f.useState({isFetching:!1}),[n,l]=f.useState({...$t}),[r,d]=f.useState({records:[],totalRecord:0,services:[],totalRow:{}}),[a,p]=f.useState({current:A,limit:L}),[h,g,T]=bt(),{serviceInUses:P,getServiceInUses:u}=Fe(),{getPermissionByModuleCode:m}=vt(),v=((O=m(Pt))==null?void 0:O[yt])??!1,y={idBuilding:s,debtGetsStatus:i,setDebtGetsStatus:o,filter:n,setFilter:l,tableData:r,setTableData:d,tablePagination:a,setTablePagination:p,serviceInUses:P,getServiceInUses:u,formExport:h,showFormExport:g,hideFormExport:T,accountsReceivableReportPermissionExport:v};return t(Se.Provider,{value:y,children:e})};qt.propTypes={children:ke.node};qt.defaultProps={children:t("div",{})};const ei=()=>{const{tableData:e,showFormExport:s,accountsReceivableReportPermissionExport:i}=f.useContext(Se),o=()=>{s()};return[e.totalRecord,o,i]},ti=()=>{const[e,s,i]=ei(),o=[i?t(Le,{ghost:!0,type:"primary",onClick:()=>s(),icon:t(ye,{name:"icon-download-outlined"}),css:n=>({marginRight:n.margin.xs}),children:c.export},"export"):null].filter(Boolean);return t(Y.ActionBox,{actions:o,total:e})},oi=(e,s)=>{const{unit:i,openingDebt:o,receivable:n,paidInPeriod:l,paidBefore:r,closingDebt:d,totalPaid:a,deductPaidBefore:p}=e,h={id:i.id,apartment:(i==null?void 0:i.name)??"",key:`key.${i.id}`,totalOpeningDebt:o.totalOpeningDebt,openingPaidBefore:o.openingPaidBefore,openingDebtBalancePrepaidDeduction:o.openingDebtBalancePrepaidDeduction,totalReceivable:n.totalReceivable,totalPaidInPeriod:l.totalPaidInPeriod,totalPaidBefore:r.totalPaidBefore,totalClosingDebt:d.totalClosingDebt,totalDeductPaidBefore:p.totalDeductPaidBefore,totalPaid:a};return s.forEach(g=>{const T=g.id,P=`openingDebt-${T}`;h[P]=Number(o[P]??0);const u=`receivable-${T}`;h[u]=Number(n[u]??0);const m=`paidInPeriod-${T}`;h[m]=Number(l[m]??0);const v=`paidBefore-${T}`;h[v]=Number(r[v]??0);const y=`deductPaidBefore-${T}`;h[y]=Number(p[y]??0);const O=`closingDebt-${T}`;h[O]=Number(d[O]??0)}),{...h}},wo=async({filter:e,pagination:s,idBuilding:i})=>{var T,P;const{current:o,limit:n}=s,{unitName:l,serviceId:r,monthSelected:d}=e,a=await xn({filter:{unitName:l||void 0,serviceId:r||void 0,monthSelected:d.format("YYYYMM")},idBuilding:i,limit:n-1,page:o}),p=((T=a==null?void 0:a.data)==null?void 0:T.services)??[];return[(((P=a==null?void 0:a.data)==null?void 0:P.units)??[]).map(u=>oi(u,p)),p,a.totalRecord]},ni=(e,s)=>{const{openingDebt:i,receivable:o,paidInPeriod:n,paidBefore:l,closingDebt:r,totalPaid:d,deductPaidBefore:a}=e,p={id:"total",apartment:c.total,key:"key.total",totalOpeningDebt:i.totalOpeningDebt,openingPaidBefore:i.openingPaidBefore,openingDebtBalancePrepaidDeduction:i.openingDebtBalancePrepaidDeduction,totalReceivable:o.totalReceivable,totalPaidInPeriod:n.totalPaidInPeriod,totalPaidBefore:l.totalPaidBefore,totalClosingDebt:r.totalClosingDebt,totalDeductPaidBefore:a.totalDeductPaidBefore,totalPaid:d};return s.forEach(h=>{const g=h.id,T=`openingDebt-${g}`;p[T]=Number(i[T]??0);const P=`receivable-${g}`;p[P]=Number(o[P]??0);const u=`paidInPeriod-${g}`;p[u]=Number(n[u]??0);const m=`paidBefore-${g}`;p[m]=Number(l[m]??0);const v=`deductPaidBefore-${g}`;p[v]=Number(a[v]??0);const y=`closingDebt-${g}`;p[y]=Number(r[y]??0)}),{...p}},Ro=async(e,s)=>{var i,o;try{const n={unitName:e.unitName||void 0,serviceId:e.serviceId||void 0,monthSelected:e.monthSelected.format("YYYYMM")},l=await On(n,s),r=((i=l==null?void 0:l.data)==null?void 0:i.services)??[],d=((o=l==null?void 0:l.data)==null?void 0:o.totalDebt)??{};return ni(d,r)}catch{return{}}},Zt=()=>{const{idBuilding:e,setTablePagination:s,setTableData:i,setDebtGetsStatus:o,tableData:n}=f.useContext(Se);return[async({filter:r,pagination:d,isChangeTotalRow:a})=>{const{current:p,limit:h}=d;o({isFetching:!0,code:void 0,codeLanguage:void 0}),s({current:p,limit:h});const[g,T,P]=await wo({filter:r,idBuilding:e,pagination:d}),u={...n,records:g,totalRecord:P,services:T};if(a){const m=await Ro(r,e);m&&Object.keys(m).length&&(u.totalRow=m)}i(u),o({isFetching:!1,code:void 0,codeLanguage:void 0})}]},ii=()=>{const{setFilter:e,serviceInUses:s}=f.useContext(Se),[i]=Zt();return[async n=>{e(n),await i({filter:{...n},pagination:{current:A,limit:L},isChangeTotalRow:!0})},s]},ai=()=>{const[e,s]=ii(),i=f.useMemo(()=>[{label:c.unit,key:"unitName",component:t(Ae,{placeholder:c.unit}),visible:!0},{label:c.service,key:"serviceId",component:S(V,{placeholder:c.service,fluid:"true",getPopupContainer:o=>o.parentNode,children:[t(V.Option,{value:"",children:c.all_service},"service_0"),s.map(o=>t(V.Option,{value:o.id,children:o.name},o.id))]}),visible:!0},{label:c.month,key:"monthSelected",component:t($e,{placeholder:c.month,fluid:"true",picker:"month",format:"MM/YYYY",allowClear:!1,getPopupContainer:o=>o.parentNode}),visible:!0,fixed:!0}],[s]);return t(Y.FilterBox,{defaultFilter:$t,filters:i,onSearch:e})},ri=()=>{const{filter:e,debtGetsStatus:s,tableData:i,tablePagination:o}=f.useContext(Se),{layoutScrollRef:n}=f.useContext(de),[l]=Zt(),r=Me(),d=async(g,T)=>{o.current!==g?await l({filter:{...e},pagination:{current:g,limit:o.limit},isChangeTotalRow:!1}):o.limit!==T&&await l({filter:{...e},pagination:{current:o.current,limit:T},isChangeTotalRow:!1})},a=f.useMemo(()=>({defaultPageSize:L,defaultCurrent:A,pageSize:o.limit,current:o.current,total:i.totalRecord+Math.ceil(i.totalRecord/o.limit),showQuickJumper:!0,showSizeChanger:!0,onChange:d}),[o,i.totalRecord]),p={offsetScroll:r.offsetScrollX,getContainer:()=>n.current};return{dataSource:f.useMemo(()=>i.totalRow&&Object.keys(i.totalRow).length?[i.totalRow,...i.records]:i.records,[i]),loading:s.isFetching,pagination:a,sticky:p,services:i.services,filter:e}},si=()=>{const{dataSource:e,loading:s,pagination:i,sticky:o,services:n}=ri(),l=f.useMemo(()=>[{key:"apartment",dataIndex:"apartment",title:c.unit,width:150,fixed:"left"},{key:"",dataIndex:"",title:c.opening_debt,width:n.length*200+150+150+220,children:[...n.map(a=>{const h=`openingDebt-${a.id}`;return{key:h,dataIndex:h,width:200,align:"right",title:a.name,render:g=>t(w.NegativeNumber,{children:g})}}),{key:"totalOpeningDebt",dataIndex:"totalOpeningDebt",width:150,align:"right",title:c.total_opening_debt,render:a=>t(w.NegativeNumber,{children:a})},{key:"openingPaidBefore",dataIndex:"openingPaidBefore",width:150,align:"right",title:c.label.opening_advance_payment,render:a=>t(w.NegativeNumber,{children:a})},{key:"openingDebtBalancePrepaidDeduction",dataIndex:"openingDebtBalancePrepaidDeduction",width:220,align:"right",title:c.label.opening_debt_balance_prepaid_deduction,render:a=>t(w.NegativeNumber,{children:a})}]},{key:"",dataIndex:"",title:c.arise,width:n.length*200+150,children:[...n.map(a=>{const h=`receivable-${a.id}`;return{key:h,dataIndex:h,width:200,align:"right",title:a.name,render:g=>t(w.NegativeNumber,{children:g})}}),{key:"totalReceivable",dataIndex:"totalReceivable",width:150,align:"right",title:c.label.total,render:a=>t(w.NegativeNumber,{children:a})}]},{key:"",dataIndex:"",title:c.paid_in_period,width:n.length*200+150+n.length*200+230+150,children:[...n.map(a=>{const h=`paidInPeriod-${a.id}`;return{key:h,dataIndex:h,width:200,align:"right",title:a.name,render:g=>t(w.NegativeNumber,{children:g})}}),{key:"totalPaidInPeriod",dataIndex:"totalPaidInPeriod",width:200,align:"right",title:c.total_paid_in_period,render:a=>t(w.NegativeNumber,{children:a})},{key:"",dataIndex:"",align:"center",title:c.deposit_in_period,children:[...n.map(a=>{const h=`paidBefore-${a.id}`;return{key:h,dataIndex:h,width:200,align:"right",title:a.name,render:g=>t(w.NegativeNumber,{children:g})}})]},{key:"totalPaidBefore",dataIndex:"totalPaidBefore",width:230,align:"right",title:c.total_deposit_in_period,render:a=>t(w.NegativeNumber,{children:a})},{key:"totalPaid",dataIndex:"totalPaid",width:150,align:"right",title:c.label.total,render:a=>t(w.NegativeNumber,{children:a})}]},{key:"",dataIndex:"",title:c.paid_before_this_month,width:n.length*200+150,children:[...n.map(a=>{const h=`deductPaidBefore-${a.id}`;return{key:h,dataIndex:h,width:200,align:"right",title:a.name,render:g=>t(w.NegativeNumber,{children:g})}}),{key:"totalDeductPaidBefore",dataIndex:"totalDeductPaidBefore",width:150,align:"right",title:c.label.total,render:a=>t(w.NegativeNumber,{children:a})}]},{key:"",dataIndex:"",title:c.closing_debt,width:n.length*200+170,children:[...n.map(a=>{const h=`closingDebt-${a.id}`;return{key:h,dataIndex:h,width:200,align:"right",title:a.name,render:g=>t(w.NegativeNumber,{children:g})}}),{key:"totalClosingDebt",dataIndex:"totalClosingDebt",width:170,align:"right",title:c.total_debt,render:a=>t(w.NegativeNumber,{children:a})}]}],[n]),r=f.useMemo(()=>{let d=0;return l.forEach(a=>{a.width&&(d+=a.width)}),{scrollToFirstRowOnChange:!0,x:d}},[l]);return t(Y.Table,{columns:l,dataSource:e,loading:s,pagination:i,sticky:o,scroll:r})},Ot=20,di=()=>{const{idBuilding:e}=be(),{hideFormExport:s,tableData:i,filter:o}=f.useContext(Se),[n,l]=f.useState({isFetching:!1}),[r,d]=f.useState(0),[a,p]=f.useState({}),[h,g]=f.useState([]),[T,P]=f.useState(!1);return f.useEffect(()=>{(async()=>{l({isFetching:!0}),d(0);const u=[];let m=1;const v=i.totalRecord+Math.ceil(i.totalRecord/Ot),y=Math.floor(v/Ot)+1;let O=0;const N=await Ro(o,e);for(N&&Object.keys(N).length&&p(N);m<=y;){const[B]=await wo({filter:o,idBuilding:e,pagination:{current:m,limit:Ot}});if(B.length>0){B.forEach(E=>{u.push({...E})}),m+=1;const I=Ot/v*100;O+=I,d(Math.round(O))}else break}g(u),P(!0)})()},[]),f.useEffect(()=>{T&&setTimeout(()=>{const u=document.getElementById("tableExcel"),m=zt.table_to_book(u);Wt(m,"thong-tin-cong-no-phat-sinh-theo-thang.xlsx"),l({isFetching:!1}),Yt.success({message:c.success,description:c.export_data_success}),s()},3e3)},[T]),[n.isFetching,r,i.services,h,a]},ci=()=>{const[e,s,i,o,n]=di(),l=f.useMemo(()=>S("table",{id:"tableExcel",hidden:!0,children:[S("tr",{children:[t("td",{rowSpan:3,style:{textAlign:"center"},children:"#"}),t("td",{rowSpan:3,children:c.unit}),t("td",{colSpan:i.length+3,children:c.opening_debt}),t("td",{colSpan:i.length+1,children:c.arise}),t("td",{colSpan:i.length+i.length+3,children:c.paid_in_period}),t("td",{colSpan:i.length+1,children:c.paid_before_this_month}),t("td",{colSpan:i.length+1,children:c.closing_debt})]}),S("tr",{children:[i.map((r,d)=>t("td",{rowSpan:2,children:r.name},d)),t("td",{rowSpan:2,children:c.total_opening_debt}),t("td",{rowSpan:2,children:c.label.opening_advance_payment}),t("td",{rowSpan:2,children:c.label.opening_debt_balance_prepaid_deduction}),i.map((r,d)=>t("td",{rowSpan:2,children:r.name},d)),t("td",{rowSpan:2,children:c.label.total}),i.map((r,d)=>t("td",{rowSpan:2,children:r.name},d)),t("td",{rowSpan:2,children:c.total_paid_in_period}),t("td",{colSpan:i.length,children:c.deposit_in_period}),t("td",{rowSpan:2,children:c.total_deposit_in_period}),t("td",{rowSpan:2,children:c.label.total}),i.map((r,d)=>t("td",{rowSpan:2,children:r.name},d)),t("td",{rowSpan:2,children:c.label.total}),i.map((r,d)=>t("td",{rowSpan:2,children:r.name},d)),t("td",{rowSpan:2,children:c.total_debt})]}),t("tr",{children:i.map((r,d)=>t("td",{children:r.name},d))}),n&&Object.keys(n).length?S("tr",{children:[t("td",{colSpan:2,children:c.total}),i.map((r,d)=>t("td",{children:(n==null?void 0:n[`openingDebt-${r.id}`])??0},d)),t("td",{children:(n==null?void 0:n.totalOpeningDebt)??0}),t("td",{children:(n==null?void 0:n.openingPaidBefore)??0}),t("td",{children:(n==null?void 0:n.openingDebtBalancePrepaidDeduction)??0}),i.map((r,d)=>t("td",{children:(n==null?void 0:n[`receivable-${r.id}`])??0},d)),t("td",{children:(n==null?void 0:n.totalReceivable)??0}),i.map((r,d)=>t("td",{children:(n==null?void 0:n[`paidInPeriod-${r.id}`])??0},d)),t("td",{children:(n==null?void 0:n.totalPaidInPeriod)??0}),i.map((r,d)=>t("td",{children:(n==null?void 0:n[`paidBefore-${r.id}`])??0},d)),t("td",{children:(n==null?void 0:n.totalPaidBefore)??0}),t("td",{children:(n==null?void 0:n.totalPaid)??0}),i.map((r,d)=>t("td",{children:(n==null?void 0:n[`deductPaidBefore-${r.id}`])??0},d)),t("td",{children:(n==null?void 0:n.totalDeductPaidBefore)??0}),i.map((r,d)=>t("td",{children:(n==null?void 0:n[`closingDebt-${r.id}`])??0},d)),t("td",{children:(n==null?void 0:n.totalClosingDebt)??0})]},"total"):null,o.map((r,d)=>S("tr",{children:[t("td",{children:d+1}),t("td",{children:r.apartment}),i.map((a,p)=>t("td",{children:(r==null?void 0:r[`openingDebt-${a.id}`])??0},p)),t("td",{children:(r==null?void 0:r.totalOpeningDebt)??0}),t("td",{children:(r==null?void 0:r.openingPaidBefore)??0}),t("td",{children:(r==null?void 0:r.openingDebtBalancePrepaidDeduction)??0}),i.map((a,p)=>t("td",{children:(r==null?void 0:r[`receivable-${a.id}`])??0},p)),t("td",{children:(r==null?void 0:r.totalReceivable)??0}),i.map((a,p)=>t("td",{children:(r==null?void 0:r[`paidInPeriod-${a.id}`])??0},p)),t("td",{children:(r==null?void 0:r.totalPaidInPeriod)??0}),i.map((a,p)=>t("td",{children:(r==null?void 0:r[`paidBefore-${a.id}`])??0},p)),t("td",{children:(r==null?void 0:r.totalPaidBefore)??0}),t("td",{children:(r==null?void 0:r.totalPaid)??0}),i.map((a,p)=>t("td",{children:(r==null?void 0:r[`deductPaidBefore-${a.id}`])??0},p)),t("td",{children:(r==null?void 0:r.totalDeductPaidBefore)??0}),i.map((a,p)=>t("td",{children:(r==null?void 0:r[`closingDebt-${a.id}`])??0},p)),t("td",{children:(r==null?void 0:r.totalClosingDebt)??0})]},r.key))]}),[o,i,n]);return S(Tt,{open:!0,okText:c.export,cancelText:c.cancel,okButtonProps:{loading:e,disabled:e},footer:null,closable:!1,children:[t(Ct,{strokeColor:{from:"#108ee9",to:"#87d068"},percent:s,status:"active"}),l]})},li=()=>{const{getServiceInUses:e,idBuilding:s,formExport:i}=f.useContext(Se),{setVisibleFilterBox:o}=f.useContext(de),[n]=Zt();return f.useEffect(()=>(o(!1),(async()=>await Promise.all([e({idBuilding:s}),n({filter:{...$t},pagination:{current:A,limit:L},isChangeTotalRow:!0})]))(),()=>{o(!1)}),[]),{isShowFormExport:i.isShow}},hi=()=>{const{isShowFormExport:e}=li();return S(Y.Wrapper,{children:[t(ai,{}),S(Y.Container,{children:[t(Y.Header,{children:t(ti,{})}),t(Y.Content,{children:t(si,{})})]}),e&&t(ci,{})]})},pi=()=>t(qt,{children:t(hi,{})}),kt={unitName:"",serviceId:"",monthSelected:F()},Ne=f.createContext({idBuilding:0,debtGetsStatus:{isFetching:!1},setDebtGetsStatus:()=>{},filter:{...kt},setFilter:()=>{},tableData:{records:[],totalRecord:0,services:[],totalRow:{},monthsOfOpeningDebt:[],monthsOfReceivable:[],monthServicesOfReceivable:[],monthsOfPaidInPeriod:[],monthsOfPaidBefore:[],monthsOfDeductPaidBefore:[],monthsOfClosingDebt:[]},setTableData:()=>{},tablePagination:{current:A,limit:L},setTablePagination:()=>{},serviceInUses:[],getServiceInUses:()=>{},formExport:void 0,showFormExport:()=>{},hideFormExport:()=>{},accountsReceivableReportPermissionExport:!1}),eo=({children:e})=>{var O;const{idBuilding:s}=be(),[i,o]=f.useState({isFetching:!1}),[n,l]=f.useState({...kt}),[r,d]=f.useState({records:[],totalRecord:0,services:[],totalRow:{},monthsOfOpeningDebt:[],monthsOfReceivable:[],monthServicesOfReceivable:[],monthsOfPaidInPeriod:[],monthsOfPaidBefore:[],monthsOfDeductPaidBefore:[],monthsOfClosingDebt:[]}),[a,p]=f.useState({current:A,limit:L}),[h,g,T]=bt(),{serviceInUses:P,getServiceInUses:u}=Fe(),{getPermissionByModuleCode:m}=vt(),v=((O=m(Pt))==null?void 0:O[yt])??!1,y={idBuilding:s,debtGetsStatus:i,setDebtGetsStatus:o,filter:n,setFilter:l,tableData:r,setTableData:d,tablePagination:a,setTablePagination:p,serviceInUses:P,getServiceInUses:u,formExport:h,showFormExport:g,hideFormExport:T,accountsReceivableReportPermissionExport:v};return t(Ne.Provider,{value:y,children:e})};eo.propTypes={children:ke.node};eo.defaultProps={children:t("div",{})};const ui=()=>{const{tableData:e,showFormExport:s,accountsReceivableReportPermissionExport:i}=f.useContext(Ne),o=()=>{s()};return[e.totalRecord,o,i]},mi=()=>{const[e,s,i]=ui(),o=[i?t(Le,{ghost:!0,type:"primary",onClick:()=>s(),icon:t(ye,{name:"icon-download-outlined"}),css:n=>({marginRight:n.margin.xs}),children:c.export},"export"):null];return t(Y.ActionBox,{actions:o,total:e})},gi=(e,s,i)=>{const{unit:o,openingDebt:n,receivable:l,paidInPeriod:r,paidBefore:d,closingDebt:a,totalPaid:p,deductPaidBefore:h,totalOpeningDebt:g,openingPaidBefore:T,openingDebtBalancePrepaidDeduction:P,totalReceivable:u,totalPaidInPeriod:m,totalPaidBefore:v,totalClosingDebt:y,totalDeductPaidBefore:O}=e,{monthsOfOpeningDebt:N=[],monthsOfReceivable:B=[],monthServicesOfReceivable:I=[],monthsOfPaidInPeriod:E=[],monthsOfPaidBefore:M=[],monthsOfDeductPaidBefore:R=[],monthsOfClosingDebt:_=[]}=i,k={id:o.id,apartment:(o==null?void 0:o.name)??"",key:`key.${o.id}`,totalOpeningDebt:g||0,openingPaidBefore:T||0,openingDebtBalancePrepaidDeduction:P||0,totalReceivable:u||0,totalPaidInPeriod:m||0,totalPaidBefore:v||0,totalClosingDebt:y||0,totalDeductPaidBefore:O||0,totalPaid:p};for(let C=0;C<N.length;C+=1){const $=N[C],K=`openingDebt-${$}`;k[K]=Number(n[$]??0)}for(let C=0;C<B.length;C+=1){const $=B[C],K=`receivable-${$}`;k[K]=Number(l[$]??0)}for(let C=0;C<I.length;C+=1){const $=I[C],K=`receivableService-${$}`;k[K]=Number(l[$]??0)}for(let C=0;C<E.length;C+=1){const $=E[C],K=`paidInPeriod-${$}`;k[K]=Number(r[$]??0)}for(let C=0;C<M.length;C+=1){const $=M[C],K=`paidBefore-${$}`;k[K]=Number(d[$]??0)}for(let C=0;C<R.length;C+=1){const $=R[C],K=`deductPaidBefore-${$}`;k[K]=Number(h[$]??0)}for(let C=0;C<_.length;C+=1){const $=_[C],K=`closingDebt-${$}`;k[K]=Number(a[$]??0)}return{...k}},Oo=async({filter:e,pagination:s,idBuilding:i,monthDebt:o})=>{var P,u;const{current:n,limit:l}=s,{unitName:r,serviceId:d,monthSelected:a}=e,p=await _n({filter:{unitName:r||void 0,serviceId:d||void 0,monthSelected:a.format("YYYYMM")},idBuilding:i,limit:l-1,page:n}),h=((P=p==null?void 0:p.data)==null?void 0:P.services)??[];return[(((u=p==null?void 0:p.data)==null?void 0:u.units)??[]).map(m=>gi(m,h,o)),h,p.totalRecord]},fi=e=>{const{openingDebt:s,receivable:i,paidInPeriod:o,paidBefore:n,closingDebt:l,totalPaid:r,deductPaidBefore:d,totalOpeningDebt:a,openingPaidBefore:p,openingDebtBalancePrepaidDeduction:h,totalReceivable:g,totalPaidInPeriod:T,totalPaidBefore:P,totalClosingDebt:u,totalDeductPaidBefore:m}=e,v={id:"total",apartment:c.total,key:"key.total",totalOpeningDebt:a||0,openingPaidBefore:p||0,openingDebtBalancePrepaidDeduction:h||0,totalReceivable:g||0,totalPaidInPeriod:T||0,totalPaidBefore:P||0,totalClosingDebt:u||0,totalDeductPaidBefore:m||0,totalPaid:r},y=[];Object.keys(s).forEach(R=>{y.push(R);const _=`openingDebt-${R}`;v[_]=Number(s[R]??0)});const O=[],N=[];Object.keys(i).forEach(R=>{if(R.includes("-")){N.push(R);const _=`receivableService-${R}`;v[_]=Number(i[R]??0)}else{O.push(R);const _=`receivable-${R}`;v[_]=Number(i[R]??0)}});const B=[];Object.keys(o).forEach(R=>{B.push(R);const _=`paidInPeriod-${R}`;v[_]=Number(o[R]??0)});const I=[];Object.keys(n).forEach(R=>{I.push(R);const _=`paidBefore-${R}`;v[_]=Number(n[R]??0)});const E=[];Object.keys(d).forEach(R=>{E.push(R);const _=`deductPaidBefore-${R}`;v[_]=Number(d[R]??0)});const M=[];return Object.keys(l).forEach(R=>{M.push(R);const _=`closingDebt-${R}`;v[_]=Number(l[R]??0)}),{totalDebt:{...v},monthsOfOpeningDebt:y.sort((R,_)=>Number(R)-Number(_)),monthServicesOfReceivable:N.sort((R,_)=>Number((R==null?void 0:R.split("-")[0])??0)-Number((_==null?void 0:_.split("-")[0])??0)),monthsOfReceivable:O.sort((R,_)=>Number(R)-Number(_)),monthsOfPaidInPeriod:B.sort((R,_)=>Number(R)-Number(_)),monthsOfPaidBefore:I.sort((R,_)=>Number(R)-Number(_)),monthsOfDeductPaidBefore:E.sort((R,_)=>Number(R)-Number(_)),monthsOfClosingDebt:M.sort((R,_)=>Number(R)-Number(_))}},Eo=async(e,s)=>{var i,o;try{const n={unitName:e.unitName||void 0,serviceId:e.serviceId||void 0,monthSelected:e.monthSelected.format("YYYYMM")},l=await En(n,s),r=((i=l==null?void 0:l.data)==null?void 0:i.services)??[],d=((o=l==null?void 0:l.data)==null?void 0:o.totalDebt)??{};return fi(d,r)}catch{return{}}},to=()=>{const{idBuilding:e,setTablePagination:s,setTableData:i,setDebtGetsStatus:o,tableData:n}=f.useContext(Ne);return[async({filter:r,pagination:d,isChangeTotalRow:a})=>{const{current:p,limit:h}=d;o({isFetching:!0,code:void 0,codeLanguage:void 0}),s({current:p,limit:h});const g={...n},T={monthsOfOpeningDebt:[],monthsOfReceivable:[],monthServicesOfReceivable:[],monthsOfPaidInPeriod:[],monthsOfPaidBefore:[],monthsOfDeductPaidBefore:[],monthsOfClosingDebt:[]};if(a){const{totalDebt:v,monthsOfOpeningDebt:y,monthsOfReceivable:O,monthsOfPaidInPeriod:N,monthsOfPaidBefore:B,monthsOfDeductPaidBefore:I,monthsOfClosingDebt:E,monthServicesOfReceivable:M}=await Eo(r,e);v&&Object.keys(v).length&&(g.totalRow=v),T.monthsOfOpeningDebt=y||[],T.monthsOfReceivable=O||[],T.monthsOfPaidInPeriod=N||[],T.monthsOfPaidBefore=B||[],T.monthsOfDeductPaidBefore=I||[],T.monthsOfClosingDebt=E||[],T.monthServicesOfReceivable=M||[]}const[P,u,m]=await Oo({filter:r,idBuilding:e,pagination:d,monthDebt:T});i({...g,records:P,totalRecord:m,services:u,...T}),o({isFetching:!1,code:void 0,codeLanguage:void 0})}]},Ti=()=>{const{setFilter:e,serviceInUses:s}=f.useContext(Ne),[i]=to();return[async n=>{e(n),await i({filter:{...n},pagination:{current:A,limit:L},isChangeTotalRow:!0})},s]},bi=()=>{const[e,s]=Ti(),i=f.useMemo(()=>[{label:c.unit,key:"unitName",component:t(Ae,{placeholder:c.unit}),visible:!0},{label:c.service,key:"serviceId",component:S(V,{placeholder:c.service,fluid:"true",getPopupContainer:o=>o.parentNode,children:[t(V.Option,{value:"",children:c.all_service},"service_0"),s.map(o=>t(V.Option,{value:o.id,children:o.name},o.id))]}),visible:!0},{label:c.month,key:"monthSelected",component:t($e,{placeholder:c.month,fluid:"true",picker:"month",format:"MM/YYYY",allowClear:!1,getPopupContainer:o=>o.parentNode}),visible:!0,fixed:!0}],[s]);return t(Y.FilterBox,{defaultFilter:kt,filters:i,onSearch:e})},vi=()=>{const{filter:e,debtGetsStatus:s,tableData:i,tablePagination:o}=f.useContext(Ne),{layoutScrollRef:n}=f.useContext(de),[l]=to(),r=Me(),d=async(T,P)=>{o.current!==T?await l({filter:{...e},pagination:{current:T,limit:o.limit},isChangeTotalRow:!1}):o.limit!==P&&await l({filter:{...e},pagination:{current:o.current,limit:P},isChangeTotalRow:!1})},a=f.useMemo(()=>({defaultPageSize:L,defaultCurrent:A,pageSize:o.limit,current:o.current,total:i.totalRecord+Math.ceil(i.totalRecord/o.limit),showQuickJumper:!0,showSizeChanger:!0,onChange:d}),[o,i.totalRecord]),p={offsetScroll:r.offsetScrollX,getContainer:()=>n.current},h=f.useMemo(()=>i.totalRow&&Object.keys(i.totalRow).length?[i.totalRow,...i.records]:i.records,[i]),g=f.useMemo(()=>Gt(i.services,"id"),[i.services]);return{dataSource:h,loading:s.isFetching,pagination:a,sticky:p,serviceObj:g,filter:e,monthsOfOpeningDebt:i.monthsOfOpeningDebt,monthsOfReceivable:i.monthsOfReceivable,monthServicesOfReceivable:i.monthServicesOfReceivable,monthsOfPaidInPeriod:i.monthsOfPaidInPeriod,monthsOfPaidBefore:i.monthsOfPaidBefore,monthsOfDeductPaidBefore:i.monthsOfDeductPaidBefore,monthsOfClosingDebt:i.monthsOfClosingDebt}},Pi=()=>{const{dataSource:e,loading:s,pagination:i,sticky:o,serviceObj:n,monthsOfOpeningDebt:l=[],monthsOfReceivable:r=[],monthServicesOfReceivable:d=[],monthsOfPaidInPeriod:a=[],monthsOfPaidBefore:p=[],monthsOfDeductPaidBefore:h=[],monthsOfClosingDebt:g=[]}=vi(),T=f.useMemo(()=>[{key:"apartment",dataIndex:"apartment",title:c.unit,width:150,fixed:"left"},{key:"",dataIndex:"",title:c.opening_debt,width:l.length*120+150+150+220,children:[...l.map(m=>{const v=`openingDebt-${m}`;return{key:v,dataIndex:v,width:120,align:"right",title:F(m,"YYYYMM").format("MM/YYYY"),render:y=>t(w.NegativeNumber,{children:y})}}),{key:"totalOpeningDebt",dataIndex:"totalOpeningDebt",width:150,align:"right",title:c.total_opening_debt,render:m=>t(w.NegativeNumber,{children:m})},{key:"openingPaidBefore",dataIndex:"openingPaidBefore",width:150,align:"right",title:c.label.opening_advance_payment,render:m=>t(w.NegativeNumber,{children:m})},{key:"openingDebtBalancePrepaidDeduction",dataIndex:"openingDebtBalancePrepaidDeduction",width:220,align:"right",title:c.label.opening_debt_balance_prepaid_deduction,render:m=>t(w.NegativeNumber,{children:m})}]},{key:"",dataIndex:"",title:c.arise,width:d.length*200+150,children:[...r.map(m=>{const v=`receivable-${m}`,y=(d==null?void 0:d.filter(O=>O==null?void 0:O.includes(m)))??[];return{key:v,dataIndex:v,align:"center",title:F(m,"YYYYMM").format("MM/YYYY"),children:[...y.map(O=>{var E;const N=`receivableService-${O}`,B=O.split("-")[1],I=((E=n==null?void 0:n[B])==null?void 0:E.name)??"";return{key:N,dataIndex:N,width:200,align:"right",title:`${I}`,render:M=>t(w.NegativeNumber,{children:M})}})]}}),{key:"totalReceivable",dataIndex:"totalReceivable",width:150,align:"right",title:c.label.total,render:m=>t(w.NegativeNumber,{children:m})}]},{key:"",dataIndex:"",title:c.paid_in_period,width:a.length*120+200+p.length*120+230+150,children:[...a.map(m=>{const v=`paidInPeriod-${m}`;return{key:v,dataIndex:v,width:120,align:"right",title:F(m,"YYYYMM").format("MM/YYYY"),render:y=>t(w.NegativeNumber,{children:y})}}),{key:"totalPaidInPeriod",dataIndex:"totalPaidInPeriod",width:200,align:"right",title:c.total_paid_in_period,render:m=>t(w.NegativeNumber,{children:m})},p.length?{key:"",dataIndex:"",align:"center",title:c.deposit_in_period,children:[...p.map(m=>{const v=`paidBefore-${m}`;return{key:v,dataIndex:v,width:150,align:"right",title:F(m,"YYYYMM").format("MM/YYYY"),render:y=>t(w.NegativeNumber,{children:y})}})]}:null,{key:"totalPaidBefore",dataIndex:"totalPaidBefore",width:230,align:"right",title:c.total_deposit_in_period,render:m=>t(w.NegativeNumber,{children:m})},{key:"totalPaid",dataIndex:"totalPaid",width:150,align:"right",title:c.label.total,render:m=>t(w.NegativeNumber,{children:m})}].filter(Boolean)},{key:"",dataIndex:"",title:c.paid_before_this_month,width:h.length*120+150,children:[...h.map(m=>{const v=`deductPaidBefore-${m}`;return{key:v,dataIndex:v,width:120,align:"right",title:F(m,"YYYYMM").format("MM/YYYY"),render:y=>t(w.NegativeNumber,{children:y})}}),{key:"totalDeductPaidBefore",dataIndex:"totalDeductPaidBefore",width:150,align:"right",title:c.label.total,render:m=>t(w.NegativeNumber,{children:m})}]},{key:"",dataIndex:"",title:c.closing_debt,width:g.length*120+170,children:[...g.map(m=>{const v=`closingDebt-${m}`;return{key:v,dataIndex:v,width:120,align:"right",title:F(m,"YYYYMM").format("MM/YYYY"),render:y=>t(w.NegativeNumber,{children:y})}}),{key:"totalClosingDebt",dataIndex:"totalClosingDebt",width:170,align:"right",title:c.total_debt,render:m=>t(w.NegativeNumber,{children:m})}]}],[l,d,r,a,p,h,g,n]),P=f.useMemo(()=>{let u=0;return T.forEach(m=>{m.width&&(u+=m.width)}),{scrollToFirstRowOnChange:!0,x:u}},[T]);return t(Y.Table,{columns:T,dataSource:e,loading:s,pagination:i,sticky:o,scroll:{...P}})},Et=20,yi=()=>{const{idBuilding:e}=be(),{hideFormExport:s,tableData:i,filter:o}=f.useContext(Ne),[n,l]=f.useState({isFetching:!1}),[r,d]=f.useState(0),[a,p]=f.useState({}),[h,g]=f.useState([]),[T,P]=f.useState({monthsOfOpeningDebt:[],monthsOfReceivable:[],monthServicesOfReceivable:[],monthsOfPaidInPeriod:[],monthsOfPaidBefore:[],monthsOfDeductPaidBefore:[],monthsOfClosingDebt:[]}),[u,m]=f.useState(!1);f.useEffect(()=>{(async()=>{l({isFetching:!0}),d(0);const y=[];let O=1;const N=i.totalRecord+Math.ceil(i.totalRecord/Et),B=Math.floor(N/Et)+1;let I=0;const{totalDebt:E,monthsOfOpeningDebt:M,monthsOfReceivable:R,monthsOfPaidInPeriod:_,monthsOfPaidBefore:k,monthsOfDeductPaidBefore:C,monthsOfClosingDebt:$,monthServicesOfReceivable:K}=await Eo(o,e);E&&Object.keys(E).length&&p(E);const H={...T};for(H.monthsOfOpeningDebt=M||[],H.monthsOfReceivable=R||[],H.monthsOfPaidInPeriod=_||[],H.monthsOfPaidBefore=k||[],H.monthsOfDeductPaidBefore=C||[],H.monthsOfClosingDebt=$||[],H.monthServicesOfReceivable=K||[],P(H);O<=B;){const[ee]=await Oo({filter:o,idBuilding:e,pagination:{current:O,limit:Et},monthDebt:H});if(ee.length>0){ee.forEach(ie=>{y.push({...ie})}),O+=1;const ne=Et/N*100;I+=ne,d(Math.round(I))}else break}g(y),m(!0)})()},[]),f.useEffect(()=>{u&&setTimeout(()=>{const y=document.getElementById("tableExcel"),O=zt.table_to_book(y);Wt(O,"thong-tin-cong-no-phat-sinh-theo-thang-no.xlsx"),l({isFetching:!1}),Yt.success({message:c.success,description:c.export_data_success}),s()},3e3)},[u]);const v=f.useMemo(()=>Gt(i.services,"id"),[i.services]);return{loading:n.isFetching,percent:r,serviceObj:v,listUnit:h,totalDebt:a,monthDebt:T}},xi=()=>{const{loading:e,percent:s,listUnit:i,totalDebt:o,monthDebt:n,serviceObj:l}=yi(),{monthsOfOpeningDebt:r=[],monthsOfReceivable:d=[],monthServicesOfReceivable:a=[],monthsOfPaidInPeriod:p=[],monthsOfPaidBefore:h=[],monthsOfDeductPaidBefore:g=[],monthsOfClosingDebt:T=[]}=n,P=f.useMemo(()=>S("table",{id:"tableExcel",hidden:!0,children:[S("tr",{children:[t("td",{rowSpan:3,style:{textAlign:"center"},children:"#"}),t("td",{rowSpan:3,children:c.unit}),t("td",{colSpan:r.length+3,children:c.opening_debt}),t("td",{colSpan:d.length+1,children:c.arise}),t("td",{colSpan:p.length+h.length+3,children:c.paid_in_period}),t("td",{colSpan:g.length+1,children:c.paid_before_this_month}),t("td",{colSpan:T.length+1,children:c.closing_debt})]}),S("tr",{children:[r.map((u,m)=>t("td",{rowSpan:2,children:F(u,"YYYYMM").format("MM/YYYY")},m)),t("td",{rowSpan:2,children:c.total_opening_debt}),t("td",{rowSpan:2,children:c.label.opening_advance_payment}),t("td",{rowSpan:2,children:c.label.opening_debt_balance_prepaid_deduction}),d.map((u,m)=>{const v=(a==null?void 0:a.filter(y=>y==null?void 0:y.includes(u)))??[];return t("td",{colSpan:v.length,children:F(u,"YYYYMM").format("MM/YYYY")},m)}),t("td",{rowSpan:2,children:c.label.total}),p.map((u,m)=>t("td",{rowSpan:2,children:F(u,"YYYYMM").format("MM/YYYY")},m)),t("td",{rowSpan:2,children:c.total_paid_in_period}),h.length?t("td",{colSpan:h.length,children:c.deposit_in_period}):null,t("td",{rowSpan:2,children:c.total_deposit_in_period}),t("td",{rowSpan:2,children:c.label.total}),g.map((u,m)=>t("td",{rowSpan:2,children:F(u,"YYYYMM").format("MM/YYYY")},m)),t("td",{rowSpan:2,children:c.label.total}),T.map((u,m)=>t("td",{rowSpan:2,children:F(u,"YYYYMM").format("MM/YYYY")},m)),t("td",{rowSpan:2,children:c.total_debt})]}),h.length||a.length&&d.length?S("tr",{children:[d.map(u=>((a==null?void 0:a.filter(v=>v==null?void 0:v.includes(u)))??[]).map((v,y)=>{var B;const O=v.split("-")[1],N=((B=l==null?void 0:l[O])==null?void 0:B.name)??"";return t("td",{children:N},y)})),h.map((u,m)=>t("td",{children:F(u,"YYYYMM").format("MM/YYYY")},m))]}):null,o&&Object.keys(o).length?S("tr",{children:[t("td",{colSpan:2,children:c.total}),r.map((u,m)=>t("td",{children:(o==null?void 0:o[`openingDebt-${u}`])??0},m)),t("td",{children:(o==null?void 0:o.totalOpeningDebt)??0}),t("td",{children:(o==null?void 0:o.openingPaidBefore)??0}),t("td",{children:(o==null?void 0:o.openingDebtBalancePrepaidDeduction)??0}),a.map((u,m)=>t("td",{children:(o==null?void 0:o[`receivableService-${u}`])??0},m)),t("td",{children:(o==null?void 0:o.totalReceivable)??0}),p.map((u,m)=>t("td",{children:(o==null?void 0:o[`paidInPeriod-${u}`])??0},m)),t("td",{children:(o==null?void 0:o.totalPaidInPeriod)??0}),h.length?h.map((u,m)=>t("td",{children:(o==null?void 0:o[`paidBefore-${u}`])??0},m)):null,t("td",{children:(o==null?void 0:o.totalPaidBefore)??0}),t("td",{children:(o==null?void 0:o.totalPaid)??0}),g.map((u,m)=>t("td",{children:(o==null?void 0:o[`deductPaidBefore-${u}`])??0},m)),t("td",{children:(o==null?void 0:o.totalDeductPaidBefore)??0}),T.map((u,m)=>t("td",{children:(o==null?void 0:o[`closingDebt-${u}`])??0},m)),t("td",{children:(o==null?void 0:o.totalClosingDebt)??0})]},"total"):null,i.map((u,m)=>S("tr",{children:[t("td",{children:m+1}),t("td",{children:u.apartment}),r.map((v,y)=>t("td",{children:(u==null?void 0:u[`openingDebt-${v}`])??0},y)),t("td",{children:(u==null?void 0:u.totalOpeningDebt)??0}),t("td",{children:(u==null?void 0:u.openingPaidBefore)??0}),t("td",{children:(u==null?void 0:u.openingDebtBalancePrepaidDeduction)??0}),a.map((v,y)=>t("td",{children:(u==null?void 0:u[`receivableService-${v}`])??0},y)),t("td",{children:(u==null?void 0:u.totalReceivable)??0}),p.map((v,y)=>t("td",{children:(u==null?void 0:u[`paidInPeriod-${v}`])??0},y)),t("td",{children:(u==null?void 0:u.totalPaidInPeriod)??0}),h.length?h.map((v,y)=>t("td",{children:(u==null?void 0:u[`paidBefore-${v}`])??0},y)):null,t("td",{children:(u==null?void 0:u.totalPaidBefore)??0}),t("td",{children:(u==null?void 0:u.totalPaid)??0}),g.map((v,y)=>t("td",{children:(u==null?void 0:u[`deductPaidBefore-${v}`])??0},y)),t("td",{children:(u==null?void 0:u.totalDeductPaidBefore)??0}),T.map((v,y)=>t("td",{children:(u==null?void 0:u[`closingDebt-${v}`])??0},y)),t("td",{children:(u==null?void 0:u.totalClosingDebt)??0})]},u.key))]}),[i,a,T,g,r,h,p,d,l,o]);return S(Tt,{open:!0,okText:c.export,cancelText:c.cancel,okButtonProps:{loading:e,disabled:e},footer:null,closable:!1,children:[t(Ct,{strokeColor:{from:"#108ee9",to:"#87d068"},percent:s,status:"active"}),P]})},_i=()=>{const{getServiceInUses:e,idBuilding:s,formExport:i}=f.useContext(Ne),{setVisibleFilterBox:o}=f.useContext(de),[n]=to();return f.useEffect(()=>(o(!1),(async()=>(await e({idBuilding:s}),await n({filter:{...kt},pagination:{current:A,limit:L},isChangeTotalRow:!0})))(),()=>{o(!1)}),[]),{isShowFormExport:i.isShow}},wi=()=>{const{isShowFormExport:e}=_i();return S(Y.Wrapper,{children:[t(bi,{}),S(Y.Container,{children:[t(Y.Header,{children:t(mi,{})}),t(Y.Content,{children:t(Pi,{})})]}),e&&t(xi,{})]})},Ri=()=>t(eo,{children:t(wi,{})}),ft={unitIds:[],serviceIds:[],monthSelected:[F(),F()]},Be=f.createContext({idBuilding:0,debtGetsStatus:{isFetching:!1},setDebtGetsStatus:()=>{},filter:{...ft},setFilter:()=>{},tableData:{records:[],totalRecord:0,services:[],totalRow:{}},setTableData:()=>{},tablePagination:{current:A,limit:L},setTablePagination:()=>{},services:[],getServices:()=>{},formExport:void 0,showFormExport:()=>{},hideFormExport:()=>{},units:[],setUnits:()=>{},getUnitStatus:{isFetching:!1},setGetUnitStatus:()=>{},totalRow:{},setTotalRow:()=>{},getTotalRowStatus:{isFetching:!1},setGetTotalRowStatus:()=>{}}),oo=({children:e})=>{var k;const{idBuilding:s}=be(),[i,o]=f.useState({isFetching:!1}),[n,l]=f.useState({...ft}),[r,d]=f.useState({records:[],totalRecord:0,services:[]}),[a,p]=f.useState({}),[h,g]=f.useState({isFetching:!1}),[T,P]=f.useState({current:A,limit:L}),[u,m]=f.useState([]),[v,y]=f.useState({isFetching:!1}),[O,N,B]=bt(),{services:I,getServices:E}=Fe(),{getPermissionByModuleCode:M}=vt(),R=((k=M(Pt))==null?void 0:k[yt])??!1,_={idBuilding:s,debtGetsStatus:i,setDebtGetsStatus:o,units:u,setUnits:m,getUnitStatus:v,setGetUnitStatus:y,filter:n,setFilter:l,tableData:r,setTableData:d,tablePagination:T,setTablePagination:P,services:I,getServices:E,totalRow:a,setTotalRow:p,getTotalRowStatus:h,setGetTotalRowStatus:g,formExport:O,showFormExport:N,hideFormExport:B,accountsReceivableReportPermissionExport:R};return t(Be.Provider,{value:_,children:e})};oo.propTypes={children:ke.node};oo.defaultProps={children:t("div",{})};const Oi=()=>{const{tableData:e,showFormExport:s,accountsReceivableReportPermissionExport:i}=f.useContext(Be),o=()=>{s()};return[e.totalRecord,o,i]},Ei=()=>{const[e,s,i]=Oi(),o=[i?t(Le,{ghost:!0,type:"primary",onClick:()=>s(),icon:t(ye,{name:"icon-download-outlined"}),css:n=>({marginRight:n.margin.xs}),children:c.export},"export"):null].filter(Boolean);return t(Y.ActionBox,{actions:o,total:e})},Si=(e,s)=>{const{unit:i,openingDebt:o,openingPaidBefore:n,receivable:l,adjust:r,paidInPeriod:d,paidBeforeInPeriod:a,deductPaidBefore:p,closingDebt:h,closingPaidBefore:g}=e,T={id:i.id,unitName:(i==null?void 0:i.name)||"",key:`uni.${i.id}`,"openingDebt-total":(o==null?void 0:o.totalOpeningDebt)||0,"openingPaidBefore-total":(n==null?void 0:n.totalOpeningPaidBefore)||0,"receivable-total":(l==null?void 0:l.totalReceivable)||0,"adjust-total":(r==null?void 0:r.totalAdjust)||0,"paidInPeriod-total":(d==null?void 0:d.totalPaidInPeriod)||0,"paidBeforeInPeriod-total":(a==null?void 0:a.totalPaidBeforeInPeriod)||0,"closingDebt-total":(h==null?void 0:h.totalClosingDebt)||0,"closingPaidBefore-total":(g==null?void 0:g.totalClosingPaidBefore)||0,"deductPaidBefore-total":(p==null?void 0:p.totalDeductPaidBefore)||0};return s.forEach(P=>{const u=P.id;if(u==="total")return;const m=`openingDebt-${u}`;T[m]=Number((o==null?void 0:o[m])||0);const v=`openingPaidBefore-${u}`;T[v]=Number((n==null?void 0:n[v])||0);const y=`receivable-${u}`;T[y]=Number((l==null?void 0:l[y])||0);const O=`adjust-${u}`;T[O]=Number((r==null?void 0:r[O])||0);const N=`paidInPeriod-${u}`;T[N]=Number((d==null?void 0:d[N])||0);const B=`paidBeforeInPeriod-${u}`;T[B]=Number((a==null?void 0:a[B])||0);const I=`deductPaidBefore-${u}`;T[I]=Number((p==null?void 0:p[I])||0);const E=`closingDebt-${u}`;T[E]=Number((h==null?void 0:h[E])||0);const M=`closingPaidBefore-${u}`;T[M]=Number((g==null?void 0:g[M])||0)}),{...T}},So=async({filter:e,pagination:s,idBuilding:i})=>{var o,n;try{const{current:l,limit:r}=s,{unitIds:d,serviceIds:a,monthSelected:p}=e,h=await wn({filter:{unitIds:d!=null&&d.length?d:void 0,serviceIds:a!=null&&a.length?a:void 0,monthSelectedFrom:F(p[0]).format("YYYYMM"),monthSelectedTo:F(p[1]).format("YYYYMM")},idBuilding:i,limit:r,page:l}),g=((o=h==null?void 0:h.data)==null?void 0:o.services)??[];return g.push({id:"total",name:c.label.total1.toUpperCase()}),[(((n=h==null?void 0:h.data)==null?void 0:n.units)??[]).map(u=>Si(u,g)),g,h.totalRecord]}catch{return[[],[],0]}},Ni=(e,s)=>{const{openingDebt:i,openingPaidBefore:o,receivable:n,adjust:l,paidInPeriod:r,paidBeforeInPeriod:d,deductPaidBefore:a,closingDebt:p,closingPaidBefore:h}=e,g={id:"total",unitName:c.total,key:"key.total","openingDebt-total":(i==null?void 0:i.totalOpeningDebt)||0,"openingPaidBefore-total":(o==null?void 0:o.totalOpeningPaidBefore)||0,"receivable-total":(n==null?void 0:n.totalReceivable)||0,"adjust-total":(l==null?void 0:l.totalAdjust)||0,"paidInPeriod-total":(r==null?void 0:r.totalPaidInPeriod)||0,"paidBeforeInPeriod-total":(d==null?void 0:d.totalPaidBeforeInPeriod)||0,"closingDebt-total":(p==null?void 0:p.totalClosingDebt)||0,"closingPaidBefore-total":(h==null?void 0:h.totalClosingPaidBefore)||0,"deductPaidBefore-total":(a==null?void 0:a.totalDeductPaidBefore)||0};return s.forEach(T=>{const P=T.id,u=`openingDebt-${P}`;g[u]=Number((i==null?void 0:i[u])||0);const m=`openingPaidBefore-${P}`;g[m]=Number((o==null?void 0:o[m])||0);const v=`receivable-${P}`;g[v]=Number((n==null?void 0:n[v])||0);const y=`adjust-${P}`;g[y]=Number((l==null?void 0:l[y])||0);const O=`paidInPeriod-${P}`;g[O]=Number((r==null?void 0:r[O])||0);const N=`paidBeforeInPeriod-${P}`;g[N]=Number((d==null?void 0:d[N])||0);const B=`deductPaidBefore-${P}`;g[B]=Number((a==null?void 0:a[B])||0);const I=`closingDebt-${P}`;g[I]=Number((p==null?void 0:p[I])||0);const E=`closingPaidBefore-${P}`;g[E]=Number((h==null?void 0:h[E])||0)}),{...g}},No=async(e,s)=>{var i,o;try{const{unitIds:n,serviceIds:l,monthSelected:r}=e,d={unitIds:n!=null&&n.length?n:void 0,serviceIds:l!=null&&l.length?l:void 0,monthSelectedFrom:F(r[0]).format("YYYYMM"),monthSelectedTo:F(r[1]).format("YYYYMM")},a=await Sn(d,s),p=((i=a==null?void 0:a.data)==null?void 0:i.services)??[],h=((o=a==null?void 0:a.data)==null?void 0:o.totalDebt)??{};return Ni(h,p)}catch{return{}}},no=()=>{const{idBuilding:e,setTablePagination:s,setTableData:i,setDebtGetsStatus:o,setTotalRow:n,setGetTotalRowStatus:l}=f.useContext(Be);return{changeDataTable:async({filter:a,pagination:p})=>{const{current:h,limit:g}=p;o({isFetching:!0,code:void 0,codeLanguage:void 0}),s({current:h,limit:g});const[T,P,u]=await So({filter:a,idBuilding:e,pagination:p});i({records:T,totalRecord:u,services:P}),o({isFetching:!1,code:void 0,codeLanguage:void 0})},changeTotalRow:async a=>{l({isFetching:!0});const p=await No(a,e);p&&Object.keys(p).length&&n(p),l({isFetching:!1})}}},Bi=e=>({id:e.id,name:e.name}),Bo=async({filter:e,limit:s,page:i,idBuilding:o})=>{try{const n=await Ko({filter:e,limit:s,page:i,idBuilding:o});return{code:n.code,codeLanguage:n.codeLanguage,data:n.data.map(l=>Bi(l))}}catch(n){return{code:n.code,codeLanguage:n.codeLanguage,data:[]}}},Ii=()=>{const{setFilter:e,services:s,idBuilding:i,getUnitStatus:o,setGetUnitStatus:n,units:l,setUnits:r,debtGetsStatus:d,getTotalRowStatus:a}=f.useContext(Be),{changeDataTable:p,changeTotalRow:h}=no(),g=async u=>{var m;e(u),(m=u==null?void 0:u.unitIds)!=null&&m.length||T(),h({...u}),await p({filter:{...u},pagination:{current:A,limit:L}})},T=async u=>{n({isFetching:!0});const m=await Bo({idBuilding:i,limit:L,page:A,filter:{name:u||void 0}});r(m==null?void 0:m.data),n({isFetching:!1})},P=f.useMemo(()=>!!(d!=null&&d.isFetching||a.isFetching),[d.isFetching,a.isFetching]);return{onSearch:g,services:s,isFetchingUnit:o.isFetching,handleSearchUnit:T,units:l,isDisableFilter:P}},Yi=()=>{const{onSearch:e,services:s,isFetchingUnit:i,handleSearchUnit:o,units:n,isDisableFilter:l}=Ii(),r=f.useMemo(()=>[{label:c.unit,key:"unitIds",component:t(V,{disabled:l,allowClear:!0,showSearch:!0,mode:"multiple",placeholder:c.label.select_apartment,filterOption:!1,loading:i,onSearch:Vo(o),style:{width:"100%"},getPopupContainer:d=>d.parentNode,dropdownRender:d=>i?t("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:t(Go,{})}):d,children:n==null?void 0:n.map(({id:d,name:a})=>t(V.Option,{value:d,children:a},d))}),visible:!0},{label:c.service,key:"serviceIds",component:t(V,{placeholder:c.service,fluid:"true",getPopupContainer:d=>d.parentNode,mode:"multiple",disabled:l,children:s.map(d=>t(V.Option,{value:d.id,children:d.name},d.id))}),visible:!0},{label:c.month,key:"monthSelected",component:t($e.RangePicker,{disabled:l,placeholder:[Rt,Rt],format:[Rt,Rt],fluid:"true",picker:"month",allowClear:!1,getPopupContainer:d=>d.parentNode}),visible:!0,fixed:!0}],[s,i,n,l]);return t(Y.FilterBox,{defaultFilter:ft,filters:r,onSearch:e})},Ci=()=>{const{filter:e,debtGetsStatus:s,tableData:i,tablePagination:o,totalRow:n,getTotalRowStatus:l}=f.useContext(Be),{layoutScrollRef:r}=f.useContext(de),{changeDataTable:d}=no(),a=Me(),p=async(T,P)=>{o.current!==T?await d({filter:{...e},pagination:{current:T,limit:o.limit}}):o.limit!==P&&await d({filter:{...e},pagination:{current:o.current,limit:P}})},h=f.useMemo(()=>({defaultPageSize:L,defaultCurrent:A,pageSize:o.limit,current:o.current,total:i.totalRecord+Math.ceil(i.totalRecord/o.limit),showQuickJumper:!0,showSizeChanger:!0,onChange:p}),[o,i.totalRecord]),g={offsetScroll:a.offsetScrollX,getContainer:()=>r.current};return{totalRow:n,dataSource:i.records,loading:s.isFetching,loadingTotalRow:l.isFetching,pagination:h,sticky:g,services:i.services,filter:e}},Mi=()=>{const{dataSource:e,loading:s,pagination:i,sticky:o,services:n,totalRow:l,loadingTotalRow:r}=Ci(),d=f.useMemo(()=>{const p=[{key:"apartment",dataIndex:"",title:c.unit,width:150,fixed:"left",children:[{key:"",dataIndex:"",width:150,title:"",fixed:"left",children:[{key:"total",dataIndex:"unitName",width:150,title:c.total,fixed:"left"}]}]}];return n.forEach(h=>{p.push({key:`service.${h.id}`,dataIndex:"",title:h.name,align:"center",children:[{key:"openingDebt",dataIndex:"openingDebt",width:150,align:"center",title:S("div",{children:[c.opening_debt,t("br",{}),"(1)"]}),children:[{key:`openingDebt-${h.id}`,dataIndex:`openingDebt-${h.id}`,width:150,align:"right",title:r?t(Pe,{zIndex:1,isLoading:!0}):t(w.NegativeNumber,{children:l[`openingDebt-${h.id}`]}),render:g=>t(w.NegativeNumber,{children:g})}]},{key:"openingPaidBefore",dataIndex:"openingPaidBefore",width:150,align:"center",title:S("div",{children:[c.opening_paid_before,t("br",{}),"(2)"]}),children:[{key:`openingPaidBefore-${h.id}`,dataIndex:`openingPaidBefore-${h.id}`,width:150,align:"right",title:r?t(Pe,{zIndex:1,isLoading:!0}):t(w.NegativeNumber,{children:l[`openingPaidBefore-${h.id}`]}),render:g=>t(w.NegativeNumber,{children:g})}]},{key:"receivable",dataIndex:"receivable",width:150,align:"center",title:S("div",{children:[c.receivables,t("br",{}),"(3)"]}),children:[{key:`receivable-${h.id}`,dataIndex:`receivable-${h.id}`,width:150,align:"right",title:r?t(Pe,{zIndex:1,isLoading:!0}):t(w.NegativeNumber,{children:l[`receivable-${h.id}`]}),render:g=>t(w.NegativeNumber,{children:g})}]},{key:"adjust",dataIndex:"adjust",width:150,align:"center",title:S("div",{children:[c.adjust,t("br",{}),"(4)"]}),children:[{key:`adjust-${h.id}`,dataIndex:`adjust-${h.id}`,width:150,align:"right",title:r?t(Pe,{zIndex:1,isLoading:!0}):t(w.NegativeNumber,{children:l[`adjust-${h.id}`]}),render:g=>t(w.NegativeNumber,{children:g})}]},{key:"deductPaidBefore",dataIndex:"deductPaidBefore",width:150,align:"center",title:S("div",{children:[c.deduct_paid_before,t("br",{}),"(5)"]}),children:[{key:`deductPaidBefore-${h.id}`,dataIndex:`deductPaidBefore-${h.id}`,width:150,align:"right",title:r?t(Pe,{zIndex:1,isLoading:!0}):t(w.NegativeNumber,{children:l[`deductPaidBefore-${h.id}`]}),render:g=>t(w.NegativeNumber,{children:g})}]},{key:"paidInPeriod",dataIndex:"paidInPeriod",width:150,align:"center",title:S("div",{children:[c.paid,t("br",{}),"(6)"]}),children:[{key:`paidInPeriod-${h.id}`,dataIndex:`paidInPeriod-${h.id}`,width:150,align:"right",title:r?t(Pe,{zIndex:1,isLoading:!0}):t(w.NegativeNumber,{children:l[`paidInPeriod-${h.id}`]}),render:g=>t(w.NegativeNumber,{children:g})}]},{key:"paidBeforeInPeriod",dataIndex:"paidBeforeInPeriod",width:150,align:"center",title:S("div",{children:[c.label.advance_payment1,t("br",{}),"(7)"]}),children:[{key:`paidBeforeInPeriod-${h.id}`,dataIndex:`paidBeforeInPeriod-${h.id}`,width:150,align:"right",title:r?t(Pe,{zIndex:1,isLoading:!0}):t(w.NegativeNumber,{children:l[`paidBeforeInPeriod-${h.id}`]}),render:g=>t(w.NegativeNumber,{children:g})}]},{key:"closingDebt",dataIndex:"closingDebt",width:150,align:"center",title:S("div",{children:[c.remaining_receivables,t("br",{}),"(8 = 1 + 3 + 4 - 5 - 6)"]}),children:[{key:`closingDebt-${h.id}`,dataIndex:`closingDebt-${h.id}`,width:150,align:"right",title:r?t(Pe,{zIndex:1,isLoading:!0}):t(w.NegativeNumber,{children:l[`closingDebt-${h.id}`]}),render:g=>t(w.NegativeNumber,{children:g})}]},{key:"closingPaidBefore",dataIndex:"closingPaidBefore",width:150,align:"center",title:S("div",{children:[c.closing_paid_before,t("br",{}),"(9 = 2 - 5 + 7)"]}),children:[{key:`closingPaidBefore-${h.id}`,dataIndex:`closingPaidBefore-${h.id}`,width:150,align:"right",title:r?t(Pe,{zIndex:1,isLoading:!0}):t(w.NegativeNumber,{children:l[`closingPaidBefore-${h.id}`]}),render:g=>t(w.NegativeNumber,{children:g})}]}]})}),p},[n,l,r]),a=f.useMemo(()=>{let p=0;return d.forEach(h=>{h.width&&(p+=h.width)}),{scrollToFirstRowOnChange:!0,x:p}},[d]);return t(Y.Table,{columns:d,dataSource:e,loading:s,pagination:i,sticky:o,scroll:a})},St=20,$i=()=>{const{idBuilding:e}=be(),{hideFormExport:s,tableData:i,filter:o}=f.useContext(Be),[n,l]=f.useState({isFetching:!1}),[r,d]=f.useState(0),[a,p]=f.useState({}),[h,g]=f.useState([]),[T,P]=f.useState([]),[u,m]=f.useState(!1);return f.useEffect(()=>{(async()=>{l({isFetching:!0}),d(0);const v=[];let y=1;const O=i.totalRecord+Math.ceil(i.totalRecord/St),N=Math.floor(O/St)+1;let B=0;const I=await No(o,e);for(I&&Object.keys(I).length&&p(I);y<=N;){const[E,M]=await So({filter:o,idBuilding:e,pagination:{current:y,limit:St}});if(T!=null&&T.length||P(M),E.length>0){E.forEach(_=>{v.push({..._})}),y+=1;const R=St/O*100;B+=R,d(Math.round(B))}else break}g(v),m(!0)})()},[]),f.useEffect(()=>{u&&setTimeout(()=>{const v=document.getElementById("tableExcel"),y=zt.table_to_book(v);Wt(y,"thong-tin-cong-no-phat-sinh-theo-thang-thong-bao-phi.xlsx"),l({isFetching:!1}),Yt.success({message:c.success,description:c.export_data_success}),s()},3e3)},[u]),[n.isFetching,r,T,h,a]},ki=()=>{const[e,s,i,o,n]=$i(),l=f.useMemo(()=>S("table",{id:"tableExcel",hidden:!0,children:[S("thead",{children:[S("tr",{children:[t("td",{rowSpan:3,style:{textAlign:"center"},children:"#"}),t("td",{rowSpan:3,children:c.unit}),i.map((r,d)=>t("td",{colSpan:9,children:r.name},d))]}),t("tr",{children:i.map((r,d)=>S(wt,{children:[t("td",{children:c.opening_debt}),t("td",{children:c.opening_paid_before}),t("td",{children:c.receivables}),t("td",{children:c.adjust}),t("td",{children:c.deduct_paid_before}),t("td",{children:c.paid}),t("td",{children:c.label.advance_payment1}),t("td",{children:c.remaining_receivables}),t("td",{children:c.closing_paid_before})]}))}),t("tr",{children:i.map((r,d)=>S(wt,{children:[t("td",{t:"s",children:"(1)"}),t("td",{t:"s",children:"(2)"}),t("td",{t:"s",children:"(3)"}),t("td",{t:"s",children:"(4)"}),t("td",{t:"s",children:"(5)"}),t("td",{t:"s",children:"(6)"}),t("td",{t:"s",children:"(7)"}),t("td",{t:"s",children:"(8 = 1 + 3 + 4 - 5 - 6)"}),t("td",{t:"s",children:"(9 = 2 - 5 + 7)"})]}))})]}),S("tbody",{children:[n&&Object.keys(n).length?S("tr",{children:[t("td",{colSpan:2,children:c.total}),i.map((r,d)=>S(wt,{children:[t("td",{children:(n==null?void 0:n[`openingDebt-${r.id}`])??0}),t("td",{children:(n==null?void 0:n[`openingPaidBefore-${r.id}`])??0}),t("td",{children:(n==null?void 0:n[`receivable-${r.id}`])??0}),t("td",{children:(n==null?void 0:n[`adjust-${r.id}`])??0}),t("td",{children:(n==null?void 0:n[`deductPaidBefore-${r.id}`])??0}),t("td",{children:(n==null?void 0:n[`paidInPeriod-${r.id}`])??0}),t("td",{children:(n==null?void 0:n[`paidBeforeInPeriod-${r.id}`])??0}),t("td",{children:(n==null?void 0:n[`closingDebt-${r.id}`])??0}),t("td",{children:(n==null?void 0:n[`closingPaidBefore-${r.id}`])??0})]}))]},"total"):null,o.map((r,d)=>S("tr",{children:[t("td",{children:d+1}),t("td",{t:"s",children:r.unitName}),i.map((a,p)=>S(wt,{children:[t("td",{children:(r==null?void 0:r[`openingDebt-${a.id}`])??0}),t("td",{children:(r==null?void 0:r[`openingPaidBefore-${a.id}`])??0}),t("td",{children:(r==null?void 0:r[`receivable-${a.id}`])??0}),t("td",{children:(r==null?void 0:r[`adjust-${a.id}`])??0}),t("td",{children:(r==null?void 0:r[`deductPaidBefore-${a.id}`])??0}),t("td",{children:(r==null?void 0:r[`paidInPeriod-${a.id}`])??0}),t("td",{children:(r==null?void 0:r[`paidBeforeInPeriod-${a.id}`])??0}),t("td",{children:(r==null?void 0:r[`closingDebt-${a.id}`])??0}),t("td",{children:(r==null?void 0:r[`closingPaidBefore-${a.id}`])??0})]}))]},r.key))]})]}),[o,i,n,e]);return S(Tt,{open:!0,okText:c.export,cancelText:c.cancel,okButtonProps:{loading:e,disabled:e},footer:null,closable:!1,children:[t(Ct,{strokeColor:{from:"#108ee9",to:"#87d068"},percent:s,status:"active"}),l]})},Fi=()=>{const{getServices:e,idBuilding:s,formExport:i,setGetUnitStatus:o,setUnits:n}=f.useContext(Be),{setVisibleFilterBox:l}=f.useContext(de),{changeDataTable:r,changeTotalRow:d}=no();return f.useEffect(()=>(l(!1),(async()=>{o({isFetching:!0});const[a]=await Promise.all([Bo({idBuilding:s,limit:L,page:A,filter:{name:void 0}}),e({idBuilding:s}),r({filter:{...ft},pagination:{current:A,limit:L}}),d({...ft})]);n(a==null?void 0:a.data),o({isFetching:!1})})(),()=>{l(!1)}),[]),{isShowFormExport:i.isShow}},Ai=()=>{const{isShowFormExport:e}=Fi();return S(Y.Wrapper,{children:[t(Yi,{}),S(Y.Container,{children:[t(Y.Header,{children:t(Ei,{})}),t(Y.Content,{children:t(Mi,{})})]}),e&&t(ki,{})]})},Li=()=>t(oo,{children:t(Ai,{})}),Ft={unitName:"",serviceIds:[],monthSelected:F()},Ui="EXPORT_TYPE_DEFAULT",Io="EXPORT_TYPE_REVENUE",Di=[{key:Ui,label:c.default},{key:Io,label:c.revenue_service}],Ie=f.createContext({idBuilding:0,debtGetsStatus:{isFetching:!1},setDebtGetsStatus:()=>{},filter:{...Ft},setFilter:()=>{},tableData:{records:[],totalRecord:0,services:[],totalRow:{}},setTableData:()=>{},tablePagination:{current:A,limit:L},setTablePagination:()=>{},serviceInUses:[],getServiceInUses:()=>{},formExport:void 0,showFormExport:()=>{},hideFormExport:()=>{}}),io=({children:e})=>{const{idBuilding:s}=be(),[i,o]=f.useState({isFetching:!1}),[n,l]=f.useState({...Ft}),[r,d]=f.useState({records:[],totalRecord:0,services:[],totalRow:{}}),[a,p]=f.useState({current:A,limit:L}),[h,g,T]=bt(),{serviceInUses:P,getServiceInUses:u}=Fe(),m={idBuilding:s,debtGetsStatus:i,setDebtGetsStatus:o,filter:n,setFilter:l,tableData:r,setTableData:d,tablePagination:a,setTablePagination:p,serviceInUses:P,getServiceInUses:u,formExport:h,showFormExport:g,hideFormExport:T};return t(Ie.Provider,{value:m,children:e})};io.propTypes={children:ke.node};io.defaultProps={children:t("div",{})};const Vi=()=>{const{tableData:e,showFormExport:s}=f.useContext(Ie),i=({key:o})=>{s({key:o})};return{totalRecord:e.totalRecord,handleMenuClick:i,exportTypes:Di}},Ki=()=>{const{totalRecord:e,handleMenuClick:s,exportTypes:i}=Vi(),o=i.map(l=>({key:l.key,label:l.label,onClick:s})),n=[t(Xt,{menu:{items:o},children:S(Le,{type:"primary",ghost:!0,icon:t(ye,{name:"icon-download-outlined"}),children:[c.export," ",t(ye,{name:"icon-arrow-down-outlined"})]})},"export")];return t(Y.ActionBox,{actions:n,total:e})},ji=(e,s)=>{var l,r,d,a,p,h,g,T;const{unit:i,totalDebt:o}=e,n={id:i.id,apartment:(i==null?void 0:i.name)??"",key:`key.${i.id}`,totalDebt:o,children:[],totalDebtUnder30days:Number(((l=e==null?void 0:e.under30days)==null?void 0:l.totalDebt)??0),totalDebt30to60days:Number(((r=e==null?void 0:e["30to60days"])==null?void 0:r.totalDebt)??0),totalDebt60to90days:Number(((d=e==null?void 0:e["60to90days"])==null?void 0:d.totalDebt)??0),totalDebtOver90days:Number(((a=e==null?void 0:e.over90days)==null?void 0:a.totalDebt)??0)};for(let P=0;P<s.length;P+=1){const u=s[P],m=u.id;n.children.push({id:i.id,apartment:(u==null?void 0:u.name)??"",key:`key.service.${u.id}`,serviceName:"",totalDebt:e[`total-${m}`],totalDebtUnder30days:Number(((p=e==null?void 0:e.under30days)==null?void 0:p[m])??0),totalDebt30to60days:Number(((h=e==null?void 0:e["30to60days"])==null?void 0:h[m])??0),totalDebt60to90days:Number(((g=e==null?void 0:e["60to90days"])==null?void 0:g[m])??0),totalDebtOver90days:Number(((T=e==null?void 0:e.over90days)==null?void 0:T[m])??0)})}return{...n}},Yo=async({filter:e,pagination:s,idBuilding:i})=>{var T,P;const{current:o,limit:n}=s,{unitName:l,serviceIds:r,monthSelected:d}=e,a=await Rn({filter:{unitName:l||void 0,serviceIds:r&&r.length?r:void 0,monthSelected:d.format("YYYYMM")},idBuilding:i,limit:n-1,page:o}),p=((T=a==null?void 0:a.data)==null?void 0:T.services)??[];return[(((P=a==null?void 0:a.data)==null?void 0:P.units)??[]).map(u=>ji(u,p)),p,a.totalRecord]},Gi=e=>{const{totalDebtUnder30days:s,totalDebt30to60days:i,totalDebt60to90days:o,totalDebtOver90days:n,totalDebt:l}=e;return{...{id:"total",apartment:c.total,key:"key.total",totalDebtUnder30days:Number(s||0),totalDebt30to60days:Number(i||0),totalDebt60to90days:Number(o||0),totalDebtOver90days:Number(n||0),totalDebt:l}}},Co=async(e,s)=>{try{const i={unitName:e.unitName||void 0,serviceIds:e!=null&&e.serviceIds&&(e!=null&&e.serviceIds.length)?e==null?void 0:e.serviceIds:void 0,monthSelected:e.monthSelected.format("YYYYMM")},o=await Nn(i,s),n=(o==null?void 0:o.data)??{};return Gi(n)}catch{return{}}},ao=()=>{const{idBuilding:e,setTablePagination:s,setTableData:i,setDebtGetsStatus:o,tableData:n}=f.useContext(Ie);return[async({filter:r,pagination:d,isChangeTotalRow:a})=>{const{current:p,limit:h}=d;o({isFetching:!0,code:void 0,codeLanguage:void 0}),s({current:p,limit:h});const g={...n};if(a){const m=await Co(r,e);m&&Object.keys(m).length&&(g.totalRow=m)}const[T,P,u]=await Yo({filter:r,idBuilding:e,pagination:d});i({...g,records:T,totalRecord:u,services:P}),o({isFetching:!1,code:void 0,codeLanguage:void 0})}]},Hi=()=>{const{setFilter:e,serviceInUses:s}=f.useContext(Ie),[i]=ao();return[async n=>{e(n),await i({filter:{...n},pagination:{current:A,limit:L},isChangeTotalRow:!0})},s]},Xi=()=>{const[e,s]=Hi(),i=f.useMemo(()=>[{label:c.unit,key:"unitName",component:t(Ae,{placeholder:c.unit}),visible:!0},{label:c.service,key:"serviceIds",component:t(V,{placeholder:c.service,fluid:"true",mode:"multiple",getPopupContainer:o=>o.parentNode,children:s.map(o=>t(V.Option,{value:o.id,children:o.name},o.id))}),visible:!0},{label:c.month,key:"monthSelected",component:t($e,{placeholder:c.month,fluid:"true",picker:"month",format:"MM/YYYY",allowClear:!1,getPopupContainer:o=>o.parentNode}),visible:!0,fixed:!0}],[s]);return t(Y.FilterBox,{defaultFilter:Ft,filters:i,onSearch:e})},zi=()=>{const{filter:e,debtGetsStatus:s,tableData:i,tablePagination:o}=f.useContext(Ie),{layoutScrollRef:n}=f.useContext(de),[l]=ao(),r=Me(),d=async(T,P)=>{o.current!==T?await l({filter:{...e},pagination:{current:T,limit:o.limit},isChangeTotalRow:!1}):o.limit!==P&&await l({filter:{...e},pagination:{current:o.current,limit:P},isChangeTotalRow:!1})},a=f.useMemo(()=>({defaultPageSize:L,defaultCurrent:A,pageSize:o.limit,current:o.current,total:i.totalRecord+Math.ceil(i.totalRecord/o.limit),showQuickJumper:!0,showSizeChanger:!0,onChange:d}),[o,i.totalRecord]),p={offsetScroll:r.offsetScrollX,getContainer:()=>n.current},h=f.useMemo(()=>i.totalRow&&Object.keys(i.totalRow).length?[i.totalRow,...i.records]:i.records,[i]),g=f.useMemo(()=>Gt(i.services,"id"),[i.services]);return{dataSource:h,loading:s.isFetching,pagination:a,sticky:p,serviceObj:g,filter:e,monthsOfOpeningDebt:i.monthsOfOpeningDebt,monthsOfReceivable:i.monthsOfReceivable,monthServicesOfReceivable:i.monthServicesOfReceivable,monthsOfPaidInPeriod:i.monthsOfPaidInPeriod,monthsOfPaidBefore:i.monthsOfPaidBefore,monthsOfDeductPaidBefore:i.monthsOfDeductPaidBefore,monthsOfClosingDebt:i.monthsOfClosingDebt}},Wi=()=>{const{dataSource:e,loading:s,pagination:i,sticky:o}=zi(),n=f.useMemo(()=>[{key:"apartment",dataIndex:"apartment",title:`${c.unit} / ${c.service}`,width:150,fixed:"left"},{key:"totalDebtUnder30days",dataIndex:"totalDebtUnder30days",title:`0-30 ${c.days}`,width:150,align:"right",render:d=>t(w.NegativeNumber,{children:d})},{key:"totalDebt30to60days",dataIndex:"totalDebt30to60days",title:`30-60 ${c.days}`,width:150,align:"right",render:d=>t(w.NegativeNumber,{children:d})},{key:"totalDebt60to90days",dataIndex:"totalDebt60to90days",title:`60-90 ${c.days}`,width:150,align:"right",render:d=>t(w.NegativeNumber,{children:d})},{key:"totalDebtOver90days",dataIndex:"totalDebtOver90days",title:`${c.over} 90 ${c.days}`,width:150,align:"right",render:d=>t(w.NegativeNumber,{children:d})},{key:"totalDebt",dataIndex:"totalDebt",title:c.total_debt,width:150,fixed:"right",align:"right",render:d=>t(w.NegativeNumber,{children:d})}],[]),l=f.useMemo(()=>{let r=0;return n.forEach(d=>{d.width&&(r+=d.width)}),{scrollToFirstRowOnChange:!0,x:r}},[n]);return t(Y.Table,{columns:n,dataSource:e,loading:s,pagination:i,sticky:o,scroll:{...l}})},Vt=20,Ji=()=>{const{idBuilding:e}=be(),{hideFormExport:s,tableData:i,filter:o,formExport:n}=f.useContext(Ie),[l,r]=f.useState({isFetching:!1}),[d,a]=f.useState(0),p=async()=>{var v,y;r({isFetching:!0}),a(0);const h=[];let g=1;const T=i.totalRecord,P=Math.floor(T/Vt)+1;let u=0;const m=await Co(o,e);if(m&&Object.keys(m).length){const O=["",c.total,Number((m==null?void 0:m.totalDebtUnder30days)||0),Number((m==null?void 0:m.totalDebt30to60days)||0),Number((m==null?void 0:m.totalDebt60to90days)||0),Number((m==null?void 0:m.totalDebtOver90days)||0),Number((m==null?void 0:m.totalDebt)||0)];h.push(O)}for(;g<=P;){const[O]=await Yo({idBuilding:e,filter:{...o},pagination:{limit:Vt,current:g}});if(O.length>0){const N=h.length-1;for(let I=0;I<O.length;I+=1){const E=O[I],M=[N+I+1];if(M.push((E==null?void 0:E.apartment)??""),M.push(Number((E==null?void 0:E.totalDebtUnder30days)||0)),M.push(Number((E==null?void 0:E.totalDebt30to60days)||0)),M.push(Number((E==null?void 0:E.totalDebt60to90days)||0)),M.push(Number((E==null?void 0:E.totalDebtOver90days)||0)),M.push(Number((E==null?void 0:E.totalDebt)||0)),h.push(M),n.data.key===Io&&((v=E==null?void 0:E.children)!=null&&v.length))for(let R=0;R<((y=E==null?void 0:E.children)==null?void 0:y.length);R+=1){const _=E==null?void 0:E.children[R],k=[""];k.push((_==null?void 0:_.apartment)??""),k.push(Number((_==null?void 0:_.totalDebtUnder30days)||0)),k.push(Number((_==null?void 0:_.totalDebt30to60days)||0)),k.push(Number((_==null?void 0:_.totalDebt60to90days)||0)),k.push(Number((_==null?void 0:_.totalDebtOver90days)||0)),k.push(Number((_==null?void 0:_.totalDebt)||0)),h.push(k)}}g+=1;const B=Vt/T*100;u+=B,a(Math.round(u))}else break}h.unshift(["#",`${c.unit} / ${c.service}`,`0-30 ${c.days}`,`30-60 ${c.days}`,`60-90 ${c.days}`,`${c.over} 90 ${c.days}`,c.total_debt]),Xo(h,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8","bao-cao-tuoi-no",".xlsx"),r({isFetching:!1}),Yt.success({message:c.success,description:c.export_data_success}),s()};return f.useEffect(()=>{p()},[]),[l.isFetching,d]},Qi=()=>{const[e,s]=Ji();return t(Tt,{open:!0,okText:c.export,cancelText:c.cancel,okButtonProps:{loading:e,disabled:e},footer:null,closable:!1,children:t(Ct,{strokeColor:{from:"#108ee9",to:"#87d068"},percent:s,status:"active"})})},qi=()=>{const{getServiceInUses:e,idBuilding:s,formExport:i}=f.useContext(Ie),{setVisibleFilterBox:o}=f.useContext(de),[n]=ao();return f.useEffect(()=>(o(!1),(async()=>await Promise.all([e({idBuilding:s}),n({filter:{...Ft},pagination:{current:A,limit:L},isChangeTotalRow:!0})]))(),()=>{o(!1)}),[]),{isShowFormExport:i.isShow}},Zi=()=>{const{isShowFormExport:e}=qi();return S(Y.Wrapper,{children:[t(Xi,{}),S(Y.Container,{children:[t(Y.Header,{children:t(Ki,{})}),t(Y.Content,{children:t(Wi,{})})]}),e&&t(Qi,{})]})},ea=()=>t(io,{children:t(Zi,{})}),_e="VIEW_TYPE_OVERALL",we="VIEW_TYPE_SERVICE",ta="DEBT_MONTH",Mo="INVOICE_MONTH",$o="DEFAULT",ko="REVENUE",Fo="DEBT",Ao="REMAINING_DEBT",At={unitName:void 0,serviceId:"",time:[F(),F()],viewType:_e,createdForType:Mo,customerCode:""},oa=[{id:ta,name:c.created_for_type_debt_month},{id:Mo,name:c.created_for_type_invoice_month}],na=[{id:_e,name:c.view_type_overall},{id:we,name:c.view_type_service}],ia=[{key:$o,label:c.default},{key:ko,label:c.revenue_service},{key:Fo,label:c.debt},{key:Ao,label:c.remaining_debt}],De=f.createContext({idBuilding:0,debtGetsStatus:{isFetching:!1},setDebtGetsStatus:()=>{},serviceInUses:[],getServiceInUses:()=>{},filter:{...At},setFilter:()=>{},tableData:{records:[],totalRecord:0},setTableData:()=>{},tableDataTotalRow:{},setTableDataTotalRow:()=>{},tablePagination:{current:A,limit:L},setTablePagination:()=>{},accountsReceivableReportPermissionExport:!1}),ro=({children:e})=>{var y;const{idBuilding:s}=be(),[i,o]=f.useState({isFetching:!1}),[n,l]=f.useState({...At}),[r,d]=f.useState({records:[],totalRecord:0}),[a,p]=f.useState(),[h,g]=f.useState({current:A,limit:L+1}),{serviceInUses:T,getServiceInUses:P}=Fe(),{getPermissionByModuleCode:u}=vt(),m=((y=u(Pt))==null?void 0:y[yt])??!1,v={idBuilding:s,debtGetsStatus:i,setDebtGetsStatus:o,serviceInUses:T,getServiceInUses:P,filter:n,setFilter:l,tableData:r,setTableData:d,tableDataTotalRow:a,setTableDataTotalRow:p,tablePagination:h,setTablePagination:g,accountsReceivableReportPermissionExport:m};return t(De.Provider,{value:v,children:e})};ro.propTypes={children:ke.node};ro.defaultProps={children:t("div",{})};const aa=async(e,s)=>{const{unitName:i,serviceId:o,time:n,viewType:l,createdForType:r,customerCode:d}=e,a=o.split("-"),p={unitName:i||void 0,[(a==null?void 0:a[2])||"contractTemplateId"]:(a==null?void 0:a[3])??void 0,[(a==null?void 0:a[0])||"serviceId"]:(a==null?void 0:a[1])??void 0,label:d||void 0,from:n==null?void 0:n[0].format("MM/YYYY"),to:n==null?void 0:n[1].format("MM/YYYY"),createdForType:r||void 0,isShowService:l===we};try{return await Fn(p,s)}catch(h){return h}},ra=async(e,s)=>{const{unitName:i,serviceId:o,time:n,viewType:l,createdForType:r,customerCode:d}=e,a=o.split("-"),p={unitName:i||void 0,[(a==null?void 0:a[2])||"contractTemplateId"]:(a==null?void 0:a[3])??void 0,[(a==null?void 0:a[0])||"serviceId"]:(a==null?void 0:a[1])??void 0,label:d||void 0,from:n==null?void 0:n[0].format("MM/YYYY"),to:n==null?void 0:n[1].format("MM/YYYY"),createdForType:r||void 0,isShowService:l===we};try{return await $n(p,s)}catch(h){return h}},sa=async(e,s)=>{const{unitName:i,serviceId:o,time:n,viewType:l,createdForType:r,customerCode:d}=e,a=o.split("-"),p={unitName:i||void 0,[(a==null?void 0:a[2])||"contractTemplateId"]:(a==null?void 0:a[3])??void 0,[(a==null?void 0:a[0])||"serviceId"]:(a==null?void 0:a[1])??void 0,label:d||void 0,from:n==null?void 0:n[0].format("MM/YYYY"),to:n==null?void 0:n[1].format("MM/YYYY"),createdForType:r||void 0,isShowService:l===we};try{return await An(p,s)}catch(h){return h}},da=async(e,s)=>{const{unitName:i,serviceId:o,time:n,viewType:l,createdForType:r,customerCode:d}=e,a=o.split("-"),p={unitName:i||void 0,[(a==null?void 0:a[2])||"contractTemplateId"]:(a==null?void 0:a[3])??void 0,[(a==null?void 0:a[0])||"serviceId"]:(a==null?void 0:a[1])??void 0,label:d||void 0,from:n==null?void 0:n[0].format("MM/YYYY"),to:n==null?void 0:n[1].format("MM/YYYY"),createdForType:r||void 0,isShowService:l===we};try{return await kn(p,s)}catch(h){return h}},ca=()=>{const{tableData:e,filter:s,idBuilding:i,accountsReceivableReportPermissionExport:o}=f.useContext(De),[n,l]=f.useState({code:void 0,codeLanguage:void 0,isFetching:!1});Ht(n.code,n.codeLanguage,{message:c.success,description:c.export_data_success});const r=async({key:a})=>{l({code:void 0,codeLanguage:void 0,isFetching:!0});let p,h="";a===$o?(h="thong-tin-cong-no-cap-nhat-den-thoi-diem-xem.xlsx",p=await ra(s,i)):a===ko?(h="thong-tin-doanh-thu-dich-vu.xlsx",p=await da(s,i)):a===Fo?(h="thong-tin-cong-no.xlsx",p=await aa(s,i)):a===Ao&&(h="thong-tin-ton-no.xlsx",p=await sa(s,i)),p.data&&vo(p.data,document,h),l({code:p.code,codeLanguage:p.codeLanguage,isFetching:!1})},d=ia;return[r,n.isFetching,e.totalRecord,d,o]},la=()=>{const[e,s,i,o,n]=ca(),l=fo(),r=t(Ce,{onClick:({key:a})=>{l({action:To,label:bo}),e({key:a})},:!0,children:o.map(({key:a,label:p})=>t(Ce.Item,{children:p},a))}),d=[n?t(Xt,{dropdownRender:()=>r,children:S(Le,{loading:s,type:"primary",ghost:!0,icon:t(ye,{name:"icon-download-outlined"}),children:[c.export," ",t(ye,{name:"icon-arrow-down-outlined"})]})},"export"):null].filter(Boolean);return t(Y.ActionBox,{actions:d,total:i})},Lo=e=>{let s=[];return e.time&&e.time.length>0&&e.time[0]&&e.time[1]&&(s=Po({from:F(e.time[0]),to:F(e.time[1])})),s.unshift("TOTAL"),s},Uo=(e,s)=>e.filter(i=>!s.serviceId||s.serviceId&&i.id===s.serviceId),ha=({units:e,services:s,months:i,viewType:o})=>{var l,r,d,a,p,h,g,T,P,u,m,v,y,O,N,B,I,E,M,R,_,k,C,$,K,H,ee,ne,ie,ce,le;const n=[];for(let q=0;q<e.length;q+=1){const x=e[q];let he=((l=x==null?void 0:x.TOTAL)==null?void 0:l.TOTAL_MONEY.mustPay)??0,pe=((r=x==null?void 0:x.TOTAL)==null?void 0:r.TOTAL_MONEY.adjust)??0,ue=((d=x==null?void 0:x.TOTAL)==null?void 0:d.TOTAL_MONEY.paid)??0,te=((a=x==null?void 0:x.TOTAL)==null?void 0:a.TOTAL_MONEY.debt)??0;o===_e&&(he=((p=x==null?void 0:x.TOTAL)==null?void 0:p.mustPay)??0,pe=((h=x==null?void 0:x.TOTAL)==null?void 0:h.adjust)??0,ue=((g=x==null?void 0:x.TOTAL)==null?void 0:g.paid)??0,te=((T=x==null?void 0:x.TOTAL)==null?void 0:T.debt)??0);const j={key:q,customerCode:((u=(P=x==null?void 0:x.unit)==null?void 0:P.label)==null?void 0:u.title)??"",apartment:((m=x==null?void 0:x.unit)==null?void 0:m.name)??"",service:"",mustPay:he,adjust:pe,paid:ue,debt:te,children:[]};for(let Q=0;Q<i.length;Q+=1){const G=i[Q];let me=((y=(v=x==null?void 0:x[G])==null?void 0:v.TOTAL_MONEY)==null?void 0:y.mustPay)??0,ge=((N=(O=x==null?void 0:x[G])==null?void 0:O.TOTAL_MONEY)==null?void 0:N.adjust)??0,fe=((I=(B=x==null?void 0:x[G])==null?void 0:B.TOTAL_MONEY)==null?void 0:I.paid)??0,ae=((M=(E=x==null?void 0:x[G])==null?void 0:E.TOTAL_MONEY)==null?void 0:M.debt)??0;o===_e&&(me=((R=x==null?void 0:x[G])==null?void 0:R.mustPay)??0,ge=((_=x==null?void 0:x[G])==null?void 0:_.adjust)??0,fe=((k=x==null?void 0:x[G])==null?void 0:k.paid)??0,ae=((C=x==null?void 0:x[G])==null?void 0:C.debt)??0);const Z={key:`${q}.${Q}`,customerCode:"",apartment:G==="TOTAL"?c.total:F(G,"YYYYMM").format("MM/YYYY"),service:"",mustPay:me,adjust:ge,paid:fe,debt:ae};if(o!==_e){Z.children=[];for(let re=0;re<s.length;re+=1){const Te=s[re],Re={key:`${q}.${Q}.${re}`,customerCode:"",apartment:"",service:Te.name,mustPay:(K=($=x==null?void 0:x[G])==null?void 0:$[Te.id])==null?void 0:K.mustPay,adjust:(ee=(H=x==null?void 0:x[G])==null?void 0:H[Te.id])==null?void 0:ee.adjust,paid:((ie=(ne=x==null?void 0:x[G])==null?void 0:ne[Te.id])==null?void 0:ie.paid)??0,debt:((le=(ce=x==null?void 0:x[G])==null?void 0:ce[Te.id])==null?void 0:le.debt)??0};Z.children.push(Re)}}j.children.push(Z)}n.push(j)}return n},pa=async({filter:e,pagination:s,idBuilding:i,services:o})=>{const{current:n,limit:l}=s,{unitName:r,serviceId:d,time:a,viewType:p,createdForType:h,customerCode:g}=e,T=d.split("-"),P=await Cn({filter:{[(T==null?void 0:T[2])||"contractTemplateId"]:(T==null?void 0:T[3])??void 0,[(T==null?void 0:T[0])||"serviceId"]:(T==null?void 0:T[1])??void 0,unitName:r||void 0,label:g||void 0,from:a==null?void 0:a[0].format("MM/YYYY"),to:a==null?void 0:a[1].format("MM/YYYY"),createdForType:h||void 0,isShowService:p===we},idBuilding:i,limit:l,page:n}),u=Lo(e),m=P.data,v=Uo(o,e);return[ha({units:m,services:v,months:u,viewType:e.viewType}),P.totalRecord]},ua=({totalDebt:e,services:s,months:i,viewType:o})=>{var p,h,g,T,P,u,m,v,y,O,N,B,I,E,M,R,_,k,C,$,K,H,ee,ne,ie,ce,le,q,x,he,pe,ue;let n={},l=((h=(p=e==null?void 0:e.TOTAL)==null?void 0:p.TOTAL_MONEY)==null?void 0:h.mustPay)??0,r=((T=(g=e==null?void 0:e.TOTAL)==null?void 0:g.TOTAL_MONEY)==null?void 0:T.adjust)??0,d=((u=(P=e==null?void 0:e.TOTAL)==null?void 0:P.TOTAL_MONEY)==null?void 0:u.paid)??0,a=((v=(m=e==null?void 0:e.TOTAL)==null?void 0:m.TOTAL_MONEY)==null?void 0:v.debt)??0;o===_e&&(l=((y=e==null?void 0:e.TOTAL)==null?void 0:y.mustPay)??0,r=((O=e==null?void 0:e.TOTAL)==null?void 0:O.adjust)??0,d=((N=e==null?void 0:e.TOTAL)==null?void 0:N.paid)??0,a=((B=e==null?void 0:e.TOTAL)==null?void 0:B.debt)??0),n={key:"total",customerCode:"",apartment:c.total,service:"",mustPay:l,adjust:r,paid:d,debt:a,children:[]};for(let te=0;te<i.length;te+=1){const j=i[te];let Q={},G=((E=(I=e==null?void 0:e[j])==null?void 0:I.TOTAL_MONEY)==null?void 0:E.mustPay)??0,me=((R=(M=e==null?void 0:e[j])==null?void 0:M.TOTAL_MONEY)==null?void 0:R.adjust)??0,ge=((k=(_=e==null?void 0:e[j])==null?void 0:_.TOTAL_MONEY)==null?void 0:k.paid)??0,fe=(($=(C=e==null?void 0:e[j])==null?void 0:C.TOTAL_MONEY)==null?void 0:$.debt)??0;if(o===_e&&(G=((K=e==null?void 0:e[j])==null?void 0:K.mustPay)??0,me=((H=e==null?void 0:e[j])==null?void 0:H.adjust)??0,ge=((ee=e==null?void 0:e[j])==null?void 0:ee.paid)??0,fe=((ne=e==null?void 0:e[j])==null?void 0:ne.debt)??0),Q={key:`total.${te}`,customerCode:"",apartment:j==="TOTAL"?c.total:F(j,"YYYYMM").format("MM/YYYY"),service:"",mustPay:G,adjust:me,paid:ge,debt:fe},o!==_e){Q.children=[];for(let ae=0;ae<s.length;ae+=1){const Z=s[ae];let re={};re={key:`total.${te}.${ae}`,customerCode:"",apartment:"",service:Z.name,mustPay:((ce=(ie=e==null?void 0:e[j])==null?void 0:ie[Z.id])==null?void 0:ce.mustPay)??0,adjust:((q=(le=e==null?void 0:e[j])==null?void 0:le[Z.id])==null?void 0:q.adjust)??0,paid:((he=(x=e==null?void 0:e[j])==null?void 0:x[Z.id])==null?void 0:he.paid)??0,debt:((ue=(pe=e==null?void 0:e[j])==null?void 0:pe[Z.id])==null?void 0:ue.debt)??0},Q.children.push(re)}}n.children.push(Q)}return n},ma=async({filter:e,idBuilding:s,services:i})=>{const{time:o,serviceId:n,customerCode:l,unitName:r,createdForType:d,viewType:a}=e,p=n.split("-");try{const h=await Mn({[(p==null?void 0:p[2])||"contractTemplateId"]:(p==null?void 0:p[3])??void 0,[(p==null?void 0:p[0])||"serviceId"]:(p==null?void 0:p[1])??void 0,unitName:r||void 0,label:l||void 0,from:o==null?void 0:o[0].format("MM/YYYY"),to:o==null?void 0:o[1].format("MM/YYYY"),createdForType:d||void 0,isShowService:a===we},s),g=Lo(e),T=Uo(i,e);return ua({totalDebt:h.data,services:T,months:g,viewType:a})}catch(h){return{code:h.code,codeLanguage:h.codeLanguage}}},so=()=>{const{idBuilding:e,setTablePagination:s,setTableData:i,setTableDataTotalRow:o,setDebtGetsStatus:n}=f.useContext(De);return[async({filter:r,pagination:d,isChangeTotalRow:a,services:p})=>{n({isFetching:!0}),s({current:d.current,limit:d.limit});const[h,g]=await pa({filter:r,idBuilding:e,pagination:{limit:d.limit-1,current:d.current},services:p});if(i({records:h,totalRecord:g}),a){const T=await ma({filter:r,idBuilding:e,services:p});o(T)}n({isFetching:!1})}]},ga=async e=>{try{const{code:s,codeLanguage:i,data:o}=await jo({idBuilding:e});return{code:s,codeLanguage:i,data:o}}catch({code:s,codeLanguage:i}){return{code:s,codeLanguage:i,data:[]}}},fa=()=>{const{idBuilding:e}=be(),{setFilter:s,serviceInUses:i,setDebtGetsStatus:o}=f.useContext(De),{labelsCustomerCodeData:n}=uo(),[l]=so(),[r,d]=f.useState({isFetching:!0,records:[]});f.useEffect(()=>{(async()=>{d({isFetching:!0,records:[]});const{data:h}=await ga(e);d({isFetching:!1,records:h})})()},[]);const a=async h=>{s(h),o({isFetching:!0}),await l({filter:{...h},isChangeTotalRow:!0,pagination:{current:A,limit:L},services:i}),o({isFetching:!1})},p=f.useMemo(()=>{const h=[];for(let g=0;g<i.length;g+=1){const T=i[g],P=r.records.filter(u=>u.serviceId===T.id).map(u=>({...u,id:`serviceId-${T.id}-contractTemplateId-${u.id}`}));h.push({...T,id:`serviceId-${T.id}`}),h.push(...P)}return h},[i,r]);return[r.isFetching,a,p,n]},Ta=()=>{const[e,s,i,o]=fa(),n=f.useMemo(()=>[{label:c.unit,key:"unitName",component:t(Ae,{placeholder:c.unit}),visible:!0},{label:c.service,key:"serviceId",component:S(V,{loading:e,placeholder:c.service,fluid:"true",children:[t(V.Option,{value:"",children:c.all_service},"service_0"),i.map(l=>t(V.Option,{value:l.id,children:l.name},l.id))]}),visible:!0},{label:c.month_type,key:"createdForType",component:t(V,{fluid:!0,placeholder:c.month_type,children:oa.map(l=>t(V.Option,{value:l.id,children:l.name},l.id))}),visible:!0,fixed:!0},{label:c.month,key:"time",component:t($e.RangePicker,{placeholder:[c.from,c.to],fluid:!0,picker:"month",format:"MM/YYYY",allowClear:!1}),visible:!0,fixed:!0},{label:c.customer_code,key:"customerCode",component:S(V,{fluid:!0,placeholder:c.customer_code,children:[t(V.Option,{value:"",children:c.all_customer_code},"label_0"),o.map(l=>t(V.Option,{value:l.id,children:l.title},l.id))]}),visible:!0},{label:c.view_type,key:"viewType",component:t(V,{fluid:"true",placeholder:c.view_type,children:na.map(l=>t(V.Option,{value:l.id,children:l.name},l.id))}),visible:!0,fixed:!0}],[o,i,e]);return t(Y.FilterBox,{defaultFilter:At,filters:n,onSearch:s})},ba=()=>{const{filter:e,debtGetsStatus:s,setDebtGetsStatus:i,tableData:o,tablePagination:n,tableDataTotalRow:l,serviceInUses:r}=f.useContext(De),{layoutScrollRef:d}=f.useContext(de),{currentBuilding:a}=jt(),[p]=so(),h=Me(),g=async(y,O)=>{n.current!==y?(i({isFetching:!0}),await p({filter:{...e},isChangeTotalRow:!1,pagination:{current:y,limit:n.limit},services:r}),i({isFetching:!1})):n.limit!==O&&(i({isFetching:!0}),await p({filter:{...e},isChangeTotalRow:!1,pagination:{current:n.current,limit:O},services:r}),i({isFetching:!1}))},T=f.useMemo(()=>({defaultPageSize:L,defaultCurrent:A,pageSize:n.limit,current:n.current,total:o.totalRecord+Math.ceil(o.totalRecord/n.limit),showQuickJumper:!0,showSizeChanger:!0,onChange:g}),[n,o.totalRecord]),P=o.records.length?[l,...o.records]:[],u=!!a.lockDataAt,m={offsetScroll:h.offsetScrollX,getContainer:()=>d.current},v={scrollToFirstRowOnChange:!0};return[u,e.viewType,P,s.isFetching,T,m,v]},va=()=>{const[e,s,i,o,n,l,r]=ba(),d=f.useMemo(()=>{const a=[{title:"",key:"collapse",dataIndex:"collapse",width:60},{title:c.customer_code,key:"customerCode",dataIndex:"customerCode",width:150},{title:c.unit,key:"apartment",dataIndex:"apartment",width:150}];return s===we&&a.push({title:c.service,key:"service",dataIndex:"service",width:150}),a.push({title:c.receivables,key:"mustPay",width:150,children:[{title:"1",key:"mustPay",dataIndex:"mustPay",align:"right",width:150,render:p=>t(w.NegativeNumber,{children:p})}]}),e&&a.push({title:c.adjust,key:"adjust",width:150,children:[{title:"2",key:"adjust",dataIndex:"adjust",align:"right",width:150,render:p=>t(w.NegativeNumber,{children:p})}]}),a.push({title:c.paid,key:"paid",width:150,children:[{title:e?"3":"2",key:"paid",dataIndex:"paid",align:"right",width:150,render:p=>t(w.NegativeNumber,{children:p})}]},{title:c.remaining_receivables,key:"debt",width:150,children:[{title:e?"4=1+2-3":"3=1-2",key:"debt",dataIndex:"debt",align:"right",width:150,render:p=>t(w.NegativeNumber,{children:p})}]}),a},[e,s]);return t(Y.Table,{columns:d,dataSource:i,loading:o,pagination:n,sticky:l,scroll:{...r,x:d.reduce((a,p)=>a+p.width,0)}})},Pa=()=>{const{getServiceInUses:e,idBuilding:s,setDebtGetsStatus:i}=f.useContext(De),{setVisibleFilterBox:o}=f.useContext(de),[n]=so();return f.useEffect(()=>{o(!1),(async()=>{i({isFetching:!0});const l=await e({idBuilding:s});return await n({filter:{...At},isChangeTotalRow:!0,pagination:{current:A,limit:L},services:l.data}),i({isFetching:!1}),()=>{o(!1)}})()},[]),[]},ya=()=>(Pa(),S(Y.Wrapper,{children:[t(Ta,{}),S(Y.Container,{children:[t(Y.Header,{children:t(la,{})}),t(Y.Content,{children:t(va,{})})]})]})),xa=()=>t(ro,{children:t(ya,{})}),mt="MENU_KEY_DEBT_UPDATE_UNTIL_CURRENT_TIME",Nt="MENU_KEY_DEBT_BY_MONTH",gt="MENU_KEY_DEBT_BY_MONTH_V2",Bt="MENU_KEY_DEBT_BY_MONTH_V3",It="MENU_KEY_DEBT_BY_MONTH_V4",_a="MENU_KEY_ACCOUNTS_RECEIVABLE_AGING_REPORT";var wa={name:"qvrrxd",styles:"flex:1;height:100%"},Ra={name:"1wmy9hl",styles:"display:flex;flex-direction:column;flex:1"};const ds=()=>{const{currentBuilding:e}=jt(),[s,i]=f.useState(!ut.includes(Number(e==null?void 0:e.id))&&ve||!ve?mt:gt),{setTitlePage:o,setVisibleFilterBox:n,setVisibleSearchBox:l}=f.useContext(de);f.useEffect(()=>(o(c.debt),l(!0),()=>{o(""),n(!1)}),[]);function r({key:d}){i(d)}return S(Ho,{css:wa,children:[t(po,{span:"3",children:S(Ce,{mode:"inline",css:d=>({height:"100%",padding:d.padding.md}),selectedKeys:[s],children:[!ut.includes(Number(e.id))&&ve||!ve?t(pt,{onClick:()=>r({key:mt}),className:s===mt?"selected":"",children:t("span",{children:c.label.update_to_the_time_of_viewing})},mt):null,!ut.includes(Number(e.id))&&ve||!ve?t(pt,{onClick:()=>r({key:Nt}),className:s===Nt?"selected":"",children:t("span",{children:c.label.arise_by_month})},Nt):null,ut.includes(Number(e.id))&&ve&&ho||!ve?t(pt,{onClick:()=>r({key:gt}),className:s===gt?"selected":"",children:t("span",{children:c.debt_report_via_fee_notice_month})},gt):null,ut.includes(Number(e.id))&&ve&&ho||!ve?t(pt,{onClick:()=>r({key:Bt}),className:s===Bt?"selected":"",children:t("span",{children:c.debt_report_via_debt_month})},Bt):null,t(pt,{onClick:()=>r({key:It}),className:s===It?"selected":"",children:t("span",{children:c.label.debt_report_via_fee_notice_month})},It)]})}),S(po,{css:Ra,span:"21",children:[s===mt&&t(xa,{}),s===Nt&&t(Zn,{}),s===gt&&t(pi,{}),s===Bt&&t(Ri,{}),s===It&&t(Li,{}),s===_a&&t(ea,{})]})]})};export{ds as default};
