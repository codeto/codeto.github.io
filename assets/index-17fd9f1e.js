import{j as e,a as y,F as I}from"./@emotion-63839449.js";import{r as p}from"./react-4fd50329.js";import{B as L}from"./index-881eef42.js";import{a as z,K as H,b0 as ee,al as te,at as oe,l as t,co as J,a3 as Y,I as M,bG as ne,a5 as D,bH as ie,bI as ae,cp as re,Y as de,cq as N,cr as k,cs as le,ct as se,cu as ce,cv as K,E as Q,cw as R}from"./index-c2ded735.js";import"./lodash-88fe09e6.js";import"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import{I as B,S as _}from"./index-43183512.js";import{r as U,P as X,a as w,s as me,k as ue,u as Z,t as pe,v as he}from"./index-b17d22e5.js";import{P as b}from"./prop-types-1172f4d5.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{u as Fe}from"./react-router-a4308f7b.js";import{B as ge,f as W,c as fe}from"./antd-f9eae174.js";import{u as $,F as u}from"./index-687ba9e6.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./account-86ffff50.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";const P=p.createContext({funds:[],fundPermissionWrite:!1}),q=({children:r})=>{const[o,i]=p.useState(!1),[a,n]=p.useState({name:"",paymentMethod:""}),h=Fe(),{idBuilding:d}=h,{funds:l}=p.useContext(z),{getFunds:g}=U(),[f,V,x]=H(),[O,v,F]=H(),{getPermissionByModuleCode:s}=ee(),m=s(te),C=(m==null?void 0:m[oe])??!1,c=async()=>{i(!0),await g(d),i(!1)},S={loading:o,idBuilding:d,filterObj:a,funds:l,refreshFunds:c,handleFilterChange:T=>{c(),n(T)},formAddFund:f,showFormAddFund:V,hideFormAddFund:x,formUpdateFund:O,showFormUpdateFund:v,hideFormUpdateFund:F,fundPermissionWrite:C};return e(P.Provider,{value:S,children:r})};q.propTypes={children:b.node};q.defaultProps={children:e("div",{})};const ve=()=>{const{handleFilterChange:r}=p.useContext(P),o=n=>{r({...n})},i=p.useMemo(()=>[{label:t.fund,key:"name",component:e(B,{placeholder:t.fund}),visible:!0},{label:t.payment_method,key:"paymentMethod",component:y(_,{fluid:"true",placeholder:t.payment_method,children:[e(_.Option,{value:"",children:t.all_fund},"fund_0"),J.map(n=>e(_.Option,{value:n.value,children:n.label},n.value))]}),visible:!0}],[]),a={name:"",paymentMethod:""};return e(X.FilterBox,{filters:i,onSearch:o,defaultFilter:a})},_e=()=>{const{showFormAddFund:r,fundPermissionWrite:o}=p.useContext(P),i=Y(),a=()=>{r()};return e("div",{style:{textAlign:"right"},children:o?e(ge,{icon:e(M,{name:"icon-plus-circle-outlined"}),onClick:()=>{i({action:ne,label:D}),a()},type:"primary",children:t.add}):null})},ye=()=>{const{funds:r,filterObj:o,showFormUpdateFund:i,idBuilding:a,refreshFunds:n,fundPermissionWrite:h,loading:d}=p.useContext(P),l=Y(),[g,f]=p.useState({code:void 0,codeLanguage:void 0}),[V]=de();$(g.code,g.codeLanguage,{message:t.success,description:t.delete_data_success},()=>{n()});const x=s=>{i({fund:s})},O=s=>{w.confirm({cancelText:t.cancel,okText:t.confirm,title:t.confirm,content:`${t.do_you_want_to_delete_this_fund}?`,onOk:async()=>{f({code:void 0,codeLanguage:void 0});try{const m=await me({idBuilding:a,idFund:s.id});if(f({code:m.code}),m.code===200)return Promise.resolve()}catch(m){f({code:m.code,codeLanguage:m.codeLanguage})}return Promise.reject()},afterClose:()=>{f({code:void 0,codeLanguage:void 0})}})},v=[{title:t.fund,key:"name",dataIndex:"name",width:240},{title:t.payment_method,key:"paymentMethod",dataIndex:"paymentMethod",width:240},{title:t.description,key:"description",dataIndex:"description"},h?{title:t.actions,key:"actions",dataIndex:"actions",width:110,align:"center",render:(s,m)=>y(I,{children:[e(M,{title:t.update,style:{marginRight:V.marginSm,fontSize:V.fontSizeLargeIcon},name:"icon-edit-outlined",onClick:()=>{l({action:ie,label:D}),x(m.fund)}}),e(M,{title:t.delete,style:{fontSize:V.fontSizeLargeIcon},name:"icon-minus-circle-outlined",onClick:()=>{l({action:ae,label:D}),O(m.fund)}})]})}:null].filter(Boolean),F=p.useMemo(()=>{const{name:s,paymentMethod:m}=o;return r.filter(c=>s?c.name.toLowerCase().indexOf(s.toLowerCase())!==-1:!0).filter(c=>m===""||c.method===m).map(c=>{var A;return{key:c.id,name:c.name,paymentMethod:(A=re[c.method])==null?void 0:A.label,description:c.description,fund:c}})},[r,o]);return e(X.Table,{columns:v,loading:d,dataSource:F,pagination:!1})},E=({disabledItems:r,listVirtualAccountBank:o})=>y(I,{children:[e(u.Item,{rules:[{required:!0}],name:"method",label:`${t.payment_method} *`,children:e(_,{disabled:r.includes("method"),fluid:"true",placeholder:t.payment_method,children:J.map(i=>e(_.Option,{value:i.value,children:i.label},i.value))})}),e(u.Item,{noStyle:!0,shouldUpdate:(i,a)=>i.method!==a.method||i.name!==a.name,children:({getFieldValue:i})=>{const a=i("method");if(a===N||a===k){let n=ce;return a===k&&(n=K),e(u.Item,{label:`${t.fund} *`,name:"name",rules:[{required:!0}],children:e(_,{disabled:r.includes("name"),placeholder:t.fund,fluid:"true",children:n.map(h=>e(_.Option,{value:h.code,children:h.name},h.code))})})}return a===le&&o.length>0?y(I,{children:[e(u.Item,{rules:[{required:!0}],name:"name",label:`${t.fund} *`,children:e(B,{placeholder:t.fund})}),e(u.Item,{name:"virtualAccountBank",label:t.virtual_account,children:y(_,{fluid:"true",placeholder:t.virtual_account,getPopupContainer:n=>n.parentNode,children:[e(_.Option,{value:"",children:t.not_identification},"virtualAccountBank_0"),o.map(({value:n,key:h,label:d})=>e(_.Option,{value:n,children:d},h))]})})]}):e(u.Item,{rules:[{required:!0}],name:"name",label:`${t.fund} *`,children:e(B,{placeholder:t.fund})})}}),e(u.Item,{name:"description",label:t.description,children:e(B.TextArea,{placeholder:t.description})}),e(u.Item,{noStyle:!0,shouldUpdate:(i,a)=>i.method!==a.method,children:({getFieldValue:i})=>{const a=i("method");return a===N||a===k?y(I,{children:[e(u.Item,{name:"paymentMode",label:`${t.payment_online_mode} *`,rules:[{required:!0}],children:e(W.Group,{children:se.map(n=>e(W,{value:n.value,children:n.label},n.value))})}),e(u.Item,{valuePropName:"checked",name:"isPromotion",children:y(fe,{children:[" ",`${t.label.using_promotion}`," "]})})]}):null}}),e(u.Item,{noStyle:!0,shouldUpdate:(i,a)=>i.isPromotion!==a.isPromotion,children:({getFieldValue:i})=>i("isPromotion")?y(I,{children:[e(u.Item,{rules:[{required:!0}],name:"promotionNameVi",label:`${t.label.promotion_name_vi} *`,children:e(B,{placeholder:t.label.promotion_name_vi})}),e(u.Item,{rules:[{required:!0}],name:"promotionNameEn",label:`${t.label.promotion_name_en} *`,children:e(B,{placeholder:t.label.promotion_name_en})}),e(u.Item,{rules:[{required:!0}],name:"promotionValue",label:`${t.label.promotion_value} *`,children:e(ue,{placeholder:t.label.promotion_value,max:100,min:-100})})]}):null})]});E.propTypes={disabledItems:b.arrayOf(b.any),listVirtualAccountBank:b.arrayOf(b.any)};E.defaultProps={disabledItems:[],listVirtualAccountBank:[]};const Ve=r=>{var o,i;if(r!=null&&r.enableVirtualAccount){const{enableVirtualAccount:a={}}=r;return((i=(o=Object==null?void 0:Object.keys(a||{}))==null?void 0:o.map(n=>({key:n,value:n,label:a[n]||""})))==null?void 0:i.filter(({value:n})=>n))??[]}return[]},j=({hideModal:r})=>{const{idBuilding:o,refreshFunds:i}=p.useContext(P),{fundData:a,setFunds:n}=U(),{currentBuilding:h}=Z(),[d]=u.useForm(),[l,g]=p.useState({isFetching:!1,code:void 0,codeLanguage:void 0});$(l.code,l.codeLanguage,{message:t.success,description:t.add_data_success},()=>{r(),i()});const f=async()=>{if(d.setFieldsValue({...Q(d.getFieldsValue(),{})}),await d.validateFields()){g({isFetching:!0,code:void 0,codeLanguage:void 0});const F={name:d.getFieldValue("name"),code:null,description:d.getFieldValue("description"),method:d.getFieldValue("method"),paymentMode:d.getFieldValue("paymentMode"),virtualAccountBank:d.getFieldValue("virtualAccountBank")||null};if((F.method===N||F.method===k)&&(F.name=R[d.getFieldValue("name")].fundName,F.code=d.getFieldValue("name"),F.domestic=R[d.getFieldValue("name")].domestic,d.getFieldValue("isPromotion"))){const m={name:d.getFieldValue("promotionNameVi"),enName:d.getFieldValue("promotionNameEn"),value:d.getFieldValue("promotionValue")};F.promotion=m}try{const s=await pe({idBuilding:o,fund:F});n([...a,s.data]),g({isFetching:!1,code:s.code,codeLanguage:void 0})}catch(s){throw g({isFetching:!1,code:s.code,codeLanguage:s.codeLanguage}),s}}},V=(v,F)=>{v.method===k?d.setFieldsValue({name:K[0].code}):v.method&&d.setFieldsValue({name:""})},x=()=>{r()},O=Ve(h);return e(w,{title:t.add_fund,open:!0,onOk:f,onCancel:x,okText:t.confirm,cancelText:t.cancel,okButtonProps:{disabled:l.isFetching,loading:l.isFetching},children:e(u,{initialValues:{name:"",description:"",isPromotion:!1,virtualAccountBank:""},layout:"vertical",form:d,onValuesChange:V,name:"formAddFund",requiredMark:!1,children:e(E,{listVirtualAccountBank:O})})})};j.propTypes={hideModal:b.func};j.defaultProps={hideModal:()=>{}};const Ae=r=>{var o,i;if(r!=null&&r.enableVirtualAccount){const{enableVirtualAccount:a={}}=r;return((i=(o=Object==null?void 0:Object.keys(a||{}))==null?void 0:o.map(n=>({key:n,value:n,label:a[n]||""})))==null?void 0:i.filter(({value:n})=>n))??[]}return[]},G=({hideModal:r,fund:o})=>{var v,F,s;const{idBuilding:i,refreshFunds:a}=p.useContext(P),{fundData:n,setFunds:h}=U(),{currentBuilding:d}=Z(),[l]=u.useForm(),[g,f]=p.useState({isFetching:!1,code:void 0,codeLanguage:void 0});$(g.code,g.codeLanguage,{message:t.success,description:t.update_data_success},()=>{r(),a()});const V=async()=>{if(l.setFieldsValue({...Q(l.getFieldsValue(),{})}),await l.validateFields()){f({isFetching:!0,code:void 0,codeLanguage:void 0});const C={name:l.getFieldValue("name"),code:o.code,description:l.getFieldValue("description"),domestic:!!o.domestic,method:o.method,paymentMode:l.getFieldValue("paymentMode"),virtualAccountBank:l.getFieldValue("virtualAccountBank")||null};if(C.method===N)if(l.getFieldValue("isPromotion")){const A={name:l.getFieldValue("promotionNameVi"),enName:l.getFieldValue("promotionNameEn"),value:l.getFieldValue("promotionValue")};C.promotion=A}else C.promotion=null;try{const c=await he({idBuilding:i,fund:C,idFund:o.id}),A=[...n],S=A.findIndex(T=>T.id===o.id);A[S]={...C,id:o.id},h(A),f({isFetching:!1,code:c.code,codeLanguage:void 0})}catch(c){throw f({isFetching:!1,code:c.code,codeLanguage:c.codeLanguage}),c}}},x=()=>{r()},O=Ae(d);return e(w,{title:t.add_fund,open:!0,onOk:V,onCancel:x,okText:t.confirm,cancelText:t.cancel,okButtonProps:{disabled:g.isFetching,loading:g.isFetching},children:e(u,{initialValues:{name:o.name,description:o.description,domestic:o.domestic,method:o.method,code:o.code,paymentMode:o.paymentMode,isPromotion:!!o.promotion,promotionNameVi:((v=o==null?void 0:o.promotion)==null?void 0:v.name)??void 0,promotionNameEn:((F=o==null?void 0:o.promotion)==null?void 0:F.enName)??void 0,promotionValue:((s=o==null?void 0:o.promotion)==null?void 0:s.value)??void 0,virtualAccountBank:(o==null?void 0:o.virtualAccountBank)??""},layout:"vertical",form:l,name:"formUpdateFund",requiredMark:!1,children:e(E,{listVirtualAccountBank:O,disabledItems:["method",o.method===N?"name":null].filter(Boolean)})})})};G.propTypes={hideModal:b.func,fund:b.objectOf(b.any)};G.defaultProps={hideModal:()=>{},fund:{}};const be=()=>{const{setTitlePage:r,setVisibleFilterBox:o,setVisibleSearchBox:i}=p.useContext(z),{formAddFund:a,formUpdateFund:n,hideFormAddFund:h,hideFormUpdateFund:d}=p.useContext(P);return p.useEffect(()=>(r(t.configs_funds),i(!0),()=>{r(""),o(!1),i(!1)}),[]),y("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[e(ve,{}),y(L,{style:{flex:1},children:[e(L.Header,{children:e(_e,{})}),e(L.Content,{fluid:!0,children:e(ye,{})})]}),a.isShow&&e(j,{hideModal:h}),n.isShow&&e(G,{fund:n.data.fund,hideModal:d})]})},to=()=>e(q,{children:e(be,{})});export{to as default};
