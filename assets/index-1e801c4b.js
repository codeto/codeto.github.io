import{j as t,a as v,b as Z,F as H,u as W,c as ee}from"./@emotion-63839449.js";import{Q as te,P as q,l as ae,D as ne,N as F,a as P}from"./index-b17d22e5.js";import{b0 as Q,K as Y,a_ as oe,bv as se,l as p,I,Y as ie,aN as re,ag as ce,at as de,a as z,gn as le,S as ue}from"./index-c2ded735.js";import"./lodash-88fe09e6.js";import{h as x}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import{r as m}from"./react-4fd50329.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{P as X}from"./prop-types-1172f4d5.js";import{u as K,d as pe}from"./react-router-a4308f7b.js";import{g as he,e as me}from"./maintenanceSchedule-3bd8648f.js";import{R as J,X as ge,r as L,B as V,Y as Se,w as fe,L as xe,T as j,D as Me,b as D,n as we,P as be}from"./antd-f9eae174.js";import{L as ye}from"./react-router-dom-2a8f5f6d.js";import{B}from"./index-881eef42.js";import{h as G}from"./constant-e1099cfb.js";import{F as _,u as ke}from"./index-687ba9e6.js";import{S as E,I as ve}from"./index-43183512.js";import{g as Ce}from"./department-807891d3.js";import{g as Re}from"./staff-2880022d.js";import{u as _e,a as Oe}from"./xlsx-0fb7ed70.js";import{u as Te}from"./useQuery-d54d310a.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./account-86ffff50.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./classnames-4ba1ba1a.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";const O=m.createContext({idBuilding:0,modalMaintenanceSchedule:void 0,showModalMaintenanceSchedule:()=>{},hideModalMaintenanceSchedule:()=>{},modalExportMaintenanceSchedule:void 0,showModalExportMaintenanceSchedule:()=>{},hideModalExportMaintenanceSchedule:()=>{},maintenanceScheduleObj:{},setMaintenanceScheduleObj:()=>{},maintenanceScheduleExport:!1,getMaintenanceScheduleStatus:!1,setGetMaintenanceScheduleStatus:()=>{},monthSelected:x(),setMonthSelected:()=>{},daySelected:void 0,setDaySelected:()=>{}}),N=({children:e})=>{const{getPermissionByModuleCode:a}=Q(),s=K(),{idBuilding:c}=s,[o,d]=m.useState(x()),[l,g]=m.useState(),[S,i]=m.useState({}),[n,r]=m.useState(!1),[h,k,u]=Y(),[M,f,w]=Y(),C=a(oe),R=(C==null?void 0:C[se])??!1,b={idBuilding:c,modalMaintenanceSchedule:h,showModalMaintenanceSchedule:k,hideModalMaintenanceSchedule:u,modalExportMaintenanceSchedule:M,showModalExportMaintenanceSchedule:f,hideModalExportMaintenanceSchedule:w,maintenanceScheduleObj:S,setMaintenanceScheduleObj:i,maintenanceScheduleExport:R,getMaintenanceScheduleStatus:n,setGetMaintenanceScheduleStatus:r,monthSelected:o,setMonthSelected:d,daySelected:l,setDaySelected:g};return t(O.Provider,{value:b,children:e})};N.propTypes={children:X.node};N.defaultProps={children:t("div",{})};const De=N,Ee="NOT_STARTED",qe=e=>({id:e.id,code:e.code,status:e.progressStatus}),Le=e=>{var c,o;let a=0;const s=(c=e==null?void 0:e.requests)==null?void 0:c.map(d=>{const l=qe(d);return l.status===Ee&&(a+=1),l});return{id:e.id,key:e==null?void 0:e.id,name:e.name,groupSystem:e==null?void 0:e.groupSystem,note:e==null?void 0:e.note,requests:s,progressColor:(o=e==null?void 0:e.requests)!=null&&o.length?"error":"success",countUnfinishedTask:a}},Ye=e=>{var a;return{date:e==null?void 0:e.date,dateByCalendar:x(e==null?void 0:e.date,"DD/MM/YYYY").format("YYYY-MM-DD"),systems:(a=e==null?void 0:e.systems)==null?void 0:a.map(s=>Le(s))}},A=async(e,a,s=!1)=>{var l;const c={from:x(e).startOf("month").toISOString(),to:x(e).endOf("month").toISOString(),isExpand:s},o=await he(c,a),d={};return(l=o==null?void 0:o.data)==null||l.forEach(g=>{const{date:S,dateByCalendar:i,systems:n}=Ye(g);d[i]={date:S,dateByCalendar:i,systems:n}}),{maintenanceScheduleObj:d}},Ae=()=>{const{idBuilding:e,showModalMaintenanceSchedule:a,maintenanceScheduleObj:s,setMonthSelected:c,setDaySelected:o,setGetMaintenanceScheduleStatus:d,setMaintenanceScheduleObj:l,monthSelected:g,daySelected:S,showModalExportMaintenanceSchedule:i,maintenanceScheduleExport:n}=m.useContext(O);return{showModalMaintenanceSchedule:a,maintenanceScheduleObj:s,handleMonthChange:async u=>{c(u),d(!0),l({});const M=await A(u,e,!0);l(M.maintenanceScheduleObj||{}),d(!1),o(void 0)},onSelectDate:u=>{const M=s[u.format("YYYY-MM-DD")],f=M==null?void 0:M.systems;x(g).isSame(u,"months")&&(o(u),(f==null?void 0:f.length)>0&&a({...M}))},maintenanceScheduleExport:n,onClickBtnExportMaintenanceSchedule:()=>i(),daySelected:S}};var Fe={name:"y4lxk2",styles:".ant-badge-status-dot{width:8px;height:8px;}.ant-badge-status-text{font-size:13px;}"};const je=()=>{const{maintenanceScheduleObj:e,handleMonthChange:a,onSelectDate:s,maintenanceScheduleExport:c,onClickBtnExportMaintenanceSchedule:o,daySelected:d}=Ae(),[l]=ie(),g=`
  .ant-picker-calendar-header .ant-picker-calendar-month-select {
    min-width: 150px;
    margin-right: 15px;
  }

  .ant-picker-calendar-header {
    flex-direction: row-reverse !important;
    justify-content: end;
  }

  th{
    border-bottom: 1px solid lightgrey
  }

  .ant-radio-button-wrapper {
    display: none;
  }

  .ant-picker-calendar-full .ant-picker-panel .ant-picker-calendar-date-today{
    border: none;
  }

  .ant-picker-calendar-header {
    padding: 0px 10px 10px;
  }

  .ant-picker-calendar-header .ant-picker-calendar-month-select {
    min-width: 0px; 
    margin-right: 15px;
  }

  .ant-picker-date-panel {
    text-align: center;
  }

  .ant-picker-panel th{
    font-weight: 700;
    padding: 0 0px 5px 0 !important;
  } 

  .ant-picker-content td, .ant-picker-content th{
    border: 1px solid #dadce0;
  }

  .ant-picker-content th {
    padding: 5px 0px !important;
  }

  .ant-picker-panel .ant-picker-calendar-date{
    border-top: 0px !important;
    margin: 0px !important;
    height: 105px;

  }

 .ant-picker-panel .ant-picker-calendar-date-today .ant-picker-calendar-date-value {
    height: 24px; 
    width: 28px;
    line-height: 24px;
    color: white;
    background-color: ${l.primaryColor};
    border-radius: 50%;
    display: inline-block;
 
  }

  .ant-picker-panel .ant-picker-cell-selected .ant-picker-calendar-date-today .ant-picker-calendar-date-value{
    color: white;
  }

  .ant-picker-panel .ant-picker-cell-selected:hover .ant-picker-calendar-date-today .ant-picker-calendar-date-value{
    color: white;
  }

  .ant-picker-calendar-date-content {
    height: 65px;
    padding: 5px;
    ::-webkit-scrollbar {
      width: 2.5px; 
    }
  
    ::-webkit-scrollbar-thumb {
      opacity: 0.5;
    }
  }

  .ant-picker-panel .ant-picker-calendar-date:hover .ant-picker-calendar-date-content{
    overflow-y: auto;
  }

  .ant-picker-panel .ant-picker-calendar-date {
    overflow: hidden;
  }
`,S=i=>{var r;const n=e[i.format("YYYY-MM-DD")];return n?t("ul",{className:"maintenance-schedule",children:(r=n==null?void 0:n.systems)==null?void 0:r.map(h=>t("li",{className:"badge-maintenance-schedule",children:t(L,{status:h.progressColor,text:h.name,css:Fe})},h.id))}):null};return v(H,{children:[v(J,{css:i=>({margin:i.margin.xs,justifyContent:"space-between"}),children:[v(ge,{direction:"vertical",children:[t(L,{color:"#ff4d4f",text:p.tasks_were_assigned_to_maintenance_schedule}),t(L,{color:"#006b32",text:p.no_tasks_were_assigned_to_maintenance_schedule})]}),c?t(V,{type:"primary",icon:t(I,{name:"icon-download-outlined"}),onClick:o,ghost:!0,css:i=>({marginBottom:i.margin.sm}),children:p.export},"export"):null]}),t(Se,{value:d,onPanelChange:a,dateCellRender:S,css:Z(g,";",""),onSelect:s})]})},T=m.createContext({idBuilding:0,getsStatus:{isFetching:!1},setGetsStatus:()=>{},tableData:{records:[],totalRecord:0},setTableData:()=>{},visibleRequestListOverlay:{data:{},flag:!1},setVisibleRequestListOverlay:()=>{},modalAddRequest:{isShow:!1,data:{}},showModalAddRequest:()=>{},hideModalAddRequest:()=>{},taskPermissionRead:!1,taskPermissionWrite:!1}),U=({children:e})=>{const a=K(),{getPermissionByModuleCode:s}=Q(),{idBuilding:c}=a,[o,d]=m.useState({isFetching:!1}),[l,g]=m.useState({records:[],totalRecord:0}),[S,i]=m.useState({data:{},flag:!1}),[n,r,h]=Y(),[k,u,M]=Y(),f=s(re),w=(f==null?void 0:f[ce])??!1,C=(f==null?void 0:f[de])??!1,R={idBuilding:c,modalRequest:n,showModalRequest:r,hideModalRequest:h,getsStatus:o,setGetsStatus:d,tableData:l,setTableData:g,visibleRequestListOverlay:S,setVisibleRequestListOverlay:i,modalAddRequest:k,showModalAddRequest:u,hideModalAddRequest:M,taskPermissionRead:w,taskPermissionWrite:C};return t(T.Provider,{value:R,children:e})};U.propTypes={children:X.node};U.defaultProps={children:t("div",{})};const Be=()=>{var l;const{idBuilding:e,showModalAddRequest:a,setVisibleRequestListOverlay:s,taskPermissionWrite:c,visibleRequestListOverlay:o}=m.useContext(T);return{idBuilding:e,handleShowModalAddRequest:()=>{a(),s({...o,flag:!1})},listRequest:((l=o==null?void 0:o.data)==null?void 0:l.requests)??[],taskPermissionWrite:c}};var Pe={name:"1x7lxj3",styles:"width:300px;min-height:180px;max-height:300px;box-shadow:0 3px 6px -4px rgb(0 0 0 / 12%), 0 6px 16px 0 rgb(0 0 0 / 8%), 0 9px 28px 8px rgb(0 0 0 / 5%);border-radius:2px"},Ie={name:"82a6rk",styles:"flex:1"};const Ve=()=>{const{idBuilding:e,handleShowModalAddRequest:a,listRequest:s,taskPermissionWrite:c}=Be();return t(xe,{css:Pe,children:v(B,{css:Ie,children:[c?v(B.Header,{children:[t("h3",{children:p.task_list}),t(V,{onClick:a,block:!0,type:"primary",icon:t(I,{name:"plus"}),children:p.add})]}):null,t(B.Content,{scrollY:!0,children:t(te,{dataSource:s??[],renderItem:o=>v("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",marginTop:6},children:[t(ye,{target:"_blank",to:`/buildings/${e}/task/${o.id}`,children:o.code}),t(fe,{color:G[o.status].color,children:G[o.status].label})]})})})]})})},Ne=()=>{const{getsStatus:e,setVisibleRequestListOverlay:a,visibleRequestListOverlay:s,taskPermissionRead:c}=m.useContext(T),{modalMaintenanceSchedule:o}=m.useContext(O),{systems:d}=o==null?void 0:o.data,{layoutScrollRef:l}=m.useContext(z),g=W(),S=(n,r)=>{a({flag:n,data:r})},i={offsetScroll:g.offsetScrollX,getContainer:()=>l.current};return{handleVisibleRequestListOverlay:S,sticky:i,dataSource:d,loading:e.isFetching,modalMaintenanceSchedule:o,isShowListRequestDropDown:s==null?void 0:s.flag,taskPermissionRead:c}},Ue=()=>{const{handleVisibleRequestListOverlay:e,sticky:a,loading:s,dataSource:c,isShowListRequestDropDown:o,taskPermissionRead:d}=Ne(),l=ee(V,{target:"eobmxix0"})({name:"192s9p1",styles:"display:flex;flex-direction:row;justify-content:center;align-items:center"}),g=[{title:p.system,key:"systemName",dataIndex:"systemName",fixed:"left",width:150,render:(i,n)=>{const r=n==null?void 0:n.name;return(r==null?void 0:r.length)>20?t(j,{title:r,placement:"topLeft",children:t("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r})}):t("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r})}},{title:p.group_system,key:"groupSystemName",dataIndex:"groupSystemName",fixed:"left",width:150,render:(i,n)=>{var h;const r=(h=n==null?void 0:n.groupSystem)==null?void 0:h.name;return(r==null?void 0:r.length)>20?t(j,{title:r,placement:"topLeft",children:t("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r})}):t("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r})}},d?{title:p.action,key:"action",dataIndex:"action",width:100,align:"center",fixed:"right",render:(i,n)=>t(L,{count:n!=null&&n.countUnfinishedTask?t("div",{style:{fontSize:"10px",background:"red",borderRadius:"100%",color:"white",padding:"2px 4px",border:"1px solid #ffffff"},children:Number(n==null?void 0:n.countUnfinishedTask)<100?n==null?void 0:n.countUnfinishedTask:"99+"}):0,offset:[-2,6],size:"small",children:t(j,{title:p.task,children:t(Me,{trigger:["click"],onOpenChange:r=>e(r,n),overlay:o?t(Ve,{}):"",children:t(l,{shape:"circle",icon:t(I,{name:"icon-list-alt-outlined"})})})})})}:null].filter(Boolean),S={x:g.reduce((i,n)=>n+i.width,0),scrollToFirstRowOnChange:!0};return t(q.Table,{sticky:a,scroll:S,columns:g,dataSource:c,loading:s,pagination:!1})},$e=async(e,a)=>{const{expiryDate:s,department:c,receiver:o,content:d,systemId:l,residentId:g,startTime:S}=a,i={description:d,departmentId:c,receiverId:o,dueDate:s?x(s).toDate():void 0,systemId:l,residentId:g,startTime:S?x(S,ae).toDate():void 0};try{const n=await le(e,i);return{code:n.code,codeLanguage:n.codeLanguage}}catch(n){return{code:n.code,codeLanguage:n.codeLanguage}}},Ge=e=>({id:e.id,name:e.name}),He=async e=>{try{const a=await Ce(e,!0);return{code:a.code,codeLanguage:a.codeLanguage,data:a.data.map(s=>Ge(s))}}catch(a){return{code:a.code,codeLanguage:a.codeLanguage,data:[]}}},We=e=>{var a;return{id:e.id,name:e.fullName,departments:((a=e==null?void 0:e.departments)==null?void 0:a.map(s=>s.id))??[]}},Qe=async e=>{try{const a=await Re(e);return{code:a.code,codeLanguage:a.codeLanguage,data:a.data.map(s=>We(s))}}catch(a){return{code:a.code,codeLanguage:a.codeLanguage,data:[]}}},ze=()=>{const{idBuilding:e,hideModalAddRequest:a,visibleRequestListOverlay:s}=m.useContext(T),{setGetMaintenanceScheduleStatus:c,setMaintenanceScheduleObj:o,monthSelected:d,showModalMaintenanceSchedule:l,daySelected:g}=m.useContext(O),[S,i]=m.useState({isFetching:!1,records:[]}),[n,r]=m.useState({isFetching:!1,records:[]}),[h,k]=m.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[u]=_.useForm(),{id:M}=s==null?void 0:s.data;ke(h.code,h.codeLanguage,{message:p.success,description:p.add_data_success},()=>{a()}),m.useEffect(()=>{(async()=>{i({isFetching:!0,records:[]}),r({isFetching:!0,records:[]});const[b,y]=await Promise.all([He(e),Qe(e)]);i({isFetching:!1,records:Array.isArray(b==null?void 0:b.data)?b==null?void 0:b.data:[]}),r({isFetching:!1,records:Array.isArray(y==null?void 0:y.data)?y==null?void 0:y.data:[]})})()},[]);const f=async(b,y)=>{b.department&&u.setFieldsValue({receiver:void 0})},w=async()=>{if(await u.validateFields()){k({isFetching:!0,code:void 0,codeLanguage:void 0});const y=await $e(e,{...u.getFieldsValue(),startTime:g,systemId:M});if(ue.includes(y.code)){c(!0);const $=await A(d,e,!0);o($.maintenanceScheduleObj||{}),c(!1),l({...$.maintenanceScheduleObj[x(g).format("YYYY-MM-DD")]})}k({isFetching:!1,code:y.code,codeLanguage:y.codeLanguage})}};return{loading:h.isFetching,formAddRequest:u,initialValues:{expiryDate:void 0,department:void 0,receiver:void 0,content:void 0,requestByResident:!1,apartment:void 0,resident:void 0},department:S,receiver:n,onFinish:w,onValuesChange:f,hideModalAddRequest:a}},Xe=()=>{const e=W(),{hideModalAddRequest:a,formAddRequest:s,initialValues:c,onValuesChange:o,loading:d,department:l,receiver:g,onFinish:S}=ze();return t(P,{title:p.add_request,open:!0,onOk:S,onCancel:a,confirmLoading:d,okText:p.confirm,cancelText:p.cancel,okBtnProps:{loading:d,disabled:d},width:"50%",children:t(_,{layout:"vertical",name:"form_add_request",form:s,initialValues:c,onValuesChange:o,children:v(J,{gutter:[e.margin.xs,0],children:[t(D,{span:24,children:t(_.Item,{dependencies:["startTime"],name:"expiryDate",rules:[({getFieldValue:i})=>({validator(n,r){return r&&x(r).isBefore(x().subtract(1,"day"))?Promise.reject(new Error(`${p.min_due_date}: ${x().format("DD/MM/YYYY")}`)):r&&x(r).isBefore(x(),"minutes")?Promise.reject(new Error(`${p.min_due_date}: ${x().format("DD/MM/YYYY HH:mm")}`)):Promise.resolve()}})],label:p.expiry_date,children:t(ne,{disabledDate:i=>x(i).isBefore(x().subtract(1,"day")),format:F,placeholder:F,showTime:{format:F},fluid:!0,allowClear:!1})})}),t(D,{span:12,children:t(_.Item,{name:"department",rules:[{required:!0}],label:p.department,children:t(E,{loading:l.isFetching,placeholder:p.department,fluid:!0,children:l.records.map(({id:i,name:n})=>t(E.Option,{value:i,children:n},i))})})}),t(D,{span:12,children:t(_.Item,{noStyle:!0,shouldUpdate:(i,n)=>i.department!==n.department,children:({getFieldValue:i})=>{var n,r;return t(_.Item,{name:"receiver",rules:[{required:!0}],label:p.receiver,children:t(E,{loading:g.isFetching,placeholder:p.receiver,fluid:!0,children:((r=(n=g==null?void 0:g.records)==null?void 0:n.filter(h=>h==null?void 0:h.departments.includes(Number(i("department")))))==null?void 0:r.map(({id:h,name:k})=>t(E.Option,{value:h,children:k},h)))??[]})})}})}),t(D,{span:24,children:t(_.Item,{name:"content",rules:[{required:!0}],label:p.content,children:t(ve.TextArea,{rows:"3",placeholder:p.content})})})]})})})},Ke=()=>{const{hideModalMaintenanceSchedule:e,modalMaintenanceSchedule:a}=m.useContext(O),{modalAddRequest:s}=m.useContext(T),c=pe(),o=()=>{e();const l=c.location.pathname;c.push(l)},{date:d}=a==null?void 0:a.data;return{onClose:o,isShowModalAddRequest:s==null?void 0:s.isShow,date:d}},Je=()=>{const{onFinish:e,onClose:a,isFetching:s,isShowModalAddRequest:c,date:o}=Ke(),d=o?`- ${p.date_on} ${o}`:"";return v(P,{title:`${p.list_request_in_system} ${d}`,open:!0,onOk:e,onCancel:a,confirmLoading:s,okText:p.confirm,cancelText:p.cancel,disabled:!0,width:"70%",footer:null,children:[t(Ue,{}),c?t(Xe,{}):null]})},Ze=()=>t(U,{children:t(Je,{})}),et=()=>{const{hideModalExportMaintenanceSchedule:e,monthSelected:a,idBuilding:s}=m.useContext(O),[c,o]=m.useState({isFetching:!1}),[d,l]=m.useState(["#",p.system,p.group_system]),[g,S]=m.useState([]);return m.useEffect(()=>{(async()=>{await me({idBuilding:s,filter:{onlyLogging:!0}});const i=await A(a,s),n=Object.values(i.maintenanceScheduleObj)??[],r=(n==null?void 0:n.map(u=>u==null?void 0:u.date))||[],h={};n==null||n.forEach(u=>{var M;(M=u==null?void 0:u.systems)==null||M.forEach(f=>{var b,y;const w=(b=f==null?void 0:f.groupSystem)==null?void 0:b.name,C=f.name;h[w]||(h[w]={systemGroupName:w,systemObj:{}}),(y=h[w])!=null&&y.systemObj[C]||(h[w].systemObj[C]={systemName:C,dates:new Array(r.length).fill("")});const R=r.indexOf(u==null?void 0:u.date);R!==-1&&(h[w].systemObj[C].dates[R]="x")})});const k=Object.values(h).map(u=>({...u,systems:Object.values(u.systemObj)}));l([...d,...r]),S(k||[])})()},[]),m.useEffect(()=>{o({isFetching:!0}),setTimeout(()=>{const i=document.getElementById("tableExcel"),n=_e.table_to_book(i);Oe(n,a?p.maintenance_schedule_info_xlsx.replace("{date}",x(a).format("MM")):p.maintenance_schedule_xlsx.replace("{date}","")),o({isFetching:!1}),we.success({message:p.success,description:p.export_data_success}),e()},3e3)},[]),{loading:c==null?void 0:c.isFetching,headers:d,systemGroups:g}},tt=()=>{const{loading:e,systemGroups:a,headers:s}=et(),c=m.useMemo(()=>v("table",{id:"tableExcel",hidden:!0,children:[t("thead",{children:t("tr",{children:s.map((o,d)=>t("td",{t:"s",children:o},d))})}),t("tbody",{children:a.map(({systems:o,systemGroupName:d},l)=>o.map(({systemName:g,dates:S},i)=>v("tr",{children:[i===0?v(H,{children:[t("td",{rowSpan:o.length,children:l+1}),t("td",{rowSpan:o.length,children:d})]}):null,t("td",{children:g}),S.map((n,r)=>t("td",{children:n},r))]},i)))})]}),[a,s]);return v(P,{open:!0,okText:p.export,cancelText:p.cancel,okButtonProps:{loading:e,disabled:e},footer:null,closable:!1,children:[t(be,{strokeColor:{from:"#108ee9",to:"#87d068"},percent:100,status:"active"}),c]})},at=()=>{const{setTitlePage:e,setVisibleFilterBox:a,setVisibleSearchBox:s}=m.useContext(z),{idBuilding:c,modalMaintenanceSchedule:o,showModalMaintenanceSchedule:d,setMaintenanceScheduleObj:l,setGetMaintenanceScheduleStatus:g,monthSelected:S,daySelected:i,setMonthSelected:n,setDaySelected:r,modalExportMaintenanceSchedule:h}=m.useContext(O),{queryParams:k}=Te(),u=k.get("startTime");return m.useEffect(()=>(e(p.maintenance_schedule),s(!1),(async()=>{const M=u?x(u,"DD/MM/YYYY"):S,f=u?x(u,"DD/MM/YYYY"):i;r(f),n(M),g(!0),l({});const w=await A(M,c,!0);l(w.maintenanceScheduleObj||{}),g(!1),u&&d({...w.maintenanceScheduleObj[M.clone().format("YYYY-MM-DD")]})})(),()=>{e(""),s(!1),a(!1)}),[u]),{isShowModalMaintenanceSchedule:o==null?void 0:o.isShow,isShowExportMaintenanceSchedule:h==null?void 0:h.isShow}},nt=()=>{const{isShowModalMaintenanceSchedule:e,isShowExportMaintenanceSchedule:a}=at();return v(q.Wrapper,{children:[t(q.Container,{children:t(q.Content,{children:t(je,{})})}),e?t(Ze,{}):null,a?t(tt,{}):null]})},Va=()=>t(De,{children:t(nt,{})});export{Va as default};
