import{j as r,u as fe,a as T,b as Q,F as Ae}from"./@emotion-63839449.js";import{h as B}from"./moment-a468e1f9.js";import{F as $,u as ie}from"./index-687ba9e6.js";import{S as H,I as Ue}from"./index-43183512.js";import{B as Y}from"./index-881eef42.js";import{dk as Ne,g as _e,cJ as xe,d8 as Ie,cK as Fe,d9 as De,s as oe,a9 as me,I as se,l as a,S as de,c6 as b,a as Ee}from"./index-c2ded735.js";import{b as Pe,d as we,n as ce,D as Be,l as le,o as ve}from"./index-b17d22e5.js";import{l as ee}from"./lodash-88fe09e6.js";import"./file-saver-40cf32a9.js";import{S as Ce,g as Re,e as Le,d as Oe,h as pe}from"./formula-46f71781.js";import{r as A}from"./react-4fd50329.js";import{a as Me,b as $e,c as Ye,d as je}from"./amenities-1e1bae0f.js";import{c as W}from"./convertNumberToDateTime-e1623b31.js";import{P as ze}from"./prop-types-1172f4d5.js";import{u as qe,d as Ge}from"./react-router-a4308f7b.js";import{R as w,b as p,S as he,a as _,B as y,A as te,J as He,E as Te,n as k,j as re}from"./antd-f9eae174.js";import{b as We}from"./buildContentForCancelOrderPolicy-dc522742.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./account-86ffff50.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";const ge=async({filter:e,limit:t,page:o,idBuilding:g})=>{try{return await Ne({filter:e,limit:t,page:o,idBuilding:g})}catch(m){return m}},Ke=e=>({id:e==null?void 0:e.id,limitDate:e==null?void 0:e.limitDate,priceType:e==null?void 0:e.priceType,price:e==null?void 0:e.price,type:e==null?void 0:e.type}),Je=e=>({startTime:e.startTime,endTime:e.endTime,startTimeFormat:W(e==null?void 0:e.startTime).time,endTimeFormat:W(e==null?void 0:e.endTime).time,remainingOrder:e==null?void 0:e.remainingOrder,status:e==null?void 0:e.status,isDisabled:!![Ce,Re].includes(e==null?void 0:e.status)}),Qe=e=>{var t,o,g,m;return{id:e==null?void 0:e.id,name:e==null?void 0:e.name[_e()],type:e==null?void 0:e.type,coverPhoto:e==null?void 0:e.coverPhoto,deposits:e==null?void 0:e.deposits,maxSlotPerTime:e==null?void 0:e.maxSlotPerTime,minSlotPerTime:e==null?void 0:e.minSlotPerTime,formulaType:e==null?void 0:e.formulaType,formulas:(t=e==null?void 0:e.formulas)==null?void 0:t.map(i=>Le(i)),surcharges:(o=e==null?void 0:e.surcharges)==null?void 0:o.map(i=>Oe(i)),cancelBookingConditions:(g=e==null?void 0:e.cancelBookingConditions)==null?void 0:g.map(i=>Ke(i)),timeDistance:(e==null?void 0:e.timeDistance)??60,availableSlots:(m=e==null?void 0:e.availableSlots)==null?void 0:m.map(i=>Je(i))}},Xe=async({startDateUsage:e,idBuilding:t,utilityGroupId:o})=>{var g;try{const m=await Me({startDateUsage:B(e).startOf("days").toISOString(),idBuilding:t,utilityGroupId:o});return(g=m==null?void 0:m.data)==null?void 0:g.map(d=>Qe(d))}catch{return[]}},ue=({type:e,timeDistance:t=60,startTime:o,endTime:g})=>{if(e===xe)return{formulaType:Ie,totalTimeUsage:1};if(e===Fe){const m=W(o).dateTime,i=W(g).dateTime;return{formulaType:De,totalTimeUsage:Number(i.diff(m,"minutes"))/(t||60)}}},Ze=({totalNumberUse:e=0,formulaType:t="",formula:o="",ratio:g=1,norm:m=1})=>{if(!o)throw new Error("Formula is empty.");if(!t)throw new Error("Formula type not empty.");let i=0;ee.isString(o)&&(o=Number(o));let d=e;switch(t){case"NUMBER_USE":i=e*o[0].price,i*=g;break;case"ACCUMULATED":ee.map(o,(f,x)=>{if(x<o.length-1){let U;x===0?U=Number(f.to):U=Number(f.to)-Number(f.from);const P=ee.round(U*g)*m;let u=0;d>P?u=P:u=d,d-=u,i+=u*f.price}else d>=0&&(i+=d*f.price)});break;default:i=0;break}return i},Se=({totalTimeUsage:e,formulaType:t,utility:o})=>{const{formulas:g,surcharges:m=[],deposits:i}=o,d={utilityPrice:Ze({totalNumberUse:e,formulaType:t,formula:g??[]}),surchargeFee:0,deposits:Number(i),amount:0};return m==null||m.forEach(f=>{d.surchargeFee+=Number((f==null?void 0:f.price)??0)}),d.amount=Number((d==null?void 0:d.utilityPrice)??0)+Number((d==null?void 0:d.deposits)??0)+Number((d==null?void 0:d.surchargeFee)??0),d},ne=A.createContext({idBuilding:0,formBooking:void 0,bookingInfo:{utilityPrice:0,amount:0,surchargeFee:0,deposits:0,totalTimeUsage:0,residentId:null,residentName:null,unitId:null,unitName:null,utilityGroupId:null,utilityGroupName:null,utilityId:null,utilityName:null,startTime:null,endTime:null,timeSelected:{},startDateUsage:B(),minSlotPerTime:0,maxSlotPerTime:0,cancelBookingConditions:[]},setBookingInfo:()=>{}}),ae=({children:e})=>{const{idBuilding:t}=qe(),[o]=$.useForm(),[g,m]=A.useState({utilityPrice:0,amount:0,surchargeFee:0,deposits:0,totalTimeUsage:0,residentId:null,residentName:null,unitId:null,unitName:null,utilityGroupId:null,utilityGroupName:null,utilityId:null,utilityName:null,startTime:null,endTime:null,timeSelected:{},startDateUsage:B(),minSlotPerTime:0,maxSlotPerTime:0,cancelBookingConditions:[]}),i={idBuilding:t,formBooking:o,bookingInfo:g,setBookingInfo:m};return r(ne.Provider,{value:i,children:e})};ae.propTypes={children:ze.node};ae.defaultProps={children:r("div",{})};const be=ae,ke=e=>({id:e==null?void 0:e.id,name:e==null?void 0:e.name[_e()],type:e==null?void 0:e.type}),ye=async e=>{try{const{data:t,code:o,codeLanguage:g}=await $e(e);return{code:o,codeLanguage:g,data:t.map(m=>ke(m))}}catch(t){return t}},Ve=()=>{const{idBuilding:e,bookingInfo:t,setBookingInfo:o,formBooking:g}=A.useContext(ne),[m,i]=A.useState({data:[],isFetching:!1}),[d,f]=A.useState({data:[],isFetching:!1}),[x,U]=A.useState({data:[],isFetching:!1}),[P,u]=A.useState([]),[v,E]=A.useState({isFetching:!1}),[K,C]=A.useState(""),J={unitId:void 0,residentId:void 0,utilityGroupId:void 0,startDateUsage:B(),note:""};A.useEffect(()=>{(async()=>{i({data:[],isFetching:!0}),U({data:[],isFetching:!0});const[l,n]=await Promise.all([ge({idBuilding:e,limit:oe,page:me,filter:{name:void 0}}),ye(e)]);i({data:l.data,isFetching:!1}),U({data:n==null?void 0:n.data,isFetching:!1})})()},[]);const I=async l=>{i({...m,isFetching:!0});const n=await ge({idBuilding:e,limit:oe,page:me,filter:{name:l||void 0}});i({data:n.data,isFetching:!1})},F=()=>{o({...t,utilityPrice:0,amount:0,surchargeFee:0,deposits:0,totalTimeUsage:0,utilityId:null,utilityName:null,startTime:null,endTime:null,timeSelected:{}})},R=async(l,n)=>{var D,j,z,L,c,O,q,G;const h={...t};if(l!=null&&l.unitId){f({...d,isFetching:!0});const S=m.data.find(M=>M.id===l.unitId);f({data:(S==null?void 0:S.residents)??[],isFetching:!1}),h.unitName=S==null?void 0:S.name,h.unitId=l==null?void 0:l.unitId,h.residentId=(j=(D=S==null?void 0:S.residents)==null?void 0:D[0])==null?void 0:j.id,h.residentName=(L=(z=S==null?void 0:S.residents)==null?void 0:z[0])==null?void 0:L.fullName,g.setFieldsValue({residentId:(O=(c=S==null?void 0:S.residents)==null?void 0:c[0])==null?void 0:O.id})}if(l!=null&&l.residentId){const S=(q=d==null?void 0:d.data)==null?void 0:q.find(M=>M.id===(l==null?void 0:l.residentId));h.residentName=S==null?void 0:S.fullName,h.residentId=l==null?void 0:l.residentId}if(n.utilityGroupId&&l.startDateUsage||l.utilityGroupId&&n.startDateUsage){const S=(G=x==null?void 0:x.data)==null?void 0:G.find(V=>V.id===n.utilityGroupId);E({isFetching:!0});const M=await Xe({startDateUsage:n.startDateUsage??null,idBuilding:+e,utilityGroupId:n.utilityGroupId});u(M),C(S==null?void 0:S.type),E({isFetching:!1}),h.utilityGroupId=n.utilityGroupId,h.utilityGroupName=S==null?void 0:S.name,h.startDateUsage=n.startDateUsage,h.utilityPrice=0,h.amount=0,h.surchargeFee=0,h.deposits=0,h.totalTimeUsage=0,h.utilityId=null,h.startTime=null,h.endTime=null,h.timeSelected={},h.minSlotPerTime=0,h.maxSlotPerTime=0,h.cancelBookingConditions=[]}o({...h})},N=(l,n)=>{const{startTime:h,endTime:D}=l,{type:j,timeDistance:z}=n,{totalTimeUsage:L,formulaType:c}=ue({type:j,timeDistance:z,startTime:h,endTime:D}),{utilityPrice:O,amount:q,surchargeFee:G,deposits:S}=Se({totalTimeUsage:L,formulaType:c,utility:n});o({...t,utilityPrice:O,amount:q,surchargeFee:G,deposits:S,startTime:h,endTime:D,utilityId:n.id,utilityName:n.name,timeSelected:{[`${h}-${D}`]:!0}})},s=(l,n)=>{const{startTime:h,endTime:D}=l,{type:j,timeDistance:z,availableSlots:L}=n,c={...t};if((c.startTime||c.startTime===0)&&c.endTime&&c.utilityId===n.id){c.startTime<=h&&(c.endTime=D),c.startTime>h&&(c.startTime=h),c.timeSelected={};for(let X=0;L.length>X;X+=1){const Z=L[X];if(Z.startTime>=c.startTime&&Z.endTime<=c.endTime){if(L[X].isDisabled){c.startTime=h,c.endTime=D,c.utilityId=n.id,c.utilityName=n==null?void 0:n.name,c.minSlotPerTime=(n==null?void 0:n.minSlotPerTime)||0,c.maxSlotPerTime=(n==null?void 0:n.maxSlotPerTime)||0,c.cancelBookingConditions=(n==null?void 0:n.cancelBookingConditions)||[],c.timeSelected={[`${h}-${D}`]:!0};break}c.timeSelected[`${Z.startTime}-${Z.endTime}`]=!0}}}(!c.startTime&&!c.endTime||c.utilityId!==n.id)&&(c.startTime=h,c.endTime=D,c.utilityId=n.id,c.utilityName=n.name,c.minSlotPerTime=(n==null?void 0:n.minSlotPerTime)||0,c.maxSlotPerTime=(n==null?void 0:n.maxSlotPerTime)||0,c.cancelBookingConditions=(n==null?void 0:n.cancelBookingConditions)||[],c.timeSelected={[`${h}-${D}`]:!0});const{totalTimeUsage:O,formulaType:q}=ue({type:j,timeDistance:z,startTime:c.startTime,endTime:c.endTime}),{utilityPrice:G,amount:S,surchargeFee:M,deposits:V}=Se({totalTimeUsage:O,formulaType:q,utility:n});o({...c,utilityPrice:G,amount:S,surchargeFee:M,deposits:V,totalTimeUsage:O})};return{initialValues:J,formBooking:g,isFetchingApartment:m.isFetching,isFetchingUtilityGroup:x.isFetching,handleSearchApartment:I,apartmentData:m.data,residentData:d.data,isFetchingResident:d.isFetching,isFetchingAvailableSlots:v.isFetching,onValuesChange:R,showAvailableSlotUtility:K,utilities:P,handleSelectFrameTime:N,utilityGroups:x,handleSlotSelect:s,bookingInfo:t,handleResetSelectTime:F}};var et={name:"s5xdrg",styles:"display:flex;align-items:center"};const tt=()=>{var N;const{initialValues:e,formBooking:t,isFetchingApartment:o,isFetchingUtilityGroup:g,handleSearchApartment:m,apartmentData:i,isFetchingResident:d,residentData:f,isFetchingAvailableSlots:x,onValuesChange:U,showAvailableSlotUtility:P,utilities:u,handleSelectFrameTime:v,utilityGroups:E,handleSlotSelect:K,bookingInfo:C,handleResetSelectTime:J}=Ve(),I=fe(),F=P===xe,R=P===Fe;return T(Y,{style:{flex:1},children:[T(Y.Header,{css:et,borderBottom:!0,children:[r(se,{name:"icon-reservationCheck-filled",css:Q({fontSize:I.iconSize,marginRight:I.margin.xs,color:I.color.primary},"","")}),r(Pe,{css:Q({color:I.color.primary,fontWeight:I.fontWeight.bold},"",""),children:a.select_a_slot})]}),r(Y.Content,{children:T($,{initialValues:e,form:t,name:"formBooking",layout:"vertical",onValuesChange:U,children:[T(w,{gutter:[8,8],children:[r(p,{span:"12",children:r($.Item,{rules:[{required:!0}],label:a.unit,name:"unitId",children:r(H,{allowClear:!0,showSearch:!0,placeholder:a.label.select_apartment,filterOption:!1,loading:o,onSearch:we(m),getPopupContainer:s=>s.parentNode,style:{width:"100%"},dropdownRender:s=>o?r("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:r(he,{})}):s,children:i==null?void 0:i.map(({id:s,name:l})=>r(H.Option,{value:s,children:l},s))})})}),r(p,{span:"12",children:r($.Item,{rules:[{required:!0}],label:a.resident,name:"residentId",children:r(H,{allowClear:!0,showSearch:!0,placeholder:a.label.select_resident,filterOption:!1,loading:d,getPopupContainer:s=>s.parentNode,style:{width:"100%"},children:f==null?void 0:f.map(({id:s,fullName:l})=>r(H.Option,{value:s,children:l},s))})})}),r(p,{span:"12",children:r($.Item,{label:a.amenities_group,name:"utilityGroupId",rules:[{required:!0}],children:r(H,{fluid:"true",showSearch:!0,placeholder:a.amenities_group,optionFilterProp:"children",filterOption:(s,l)=>ce(l.children).indexOf(ce(s))>=0,getPopupContainer:s=>s.parentNode,loading:g||x,children:(N=E==null?void 0:E.data)==null?void 0:N.map(s=>r(H.Option,{value:s.id,children:s==null?void 0:s.name},s.id))})})}),r(p,{span:"12",children:r($.Item,{rules:[{required:!0}],name:"startDateUsage",label:a.day_of_using,children:r(Be,{fluid:!0,format:le,placeholder:le,disabledDate:s=>B(s).isBefore(B().subtract(1,"day")),allowClear:!1})})})]}),T(w,{style:{justifyContent:"space-between"},children:[r(p,{span:"20",children:r(_.Title,{level:4,children:a.select_frame_time})}),r(p,{span:"4",style:{textAlign:"right"},children:T(y,{onClick:()=>J(),disabled:!C.startTime&&!C.endTime,children:[r(se,{name:"icon-reset-outlined",css:s=>({fontSize:s.iconSize.xs})}),a.reSelect]})})]}),T(w,{style:{gap:"10px",margin:"10px 0",overflowY:"scroll",height:"300px",justifyContent:"center"},children:[x?r("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:r(he,{})}):null,!x&&u&&u.length?u==null?void 0:u.map(s=>{var l;return T(p,{span:"24",style:{marginBottom:I.margin.md},children:[r(_.Title,{level:5,children:s==null?void 0:s.name}),R?T("div",{style:{marginBottom:I.margin.xs},children:[s!=null&&s.minSlotPerTime&&!(s!=null&&s.maxSlotPerTime)?r(te,{message:a.please_order_at_least_frame.replace("{slot}",s.minSlotPerTime),type:"warning",showIcon:!0,closable:!0}):null,s!=null&&s.minSlotPerTime&&(s!=null&&s.maxSlotPerTime)&&(s==null?void 0:s.minSlotPerTime)===(s==null?void 0:s.maxSlotPerTime)?r(te,{message:a.please_order_at_frame.replace("{slot}",s.maxSlotPerTime),type:"warning",showIcon:!0,closable:!0}):null,s!=null&&s.minSlotPerTime&&(s!=null&&s.maxSlotPerTime)&&(s==null?void 0:s.minSlotPerTime)!==(s==null?void 0:s.maxSlotPerTime)?r(te,{message:a.please_order_from_to_frames.replace("{frameFrom}",s.minSlotPerTime).replace("{frameTo}",s.maxSlotPerTime),type:"warning",showIcon:!0,closable:!0}):null]}):null,r(He,{size:"small",hoverable:!0,children:r(w,{style:{gap:"10px",overflowY:"scroll"},children:(l=s==null?void 0:s.availableSlots)==null?void 0:l.map(n=>T(y,{onClick:()=>F?v(n,s):K(n,s),type:C.utilityId===s.id&&C.timeSelected[`${n.startTime}-${n.endTime}`]?"primary":"default",disabled:n.isDisabled,style:{display:"flex",flexDirection:"column",fontSize:"12px",height:"50px",width:"100px",alignItems:"center"},children:[T("span",{children:[n.startTimeFormat," - ",n.endTimeFormat]}),r("span",{css:Q({color:[pe].includes(n==null?void 0:n.status)?I.color.success:I.color.default},"",""),children:[pe].includes(n==null?void 0:n.status)?`${a.left_slot.replace("{item}",`${n.remainingOrder}`)}`:a.out_of_slots})]},`${n.startTime}-${n.endTime}`))})})]},s.id)}):null,!x&&u&&!u.length?r(p,{span:24,children:r(Te,{image:Te.PRESENTED_IMAGE_SIMPLE,style:{width:"100%",justifyContent:"center"}})}):null]}),r(w,{children:r(p,{span:"24",children:r($.Item,{label:a.note,name:"note",children:r(Ue.TextArea,{maxLength:"255",fluid:"true",placeholder:a.note,rows:"4",allowClear:!0})})})})]})})]})},rt=async(e,t)=>{const{cancelBookingConditions:o,utilityId:g,unitId:m,residentId:i,startDateUsage:d,amount:f,startTime:x,endTime:U}=e;try{const P={cancelBookingConditions:o??[],utilityId:g??null,unitId:m??null,residentId:i??null,startDateUsage:d?B(d).startOf("day").toDate():null,startTime:x,endTime:U,amount:f??0},u=await Ye(P,t);return{code:u.code,codeLanguage:u.codeLanguage}}catch(P){return{error:P,code:P.code,codeLanguage:P.codeLanguage}}},st=async(e,t)=>{const{cancelBookingConditions:o,utilityId:g,unitId:m,residentId:i,startDateUsage:d,amount:f,startTime:x,endTime:U,note:P}=e;try{const u={cancelBookingConditions:o??[],utilityId:g??null,unitId:m??null,residentId:i??null,startDateUsage:d?B(d).startOf("day").toDate():null,startTime:x,endTime:U,amount:f??0,note:P||null};return await je(u,t)}catch(u){return u}},nt="UTILITY_BOOKING_TIME_OF_UNIT_GREATER_THAN_REMAINING_TIME",at=()=>{const{idBuilding:e,bookingInfo:t,formBooking:o}=A.useContext(ne),g=Ge(),[m,i]=A.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),[d,f]=A.useState({code:void 0,codeLanguage:void 0,isFetching:!1});ie(m.code,m.codeLanguage),ie(d.code,d.codeLanguage,{message:a.success,description:a.booking_status_success});const x=async()=>{ve({loading:d.isFetching,onCancel:()=>{f({isFetching:!1,code:void 0,codeLanguage:void 0})},isAll:!1,onOk:async()=>{var l,n;f({code:void 0,codeLanguage:void 0,isFetching:!0});const F=o.getFieldsValue(),R={utilityId:t==null?void 0:t.utilityId,cancelBookingConditions:(t==null?void 0:t.cancelBookingConditions)??[],unitId:+(F==null?void 0:F.unitId),residentId:+(F==null?void 0:F.residentId),startDateUsage:F==null?void 0:F.startDateUsage,amount:t.amount||0,startTime:t.startTime,endTime:t.endTime,note:F.note},N=await st(R,e),s=de.includes(N.code);return f({code:N.code,codeLanguage:N.codeLanguage,isFetching:!1}),s&&(l=N==null?void 0:N.data)!=null&&l.id&&g.push(`/buildings/${e}/amenities-orders/${(n=N==null?void 0:N.data)==null?void 0:n.id}`),s?Promise.resolve():Promise.reject()},questionText:`${a.do_you_want_to_book_utility.replace("{utilityName}",t.utilityName)}?`,totalItem:1})},U=async()=>{var R;const F=await o.validateFields();if(F){if(t!=null&&t.minSlotPerTime&&!(t!=null&&t.maxSlotPerTime)&&(t==null?void 0:t.minSlotPerTime)>t.totalTimeUsage){k.error({message:a.please_order_at_least_frame.replace("{slot}",t.minSlotPerTime),description:a.data_invalid});return}if(t!=null&&t.minSlotPerTime&&(t!=null&&t.maxSlotPerTime)&&((t==null?void 0:t.minSlotPerTime)>t.totalTimeUsage||(t==null?void 0:t.maxSlotPerTime)<t.totalTimeUsage)){if((t==null?void 0:t.minSlotPerTime)===(t==null?void 0:t.maxSlotPerTime)){k.error({message:a.please_order_at_frame.replace("{slot}",t.maxSlotPerTime),description:a.data_invalid});return}if((t==null?void 0:t.minSlotPerTime)!==(t==null?void 0:t.maxSlotPerTime)){k.error({message:a.please_order_from_to_frames.replace("{frameFrom}",t.minSlotPerTime).replace("{frameTo}",t.maxSlotPerTime),description:a.data_invalid});return}}if(F){const N={utilityId:t==null?void 0:t.utilityId,cancelBookingConditions:(t==null?void 0:t.cancelBookingConditions)??[],unitId:+(t==null?void 0:t.unitId),residentId:+(t==null?void 0:t.residentId),startDateUsage:t==null?void 0:t.startDateUsage,amount:t.amount||0,startTime:t.startTime,endTime:t.endTime};i({code:void 0,codeLanguage:void 0,isFetching:!0});const s=await rt(N,e);(s==null?void 0:s.codeLanguage)===nt?(k.error({message:a.label.error,description:(R=s==null?void 0:s.error)==null?void 0:R.message}),i({isFetching:!1})):i({code:s.code,codeLanguage:s.codeLanguage,isFetching:!1}),de.includes(s.code)&&await x()}}},P=()=>{g.goBack()},u=A.useMemo(()=>{var F;return(F=t==null?void 0:t.cancelBookingConditions)!=null&&F.length?We(t==null?void 0:t.cancelBookingConditions):[]},[t==null?void 0:t.cancelBookingConditions]),v=A.useMemo(()=>!(t.unitId&&t.residentId&&(t.startTime||t.startTime===0)&&t.endTime),[t]),E=B(t.startDateUsage).format("DD/MM/YYYY"),K=o.getFieldValue("note")||"",C=W(t.startTime).time,J=W(t.endTime).time,I=B().format("DD/MM/YYYY");return{isFetchingBooking:m==null?void 0:m.isFetching,bookingInfo:t,startTime:C,endTime:J,createdAt:I,startDateUsage:E,dataCancelOrderPolicy:u,note:K,handleCheckBooking:U,onClickBtnCancelUtilityBooking:P,disableBtnBooking:v}};var it={name:"s5xdrg",styles:"display:flex;align-items:center"};const ot=()=>{const{bookingInfo:e,startTime:t,endTime:o,createdAt:g,startDateUsage:m,dataCancelOrderPolicy:i,note:d,handleCheckBooking:f,onClickBtnCancelUtilityBooking:x,disableBtnBooking:U,isFetchingBooking:P}=at(),u=fe();return T(Y,{style:{flex:1},children:[T(Y.Header,{css:it,borderBottom:!0,children:[r(se,{name:"icon-info-circle-filled",css:Q({fontSize:u.iconSize,marginRight:u.margin.xs,color:u.color.primary},"","")}),r(Pe,{css:Q({color:u.color.primary,fontWeight:u.fontWeight.bold},"",""),children:a.utility_info})]}),T(Y.Content,{children:[T(w,{gutter:[4,20],children:[r(p,{span:10,children:T(_.Text,{children:[a.resident,": "]})}),r(p,{span:14,style:{textAlign:"right"},children:r(_.Text,{strong:!0,children:(e==null?void 0:e.residentName)||"-"})}),r(p,{span:10,children:T(_.Text,{children:[a.unit,": "]})}),r(p,{span:14,style:{textAlign:"right"},children:r(_.Text,{strong:!0,children:(e==null?void 0:e.unitName)||"-"})}),r(p,{span:10,children:T(_.Text,{children:[a.amenities_group,": "]})}),r(p,{span:14,style:{textAlign:"right"},children:r(_.Text,{strong:!0,children:(e==null?void 0:e.utilityGroupName)||"-"})}),r(p,{span:10,children:T(_.Text,{children:[a.amenities_name,": "]})}),r(p,{span:14,style:{textAlign:"right"},children:r(_.Text,{strong:!0,children:(e==null?void 0:e.utilityName)||"-"})}),r(p,{span:10,children:T(_.Text,{children:[a.order_time,": "]})}),r(p,{span:14,style:{textAlign:"right"},children:r(_.Text,{strong:!0,children:t&&o?g:"-"})}),r(p,{span:10,children:T(_.Text,{children:[a.usage_time,": "]})}),r(p,{span:14,style:{textAlign:"right"},children:r(_.Text,{strong:!0,children:t&&o?`${m} (${t} - ${o})`:"-"})}),r(p,{span:24,children:T(_.Text,{children:[a.note,": ",d]})})]}),i&&i.length?T(Ae,{children:[r(re,{style:{margin:"8px 0"}}),T(w,{gutter:[8,8],children:[r(p,{span:24,children:r(_.Text,{strong:!0,children:a.cancel_order_policy})}),i==null?void 0:i.map((v,E)=>r(p,{span:24,children:T(_.Text,{children:[E+1,". ",v]})},v))]})]}):null,r(re,{style:{margin:"8px 0"}}),T(w,{gutter:[8,8],children:[r(p,{span:10,children:r(_.Text,{children:a.price_service_info})}),r(p,{span:14,style:{textAlign:"right"},children:T(_.Text,{strong:!0,children:[e!=null&&e.utilityPrice?b(e==null?void 0:e.utilityPrice):0," VNĐ"]})}),r(p,{span:10,children:r(_.Text,{children:a.deposit_info})}),r(p,{span:14,style:{textAlign:"right"},children:T(_.Text,{strong:!0,children:[e!=null&&e.deposits?b(e==null?void 0:e.deposits):0," VNĐ"]})}),r(p,{span:24,children:T("h5",{style:{color:u.labelColor},children:["(",a.refund_after_service_ends,")"]})}),r(p,{span:10,children:r(_.Text,{children:a.surcharge})}),r(p,{span:14,style:{textAlign:"right"},children:T(_.Text,{strong:!0,children:[e!=null&&e.surchargeFee?b(e==null?void 0:e.surchargeFee):0," VNĐ"]})}),r(p,{span:24,children:T("h5",{style:{color:u.labelColor},children:["(",a.pay_after_using_the_utility,")"]})}),r(re,{style:{margin:"8px 0"}}),r(p,{span:10,style:{fontSize:16},children:r(_.Text,{strong:!0,children:a.total_money})}),r(p,{span:14,style:{textAlign:"right",fontSize:16},children:T(_.Text,{strong:!0,children:[e!=null&&e.amount?b(e==null?void 0:e.amount):0," VNĐ"]})})]})]}),r(Y.Footer,{borderTop:!0,children:T(w,{gutter:[8,0],children:[r(p,{span:8,children:r(y,{onClick:x,style:{width:"100%"},children:a.cancel})}),r(p,{span:16,children:r(y,{disabled:U,onClick:f,type:"primary",style:{width:"100%"},loading:P,children:a.order_amenity})})]})})]})},mt=()=>{const{setTitlePage:e}=A.useContext(Ee);A.useEffect(()=>(e(a.booking_amenities),()=>{e("")}),[])},dt=()=>(mt(),r("div",{style:{flex:1,height:"100%",display:"flex",flexDirection:"column"},children:T(w,{style:{flex:1},gutter:[12,12],children:[r(p,{span:16,style:{flex:1,display:"flex",flexDirection:"column"},children:r(tt,{})}),r(p,{span:8,style:{flex:1,display:"flex",flexDirection:"column"},children:r(ot,{})})]})})),Kr=()=>r(be,{children:r(dt,{})});export{Kr as default};
