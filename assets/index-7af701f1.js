import{j as s,a as p,F as U,b as q,c as S}from"./@emotion-63839449.js";import{d as z,Q as M,C as Q,P as R}from"./index-b17d22e5.js";import{B as Y}from"./index-881eef42.js";import{F}from"./index-687ba9e6.js";import{I as J}from"./index-43183512.js";import"./lodash-88fe09e6.js";import{h as v}from"./moment-a468e1f9.js";import{gL as K,s as I,a9 as b,l as k,b1 as X,I as Z,gQ as ee,gR as te,a as H,a1 as se}from"./index-c2ded735.js";import"./file-saver-40cf32a9.js";import{r as l}from"./react-4fd50329.js";import{P as h}from"./prop-types-1172f4d5.js";import{u as V}from"./react-router-a4308f7b.js";import{I as N}from"./react-infinite-scroll-component-e33646cb.js";import{r as oe,h as A,S as j,b as E,R as $,I as W,j as ie}from"./antd-f9eae174.js";import{c as re,b as ae,d as ne,e as le}from"./chat-dae5776c.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./libphonenumber-js-0d5a9c92.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";const C={keyword:""},w=l.createContext({idBuilding:0,formFilter:void 0,filter:{...C},setFilter:()=>{},listRoom:[],setListRoom:()=>{},roomSelected:void 0,setRoomSelected:()=>{},getListRoomStatus:{isFetching:!1},setGetListRoomStatus:()=>{},isEndOfRoomList:!1,setIsEndOfRoomList:()=>{}}),T=({children:e})=>{const{idBuilding:t}=V(),[o,i]=l.useState({...C}),[r,d]=l.useState({isFetching:!1}),[a,c]=l.useState([]),[f,u]=l.useState({id:0,status:"",title:"",code:"",unit:""}),[x,n]=l.useState(!1),[g]=F.useForm(),m={idBuilding:t,formFilter:g,filter:o,setFilter:i,listRoom:a,setListRoom:c,roomSelected:f,setRoomSelected:u,getListRoomStatus:r,setGetListRoomStatus:d,isEndOfRoomList:x,setIsEndOfRoomList:n};return s(w.Provider,{value:m,children:e})};T.propTypes={children:h.node};T.defaultProps={children:s("div",{})};const de=T,ce=e=>{var t,o;return{id:e.roomId,key:e.roomId,name:(e==null?void 0:e.name)??"",unitName:(e==null?void 0:e.unitName)??"",unitId:((t=e==null?void 0:e.unitIds)==null?void 0:t[0])??"",status:(e==null?void 0:e.status)??"",content:(e==null?void 0:e.content)??"",latestMessageAt:((o=e==null?void 0:e.latestMessageDate)==null?void 0:o.iso)??(e==null?void 0:e.createdAt)??"",isHaveNewMessage:(e==null?void 0:e.unread)>0}},pe=async({idBuilding:e,filter:t,page:o,limit:i})=>{try{const{keyword:r}=t,d=await K({idBuilding:e,filter:{keyword:r||void 0,requestBy:"EMPLOYEE"},page:o,limit:i});return{code:d.code,codeLanguage:d.codeLanguage,data:d.data.map(a=>ce(a)),loadMore:d.readmore}}catch(r){return{code:r.code,codeLanguage:r.codeLanguage,data:[]}}},B=()=>{const{setGetListRoomStatus:e,idBuilding:t,listRoom:o,setListRoom:i,roomSelected:r,setRoomSelected:d,setIsEndOfRoomList:a}=l.useContext(w);return[async(f,u,x=!1)=>{e({isFetching:!0});const n=await pe({filter:{...u},idBuilding:t,limit:I,page:f});if(n.data.length>0){let g=[...o,...n.data];x&&(g=[...n.data]);let m=!1;for(let y=0;y<g.length;y+=1)if(g[y].id===r.id){m=!0;break}m||d({...g==null?void 0:g[0]}),i(g)}e({isFetching:!1}),a(n.loadMore)}]},fe=()=>{const{formFilter:e}=l.useContext(w),[t]=B();return[e,C,async(i,r)=>{await t(b-1,r,!0)}]},ge=()=>{const[e,t,o]=fe();return s(F,{initialValues:t,onValuesChange:z(o),form:e,name:"form_filter",children:s(F.Item,{name:"keyword",noStyle:!0,children:s(J.Search,{placeholder:k.filter,fluid:"true"})})})},ue=()=>{const{filter:e,getListRoomStatus:t,listRoom:o,roomSelected:i,setRoomSelected:r,isEndOfRoomList:d}=l.useContext(w),[a]=B(),c=async()=>{await a(o.length,e)},f=async u=>{r({...u})};return[t.isFetching,!d,o,i,c,f]};var he={name:"sqkazh",styles:"align-items:center;& .ant-list-item-meta-title{margin-bottom:0;}"},me={name:"13dbbpr",styles:"position:absolute;top:50%;translate:transformY(-50%);right:12px;.ant-badge-dot{width:12px;height:12px;background-color:#3487cb;}"},xe={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"},ye={name:"974d2w",styles:"position:absolute;top:50%;width:100%;height:100%;text-align:center"};const Le=()=>{const[e,t,o,i,r,d]=ue();return p(U,{children:[s(N,{dataLength:o.length,next:r,hasMore:t,scrollableTarget:"scrollableListRoom",children:s(M,{split:!0,dataSource:o,renderItem:a=>{var c,f,u,x;return s(M.Item,{css:n=>({cursor:"pointer",backgroundColor:i&&i.id===a.id?"#ddd":"",padding:`${n.padding.xs}px`,position:"relative"}),onClick:()=>d(a),extra:s(oe,{css:me,dot:a.isHaveNewMessage}),children:s(M.Item.Meta,{css:he,avatar:p(A,{size:"large",css:n=>({backgroundColor:n.color.primary,display:"flex",alignItems:"center"}),children:[(f=(c=a==null?void 0:a.name)==null?void 0:c[0])==null?void 0:f.toUpperCase(),(x=(u=a==null?void 0:a.name)==null?void 0:u[1])==null?void 0:x.toUpperCase()]}),title:s("div",{css:xe,children:p("h4",{css:n=>({color:n.color.link,wordBreak:"keep-all",fontFamily:a.isHaveNewMessage?n.fontWeight.bold:"inherit",margin:0}),children:[a.unitName," - ",a.name]})}),description:p("div",{children:[s("p",{css:n=>({whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",width:"100%",fontFamily:a.isHaveNewMessage?n.fontWeight.bold:"inherit",color:n.textColor,margin:0}),children:a.content}),s("h5",{css:n=>({color:n.disabledColor,margin:0}),children:a.latestMessageAt?v(a.latestMessageAt).format("DD/MM/YYYY HH:mm"):"-"})]})})},a.id)}})}),e?s("div",{css:ye,children:s(j,{})}):null]})},ve=()=>{const{roomSelected:e}=l.useContext(w);return[e]};var Re={name:"1w5wln4",styles:"width:100%;display:flex;flex-direction:column;justify-content:center"},we={name:"s5xdrg",styles:"display:flex;align-items:center"};const Me=()=>{var d,a;const[e]=ve(),{name:t,content:o,latestMessageAt:i,unitName:r}=e;return p($,{gutter:[12,0],children:[s(Q,{centerVertical:!0,children:p(A,{size:{xs:16,sm:24,md:32,lg:40,xl:48,xxl:56},css:c=>({backgroundColor:c.color.primary,display:"flex",alignItems:"center"}),children:[((d=t==null?void 0:t[0])==null?void 0:d.toUpperCase())??"A",((a=t==null?void 0:t[1])==null?void 0:a.toUpperCase())??"V"]})}),p(E,{flex:"1 0 0",css:Re,children:[s("div",{css:we,children:p("span",{css:c=>({color:c.color.link,wordBreak:"keep-all",margin:0}),children:[r," - ",t]})}),s("p",{css:c=>({whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",width:"100%",color:c.textColor,margin:`${c.margin.xss}px 0 0 0`}),children:o||"-"}),s("h5",{css:c=>({color:c.disabledColor,margin:`${c.margin.xss}px 0 0 0`}),children:i?v(i).format("DD/MM/YYYY HH:mm"):"-"})]})]})},Se=(e,t)=>{const o=e==null?void 0:e.type,i=e==null?void 0:e.name;return o===ne&&i||o===le?t?"***":i:k.label.deleted_account},Ce=S("span",{target:"e382dtc3"})(({position:e,theme:t})=>({backgroundColor:e==="left"?"#F1F0F0":"#d3ebff",color:e==="left"?"#4A4A4A":"#FFFFF",borderRadius:10,borderTopRightRadius:e==="left"?10:0,borderTopLeftRadius:e==="left"?0:10,borderBottomLeftRadius:10,borderBottomRightRadius:10,padding:"12px",width:"fit-content",wordBreak:"break-word",whiteSpace:"pre-wrap",lineHeight:"1.5"}),""),Fe=S("div",{target:"e382dtc2"})(({position:e})=>({display:"flex",flexDirection:e==="left"?"row":"row-reverse",flex:"2"}),""),Ie=S("div",{target:"e382dtc1"})(({position:e})=>({alignItems:e==="left"?"flex-start":"flex-end",margin:e==="left"?"0 0 0 15px":"0 15px 0 0",display:"flex",flexDirection:"column",maxWidth:"80%"}),""),Ee=S(W,{target:"e382dtc0"})(({position:e})=>({width:"auto",height:"120px",objectFit:"cover",border:"1px solid #ddd",borderRadius:"3px",marginLeft:e==="right"?"6px":"0",marginRight:e==="left"?"6px":"0",marginBottom:"6px",minWidth:"100px"}),""),O=({position:e,currentMember:t,message:o,isUserCs:i})=>p(Fe,{position:e,children:[e==="left"&&s("div",{children:s(A,{src:re(t==null?void 0:t.avatar,36,36)||"/assets/images/default-avatar.jpg",width:"36px",height:"36px"})}),p(Ie,{position:e,children:[e==="left"&&p("small",{children:[Se(t,i),", ",v(o.createdAt).format("HH:mm")]}),e==="right"&&s("small",{children:v(o.createdAt).format("HH:mm")}),o.type===ae?s("div",{css:q({display:"flex",flexDirection:e==="left"?"row":"row-reverse",flexWrap:"wrap"},"",""),children:s(W.PreviewGroup,{children:o.images.map(r=>s(Ee,{placeholder:!0,fallback:"/assets/images/image-error.png",position:e,src:r},r))})}):p(U,{children:[s(Ce,{position:e,children:o.content}),o.loading?s(X,{onlyIcon:!0,isLoading:!0,width:"11px",height:"11px"}):null,o.success?null:s(Z,{style:{fontSize:11,color:"red",marginTop:3},name:"exclamation-circle"})]})]})]}),_=({currentMember:e,item:t,position:o,isUserCs:i})=>s(O,{position:o,currentMember:e,message:t,isUserCs:i});O.propTypes={position:h.string,currentMember:h.objectOf(h.any),message:h.objectOf(h.any),isUserCs:h.bool};O.defaultProps={position:"left",currentMember:void 0,message:{createdAt:new Date,content:"",type:"",images:[],loading:!1,success:!0},isUserCs:!1};_.propTypes={currentMember:h.objectOf(h.any),item:h.objectOf(h.any),position:h.string,isUserCs:h.bool};_.defaultProps={currentMember:void 0,item:void 0,position:"left",isUserCs:!1};const G=l.createContext({idBuilding:0,messages:[],setMessages:()=>{},requests:[],setRequests:()=>{},modalApprove:void 0,showModalApprove:()=>{},hideModalApprove:()=>{},modalComplete:void 0,showModalComplete:()=>{},hideModalComplete:()=>{},visibleRequestListOverlay:!1,setVisibleRequestListOverlay:()=>{}}),D=({children:e})=>{const{idBuilding:t}=V(),[o,i]=l.useState([]),r={idBuilding:t,messages:o,setMessages:i};return s(G.Provider,{value:r,children:e})};D.propTypes={children:h.node};D.defaultProps={children:s("div",{})};const be=e=>{var t;return{key:e.id||e.objectId,id:e.id||e.objectId,content:e.content,createdAt:e.createdAt,deviceToken:e.deviceToken,images:((t=e==null?void 0:e.extraData)==null?void 0:t.images)??[],isRead:e.isRead,idMessage:e.messageId,readUserIds:e.readUserIds,idRoom:e.roomId,idSender:e.senderId,type:e.type,idUnit:e.unitId||e.cyUnitId,loading:!1,success:!0}},P=async({idBuilding:e,idRoom:t,page:o,limit:i})=>{try{const r=await ee({idBuilding:e,idRoom:t,offset:o,limit:i});return{code:r.code,codeLanguage:r.codeLanguage,data:r.data.map(d=>be(d)),loadMore:r.readmore}}catch(r){return{code:r.code,codeLanguage:r.codeLanguage,data:[]}}},ke=e=>{var t,o,i;return{id:e.id,key:e.id,name:(e==null?void 0:e.fullName)??"",avatar:e.avatar,type:e.type,unit:{id:(t=e==null?void 0:e.unit)==null?void 0:t.id,name:((o=e==null?void 0:e.unit)==null?void 0:o.name)??""},unitName:((i=e==null?void 0:e.unit)==null?void 0:i.name)??"",idUser:e.userId,role:e.role}},Ae=async(e,t)=>{try{const o=await te(e,t);return{code:o.code,codeLanguage:o.codeLanguage,data:o.data.reduce((i,r)=>(i[r.userId]=ke(r),i),{})}}catch(o){return{code:o.code,codeLanguage:o.codeLanguage,data:[]}}};function Te(){const{currentUser:e}=l.useContext(H),{roomSelected:t}=l.useContext(w),{idBuilding:o,messages:i,setMessages:r}=l.useContext(G),{isUserCs:d}=se(),[a,c]=l.useState({}),[f,u]=l.useState(!1),[x,n]=l.useState({isFetching:!1}),[g,m]=l.useState({isFetching:!1});l.useEffect(()=>(t.id&&((async()=>{n({isFetching:!0});const L=await Ae(o,t.unitId);c(L.data),n({isFetching:!1})})(),(async()=>{m({isFetching:!0});const L=await P({idBuilding:o,idRoom:t.id,limit:I,page:b-1});r([...L.data]),u(L.loadMore),m({isFetching:!1})})()),()=>{}),[t.id]);const y=async()=>{if(!g.isFetching){m({isFetching:!0});const L=await P({idBuilding:o,idRoom:t.id,limit:I,page:i.length+1});L.data.length>0&&r([...L.data,...i]),u(L.loadMore),m({isFetching:!1})}};return[g.isFetching,x.isFetching,f,e.id,i,a,y,d]}var Be={name:"79azp8",styles:"display:flex;flex-direction:column-reverse"},Oe={name:"ti75j2",styles:"margin:0"},_e={name:"974d2w",styles:"position:absolute;top:50%;width:100%;height:100%;text-align:center"};function De(){const[e,t,o,i,r,d,a,c]=Te();return p(N,{dataLength:r.length,next:a,css:Be,inverse:!0,hasMore:o,scrollableTarget:"scrollableListMessage",children:[s(M,{split:!1,dataSource:r,renderItem:(f,u)=>{const{idSender:x}=f,n=d[x],g=u===0?void 0:r[u-1],m=!g||g&&v(g.createdAt).startOf("day").diff(v(f.createdAt).startOf("day"))?v(f.createdAt).format("DD/MM/YYYY"):null;let y="right";return i!==x&&(y="left"),p("div",{children:[m?s(ie,{style:{margin:0},children:s("h5",{css:Oe,children:m})}):null,s(M.Item,{style:{padding:"10px 0px"},children:s(_,{currentUserId:i,currentMember:n,item:f,position:y,isUserCs:c})},u)]},f.id)}}),e||t?s("div",{css:_e,children:s(j,{})}):null]})}var Pe={name:"6v2dj9",styles:"flex-direction:column-reverse"};const Ue=()=>s(R.Wrapper,{children:p(R.Container,{children:[s(R.Header,{borderBottom:!0,children:s(Me,{})}),s(Y.Content,{id:"scrollableListMessage",scrollY:!0,css:Pe,children:s(De,{})})]})}),Ye=()=>s(D,{children:s(Ue,{})}),He=()=>{const{setTitlePage:e,setVisibleFilterBox:t,setVisibleSearchBox:o}=l.useContext(H),[i]=B();return l.useEffect(()=>{e(k.resident_message_archive),t(!1),o(!1),(async()=>await i(b-1,C))()},[]),[]},Ve=()=>(He(),s(R.Wrapper,{gutter:[12,0],style:{flex:1},children:p($,{style:{flex:1},gutter:[0,0],children:[s(E,{span:6,style:{display:"flex",flexDirection:"column",flex:1},children:p(R.Container,{children:[s(R.Header,{children:s(ge,{})}),s(Y.Content,{id:"scrollableListRoom",scrollY:!0,children:s(Le,{})})]})}),s(E,{span:18,style:{display:"flex",flexDirection:"column",flex:1},children:s(Ye,{})})]})})),vs=()=>s(de,{children:s(Ve,{})});export{vs as default};
