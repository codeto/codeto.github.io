import{j as t,a as P,u as ne,c as oe}from"./@emotion-63839449.js";import{r as u}from"./react-4fd50329.js";import{a9 as q,s as V,a1 as re,b0 as ie,aE as le,bv as se,c6 as O,i as K,A as ce,M as z,X as J,e4 as de,j as ue,a3 as pe,l as a,dq as me,a5 as ge,I as he,a as Q,n as be,o as fe}from"./index-c2ded735.js";import{m as X}from"./lodash-88fe09e6.js";import{h as G}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import{P as R,r as Se,j as Z,D as ve,T as ee}from"./index-b17d22e5.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{P as xe}from"./prop-types-1172f4d5.js";import{u as ye}from"./react-router-a4308f7b.js";import{d as Te}from"./downloadFileFromUrl-79614833.js";import{u as we}from"./index-687ba9e6.js";import{B as Ce,w as _e,a as m}from"./antd-f9eae174.js";import{S as y,I as W}from"./index-43183512.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./account-86ffff50.js";import"./index-881eef42.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";const j={time:[G(),G()],fundId:"",apartment:"",code:"",labelId:"",accountantLabelId:""},M="createdAt-desc",ke=({cashbookData:l,servicesData:p,fundsData:s,isUserCs:c})=>l.map(({services:h,funds:d,...b})=>{const o=p.map(e=>e.id).reduce((e,r)=>({...e,[`service-${r}`]:0}),{});h.forEach(e=>{const{id:r}=e;o[`service-${r}`]+=Number(e.total)});const n=s.map(e=>e.id).reduce((e,r)=>({...e,[`fund-${r}`]:0}),{});d.forEach(e=>{const{id:r}=e;n[`fund-${r}`]+=Number(e.total)});const{id:i,code:x,content:f,createdAt:T,unitName:w,unitLabelTitle:C,cashier:_,payer:k,unitAccountRevenue:D=0,unitAccountExpense:E=0,other:N=0,revenue:B=0,expense:A=0,redundancy:F=0,accountantLabelColor:U,accountantLabelTitle:I}=b;return{key:i,code:x,content:f,createdAt:T,apartmentCode:w,customerCode:C,creator:_,payer:c?"***":k,unitAccountRevenue:D,unitAccountExpense:E,...o,other:N,...n,revenue:B,expense:A,redundancy:F,accountantLabelColor:U,accountantLabelTitle:I}}),L=u.createContext({idBuilding:0,getsStatus:{isFetching:!1},setGetsStatus:()=>{},tableDataOverview:{openingBalance:0,closeBalance:0,grossRevenue:0,grossExpense:0},setTableDataOverview:()=>{},tableData:{fundsData:[],servicesData:[],rows:[],serviceTotal:0,fundTotal:0,totalUnitAccountRevenue:0,totalUnitAccountExpense:0,otherTotal:0,totalRecord:0},setTableData:()=>{},tablePagination:{current:q,limit:V},setTablePagination:()=>{},filter:{...j},setFilter:()=>{},cashBookPermissionExport:!1,listLabel:[],setListLabel:()=>{},sortString:M,setSortString:()=>{}}),H=({children:l})=>{var B;const p=ye(),{idBuilding:s}=p,{isUserCs:c}=re(),[g,h]=u.useState({isFetching:!1}),[d,b]=u.useState({openingBalance:0,closeBalance:0,grossRevenue:0,grossExpense:0}),[o,n]=u.useState({fundsData:[],servicesData:[],rows:[],serviceTotal:0,fundTotal:0,totalUnitAccountRevenue:0,totalUnitAccountExpense:0,otherTotal:0,totalRecord:0}),[i,x]=u.useState({current:q,limit:V}),[f,T]=u.useState({...j}),[w,C]=u.useState([]),[_,k]=u.useState(M),{getPermissionByModuleCode:D}=ie(),E=((B=D(le))==null?void 0:B[se])??!1,N={idBuilding:s,getsStatus:g,setGetsStatus:h,tableDataOverview:d,setTableDataOverview:b,tableData:o,setTableData:({fundsData:A,otherTotal:F=0,rows:U,servicesData:I,totalRecord:e,totalUnitAccountExpense:r=0,totalUnitAccountRevenue:Y=0})=>{n({fundsData:A,otherTotal:O(F),rows:ke({cashbookData:U,fundsData:A,servicesData:I,isUserCs:c}),serviceTotal:I.reduce((v,S)=>({...v,[S.id]:S.total}),{}),fundTotal:A.reduce((v,S)=>({...v,[S.id]:S.total}),{}),servicesData:I,totalRecord:e,totalUnitAccountExpense:O(r),totalUnitAccountRevenue:O(Y)})},tablePagination:i,setTablePagination:x,filter:f,setFilter:T,cashBookPermissionExport:E,listLabel:w,setListLabel:C,sortString:_,setSortString:k};return t(L.Provider,{value:N,children:l})};H.propTypes={children:xe.node};H.defaultProps={children:t("div",{})};const De=H,te=`${ue}/cashbook`,Ee=`${te}/export-data`,Ne=async({idBuilding:l,filter:p,page:s,limit:c})=>await K({type:ce,payload:{method:z.GET,apiUrl:te,options:{headers:{[J]:l},params:{...p,page:s,limit:c}}}}),Ae=async({idBuilding:l,filter:p,sort:s})=>await K({type:de,payload:{method:z.GET,apiUrl:Ee,options:{headers:{[J]:l},params:{...p,sort:s}}}});function Ie(){const l=pe(),{idBuilding:p,filter:s,tableData:c,cashBookPermissionExport:g,sortString:h}=u.useContext(L),[d,b]=u.useState({isFetching:!1,code:void 0,codeLanguage:void 0});we(d.code,d.codeLanguage,{message:a.success,description:a.export_data_success});const o=async()=>{b({isFetching:!0,code:void 0,codeLanguage:void 0});try{const{time:i,...x}=s,f=await Ae({filter:{...x,from:i==null?void 0:i[0].startOf("day").toISOString(),to:i==null?void 0:i[1].endOf("day").toISOString()},sort:h,idBuilding:p});b({isFetching:!1,code:f.code,codeLanguage:f.codeLanguage}),f.data&&Te(f.data,document,"thong-tin-so-quy.xlsx")}catch(i){b({isFetching:!1,code:i.code,codeLanguage:i.codeLanguage})}},n=[g?t(Ce,{onClick:()=>{l({action:me,label:ge}),o()},icon:t(he,{name:"icon-download-outlined"}),loading:d.isFetching,disabled:d.isFetching,type:"primary",ghost:!0,children:a.label.export},"export"):null].filter(Boolean);return t(R.ActionBox,{actions:n,total:c.totalRecord})}const ae=()=>{const{idBuilding:l,setTablePagination:p,setTableData:s,setTableDataOverview:c}=u.useContext(L);return[async({filter:h,tablePaginationInp:d,sort:b=M})=>{const{time:o,...n}=h;p({current:d.current,limit:d.limit});const i=await Ne({filter:{...n,from:o==null?void 0:o[0].startOf("day").toISOString(),to:o==null?void 0:o[1].endOf("day").toISOString(),sort:b},idBuilding:l,limit:d.limit,page:d.current}),{openingBalance:x,closeBalance:f,grossRevenue:T,grossExpense:w,funds:C,services:_,rows:k,totalUnitAccountRevenue:D,totalUnitAccountExpense:E,otherTotal:N}=i.data;c({openingBalance:x,closeBalance:f,grossRevenue:T,grossExpense:w}),s({fundsData:C,servicesData:_,rows:k,totalUnitAccountRevenue:D,totalUnitAccountExpense:E,otherTotal:N,totalRecord:i.totalRecord})}]},Oe=()=>{const{fundData:l}=Se(),{labelsCustomerCodeData:p}=Z(),{setGetsStatus:s,setFilter:c,listLabel:g,sortString:h}=u.useContext(L),[d]=ae(),b=async n=>{s({isFetching:!0}),c(n),await d({filter:n,tablePaginationInp:{current:1,limit:V},sort:h}),s({isFetching:!1})},o=u.useMemo(()=>[{label:a.label.time,key:"time",component:t(ve.RangePicker,{placeholder:["DD/MM/YYYY","DD/MM/YYYY"],format:"DD/MM/YYYY",fluid:"true",allowClear:!1,getPopupContainer:n=>n.parentNode}),visible:!0,fixed:!0},{label:a.fund,key:"fundId",component:P(y,{fluid:"true",showSearch:!0,allowClear:!1,placeholder:a.fund,filterOption:(n,i)=>i.children.toLowerCase().indexOf(n.toLowerCase())>=0,getPopupContainer:n=>n.parentNode,children:[t(y.Option,{value:"",children:a.all_fund},"fund_id_0"),l.map(n=>t(y.Option,{value:n.id,children:n.name},n.id))]}),visible:!0},{label:a.unit,key:"apartment",component:t(W,{placeholder:a.unit}),visible:!0},{label:a.label.number_of_document,key:"code",component:t(W,{placeholder:a.label.number_of_document}),visible:!0},{label:a.customer_code,key:"labelId",component:P(y,{fluid:"true",showSearch:!0,allowClear:!1,placeholder:a.customer_code,filterOption:(n,i)=>i.children.toLowerCase().indexOf(n.toLowerCase())>=0,getPopupContainer:n=>n.parentNode,children:[t(y.Option,{value:"",children:a.all_customer_code},"label_id_0"),p.map(n=>t(y.Option,{value:n.id,children:n.title},n.id))]}),visible:!0},{label:a.label1,key:"accountantLabelId",component:P(y,{showSearch:!0,filterOption:(n,i)=>i.children.toLowerCase().includes(n.toLowerCase()),placeholder:a.label1,fluid:"true",getPopupContainer:n=>n.parentNode,children:[t(y.Option,{value:"",children:a.all_label},"label_0"),g==null?void 0:g.map(({id:n,title:i})=>t(y.Option,{value:n,children:i},n))]}),visible:!0}],[l,p,g]);return t(R.FilterBox,{defaultFilter:{...j},onSearch:b,layout:"vertical",filters:o})},Le=150;function Be(){const l=ne(),{layoutScrollRef:p}=u.useContext(Q),[s]=ae(),{tablePagination:c,tableData:g,tableDataOverview:h,getsStatus:d,filter:b,setGetsStatus:o,setSortString:n}=u.useContext(L),{closeBalance:i,grossRevenue:x,grossExpense:f}=h,{fundsData:T,servicesData:w,rows:C,serviceTotal:_,fundTotal:k,totalUnitAccountRevenue:D,totalUnitAccountExpense:E,otherTotal:N,totalRecord:B}=g;u.useEffect(()=>{(async()=>(o({isFetching:!0}),await s({filter:b,tablePaginationInp:{current:c.current,limit:c.limit}}),o({isFetching:!1})))()},[]);const A=async(e,r,Y)=>{let{current:v,limit:S}=c;e!==v&&(v=e),r!==S&&(S=r),o({isFetching:!0}),await s({filter:b,tablePaginationInp:{current:v,limit:r},sort:Y}),o({isFetching:!1})},F=[{title:a.label.number_of_document,rowSpan:2,key:"code",dataIndex:"code",sorter:!0,children:[{rowSpan:0,children:[{title:a.label.total1,dataIndex:"code",key:"code",fixed:!0}]}]},{title:a.label.detail,rowSpan:2,children:[{rowSpan:0,children:[{title:"",dataIndex:"content",key:"content",ellipsis:!0}]}]},{title:a.label.created_at,rowSpan:2,key:"createdAt",dataIndex:"createdAt",sorter:!0,children:[{rowSpan:0,children:[{title:"",dataIndex:"createdAt",key:"createdAt",render:e=>e?G(e).format("DD/MM/YYYY"):""}]}]},{title:a.label.apartment,rowSpan:2,children:[{rowSpan:0,children:[{title:"",dataIndex:"apartmentCode",key:"apartmentCode"}]}]},{title:a.customer_code,rowSpan:2,children:[{rowSpan:0,children:[{title:"",dataIndex:"customerCode",key:"customerCode",ellipsis:!0}]}]},{title:a.label.creator,rowSpan:2,children:[{rowSpan:0,children:[{title:"",dataIndex:"creator",key:"creator",ellipsis:!0}]}]},{title:a.label.payer_or_receiver,rowSpan:2,children:[{rowSpan:0,children:[{title:"",dataIndex:"payer",key:"payer",ellipsis:!0}]}]},{title:a.label1,rowSpan:2,children:[{rowSpan:0,children:[{key:"label",width:180,ellipsis:!0,render:(e,r)=>r!=null&&r.accountantLabelTitle?t(_e,{color:r==null?void 0:r.accountantLabelColor,children:r==null?void 0:r.accountantLabelTitle}):null}]}]},{title:a.label.service_advance_payment,rowSpan:1,children:[{title:a.label.revenue1,rowSpan:1,align:"right",children:[{title:t(m.NegativeNumber,{children:D}),align:"right",dataIndex:"unitAccountRevenue",key:"unitAccountRevenue",render:e=>t(m.Text,{style:{color:e<0?l.color.warning:l.textColor},children:e<0?`(${O(e*-1)})`:O(e)})}]},{title:a.label.expense1,rowSpan:1,align:"right",children:[{title:t(m.NegativeNumber,{children:E}),align:"right",dataIndex:"unitAccountExpense",key:"unitAccountExpense",render:e=>t(m.Text,{style:{color:e<0?l.color.warning:l.textColor},children:e<0?`(${O(e*-1)})`:O(e)})}]}]},{title:a.label.service,rowSpan:1,children:X(w,e=>({title:e.name,rowSpan:1,align:"right",ellipsis:!0,children:[{title:t(m.NegativeNumber,{children:_[e.id]}),dataIndex:`service-${e.id}`,key:`service-${e.id}`,align:"right",render:r=>t(m.NegativeNumber,{children:r})}]}))},{title:a.label.other,rowSpan:2,align:"right",children:[{rowSpan:0,children:[{title:t(m.NegativeNumber,{children:N}),align:"right",dataIndex:"other",key:"other",render:e=>t(m.NegativeNumber,{children:e})}]}]},{title:a.label.fund,rowSpan:1,children:X(T,e=>({title:e.name,rowSpan:1,ellipsis:!0,align:"right",children:[{title:t(m.NegativeNumber,{children:k[e.id]}),dataIndex:`fund-${e.id}`,key:`fund-${e.id}`,align:"right",render:r=>t(m.NegativeNumber,{children:r})}]}))},{title:a.label.actually_revenue,rowSpan:2,colSpan:1,align:"right",children:[{rowSpan:0,children:[{title:t(m.NegativeNumber,{children:x}),align:"right",dataIndex:"revenue",key:"revenue",render:e=>t(m.NegativeNumber,{children:e})}]}]},{title:a.label.actually_expense,rowSpan:2,colSpan:1,align:"right",children:[{rowSpan:0,children:[{title:t(m.NegativeNumber,{children:f}),align:"right",dataIndex:"expense",key:"expense",render:e=>t(m.NegativeNumber,{children:e})}]}]},{title:a.label.redundancy,rowSpan:2,colSpan:1,align:"right",children:[{rowSpan:0,children:[{title:t(m.NegativeNumber,{children:i}),align:"right",dataIndex:"redundancy",key:"redundancy",render:e=>t(m.NegativeNumber,{children:e})}]}]}],U={pageSize:c.limit,defaultCurrent:1,current:c.current,total:B,showQuickJumper:!0,showSizeChanger:!0},I=async(e,r,Y)=>{const{field:v,order:S}=Y;let $=M;v&&S&&($=v&&S?`${v}-${S==="ascend"?"asc":"desc"}`:void 0,n($)),A(e.current,e.pageSize,$)};return t(ee,{bordered:!0,dataSource:C,columns:F,scroll:{x:Le*(13+Object.keys(w).length+Object.keys(T).length)},loading:d.isFetching,pagination:U,sticky:{offsetScroll:l.offsetScrollX,getContainer:()=>p.current},onChange:I,locale:{triggerAsc:a.click_to_sort,triggerDesc:a.ascending_order,cancelSort:a.descending_order}})}function Re(){const{tableDataOverview:l,getsStatus:p}=u.useContext(L),s=[{title:a.label.opening_accounting_balance,dataIndex:"openingBalance",key:"openingBalance",align:"right",render:o=>t(m.NegativeNumber,{children:o})},{title:a.label.gross_revenue,dataIndex:"grossRevenue",key:"grossRevenue",align:"right",render:o=>t(m.NegativeNumber,{children:o})},{title:a.label.gross_expense,dataIndex:"grossExpense",key:"grossExpense",align:"right",render:o=>t(m.NegativeNumber,{children:o})},{title:a.label.closing_accounting_balance,dataIndex:"closeBalance",key:"closeBalance",align:"right",render:o=>t(m.NegativeNumber,{children:o})}],{openingBalance:c,grossRevenue:g,grossExpense:h,closeBalance:d}=l;return t(ee,{bordered:!0,pagination:!1,columns:s,dataSource:[{key:1,openingBalance:c,grossRevenue:g,grossExpense:h,closeBalance:d}],loading:p.isFetching})}const Pe=oe("div",{target:"e1vppg8m0"})({name:"1r0yqr6",styles:"margin-top:10px"}),Fe=()=>{const{setTitlePage:l,setVisibleFilterBox:p,setVisibleSearchBox:s}=u.useContext(Q),{setListLabel:c}=u.useContext(L),{labelData:g}=Z();return u.useEffect(()=>(l(a.cashbook),s(!0),()=>{l(""),s(!1),p(!1)}),[]),u.useEffect(()=>{const h=g.filter(d=>[be,fe].includes(d.type));c(h??[])},[g]),P(R.Wrapper,{children:[t(Oe,{}),P(R.Container,{children:[t(R.Header,{children:t(Ie,{})}),P(R.Content,{children:[t(Re,{}),t(Pe,{children:t(Be,{})})]})]})]})},ba=()=>t(De,{children:t(Fe,{})});export{ba as default};
