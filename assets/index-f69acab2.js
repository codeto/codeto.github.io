import{j as e,u as ke,a as x,b as he,F as te,c as De}from"./@emotion-63839449.js";import{a as oe,N as ce,w as be,P as Z,l as we,D as Ye,d as pt,k as We,T as ht,e as gt}from"./index-b17d22e5.js";import{F as p,u as Se}from"./index-687ba9e6.js";import{l as t,by as Be,a9 as M,s as V,cP as Fe,b0 as ft,K as le,aX as Pe,at as _t,bv as yt,ax as St,f_ as It,I as D,gY as wt,gZ as bt,g_ as Ft,g$ as At,h0 as xt,dw as vt,h1 as Rt,a1 as Nt,a0 as xe,S as Me,cf as Ke,h2 as Ct,a as Je,h3 as Tt,dk as Pt,gb as Xe,h4 as Et,b1 as Ot,h5 as Lt,h6 as kt,h as Ce}from"./index-c2ded735.js";import"./lodash-88fe09e6.js";import{h as E}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import{P as Ue}from"./index-d2c5b7c0.js";import{r as b}from"./react-4fd50329.js";import{P as ne}from"./prop-types-1172f4d5.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{u as ve,a as Dt}from"./react-router-a4308f7b.js";import{F as Yt}from"./file-8888dc2a.js";import{R as j,b as y,a as de,w as Ze,T as pe,I as Bt,B as J,n as Mt,c as $e,A as Ut,S as et}from"./antd-f9eae174.js";import{I as H,S as $}from"./index-43183512.js";import{g as Vt}from"./getPageByTotalAndLimit-7f60b558.js";import{u as zt}from"./useQuery-d54d310a.js";import{T as qt}from"./index-dac0556c.js";import{u as Ht,g as jt,a as $t}from"./buildingConfig-5e834703.js";import{d as Qt}from"./downloadFileFromUrl-79614833.js";import{c as Ve}from"./compareObject-7b349d22.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./index-881eef42.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./classnames-4ba1ba1a.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./@tinymce-4731cc9d.js";const Gt="IN",Wt="OUT",Re=[{label:t.move_in,value:Gt,color:"green"},{label:t.move_out,value:Wt,color:"default"}],Ee=Be(Re,"value"),W="WAITING_FOR_APPROVED",X="APPROVED",tt="IN_PROGRESS",Kt="COMPLETED",ue="CANCELLED",ze="ALL",Oe=[{label:t.waiting_for_approved,value:W},{label:t.approved,value:X},{label:t.transferring,value:tt},{label:t.completed,value:Kt},{label:t.canceled,value:ue},{label:t.all,value:ze}],nt=Be(Oe,"value"),ae={expectedTransportAt:[],unitName:"",code:"",transporterName:"",type:""},Qe="EMPLOYEE",Ge="RESIDENT",Te={[Qe]:{label:t.employee,value:Qe},[Ge]:{label:t.resident,value:Ge}},ge="APPROVE",fe="REJECT",_e="IN_PROGRESS",ye="COMPLETED",Ae="REMOVE",qe="ELEVATOR_RESERVATION",Jt="create",Xt="update",Zt="approved",en="in_progress",tn="completed",nn="cancelled",an=[{label:t.add,value:Jt},{label:t.update,value:Xt},{label:t.approve,value:Zt},{label:t.in_progress,value:en},{label:t.complete,value:tn},{label:t.button.cancel,value:nn}],on=Be(an,"value"),q=b.createContext({tableData:{records:[],totalRecord:0},setTableData:()=>{},getsStatus:{isFetching:!1},setGetsStatus:()=>{},filter:{...ae},setFilter:()=>{},tablePagination:{current:M,limit:V},setTablePagination:()=>{},tableSelection:()=>{},formDetailData:{isShow:!1,data:{}},hideFormDetail:()=>{},showFormDetail:()=>{},showFormAdd:()=>{},hideFormAdd:()=>{},showFormUpdateStatus:()=>{},formUpdateStatusData:{isShow:!1,data:{}},hideFormUpdateStatus:()=>{},status:W,setStatus:()=>{},inventoryTransferSetting:{autoApprove:!1,status:Fe,id:null},setInventoryTransferSetting:()=>{},formConfigData:{isShow:!1,data:{}},showFormConfig:()=>{},hideFormConfig:()=>{},goodsMovingPermissionWrite:!1,goodsMovingPermissionExport:!1,goodsMovingPermissionApprove:!1,goodsMovingPermissionUpdateStatus:!1,formFilter:void 0,idBuilding:void 0,formShowRegulation:{isShow:!1,data:{}},hideFormRegulation:()=>{},showFormRegulation:()=>{},formHistoryInventoryTransfer:{isShow:!1,data:{}},showFormHistoryInventoryTransfer:()=>{},hideFormHistoryInventoryTransfer:()=>{},dataHistory:[],setDataHistory:()=>{},formUpdateInventoryTransfer:{isShow:!1,data:{}},showFormUpdateInventoryTransfer:()=>{},hideFormUpdateInventoryTransfer:()=>{},formConfirmExit:!1,setFormConfirmExit:()=>{}}),He=({children:a})=>{const{getPermissionByModuleCode:i}=ft(),n=ve(),{idBuilding:l}=n,[o]=p.useForm(),[c,s]=b.useState({isFetching:!1}),[u,m]=b.useState({...ae}),[f,w]=b.useState({current:M,limit:V}),[_,A]=b.useState({records:[],totalRecord:0}),[I,R]=b.useState(W),[S,F,d]=le(),[r,h,k]=le(),[P,Y,O]=le(),[L,z,N]=le(),[U,g,v]=le(),[C,B]=b.useState({autoApprove:!1,status:!0,id:null,regulation:""}),[ie,T]=b.useState([]),[K,Q]=b.useState(!1),[se,at,ot]=le(),[rt,it,st]=le(),G=i(Pe),lt=(G==null?void 0:G[_t])??!1,ct=(G==null?void 0:G[yt])??!1,dt=(G==null?void 0:G[St])??!1,ut=(G==null?void 0:G[It])??!1,mt={tableData:_,setTableData:A,getsStatus:c,setGetsStatus:s,filter:u,setFilter:m,tablePagination:f,setTablePagination:w,inventoryTransferSetting:C,setInventoryTransferSetting:B,formDetailData:r,showFormDetail:h,hideFormDetail:k,formUpdateStatusData:P,showFormUpdateStatus:Y,hideFormUpdateStatus:O,status:I,setStatus:R,formAddData:S,showFormAdd:F,hideFormAdd:d,formConfigData:L,showFormConfig:z,hideFormConfig:N,goodsMovingPermissionWrite:lt,goodsMovingPermissionExport:ct,goodsMovingPermissionApprove:dt,goodsMovingPermissionUpdateStatus:ut,formFilter:o,idBuilding:l,formShowRegulation:U,showFormRegulation:g,hideFormRegulation:v,dataHistory:ie,setDataHistory:T,formHistoryInventoryTransfer:se,showFormHistoryInventoryTransfer:at,hideFormHistoryInventoryTransfer:ot,formUpdateInventoryTransfer:rt,showFormUpdateInventoryTransfer:it,hideFormUpdateInventoryTransfer:st,formConfirmExit:K,setFormConfirmExit:Q};return e(q.Provider,{value:mt,children:a})};He.propTypes={children:ne.node};He.defaultProps={children:e("div",{})};const rn=He,sn=()=>{var f;const{formDetailData:a,hideFormDetail:i,showFormRegulation:n}=b.useContext(q),[l]=p.useForm(),o=(f=a==null?void 0:a.data)==null?void 0:f.inventoryTransfer,{images:c}=o,s=w=>{n({inventoryTransfer:w})},m=(w=>w==null?void 0:w.map(({image:_})=>{var I;return{url:_,fileName:_.substring((_==null?void 0:_.lastIndexOf("/"))+1),fileType:_.split(".").pop().toLowerCase(),icon:((I=Yt)==null?void 0:I[_.split(".").pop().toLowerCase()])??_}}))(c);return[i,l,(a==null?void 0:a.data.inventoryTransfer)??{},s,m]},ln=()=>{var s,u;const[a,i,n,l,o]=sn(),c=ke();return e(oe,{open:!0,title:t.detail,onCancel:a,footer:null,width:"65%",children:x(p,{form:i,layout:"vertical",name:"detail",children:[x(j,{gutter:[c.margin.md,c.margin.md],style:{background:"#f7f7f7",padding:"10px 10px 0 10px",marginBottom:"15px"},children:[e(y,{span:"24",css:he({marginBottom:c.margin.sm},"",""),children:e(de.Text,{strong:t.inventory_transfer_info,children:t.inventory_transfer_info})}),e(y,{span:"8",children:e(p.Item,{label:t.registration_code,children:(n==null?void 0:n.code)??"-"})}),e(y,{span:"8",children:e(p.Item,{label:t.transporter_name,children:(n==null?void 0:n.transporterName)??"-"})}),e(y,{span:"8",children:e(p.Item,{label:t.phone,children:(n==null?void 0:n.transporterPhone)??"-"})}),e(y,{span:"8",children:e(p.Item,{label:t.transport_name,children:n!=null&&n.transportName?n==null?void 0:n.transportName:"-"})}),e(y,{span:"8",children:e(p.Item,{label:t.transport_license_number,children:n!=null&&n.transportLicenseNumber?n==null?void 0:n.transportLicenseNumber:"-"})}),e(y,{span:"8",children:e(p.Item,{label:t.transfer_type,children:e(Ze,{color:n==null?void 0:n.inventoryTypeColor,children:(n==null?void 0:n.type)??"-"})})}),e(y,{span:"8",children:e(p.Item,{label:t.expected_transport,children:(n==null?void 0:n.expectedTransportAt)??"-"})}),e(y,{span:"8",children:e(p.Item,{label:t.realtime_transport,children:n!=null&&n.realtime?n==null?void 0:n.realtime:"-"})}),e(y,{span:"8",children:e(p.Item,{label:t.status1,children:((s=nt[(n==null?void 0:n.status)??""])==null?void 0:s.label)??"-"})}),e(y,{span:"8",children:e(p.Item,{label:t.registrant_full_name,children:(n==null?void 0:n.registrantFullName)??"-"})}),e(y,{span:"8",children:e(p.Item,{label:t.unit,children:(n==null?void 0:n.unitName)??"-"})}),e(y,{span:"8",children:e(p.Item,{label:t.registrant_role,children:(n==null?void 0:n.registrantRole)??"-"})})]}),x(j,{gutter:[c.margin.md,c.margin.md],style:{background:"#f7f7f7",padding:"10px 10px 0 10px",marginBottom:"15px"},children:[e(y,{span:"24",css:he({marginBottom:c.margin.sm},"",""),children:e(de.Text,{strong:t.registration_information,children:t.registration_information})}),e(y,{span:"8",children:e(p.Item,{label:t.creator,children:(n==null?void 0:n.employeeName)??"-"})}),e(y,{span:"8",children:e(p.Item,{label:t.created_at,children:n.createdAt})}),e(y,{span:"8",children:e(p.Item,{label:t.approved_at,children:n.approvedAt})}),(n==null?void 0:n.status)===ue?x(te,{children:[e(y,{span:"8",children:e(p.Item,{label:t.cancel_by,children:n.cancelBy||"-"})}),e(y,{span:"8",children:e(p.Item,{label:t.canceler,children:n.canceler||"-"})}),e(y,{span:"8",children:e(p.Item,{label:t.cancel_at,children:n.canceledAt})}),e(y,{span:"8",children:e(p.Item,{label:t.reason,children:(n==null?void 0:n.reason)??"-"})})]}):null,e(y,{span:"24",children:x(p.Item,{label:t.inventory_transfer_regulations,children:[t.agreed,e(de.Text,{strong:!0,onClick:()=>l(n),css:he({marginLeft:c.margin.xs,color:c.color.primary,cursor:"pointer"},"",""),children:t.inventory_transfer_regulations})]})}),e(y,{span:"8",children:e(p.Item,{label:t.note,children:n.note})}),e(y,{span:"24",children:x(p.Item,{label:`${t.commodity} (${t.quantity})`,children:[" ",n.commoditiesInfo]})}),((u=n==null?void 0:n.images)==null?void 0:u.length)>0?x(y,{span:"24",children:[e(de,{children:t.attached_files}),e(j,{gutter:[c.margin.md,c.margin.md],children:o==null?void 0:o.map((m,f)=>e(y,{style:{width:"10%"},children:e(pe,{title:m.fileName,children:x("figure",{className:"upload__item",style:{margin:"15px 0px"},children:[e(Bt,{title:m.fileName,src:m.icon,width:"100%",height:"80px",preview:!1,alt:m.fileName,style:{cursor:"pointer",objectFit:"cover",borderRadius:"5px"}}),e("div",{className:"upload__item__action",style:{zIndex:1e6,width:"100%"},children:e(D,{name:"icon-eye-outlined",style:{fontSize:"20px"},onClick:()=>{Ue.open({url:m.url})}})})]})})},f))})]}):null]})]})})},re=()=>{const{getAllQuery:a,setQuery:i}=zt(),{setTablePagination:n,setStatus:l,setFilter:o,formFilter:c}=b.useContext(q);return{getQueryParamsInventoryTransfer:m=>{var k,P,Y,O;const{limit:f,page:w,status:_,code:A,unitName:I,transporterName:R,type:S,expectedTransportFrom:F,expectedTransportTo:d}=a(),r={pagination:{limit:f&&+f||V,page:w&&+w||M},status:_||W,filter:{code:A||"",unitName:I||"",transporterName:R||"",expectedTransportAt:F&&d&&E(F,"DD/MM/YYYY",!0).isValid()&&E(d,"DD/MM/YYYY",!0).isValid()?[E(F,"DD/MM/YYYY",!0),E(d,"DD/MM/YYYY",!0)]:[],type:S||""}};m&&r.status===W&&(r.status=X),n({limit:r.pagination.limit,current:r.pagination.page}),l(r.status),o({...r.filter}),c.setFieldsValue({...r.filter});const h={limit:r.pagination.limit,page:r.pagination.page,status:r.status,code:(k=r.filter)==null?void 0:k.code,unitName:(P=r.filter)==null?void 0:P.unitName,transporterName:(Y=r.filter)==null?void 0:Y.transporterName,type:(O=r.filter)==null?void 0:O.type,expectedTransportFrom:"",expectedTransportTo:""};return Array.isArray(r.filter.expectedTransportAt)&&r.filter.expectedTransportAt.length&&(h.expectedTransportFrom=E(r.filter.expectedTransportAt[0]).format("DD/MM/YYYY"),h.expectedTransportTo=E(r.filter.expectedTransportAt[1]).format("DD/MM/YYYY")),i(h),r},setQueryParamsInventoryTransfer:({limit:m=V,page:f=M,status:w=W,filter:_=ae})=>{const{code:A="",unitName:I="",transporterName:R="",expectedTransportAt:S=null,type:F=""}=_,d={limit:m,page:f,status:w,code:A,unitName:I,transporterName:R,type:F,expectedTransportFrom:"",expectedTransportTo:""};S&&Array.isArray(S)&&S.length&&(d.expectedTransportFrom=E(S[0]).format("DD/MM/YYYY"),d.expectedTransportTo=E(S[1]).format("DD/MM/YYYY")),i(d)}}},me=async({id:a,body:i={},type:n,idBuilding:l})=>{try{let o=null;switch(n){case ge:o=await xt(a,i,l);break;case fe:o=await At(a,i,l);break;case _e:o=await Ft(a,i,l);break;case ye:o=await bt(a,i,l);break;case Ae:o=await wt(a,i,l);break;default:break}return o}catch(o){return o}},cn=(a,i)=>{var w,_,A,I,R,S,F,d,r,h,k,P,Y,O;const{createdAt:n,startTime:l,endTime:o,expectedTransportAt:c}=a,s=(_=(w=a==null?void 0:a.changeStatusBy)==null?void 0:w[X])==null?void 0:_.time,u=(I=(A=a==null?void 0:a.changeStatusBy)==null?void 0:A[ue])==null?void 0:I.time,m=(F=Te==null?void 0:Te[(S=(R=a==null?void 0:a.changeStatusBy)==null?void 0:R[ue])==null?void 0:S.type])==null?void 0:F.label,f=i?"***":(r=(d=a==null?void 0:a.changeStatusBy)==null?void 0:d[ue])==null?void 0:r.name;return{key:a.id,id:a.id,code:a==null?void 0:a.code,status:a==null?void 0:a.status,transporterName:i?"***":a.transporterName,transporterPhone:i?"***":a.transporterPhone,transportName:i?"***":(a==null?void 0:a.transportName)||"",transportLicenseNumber:(a==null?void 0:a.transportLicenseNumber)??"",registrantFullName:i?"***":((h=a==null?void 0:a.resident)==null?void 0:h.fullName)??"",note:(a==null?void 0:a.note)??"-",typeOrigin:a.type??"",type:Ee[a.type].label,inventoryTypeColor:Ee[a.type].color,expectedTransportAtOrigin:c??"",expectedTransportAt:`${c?E(c).format(ce):""}`,realtime:`${l?E(l).format(ce):""}${o?` - ${E(o).format(ce)}`:""}`,createdAt:n?E(n).format(ce):"-",approvedAt:s?E(s).format(ce):"-",canceledAt:u?E(u).format(ce):"-",cancelBy:m,canceler:f,reason:(a==null?void 0:a.reason)??"-",unitId:(a==null?void 0:a.unitId)??"",unitName:((k=a==null?void 0:a.unit)==null?void 0:k.name)??"-",relationship:(a==null?void 0:a.relationship)??"-",employeeName:i?"***":((P=a==null?void 0:a.employee)==null?void 0:P.fullName)??"-",images:(a==null?void 0:a.images)??[],registrantRole:i?"***":((O=vt[((Y=a==null?void 0:a.resident)==null?void 0:Y.role)??""])==null?void 0:O.name)??"-",commoditiesInfo:a.commodities.map(L=>`${L.name}(${L.quantity})`).join("; "),commodities:a.commodities??[],residentId:(a==null?void 0:a.residentId)??""}},dn=async({filter:a,limit:i,page:n,idBuilding:l,isUserCs:o})=>{const{expectedTransportAt:c=void 0,unitName:s=void 0,code:u=void 0,transporterName:m=void 0,type:f=void 0,status:w=void 0}=a,_={unitName:s,code:u,transporterName:m,type:f,status:w===ze?void 0:w};c&&c.length>1&&(_.expectedTransportAtFrom=E(c[0]).startOf("day").toDate(),_.expectedTransportAtTo=E(c[1]).endOf("day").toDate());const A=await Rt({filter:_,limit:i,page:n,idBuilding:l}),I=A.data.map(S=>cn(S,o)),R=(A==null?void 0:A.totalRecord)??0;return[I,R]},Ie=()=>{const{setTableData:a,idBuilding:i,setGetsStatus:n}=b.useContext(q),{isUserCs:l}=Nt();return[async({filter:c,limit:s,page:u})=>{n({isFetching:!0});const[m,f]=await dn({filter:c,limit:s,page:u,idBuilding:i,isUserCs:l});a({records:m,totalRecord:f}),n({isFetching:!1})}]},un=()=>{var P,Y;const{getInventoryTransferBadges:a}=xe(),{formUpdateStatusData:i,hideFormUpdateStatus:n,filter:l,status:o,tablePagination:c,idBuilding:s,tableData:u}=b.useContext(q),{setQueryParamsInventoryTransfer:m}=re(),[f,w]=b.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),[_]=p.useForm(),[A]=Ie(),I={id:(Y=(P=i==null?void 0:i.data)==null?void 0:P.inventoryTransfer)==null?void 0:Y.id,idBuilding:s};Se(f.code,f.codeLanguage,{message:t.success,description:t.update_data_success});const R=async()=>(I.type=ge,I.body={},await me(I)),S=async()=>{if(await _.validateFields())return I.type=fe,I.body={reason:_.getFieldValue("reason")},await me(I)},F=async()=>{var z,N;const O=((z=_.getFieldValue("images"))==null?void 0:z.fileList)??[],L=((N=O.map(U=>{var g,v;return((v=(g=U==null?void 0:U.response)==null?void 0:g.data)==null?void 0:v.url)??void 0}))==null?void 0:N.filter(Boolean))??[];if(O.length===0||L.length>0&&L.length===O.length)return I.type=_e,I.body={images:L},await me(I)},d=async()=>{var z,N;const O=((z=_.getFieldValue("images"))==null?void 0:z.fileList)??[],L=((N=O.map(U=>{var g,v;return((v=(g=U==null?void 0:U.response)==null?void 0:g.data)==null?void 0:v.url)??void 0}))==null?void 0:N.filter(Boolean))??[];if(O.length===0||L.length>0&&L.length===O.length)return I.type=ye,I.body={images:L},await me(I)},r=async()=>(I.type=Ae,I.body={},await me(I)),h={[ge]:R,[fe]:S,[_e]:F,[ye]:d,[Ae]:r};return[async()=>{if(await _.validateFields()){w({code:void 0,codeLanguage:void 0,isFetching:!0});const L=await h[i.data.type]();if(w({code:L.code||void 0,codeLanguage:L.codeLanguage||void 0,isFetching:!1}),Me.includes(L.code)){const z=Vt(u.totalRecord-1,c.limit,c.current),N=c.current===z;N&&await A({limit:c.limit,page:c.current,filter:{...l,status:o}}),N||m({limit:c.limit,page:z,status:o,filter:{...l}}),await a(s),n()}}},_,f.isFetching,i.data.type]};var mn={name:"1kevbid",styles:"& .ant-upload{width:100%;}"},pn={name:"1kevbid",styles:"& .ant-upload{width:100%;}"};const hn=()=>{const[a,i,n,l]=un(),{hideFormUpdateStatus:o}=b.useContext(q);return x(oe,{title:t.confirm,open:!0,loading:n,okText:t.confirm,cancelText:t.cancel,onOk:a,onCancel:o,okButtonProps:{disabled:n,loading:n},children:[l===ge&&x("p",{children:[t.do_you_want_to_approve_this_registration_form,"?"]}),l===fe&&x(p,{initialValues:{reason:""},form:i,name:"formUpdate",layout:"vertical",children:[e("div",{style:{marginBottom:12},children:x("span",{children:[t.do_you_want_to_reject_this_registration_form,"?"]})}),e(p.Item,{rules:[{required:!0}],name:"reason",label:t.reason,children:e(H.TextArea,{maxLength:"255",placeholder:t.reason,rows:"2"})})]}),l===_e&&x(p,{initialValues:{note:"",images:[]},form:i,name:"formUpdate",layout:"vertical",children:[e("div",{style:{marginBottom:12},children:x("span",{children:[t.transferring,"?"]})}),e(y,{span:"24",children:e(p.Item,{name:"images",label:t.image_attach,children:e(be,{maxCount:5,accept:"image/*",listType:"picture",multiple:!0,module:Pe,css:pn,children:e(J,{block:!0,icon:e(D,{name:"icon-upload-outlined",css:c=>({marginRight:c.marginSm,fontSize:"16px"})}),children:t.image_attach})})})})]}),l===ye&&x(p,{initialValues:{note:"",images:[]},form:i,name:"formUpdate",layout:"vertical",children:[e("div",{style:{marginBottom:12},children:x("span",{children:[t.completed,"?"]})}),e(y,{span:"24",children:e(p.Item,{name:"images",label:t.image_attach,children:e(be,{maxCount:5,accept:"image/*",listType:"picture",multiple:!0,module:Pe,css:mn,children:e(J,{block:!0,icon:e(D,{name:"icon-upload-outlined",css:c=>({marginRight:c.marginSm,fontSize:"16px"})}),children:t.image_attach})})})})]}),l===Ae&&x("p",{children:[t.do_you_want_to_remove_this_access_history,"?"]})]})},gn=async(a,i,n)=>{const l={type:qe,status:i.status?Fe:Ke,autoApprove:i.autoApprove,regulation:i.regulation},{code:o,codeLanguage:c}=await Ht(a,l,n);return[o,c]},fn=()=>{const{getInventoryTransferBadges:a}=xe(),{setQueryParamsInventoryTransfer:i}=re(),{inventoryTransferSetting:n,setInventoryTransferSetting:l,filter:o,hideFormConfig:c,status:s,idBuilding:u}=b.useContext(q),[m,f]=b.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),[w]=p.useForm();Se(m.code,m.codeLanguage,{message:t.success,description:t.update_data_success});const _=async()=>{f({code:void 0,codeLanguage:void 0,isFetching:!0});try{const I={autoApprove:w.getFieldValue("autoApprove"),status:w.getFieldValue("status"),regulation:w.getFieldValue("regulation")};if(I.status&&!I.regulation){Mt.error({message:t.error1,description:t.please_input_regulation_goods_transportation}),f({code:void 0,codeLanguage:void 0,isFetching:!1});return}const[R,S]=await gn(n.id,I,u);l({id:n.id,...I}),s===W&&I.autoApprove&&i({current:M,limit:V,filter:{...o},status:X}),f({code:R,codeLanguage:S,isFetching:!1}),await a(u),c()}catch(I){f({code:I.code,codeLanguage:I.codeLanguage,isFetching:!1})}},A=b.useMemo(()=>({autoApprove:(n==null?void 0:n.autoApprove)??!1,status:(n==null?void 0:n.status)??!0,regulation:(n==null?void 0:n.regulation)??"<p></p>"}),[n]);return[c,w,_,A,m.isFetching]},_n=()=>{const[a,i,n,l,o]=fn();return e(oe,{title:t.setting,open:!0,onOk:n,okText:t.confirm,onCancel:a,cancelText:t.cancel,okButtonProps:{disabled:o,loading:o},width:"70%",children:e(p,{initialValues:l,layout:"vertical",form:i,name:"form_config_data",children:x(j,{gutter:[12,12],children:[e(y,{span:"12",children:e(p.Item,{noStyle:!0,name:"status",valuePropName:"checked",children:e($e,{children:t.active})})}),e(y,{span:"12",children:e(p.Item,{noStyle:!0,name:"autoApprove",valuePropName:"checked",children:e($e,{children:t.auto_approve_registration_form_of_resident})})}),x(y,{span:"24",children:[t.regulation,e(p.Item,{name:"regulation",children:e(qt,{height:"400",placeholder:t.regulation,initialContent:l.regulation})})]})]})})})},yn=async(a,i)=>{const{expectedTransportAt:n=void 0,unitName:l=void 0,code:o=void 0,transporterName:c=void 0,type:s=void 0,status:u=void 0}=a,m={unitName:l,code:o,transporterName:c,type:s,status:u===ze?void 0:u};n&&n.length>1&&(m.expectedTransportAtFrom=E(n[0]).startOf("day").toDate(),m.expectedTransportAtTo=E(n[1]).endOf("day").toDate());const f=await Ct(m,i);return{data:f.data,code:f.code}},Sn=()=>{const a=ve(),{idBuilding:i}=a,{filter:n,tableData:l,status:o,showFormAdd:c,showFormConfig:s,goodsMovingPermissionExport:u,goodsMovingPermissionWrite:m,goodsMovingPermissionApprove:f}=b.useContext(q),[w,_]=b.useState({code:void 0,codeLanguage:void 0,isFetching:!1});Se(w.code,w.codeLanguage,{message:t.success,description:t.export_data_success});const A=async()=>{_({code:void 0,codeLanguage:void 0,isFetching:!0});const F=await yn({...n,status:o},i);F.data&&Qt(F.data,document,"thong-tin-lich-su-chuyen-do.xlsx"),_({code:F.code,codeLanguage:F.codeLanguage,isFetching:!1})},{totalRecord:I}=l;return{onClickBtnExportDataInventoryTransfers:A,totalRecord:I,inventoryTransferExportState:w,onClickBtnAdd:()=>{c()},onClickBtnConfig:()=>{s()},goodsMovingPermissionExport:u,goodsMovingPermissionWrite:m,goodsMovingPermissionApprove:f}},In=()=>{const{onClickBtnExportDataInventoryTransfers:a,totalRecord:i,inventoryTransferExportState:n,onClickBtnAdd:l,onClickBtnConfig:o,goodsMovingPermissionExport:c,goodsMovingPermissionWrite:s,goodsMovingPermissionApprove:u}=Sn(),m=[u?e(J,{onClick:o,type:"primary",ghost:!0,icon:e(D,{name:"icon-setting-outlined"}),css:f=>({marginRight:f.margin.xs}),children:t.setting},"setting"):null,c?e(J,{type:"primary",ghost:!0,loading:n.isFetching,icon:e(D,{name:"icon-download-outlined"}),onClick:a,css:f=>({marginRight:f.margin.xs}),children:t.export},"export"):null,s?e(J,{onClick:l,type:"primary",icon:e(D,{name:"icon-plus-circle-outlined"}),children:t.add},"add"):null].filter(Boolean);return e(Z.ActionBox,{total:e(te,{children:i}),actions:m})},wn=()=>{const{status:a,formFilter:i,filter:n,tablePagination:l}=b.useContext(q),{setQueryParamsInventoryTransfer:o}=re(),[c]=Ie();return[async u=>{const m=Ve(u,n);m&&await c({filter:{...u,status:a},limit:l.limit,page:l.current}),m||o({limit:V,page:M,filter:{...u},status:a})},ae,i]},bn=()=>{const[a,i,n]=wn(),l=b.useMemo(()=>[{label:t.registration_code,key:"code",component:e(H,{placeholder:t.registration_code}),visible:!0},{label:t.unit,key:"unitName",component:e(H,{placeholder:t.unit}),visible:!0},{label:t.transporter_name,key:"transporterName",component:e(H,{placeholder:t.transporter_name}),visible:!0},{label:t.transfer_type,key:"type",component:x($,{fluid:"true",placeholder:t.transfer_type,getPopupContainer:o=>o.parentNode,children:[e($.Option,{value:"",children:t.all_type},"guest_type_0"),Re.map(o=>e($.Option,{value:o.value,children:o.label},o.value))]}),visible:!0},{label:t.expected_transport,key:"expectedTransportAt",component:e(Ye.RangePicker,{fluid:"true",placeholder:[we,we],format:[we,we],getPopupContainer:o=>o.parentNode}),visible:!0}],[]);return e(Z.FilterBox,{defaultFilter:i,filters:l,onSearch:a,formData:n})},Fn=()=>{const{setTablePagination:a,filter:i,inventoryTransferSetting:n,setStatus:l,status:o}=b.useContext(q),{setQueryParamsInventoryTransfer:c}=re(),s=async m=>{m!==o&&(l(m),a({current:M,limit:V}),c({limit:V,page:M,status:m,filter:i}))};b.useEffect(()=>{o===W&&(n!=null&&n.autoApprove)&&l(X)},[n,o]);const u=b.useMemo(()=>n!=null&&n.autoApprove?Oe.filter(m=>m.value!==W):Oe,[n]);return[s,u,o]},An=()=>{const[a,i,n]=Fn();return e(Z.Tabs,{activeKey:n,onTabChange:a,tabs:i})},xn=()=>{const{getsStatus:a,tablePagination:i,tableData:n,filter:l,showFormDetail:o,showFormUpdateStatus:c,goodsMovingPermissionApprove:s,goodsMovingPermissionUpdateStatus:u,status:m,goodsMovingPermissionWrite:f,showFormUpdateInventoryTransfer:w,showFormHistoryInventoryTransfer:_}=b.useContext(q),{layoutScrollRef:A}=b.useContext(Je),I=ke(),{setQueryParamsInventoryTransfer:R}=re(),S=async(N,U)=>{let{current:g,limit:v}=i;N!==g&&(g=N),U!==v&&(v=U,g=M),R({limit:v,page:g,status:m,filter:l})},F=N=>{o({inventoryTransfer:N})},d=N=>{c({inventoryTransfer:N,type:ge})},r=N=>{c({inventoryTransfer:N,type:fe})},h=N=>{c({inventoryTransfer:N,type:_e})},k=N=>{c({inventoryTransfer:N,type:ye})},P=N=>{_({inventoryTransfer:N})},Y=N=>{w({inventoryTransfer:N})},O={pageSize:i.limit,defaultCurrent:M,current:i.current,total:n.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:S},L={offsetScroll:I.offsetScrollX,getContainer:()=>A.current},z=b.useMemo(()=>![W,X].includes(m),[m]);return{onClickBtnDetail:F,onClickBtnApprove:d,onClickBtnReject:r,onClickBtnInprogress:h,onClickBtnCompleted:k,sticky:L,dataSource:n.records,inventoryTransferTablePagination:O,loading:a.isFetching,isShowRealTime:z,goodsMovingPermissionApprove:s,goodsMovingPermissionUpdateStatus:u,goodsMovingPermissionWrite:f,onClickBtnHistory:P,onClickBtnUpdate:Y}},vn=()=>{const{onClickBtnDetail:a,onClickBtnApprove:i,onClickBtnReject:n,onClickBtnInprogress:l,onClickBtnCompleted:o,sticky:c,dataSource:s,inventoryTransferTablePagination:u,loading:m,isShowRealTime:f,goodsMovingPermissionApprove:w,goodsMovingPermissionUpdateStatus:_,goodsMovingPermissionWrite:A,onClickBtnHistory:I,onClickBtnUpdate:R}=xn(),S=[{title:t.registration_code,key:"code",dataIndex:"code",width:150,fixed:"left"},{title:t.unit,key:"unitName",dataIndex:"unitName",width:100,fixed:"left"},{title:t.registrant_full_name,key:"registrantFullName",dataIndex:"registrantFullName",width:150},{title:t.registrant_role,key:"registrantRole",dataIndex:"registrantRole",width:150},{title:t.transporter_name,key:"transporterName",dataIndex:"transporterName",width:150},{title:t.phone,key:"transporterPhone",dataIndex:"transporterPhone",width:120},{title:t.transport_name,key:"transportName",dataIndex:"transportName",width:150},{title:t.transport_license_number,key:"transportLicenseNumber",dataIndex:"transportLicenseNumber",width:200},{title:t.transfer_type,key:"type",dataIndex:"type",width:120,render:(d,r)=>d?e(Ze,{color:r==null?void 0:r.inventoryTypeColor,children:d}):null},{title:t.expected_transport,key:"expectedTransportAt",dataIndex:"expectedTransportAt",width:200},f?{title:t.realtime_transport,key:"realtime",dataIndex:"realtime",width:250}:null,{title:t.action,key:"action",dataIndex:"action",width:170,align:"center",fixed:"right",render:(d,r)=>x(te,{children:[e(D,{onClick:()=>a(r),name:"icon-eye-outlined",css:h=>({fontSize:h.iconSize}),title:t.detail}),e(D,{title:t.history,css:h=>({fontSize:h.iconSize,marginLeft:h.margin.xs,marginRight:h.marginXs}),name:"icon-history-filled",onClick:()=>I(r)}),A&&![W,ue].includes(r==null?void 0:r.status)?e(D,{title:t.update_visitor,onClick:()=>{R(r)},name:"icon-edit-outlined",css:h=>({fontSize:h.iconSize,marginLeft:h.margin.xs,marginRight:h.marginXs})}):null,(r==null?void 0:r.status)===W&&w?x(te,{children:[e(D,{css:h=>({marginLeft:h.margin.xs,fontSize:h.iconSize}),onClick:()=>i(r),name:"icon-check-outlined",title:t.confirm}),e(D,{onClick:()=>n(r),name:"icon-close-circle-outlined",css:h=>({marginLeft:h.margin.xs,fontSize:h.iconSize}),title:t.reject})]}):null,(r==null?void 0:r.status)===X&&_?e(te,{children:e(D,{css:h=>({marginLeft:h.margin.xs,fontSize:h.iconSize}),onClick:()=>l(r),name:"icon-exit-to-app-outlined",title:t.transferring})}):null,(r==null?void 0:r.status)===X&&w?e(te,{children:e(D,{css:h=>({marginLeft:h.margin.xs,fontSize:h.iconSize}),onClick:()=>n(r),name:"icon-close-circle-outlined",title:t.reject})}):null,(r==null?void 0:r.status)===tt&&_?e(te,{children:e(D,{css:h=>({marginLeft:h.margin.xs,fontSize:h.iconSize}),onClick:()=>o(r),name:"icon-export-outlined",title:t.complete})}):null]})}].filter(Boolean),F={x:S.reduce((d,r)=>r+d.width,0),scrollToFirstRowOnChange:!0};return e(Z.Table,{sticky:c,scroll:F,columns:S,dataSource:s,loading:m,pagination:u})};var Rn={name:"99halj",styles:"color:#2424f3"};const Nn=De("span",{target:"e1i050kk0"})("cursor:pointer;width:85%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;",a=>a.isUploaded&&Rn,";"),je=({file:a,handlePreviewAttachment:i})=>e(Nn,{title:a.name,onClick:()=>i(a),children:a.name});je.propTypes={file:ne.objectOf(ne.any),handlePreviewAttachment:ne.func};je.defaultProps={file:{},handlePreviewAttachment:()=>{}};const Cn=De("div",{target:"efewlw40"})({name:"seoft9",styles:"display:flex;justify-content:space-between;margin:10px;&:hover{background:#f7f7f7;}"}),Ne=({file:a,handlePreviewAttachment:i,handleRemoveFile:n})=>{const l=ke();return x(Cn,{children:[x(j,{style:{flexFlow:"row"},children:[e(D,{name:"icon-attachment-outlined",css:he({fontsize:l.iconSize,marginRight:l.margin.xs},"","")}),e(je,{file:a,handlePreviewAttachment:i})]}),e(D,{name:"icon-delete-outlined",css:he({fontsize:l.iconSize,marginLeft:l.margin.xs},"",""),onClick:()=>{n(a==null?void 0:a.uid)}})]},a)};Ne.propTypes={file:ne.objectOf(ne.any),handlePreviewAttachment:ne.func,handleRemoveFile:ne.func};Ne.defaultProps={file:{},handlePreviewAttachment:()=>{},handleRemoveFile:()=>{}};const Tn=async(a,i)=>{try{const{expectedTransportAt:n,phone:l,files:o,unit:c,type:s,note:u,resident:m}=a,f={transporterName:(a==null?void 0:a.transporterName)??"",transporterPhone:`${l.countryCode}${l.phoneNumber}`,transportName:(a==null?void 0:a.transportName)??"",transportLicenseNumber:(a==null?void 0:a.transportLicenseNumber)??"",expectedTransportAt:n?E(n).toDate():void 0,images:o||[],commodities:(a==null?void 0:a.commodities)??[],unitId:c||null,type:s,note:u||null,residentId:m||null};return await Tt(f,i)}catch(n){return n}},Le=async({filter:a,limit:i,page:n,idBuilding:l})=>{try{return await Pt({filter:a,limit:i,page:n,idBuilding:l})}catch(o){return o}},Pn=()=>{const a=ve(),{idBuilding:i}=a,[n]=p.useForm(),{getInventoryTransferBadges:l}=xe(),{setQueryParamsInventoryTransfer:o}=re(),{hideFormAdd:c,tablePagination:s,filter:u,status:m,formConfirmExit:f,setFormConfirmExit:w}=b.useContext(q),[_]=Ie(),[A,I]=b.useState({data:[],isFetching:!1}),[R,S]=b.useState({data:[],isFetching:!1}),[F,d]=b.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),[r,h]=b.useState([]),k=({file:g,fileList:v})=>{let C=v;g.status==="removed"&&(C=v),(g.status==="done"||g.status==="uploading")&&(C=v),g.status||(C=v.filter(B=>B.uid!==g.uid)),h(C.filter(B=>["done","uploading"].includes(B.status)))},P=g=>{var v,C;Ue.open({url:(C=(v=g==null?void 0:g.response)==null?void 0:v.data)==null?void 0:C.url})},Y=g=>{const v=r.filter(C=>C.uid!==g);h(v)};b.useEffect(()=>{(async()=>{I({data:[],isFetching:!0});const g=await Le({idBuilding:i,limit:V,page:M,filter:{name:void 0}});I({data:g.data,isFetching:!1})})()},[]);const O=async g=>{I({...A,isFetching:!0});const v=await Le({idBuilding:i,limit:V,page:M,filter:{name:g||void 0}});I({data:v.data,isFetching:!1})};Se(F.code,F.codeLanguage,{message:t.success,description:t.add_data_success});const L=async()=>{var ie;const g=await n.validateFields(),v=n.getFieldsValue(),C=n.getFieldValue("inventoryTransferFiles");let B=[];if(r!=null&&r.length?B=(r==null?void 0:r.map(T=>{var K,Q;return((Q=(K=T==null?void 0:T.response)==null?void 0:K.data)==null?void 0:Q.url)??(T==null?void 0:T.url)}))??[]:B=((ie=C==null?void 0:C.map(T=>(T==null?void 0:T.url)??null))==null?void 0:ie.filter(Boolean))??[],g){d({code:void 0,codeLanguage:void 0,isFetching:!0});const T=await Tn({...v,files:B},i);if(d({code:T.code,codeLanguage:T.codeLanguage,isFetching:!1}),Me.includes(T.code)){const K={limit:s.limit,page:s.current,filter:{...u},status:m},Q={limit:V,page:M,filter:{...ae},status:X},se=Ve(Q,K);se&&await _({limit:V,page:M,filter:{...ae,status:X}}),se||o({...Q}),await l(i),c()}}},z=g=>{if(w(!0),g!=null&&g.unit){S({...R,isFetching:!0});const v=A.data.find(C=>C.id===g.unit);S({data:(v==null?void 0:v.residents)??[],isFetching:!1}),n.setFieldsValue({resident:void 0})}},N=()=>{f?oe.confirm({cancelText:t.cancel,okText:t.confirm,title:t.confirm,content:t.the_content_you_enter_has_not_been_saved_are_you_sure_you_want_to_exit_this_screen,onOk:()=>{w(!1),c()}}):c()},U={transporterName:void 0,type:void 0,phone:void 0,unit:void 0,transportName:void 0,transportLicenseNumber:void 0,expectedTransportAt:void 0,images:[],commodities:[{name:void 0,quantity:void 0}],note:void 0,resident:void 0};return[N,L,n,F.isFetching,A.isFetching,A.data,O,Re,R.data,R.isFetching,z,P,r,k,Y,U]};var En={name:"1kevbid",styles:"& .ant-upload{width:100%;}"};const On=()=>{const[a,i,n,l,o,c,s,u,m,f,w,_,A,I,R,S]=Pn(),F=x(j,{style:{justifyContent:"space-between",alignItems:"center"},children:[e(de.Text,{children:t.add_transfer_registration_form}),x(j,{children:[e(J,{onClick:a,style:{marginRight:10},children:t.cancel}),e(J,{type:"primary",onClick:i,disabled:l,loading:l,children:t.add})]})]}),d=e(y,{span:"24",style:{textAlign:"left"},children:e(Ut,{message:t.after_create_inventory_transfer_will_show_in_tab_approved,type:"warning",showIcon:!0,closable:!0})});return e(oe,{title:F,onCancel:a,open:!0,width:"55%",bodyStyle:{maxHeight:"450px",overflowY:"scroll"},footer:d,closable:!1,closeIcon:null,children:e(p,{initialValues:S,form:n,name:"formAdd",layout:"vertical",onValuesChange:w,children:x(j,{gutter:[12,12],children:[e(y,{span:"12",children:e(p.Item,{rules:[{required:!0}],label:t.transporter_name,name:"transporterName",children:e(H,{fluid:"true",placeholder:t.transporter_name})})}),e(y,{span:"12",children:e(p.Item,{name:"phone",label:t.label.phone,rules:[{required:!0},{validator:async(r,h)=>h&&h.phoneNumber&&!Xe(h.phoneNumber)?Promise.reject(t.status.phone_invalid):Promise.resolve()}],children:e(H.PhoneInput,{placeholder:t.label.phone})})}),e(y,{span:"12",children:e(p.Item,{rules:[{required:!0}],label:t.transfer_type,name:"type",children:e($,{placeholder:t.label.type,filterOption:!1,style:{width:"100%"},children:u==null?void 0:u.map(({label:r,value:h})=>e($.Option,{value:h,children:r},h))})})}),e(y,{span:"12",children:e(p.Item,{rules:[{required:!0}],label:t.transport_name,name:"transportName",children:e(H,{fluid:"true",placeholder:t.transport_name})})}),e(y,{span:"12",children:e(p.Item,{label:t.transport_license_number,name:"transportLicenseNumber",children:e(H,{fluid:"true",placeholder:t.transport_license_number})})}),e(y,{span:"12",children:e(p.Item,{dependencies:["expectedTransportAt"],rules:[{required:!0},({getFieldValue:r})=>({validator(h,k){const P=r("expectedTransportAt");return k&&E(k).startOf("day").isBefore(E().startOf("day"))?Promise.reject(t.expected_incoming_at_must_greater_or_equal_than_current_date):P&&k&&E(k).isAfter(P)?Promise.reject(t.expected_incoming_at_must_lower_or_equal_than_expected_leaving_at):Promise.resolve()}})],label:t.expected_transport,name:"expectedTransportAt",children:e(Ye,{fluid:"true",placeholder:"HH:mm DD/MM/YYYY",format:"HH:mm DD/MM/YYYY",showTime:{format:"HH:mm DD/MM/YYYY"}})})}),e(y,{span:"12",children:e(p.Item,{rules:[{required:!0}],label:t.unit,name:"unit",children:e($,{allowClear:!0,showSearch:!0,placeholder:t.label.select_apartment,filterOption:!1,loading:o,onSearch:pt(s),style:{width:"100%"},dropdownRender:r=>o?e("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:e(et,{})}):r,children:c==null?void 0:c.map(({id:r,name:h})=>e($.Option,{value:r,children:h},r))})})}),e(y,{span:"12",children:e(p.Item,{rules:[{required:!0}],label:t.resident,name:"resident",children:e($,{allowClear:!0,showSearch:!0,placeholder:t.label.select_resident,filterOption:!1,loading:f,style:{width:"100%"},children:m==null?void 0:m.map(({id:r,fullName:h})=>e($.Option,{value:r,children:h},r))})})}),e(y,{span:"24",children:e(p.Item,{label:t.note,name:"note",children:e(H.TextArea,{maxLength:"255",fluid:"true",placeholder:t.note,rows:"3"})})}),e(y,{span:"24",children:e(p.List,{name:"commodities",children:(r,{add:h,remove:k})=>r.map(P=>x(j,{gutter:[12,12],style:{width:"100%"},children:[e(y,{flex:"1 0 0",style:{width:"100%"},children:x(j,{gutter:[8,8],children:[e(y,{span:16,children:e(p.Item,{name:[P.name,"name"],fieldKey:[P.fieldKey,"name"],rules:[{required:!0}],label:t.commodity_name,children:e(H,{fluid:"true",placeholder:t.commodity_name})},P.key)}),e(y,{span:8,children:e(p.Item,{name:[P.name,"quantity"],fieldKey:[P.fieldKey,"quantity"],rules:[{required:!0}],label:t.label.quantity,children:e(We,{placeholder:t.label.quantity,min:1,max:100})},P.key)})]})}),e(y,{children:e(p.Item,{label:e("div",{}),children:x("div",{style:{width:"50px",height:"32px",display:"flex",flexDirection:"row",alignItems:"center"},children:[e(D,{onClick:()=>{r.length>1&&k(P.name)},name:"icon-minus-circle-outlined",css:Y=>({fontSize:Y.fontSize.md})}),P.name!==r.length-1?null:e(D,{onClick:()=>{h({name:void 0,quantity:void 0})},name:"icon-plus-circle-outlined",css:Y=>({marginLeft:Y.margin.sm,fontSize:Y.fontSize.md})})]})})})]},P.key))})}),x(y,{span:"24",children:[e(p.Item,{name:"inventoryTransferFiles",label:t.attached_files,children:e(be,{multiple:!0,maxCount:"10",css:En,onPreview:_,limitSizeFile:5,isUploadAllFile:!0,fileList:A,onChange:I,showUploadList:!1,children:e(J,{icon:e(D,{name:"icon-attachment-outlined",css:r=>({fontsize:r.iconSize})}),type:"primary",ghost:!0,block:!0,size:"default",children:t.attachments})})}),A.map(r=>e(Ne,{file:r,handlePreviewAttachment:_,handleRemoveFile:R})),x("i",{css:r=>({fontSize:r.fontSize.sm,color:r.labelColor}),children:["* ",t.file_format]})]})]})})})},Ln=async({filter:a,limit:i,page:n,idBuilding:l})=>{try{return await Et({filter:a,limit:i,page:n,idBuilding:l})}catch(o){return o}},kn=()=>{const{idBuilding:a,hideFormRegulation:i}=b.useContext(q),[n]=p.useForm(),[l,o]=b.useState(""),[c,s]=b.useState(!1);return b.useEffect(()=>{(async()=>{s(!0);const u=await Ln({idBuilding:a,limit:V,page:M,filter:{name:void 0}});o(u==null?void 0:u.data),s(!1)})()},[]),[i,l,c,n]},Dn=()=>{const[a,i,n,l]=kn();return e(oe,{title:t.inventory_transfer_regulations,cancelText:t.close,onCancel:a,onClose:!1,footer:null,open:!0,width:"60%",style:{zIndex:1e6},children:e(p,{form:l,name:"formRegulation",layout:"vertical",children:n?e(Ot,{isLoading:n}):e(j,{gutter:[0,0],dangerouslySetInnerHTML:{__html:i}})})})},Yn=a=>{var u,m,f,w;const{id:i,employee:n,action:l,currentData:o,actionDate:c}=a;return{...a,id:i??"",creator:(n==null?void 0:n.fullName)??"",actionName:l!=null&&l.toLowerCase()?(u=on[l==null?void 0:l.toLowerCase()])==null?void 0:u.label:"",time:c?(m=E(c))==null?void 0:m.format(ce):"",status:((f=nt[o==null?void 0:o.status])==null?void 0:f.label)??"",transporterName:(o==null?void 0:o.transporterName)??"",phone:(o==null?void 0:o.transporterPhone)??"",type:((w=Ee[o==null?void 0:o.type])==null?void 0:w.label)??"",transportName:(o==null?void 0:o.transportName)??"",commodity:o.commodities.map(_=>`${_.name}(${_.quantity})`).join("; "),note:(o==null?void 0:o.note)??"",transportLicenseNumber:(o==null?void 0:o.transportLicenseNumber)??""}},Bn=async({idBuilding:a,inventoryTransferId:i,filter:n,limit:l,page:o})=>{try{const{code:c,data:s,codeLanguage:u}=await Lt({idBuilding:a,inventoryTransferId:i,filter:n,limit:l,page:o});return{code:c,codeLanguage:u,data:s==null?void 0:s.map(m=>Yn(m))}}catch({code:c,codeLanguage:s}){return{code:c,codeLanguage:s,data:[]}}},Mn=()=>{var _;const{formHistoryInventoryTransfer:a,hideFormHistoryInventoryTransfer:i,idBuilding:n,dataHistory:l,setDataHistory:o}=b.useContext(q),[c,s]=b.useState({current:M,limit:V}),[u,m]=b.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),f=(_=a==null?void 0:a.data)==null?void 0:_.inventoryTransfer;b.useEffect(()=>{(async()=>{m({code:void 0,codeLanguage:void 0,isFetching:!0});const A=await Bn({idBuilding:n,inventoryTransferId:f==null?void 0:f.id,limit:c.limit,page:c.current});o((A==null?void 0:A.data)??[]),s({current:M,limit:V}),m({code:A.code,codeLanguage:A.codeLanguage,isFetching:!1})})()},[]);const w={scrollToFirstRowOnChange:!0};return{dataSource:l,totalRecord:l==null?void 0:l.length,hideFormHistoryInventoryTransfer:i,loading:u.isFetching,scroll:w}},ee=De("div",{target:"e1rzgsbs0"})({name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"}),Un=()=>{const{dataSource:a,totalRecord:i,hideFormHistoryInventoryTransfer:n,loading:l,scroll:o}=Mn(),c=[{title:t.the_operator,key:"creator",dataIndex:"creator",width:180,align:"left",fixed:"left",render:(s,u)=>(s==null?void 0:s.length)>20?e(pe,{title:s,placement:"topLeft",children:e(ee,{children:s})}):e(ee,{children:s})},{title:t.operation,key:"actionName",dataIndex:"actionName",width:100,align:"left"},{title:t.time,key:"time",dataIndex:"time",width:150,align:"left"},{title:t.status1,key:"status",dataIndex:"status",width:150,align:"left"},{title:t.transporter_name,key:"transporterName",dataIndex:"transporterName",width:180,align:"left",render:(s,u)=>(s==null?void 0:s.length)>20?e(pe,{title:s,placement:"topLeft",children:e(ee,{children:s})}):e(ee,{children:s})},{title:t.phone,key:"phone",dataIndex:"phone",width:120,align:"left"},{title:t.transfer_type,key:"type",dataIndex:"type",width:150,align:"left"},{title:t.transport_name,key:"transportName",dataIndex:"transportName",width:120,align:"center"},{title:`${t.commodity} (${t.quantity})`,key:"commodity",dataIndex:"commodity",width:150,align:"center",render:(s,u)=>(s==null?void 0:s.length)>20?e(pe,{title:s,placement:"topLeft",children:e(ee,{children:s})}):e(ee,{children:s})},{title:t.note,key:"note",dataIndex:"note",width:120,align:"center",render:(s,u)=>(s==null?void 0:s.length)>20?e(pe,{title:s,placement:"topLeft",children:e(ee,{children:s})}):e(ee,{children:s})},{title:t.transport_license_number,key:"transportLicenseNumber",dataIndex:"transportLicenseNumber",width:120,align:"center",fixed:"right"}];return x(oe,{title:t.history_registration_inventory_transfer,footer:null,open:!0,onCancel:n,width:"80%",children:[e(Z.ActionBox,{total:i}),e(ht,{loading:l,columns:c,dataSource:a,bordered:!0,pagination:!1,scroll:{...o,x:c.reduce((s,u)=>s+ +((u==null?void 0:u.width)??0),0)}})]})},Vn=async(a,i,n,l)=>{try{const{transporterName:o,transportName:c,phone:s,transportLicenseNumber:u,expectedTransportAt:m,files:f,commodities:w,unit:_,type:A,note:I,resident:R}=a,S={transporterName:o??"",transporterPhone:`${s.countryCode}${s.phoneNumber}`,transportName:c??"",transportLicenseNumber:u??"",expectedTransportAt:m?E(m).toDate():void 0,images:f,commodities:w??[],unitId:_||null,type:A,note:I||null,residentId:R||null};return await kt(S,n,l)}catch(o){return o}},zn=()=>{var z,N,U;const a=ve(),{idBuilding:i}=a,[n]=p.useForm(),{getInventoryTransferBadges:l}=xe(),{setQueryParamsInventoryTransfer:o}=re(),{formUpdateInventoryTransfer:c,hideFormUpdateInventoryTransfer:s,tablePagination:u,filter:m,status:f}=b.useContext(q),[w]=Ie(),[_,A]=b.useState({data:[],isFetching:!1}),[I,R]=b.useState({data:[],isFetching:!1}),[S,F]=b.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),d=(z=c==null?void 0:c.data)==null?void 0:z.inventoryTransfer,[r,h]=b.useState(((N=d==null?void 0:d.images)==null?void 0:N.map(({image:g})=>({url:g,status:"done",name:g,isUploaded:!0})))??[]),k=({file:g,fileList:v})=>{let C=v;g.status==="removed"&&(C=v),(g.status==="done"||g.status==="uploading")&&(C=v),g.status||(C=v.filter(B=>B.uid!==g.uid)),h(C.filter(B=>["done","uploading"].includes(B.status)))},P=g=>{var C,B;const v=((B=(C=g==null?void 0:g.response)==null?void 0:C.data)==null?void 0:B.url)||(g==null?void 0:g.url);Ue.open(v?{url:v}:"")},Y=g=>{const v=r.filter(C=>C.uid!==g);h(v)};b.useEffect(()=>{(async()=>{A({data:[],isFetching:!0});const g=await Le({idBuilding:i,limit:V,page:M,filter:{id:d==null?void 0:d.unitId}});A({data:g.data,isFetching:!1})})()},[]),b.useEffect(()=>{(async()=>{R({...I,isFetching:!0});const g=_.data.find(v=>v.id===d.unitId);R({data:(g==null?void 0:g.residents)??[],isFetching:!1})})()},[_]),Se(S.code,S.codeLanguage,{message:t.success,description:t.update_data_success});const O=async()=>{var ie;const g=await n.validateFields(),v=n.getFieldsValue(),C=n.getFieldValue("inventoryTransferFiles");let B=[];if(r!=null&&r.length?B=(r==null?void 0:r.map(T=>{var K,Q;return((Q=(K=T==null?void 0:T.response)==null?void 0:K.data)==null?void 0:Q.url)??(T==null?void 0:T.url)}))??[]:B=((ie=C==null?void 0:C.map(T=>(T==null?void 0:T.url)??null))==null?void 0:ie.filter(Boolean))??[],g){F({code:void 0,codeLanguage:void 0,isFetching:!0});const T=await Vn({...v,files:B},d==null?void 0:d.unitId,d==null?void 0:d.id,i);if(F({code:T.code,codeLanguage:T.codeLanguage,isFetching:!1}),Me.includes(T.code)){const K={limit:u.limit,page:u.current,filter:{...m},status:f},Q={limit:V,page:M,filter:{...ae},status:f},se=Ve(Q,K);se&&await w({limit:V,page:M,filter:{...ae,status:f}}),se||o({...Q}),await l(i),s()}}},L={transporterName:(d==null?void 0:d.transporterName)??"",type:(d==null?void 0:d.typeOrigin)??"",phone:{countryCode:(d==null?void 0:d.countryCode)??Ce,phoneCode:(d==null?void 0:d.phoneCode)??Ce,phoneNumber:gt(d==null?void 0:d.transporterPhone,Ce)},unit:(d==null?void 0:d.unitId)??"",transportName:(d==null?void 0:d.transportName)??"",transportLicenseNumber:(d==null?void 0:d.transportLicenseNumber)??"",expectedTransportAt:d.expectedTransportAtOrigin?E(d.expectedTransportAtOrigin):void 0,images:{fileList:d==null?void 0:d.images.map(g=>({response:{data:{url:g}}}))},commodities:((U=d==null?void 0:d.commodities)==null?void 0:U.length)>0?d==null?void 0:d.commodities:[{name:void 0,quantity:void 0}],note:(d==null?void 0:d.note)??"",resident:d==null?void 0:d.residentId};return{hideFormUpdateInventoryTransfer:s,handleUpdateInventoryTransfer:O,formUpdate:n,isFetchingUpdate:S.isFetching,isFetchingApartment:_.isFetching,apartmentData:_.data,types:Re,residentData:I.data,isFetchingResident:_.isFetching,initialValues:L,handlePreviewAttachment:P,fileList:r,handleChange:k,handleRemoveFile:Y}};var qn={name:"1kevbid",styles:"& .ant-upload{width:100%;}"};const Hn=()=>{const{hideFormUpdateInventoryTransfer:a,handleUpdateInventoryTransfer:i,formUpdate:n,isFetchingUpdate:l,isFetchingApartment:o,apartmentData:c,types:s,residentData:u,isFetchingResident:m,initialValues:f,handlePreviewAttachment:w,fileList:_,handleChange:A,handleRemoveFile:I}=zn(),R=x(j,{style:{justifyContent:"space-between",alignItems:"center"},children:[e(de.Text,{children:t.update_registration_inventory_transfer}),x(j,{children:[e(J,{onClick:a,style:{marginRight:10},children:t.cancel}),e(J,{type:"primary",onClick:i,disabled:l,loading:l,children:t.confirm})]})]});return e(oe,{title:R,onCancel:a,open:!0,width:"55%",bodyStyle:{maxHeight:"550px",overflowY:"scroll"},footer:null,closable:!1,closeIcon:null,children:e(p,{initialValues:f,form:n,name:"formUpdate",layout:"vertical",children:x(j,{gutter:[12,12],children:[e(y,{span:"12",children:e(p.Item,{rules:[{required:!0}],label:t.transporter_name,name:"transporterName",children:e(H,{fluid:"true",placeholder:t.transporter_name})})}),e(y,{span:"12",children:e(p.Item,{name:"phone",label:t.label.phone,rules:[{required:!0},{validator:async(S,F)=>F!=null&&F.phoneNumber&&!Xe(F.phoneNumber)?Promise.reject(t.status.phone_invalid):Promise.resolve()}],children:e(H.PhoneInput,{placeholder:t.label.phone})})}),e(y,{span:"12",children:e(p.Item,{rules:[{required:!0}],label:t.transfer_type,name:"type",children:e($,{placeholder:t.label.type,filterOption:!1,style:{width:"100%"},children:s==null?void 0:s.map(({label:S,value:F})=>e($.Option,{value:F,children:S},F))})})}),e(y,{span:"12",children:e(p.Item,{rules:[{required:!0}],label:t.transport_name,name:"transportName",children:e(H,{fluid:"true",placeholder:t.transport_name})})}),e(y,{span:"12",children:e(p.Item,{label:t.transport_license_number,name:"transportLicenseNumber",children:e(H,{fluid:"true",placeholder:t.transport_license_number})})}),e(y,{span:"12",children:e(p.Item,{dependencies:["expectedTransportAt"],rules:[{required:!0},({getFieldValue:S})=>({validator(F,d){const r=S("expectedTransportAt");return d&&E(d).startOf("day").isBefore(E().startOf("day"))?Promise.reject(t.expected_incoming_at_must_greater_or_equal_than_current_date):r&&d&&E(d).isAfter(r)?Promise.reject(t.expected_incoming_at_must_lower_or_equal_than_expected_leaving_at):Promise.resolve()}})],label:t.expected_transport,name:"expectedTransportAt",children:e(Ye,{fluid:"true",placeholder:"HH:mm DD/MM/YYYY",format:"HH:mm DD/MM/YYYY",showTime:{format:"HH:mm DD/MM/YYYY"}})})}),e(y,{span:"12",children:e(p.Item,{rules:[{required:!0}],label:t.unit,name:"unit",children:e($,{allowClear:!0,disabled:!0,showSearch:!0,placeholder:t.label.select_apartment,filterOption:!1,loading:o,style:{width:"100%"},dropdownRender:S=>o?e("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:e(et,{})}):S,children:c==null?void 0:c.map(({id:S,name:F})=>e($.Option,{value:S,children:F},S))})})}),e(y,{span:"12",children:e(p.Item,{rules:[{required:!0}],label:t.resident,name:"resident",children:e($,{allowClear:!0,showSearch:!0,placeholder:t.label.select_resident,filterOption:!1,loading:m,style:{width:"100%"},children:u==null?void 0:u.map(({id:S,fullName:F})=>e($.Option,{value:S,children:F},S))})})}),e(y,{span:"24",children:e(p.Item,{label:t.note,name:"note",children:e(H.TextArea,{maxLength:"255",fluid:"true",placeholder:t.note,rows:"2"})})}),e(y,{span:"24",children:e(p.List,{name:"commodities",children:(S,{add:F,remove:d})=>S.map(r=>x(j,{gutter:[12,12],style:{width:"100%"},children:[e(y,{flex:"1 0 0",style:{width:"100%"},children:x(j,{gutter:[8,8],children:[e(y,{span:16,children:e(p.Item,{name:[r.name,"name"],fieldKey:[r.fieldKey,"name"],rules:[{required:!0}],label:t.commodity_name,children:e(H,{fluid:"true",placeholder:t.commodity_name})},r.key)}),e(y,{span:8,children:e(p.Item,{name:[r.name,"quantity"],fieldKey:[r.fieldKey,"quantity"],rules:[{required:!0}],label:t.label.quantity,children:e(We,{placeholder:t.label.quantity,min:1,max:100})},r.key)})]})}),e(y,{children:e(p.Item,{label:e("div",{}),children:x("div",{style:{width:"50px",height:"32px",display:"flex",flexDirection:"row",alignItems:"center"},children:[e(D,{onClick:()=>{S.length>1&&d(r.name)},name:"icon-minus-circle-outlined",css:h=>({fontSize:h.fontSize.md})}),r.name!==S.length-1?null:e(D,{onClick:()=>{F({name:void 0,quantity:void 0})},name:"icon-plus-circle-outlined",css:h=>({marginLeft:h.margin.sm,fontSize:h.fontSize.md})})]})})})]},r.key))})}),x(y,{span:"24",children:[e(p.Item,{name:"inventoryTransferFiles",label:t.attached_files,children:e(be,{multiple:!0,maxCount:"10",css:qn,onPreview:w,limitSizeFile:5,isUploadAllFile:!0,fileList:_,onChange:A,showUploadList:!1,children:e(J,{icon:e(D,{name:"icon-attachment-outlined",css:S=>({fontsize:S.iconSize})}),type:"primary",ghost:!0,block:!0,size:"default",children:t.attachments})})}),_.map(S=>e(Ne,{file:S,handlePreviewAttachment:w,handleRemoveFile:I})),x("i",{css:S=>({fontSize:S.fontSize.sm,color:S.labelColor}),children:["* ",t.file_format]})]})]})})})},jn=async a=>(await jt({type:qe},a)).data,$n=async a=>{const i={type:qe,status:Ke,autoApprove:!1,regulation:""},{data:n,code:l,codeLanguage:o}=await $t(i,a);return[n,l,o]},Qn=()=>{const{setInventoryTransferSetting:a,inventoryTransferSetting:i,idBuilding:n}=b.useContext(q);return[async()=>{const o={...i},c=await jn(n);if(c&&c.length){const s=c[0];o.autoApprove=(s==null?void 0:s.autoApprove)??!1,o.status=s.status===Fe,o.id=s.id,o.regulation=s.regulation,a(o)}else{const[s]=await $n(n);o.autoApprove=(s==null?void 0:s.autoApprove)??!1,o.status=s.status===Fe,o.id=s.id,o.regulation=s.regulation,a(o)}return o}]},Gn=()=>{const{search:a}=Dt(),{setTitlePage:i,setVisibleFilterBox:n,setVisibleSearchBox:l}=b.useContext(Je),{formUpdateStatusData:o,formDetailData:c,formAddData:s,formConfigData:u,idBuilding:m,inventoryTransferSetting:f,formShowRegulation:w,formHistoryInventoryTransfer:_,formUpdateInventoryTransfer:A}=b.useContext(q),{getQueryParamsInventoryTransfer:I}=re(),[R]=Qn(),[S]=Ie();return b.useEffect(()=>(i(t.inventory_transfer_management),l(!0),()=>{i(""),n(!1),l(!1)}),[]),b.useEffect(()=>{(async()=>{if(m){let F={...f};F.id||(F=await R());const{pagination:d,filter:r,status:h}=I(F.autoApprove);a&&await S({filter:{...r,status:h},limit:d.limit,page:d.page})}})()},[a]),[o,c,s,u,w,_,A]},Wn=()=>{const[a,i,n,l,o,c,s]=Gn();return x(te,{children:[x(Z.Wrapper,{children:[e(bn,{}),x(Z.Container,{children:[e(Z.Header,{children:e(In,{})}),x(Z.Content,{children:[e(An,{}),e(vn,{})]})]})]}),a.isShow&&e(hn,{}),i.isShow&&e(ln,{}),n.isShow&&e(On,{}),l.isShow&&e(_n,{}),o.isShow&&e(Dn,{}),c.isShow&&e(Un,{}),s.isShow&&e(Hn,{})]})},Yo=()=>e(rn,{children:e(Wn,{})});export{Yo as default};
