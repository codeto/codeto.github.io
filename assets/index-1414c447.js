import{j as t,a as _,c as W,F as A}from"./@emotion-63839449.js";import{a as J,l as Y,D as Ce,k as nt,P as et}from"./index-b17d22e5.js";import{r as v}from"./react-4fd50329.js";import{P as ye}from"./prop-types-1172f4d5.js";import{b0 as ht,aZ as gt,at as yt,I as ce,l as a,i as Z,A as Q,M as ee,X as te,j as ot,K as Se,S as ne,g as Re,by as We,c6 as at,a as St}from"./index-c2ded735.js";import"./react-redux-896b353b.js";import"./lodash-88fe09e6.js";import{h as I}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import"./@firebase-43527ee1.js";import{u as ft}from"./react-router-a4308f7b.js";import{b as T,B as ue,a as $,T as Mt,R as N,S as qe,E as fe,A as ge}from"./antd-f9eae174.js";import{F as b,u as oe}from"./index-687ba9e6.js";import{e as Ee}from"./rules-c1d56c23.js";import{I as z,S as B}from"./index-43183512.js";import{d as _t,a as vt,u as wt}from"./maintenanceSchedule-3bd8648f.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./index-881eef42.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";const q=v.createContext({idBuilding:0,groupSystemSelected:void 0,setGroupSystemSelected:()=>{},systemSelected:void 0,setSystemSelected:()=>{},maintenanceScheduleSelected:void 0,setMaintenanceScheduleSelected:()=>{},listGroupSystem:[],setListGroupSystem:()=>{},listSystem:[],setListSystem:()=>{},listMaintenanceSchedule:[],setListMaintenanceSchedule:()=>{},getListGroupSystemStatus:{loading:!1},setGetListGroupSystemStatus:()=>{},getListSystemStatus:{loading:!1},setGetListSystemStatus:()=>{},getListMaintenanceScheduleStatus:{loading:!1},setGetListMaintenanceScheduleStatus:()=>{},maintenancePlanPermissionWrite:!1}),Ve=({children:n})=>{const{getPermissionByModuleCode:o}=ht(),e=ft(),{idBuilding:s}=e,[r,c]=v.useState(),[u,l]=v.useState(),[p,f]=v.useState(),[g,y]=v.useState([]),[h,m]=v.useState([]),[M,L]=v.useState([]),[E,i]=v.useState({loading:!1}),[S,w]=v.useState({loading:!1}),[k,d]=v.useState({loading:!1}),C=o(gt),U=(C==null?void 0:C[yt])??!1,ae={idBuilding:s,groupSystemSelected:r,setGroupSystemSelected:c,systemSelected:u,setSystemSelected:l,maintenanceScheduleSelected:p,setMaintenanceScheduleSelected:f,listGroupSystem:g,setListGroupSystem:y,listSystem:h,setListSystem:m,getListGroupSystemStatus:E,setGetListGroupSystemStatus:i,listMaintenanceSchedule:M,setListMaintenanceSchedule:L,getListSystemStatus:S,setGetListSystemStatus:w,getListMaintenanceScheduleStatus:k,setGetListMaintenanceScheduleStatus:d,maintenancePlanPermissionWrite:U};return t(q.Provider,{value:ae,children:n})};Ve.propTypes={children:ye.node};Ve.defaultProps={children:t("div",{})};const Lt=Ve,bt=W(T,{target:"e355wzc4"})("border-right:1px solid ",n=>n.theme.borderColor,";position:relative;display:flex;flex-direction:column;padding-bottom:",n=>n.theme.padding.sm,"px;"),Dt=W("div",{target:"e355wzc3"})("padding:",n=>n.theme.padding.sm,"px ",n=>n.theme.padding.xs,"px;border-bottom:1px solid ",n=>n.theme.borderColor,";font-size:",n=>n.theme.heading.four,"px;display:flex;justify-content:space-between;align-items:center;background-color:#ffffff;z-index:1;"),Ct=W("div",{target:"e355wzc2"})({name:"byw84t",styles:"flex:1 0 0;overflow:scroll"}),tt=W(ue,{target:"e355wzc1"})({name:"d4o7tm",styles:"&:hover{svg g polygon{fill:#40a9ff;}span{color:#40a9ff!important;}}"}),xt=W("div",{target:"e355wzc0"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),Et=({saveButton:n,isHavePermissionCreate:o,isHavePermissionUpdate:e,isFetchingSave:s,disabled:r,onClickButton:c})=>n&&e?t(tt,{onClick:c,icon:t(ce,{name:"icon-save-outlined"}),loading:s,disabled:r,type:"primary",ghost:!0,children:a.save}):!n&&o?t(tt,{type:"primary",ghost:!0,onClick:c,icon:t(ce,{name:"icon-plus-outlined"}),disabled:r,children:a.add}):t(A,{}),Ye=({title:n,span:o,saveButton:e,isFetchingSave:s,onClickButton:r,children:c,disabled:u,isHavePermissionCreate:l,isHavePermissionUpdate:p})=>_(bt,{span:o,children:[_(Dt,{children:[t(xt,{children:n}),t(Et,{saveButton:e,isFetchingSave:s,onClickButton:r,disabled:u,isHavePermissionCreate:l,isHavePermissionUpdate:p})]}),t(Ct,{children:c})]}),He=W("div",{target:"e1gn712f0"})({name:"ubdald",styles:"display:flex;justify-content:center;align-items:center;height:400px"}),Gt=W("div",{target:"e131qszb0"})(n=>{const o=`
      cursor: pointer;
      padding: ${n.theme.padding.sm}px ${n.theme.padding.xs}px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid ${n.theme.borderColor};
      font-size: ${n.theme.fontSize.md}px;
    `;return n.selected?`
        ${o}
        background-color: ${n.theme.backgroundContent};
        font-weight: ${n.theme.fontWeight.bold};
      `:o},";"),st=({selected:n,title:o,data:e,onClick:s,onClickEdit:r,onClickDelete:c,isShowIconArrowRight:u,isHavePermissionWrite:l})=>{const p=()=>{s(e)},f=h=>{h.stopPropagation(),c(e)},g=h=>{h.stopPropagation(),r(e)},y=[l?t(ce,{title:a.update,css:h=>({fontSize:h.iconSize+"px",marginRight:h.margin.xs+"px"}),name:"icon-edit-outlined",onClick:g}):null];return l&&y.push(t(ce,{title:a.delete,css:h=>({fontSize:h.iconSize+"px",marginRight:h.margin.xs+"px"}),name:"icon-minus-circle-outlined",onClick:f})),_(Gt,{selected:n,onClick:p,children:[t(N,{children:t($.Text,{ellipsis:!0,children:t(Mt,{title:o,placement:"topLeft",children:o})})}),_("div",{children:[y.map(h=>h),u&&t(ce,{css:h=>({fontSize:h.iconSize+"px"}),name:"icon-arrow-right-outlined"})]})]})},Le=`${ot}/group-system`,Tt=Le,It=Le,Pt=n=>`${Le}/${n} `,At=n=>`${Le}/${n}`,kt=n=>`${Le}/${n}/system`,Ft=async n=>{const o={[te]:n};return await Z({type:Q,payload:{apiUrl:Tt,method:ee.GET,options:{params:{},headers:o}}})},Ot=async(n,o)=>{const e={[te]:o};return await Z({type:Q,payload:{apiUrl:kt(n),method:ee.GET,options:{headers:e}}})},Bt=async(n,o)=>{const e={[te]:n};return await Z({type:Q,payload:{apiUrl:It,method:ee.POST,body:o,options:{headers:e}}})},Ut=async(n,o,e)=>{const s={[te]:n};return await Z({type:Q,payload:{apiUrl:Pt(o),method:ee.PUT,body:e,options:{headers:s}}})},$t=async(n,o)=>{const e={[te]:n};return await Z({type:Q,payload:{apiUrl:At(o),method:ee.DELETE,options:{headers:e}}})},Nt=async(n,o)=>{try{const e=await Bt(n,o);return{code:e.code,codeLanguage:e.codeLanguage}}catch(e){return{code:e.code,codeLanguage:e.codeLanguage}}},Rt=n=>{const{id:o,name:e,note:s,groupSystemId:r}=n;return{...n,id:o??"",key:`key-${o??0}`,name:e??"",note:s??"",groupSystemId:r??""}},me=async n=>{var r;const o=await Ft(n),e=(o==null?void 0:o.totalRecord)??0;return{result:(r=o==null?void 0:o.data)==null?void 0:r.map(c=>Rt(c)),totalRecord:e}},Ge=v.createContext({deleteGroupSystemStatus:{loading:!1,code:void 0,codeLanguage:void 0},setDeleteGroupSystemStatus:()=>{},modalAddGroupSystem:void 0,showModalAddGroupSystem:()=>{},hideModalAddGroupSystem:()=>{},modalUpdateGroupSystem:void 0,showModalUpdateGroupSystem:()=>{},hideModalUpdateGroupSystem:()=>{}}),ze=({children:n})=>{const[o,e]=v.useState({loading:!1}),[s,r,c]=Se(),[u,l,p]=Se(),f={deleteGroupSystemStatus:o,setDeleteGroupSystemStatus:e,modalAddGroupSystem:s,showModalAddGroupSystem:r,hideModalAddGroupSystem:c,modalUpdateGroupSystem:u,showModalUpdateGroupSystem:l,hideModalUpdateGroupSystem:p};return t(Ge.Provider,{value:f,children:n})};ze.propTypes={children:ye.node};ze.defaultProps={children:t("div",{})};const Wt=()=>{const{idBuilding:n,setListGroupSystem:o,setGetListGroupSystemStatus:e}=v.useContext(q),{hideModalAddGroupSystem:s}=v.useContext(Ge),[r]=b.useForm(),[c,u]=v.useState({loading:!1,code:void 0,codeLanguage:void 0});oe(c.code,c.codeLanguage,{message:a.success,description:a.add_data_success});const l=async()=>{const g=await r.validateFields();if(g){u({loading:!0,code:void 0,codeLanguage:void 0});const y=await Nt(n,{...g});if(u({loading:!1,code:y==null?void 0:y.code,codeLanguage:y==null?void 0:y.codeLanguage}),ne.includes(y.code)){e({loading:!0});const{result:h}=await me(n);o(h??[]),e({loading:!1}),s()}}},p={name:void 0};return{formAddGroupSystem:r,onClose:()=>s(),onFinish:l,isFetching:c.loading,initialValues:p}},qt=W("button",{target:"eltjl0b0"})({name:"eivff4",styles:"display:none"}),Vt=()=>{const{formAddGroupSystem:n,onClose:o,onFinish:e,isFetching:s,initialValues:r}=Wt();return t(J,{title:a.add_group_system,open:!0,onOk:e,onCancel:o,confirmLoading:s,okText:a.confirm,cancelText:a.cancel,disabled:!0,children:_(b,{layout:"vertical",name:"form_add_group_system",form:n,onFinish:e,initialValues:r,children:[t(N,{gutter:16,children:t(T,{span:24,children:t(b.Item,{name:"name",rules:[{required:!0},Ee],label:a.name,children:t(z,{placeholder:a.name})})})}),t(qt,{type:"submit"})]})})},Yt=async(n,o,e)=>{try{const s=await Ut(n,o,e);return{code:s.code,codeLanguage:s.codeLanguage}}catch(s){return{code:s.code,codeLanguage:s.codeLanguage}}},Ht=()=>{var M;const{idBuilding:n,setListGroupSystem:o,setGetListGroupSystemStatus:e,setGroupSystemSelected:s,groupSystemSelected:r}=v.useContext(q),{hideModalUpdateGroupSystem:c,modalUpdateGroupSystem:u,groupSystemPermissionWrite:l}=v.useContext(Ge),[p]=b.useForm(),[f,g]=v.useState({loading:!1,code:void 0,codeLanguage:void 0});oe(f.code,f.codeLanguage,{message:a.success,description:a.update_data_success});const y=async()=>{var E;const L=await p.validateFields();if(L){g({loading:!0,code:void 0,codeLanguage:void 0});const i=await Yt(n,(E=u==null?void 0:u.data)==null?void 0:E.id,{...L});if(g({loading:!1,code:i==null?void 0:i.code,codeLanguage:i==null?void 0:i.codeLanguage}),ne.includes(i.code)){e({loading:!0});const{result:S}=await me(n);o(S??[]);const w=S==null?void 0:S.findIndex(k=>k.id===(r==null?void 0:r.id));s(S[w]),e({loading:!1}),c()}}},h={name:((M=u==null?void 0:u.data)==null?void 0:M.name)??void 0};return{formUpdateGroupSystem:p,onClose:()=>c(),onFinish:y,isFetching:f.loading,initialValues:h,groupSystemPermissionWrite:l}},zt=()=>{const{formUpdateGroupSystem:n,onClose:o,onFinish:e,isFetching:s,initialValues:r}=Ht();return t(J,{title:a.update_group_system,open:!0,confirmLoading:s,onCancel:o,footer:[[t(ue,{onClick:o,children:a.cancel},"cancel"),t(ue,{onClick:e,type:"primary",children:a.confirm},"ok")]],children:t(b,{layout:"vertical",name:"form_update_group_system",form:n,onFinish:e,initialValues:r,children:t(N,{gutter:16,children:t(T,{span:24,children:t(b.Item,{name:"name",rules:[{required:!0},Ee],label:a.name,children:t(z,{placeholder:a.name})})})})})})},jt=async(n,o)=>{try{const e=await $t(n,o);return{code:e.code,codeLanguage:e.codeLanguage}}catch(e){return{code:e.code,codeLanguage:e.codeLanguage}}},Kt=async(n,o)=>{try{return await Ot(n,o)}catch(e){return e}},Xt=()=>{const{idBuilding:n,groupSystemSelected:o,setGroupSystemSelected:e,listGroupSystem:s,setListGroupSystem:r,getListGroupSystemStatus:c,setGetListGroupSystemStatus:u,setSystemSelected:l,setListSystem:p,setListMaintenanceSchedule:f,maintenancePlanPermissionWrite:g}=v.useContext(q),{deleteGroupSystemStatus:y,setDeleteGroupSystemStatus:h,modalAddGroupSystem:m,showModalAddGroupSystem:M,modalUpdateGroupSystem:L,showModalUpdateGroupSystem:E}=v.useContext(Ge);v.useEffect(()=>{(async()=>{if(o){const d=await Kt(o==null?void 0:o.id,n),C=(d==null?void 0:d.data)??[];l(C==null?void 0:C[0]),p(C??[]),C!=null&&C.length||f([])}})()},[o]);const i=()=>{M()},S=d=>{E({...d})},w=d=>{e(d)};oe(y.code,y.codeLanguage,{message:a.success,description:a.delete_data_success});const k=async d=>{h({loading:!0,code:void 0,codeLanguage:void 0});const C=await jt(n,d);if(h({loading:!1,code:C.code,codeLanguage:C.codeLanguage}),ne.includes(C.code)){u({loading:!0});const{result:U}=await me(n);r(U??[]),u({loading:!1}),d===(o==null?void 0:o.id)&&e((U==null?void 0:U[0])??void 0)}};return{isFetchingGroupSystem:c.loading,isFetchingDeleteGroupSystem:y.loading,groupSystemSelected:o,listGroupSystem:s,handleShowModalAddGroupSystem:i,handleShowModalUpdateGroupSystem:S,onChangeGroupSystem:w,modalAddGroupSystem:m,modalUpdateGroupSystem:L,handleDeleteGroupSystem:k,isEnLanguage:Re()==="en",maintenancePlanPermissionWrite:g}},Jt=()=>{const{isFetchingGroupSystem:n,isFetchingDeleteGroupSystem:o,groupSystemSelected:e,listGroupSystem:s,handleShowModalAddGroupSystem:r,handleShowModalUpdateGroupSystem:c,onChangeGroupSystem:u,modalAddGroupSystem:l,modalUpdateGroupSystem:p,handleDeleteGroupSystem:f,isEnLanguage:g,maintenancePlanPermissionWrite:y}=Xt(),h=async m=>{J.confirm({title:a.confirm,content:`${a.confirm_delete} ${m.name}?`,okText:a.confirm,okType:"danger",cancelText:a.cancel,confirmLoading:o,okBtnProps:{disabled:o,loading:o},onOk:async()=>(await f(m==null?void 0:m.id),Promise.resolve())})};return _(A,{children:[_(Ye,{span:8,title:a.group_system,onClickButton:r,isHavePermissionCreate:y,children:[n&&t(He,{children:t(qe,{})}),!n&&((s==null?void 0:s.length)>0?s.map(m=>t(st,{data:m,selected:(e==null?void 0:e.id)===m.id,title:m.name,isFetching:o,onClick:u,onClickEdit:c,onClickDelete:h,isShowIconArrowRight:!0,isHavePermissionWrite:y},m.key)):t(fe,{image:fe.PRESENTED_IMAGE_SIMPLE}))]}),l!=null&&l.isShow?t(Vt,{}):null,p!=null&&p.isShow?t(zt,{}):null]})},Zt=()=>t(ze,{children:t(Jt,{})}),Te=`${ot}/system`,Qt=Te,en=n=>`${Te}/${n} `,tn=n=>`${Te}/${n}`,nn=n=>`${Te}/${n}/maintenance-schedule`,on=async(n,o)=>{const e={[te]:o};return await Z({type:Q,payload:{apiUrl:nn(n),method:ee.GET,options:{headers:e}}})},an=async(n,o)=>{const e={[te]:n};return await Z({type:Q,payload:{apiUrl:Qt,method:ee.POST,body:o,options:{headers:e}}})},sn=async(n,o,e)=>{const s={[te]:n};return await Z({type:Q,payload:{apiUrl:en(o),method:ee.PUT,body:e,options:{headers:s}}})},rn=async(n,o)=>{const e={[te]:n};return await Z({type:Q,payload:{apiUrl:tn(o),method:ee.DELETE,options:{headers:e}}})},cn=async(n,o,e)=>{const s={...e,groupSystemId:o};try{const r=await an(n,s);return{code:r.code,codeLanguage:r.codeLanguage}}catch(r){return{code:r.code,codeLanguage:r.codeLanguage}}},Ie=v.createContext({deleteSystemStatus:{loading:!1,code:void 0,codeLanguage:void 0},setDeleteSystemStatus:()=>{},modalAddSystem:void 0,showModalAddSystem:()=>{},hideModalAddSystem:()=>{},modalUpdateSystem:void 0,showModalUpdateSystem:()=>{},hideModalUpdateSystem:()=>{}}),je=({children:n})=>{const[o,e]=v.useState({loading:!1}),[s,r,c]=Se(),[u,l,p]=Se(),f={deleteSystemStatus:o,setDeleteSystemStatus:e,modalAddSystem:s,showModalAddSystem:r,hideModalAddSystem:c,modalUpdateSystem:u,showModalUpdateSystem:l,hideModalUpdateSystem:p};return t(Ie.Provider,{value:f,children:n})};je.propTypes={children:ye.node};je.defaultProps={children:t("div",{})};const dn=()=>{const{idBuilding:n,setGetListGroupSystemStatus:o,setGroupSystemSelected:e,groupSystemSelected:s}=v.useContext(q),{hideModalAddSystem:r}=v.useContext(Ie),[c]=b.useForm(),[u,l]=v.useState({loading:!1,code:void 0,codeLanguage:void 0});oe(u.code,u.codeLanguage,{message:a.success,description:a.add_data_success});const p=async()=>{const y=await c.validateFields();if(y){l({loading:!0,code:void 0,codeLanguage:void 0});const h=await cn(n,s==null?void 0:s.id,{...y});if(l({loading:!1,code:h==null?void 0:h.code,codeLanguage:h==null?void 0:h.codeLanguage}),ne.includes(h.code)){o({loading:!0});const{result:m}=await me(n),M=m.findIndex(L=>L.id===(s==null?void 0:s.id));e(m[M]),o({loading:!1}),r()}}},f={name:void 0,note:void 0};return{formAddSystem:c,onClose:()=>r(),onFinish:p,isFetching:u.loading,initialValues:f,groupSystemSelected:s}},ln=W("button",{target:"e1bl2ui0"})({name:"eivff4",styles:"display:none"}),un=()=>{const{formAddSystem:n,onClose:o,onFinish:e,isFetching:s,initialValues:r,groupSystemSelected:c}=dn();return t(J,{title:`${a.add_system_in} ${c==null?void 0:c.name}`,open:!0,onOk:e,onCancel:o,confirmLoading:s,okText:a.confirm,cancelText:a.cancel,children:_(b,{layout:"vertical",name:"form_add_system",form:n,onFinish:e,initialValues:r,children:[_(N,{gutter:16,children:[t(T,{span:24,children:t(b.Item,{name:"name",rules:[{required:!0},Ee],label:a.name,children:t(z,{placeholder:a.name})})}),t(T,{span:24,children:t(b.Item,{name:"note",label:a.description,children:t(z.TextArea,{maxLength:"255",placeholder:a.description,rows:"4"})})})]}),t(ln,{type:"submit"})]})})},mn=async(n,o)=>{try{const e=await rn(n,o);return{code:e.code,codeLanguage:e.codeLanguage}}catch(e){return{code:e.code,codeLanguage:e.codeLanguage}}},be="DAILY",j="WEEKLY",re="MONTHLY",de=[{label:a.daily,value:be},{label:a.weekly,value:j},{label:a.monthly,value:re}],it=0,rt=1,ct=2,dt=3,lt=4,ut=5,mt=6,H=[{label:a.amenities_serve_day_monday,value:rt},{label:a.amenities_serve_day_tuesday,value:ct},{label:a.amenities_serve_day_wednesday,value:dt},{label:a.amenities_serve_day_thursday,value:lt},{label:a.amenities_serve_day_friday,value:ut},{label:a.amenities_serve_day_saturday,value:mt},{label:a.amenities_serve_day_sunday,value:it}],xe=[rt,ct,dt,lt,ut,mt,it],Me="DAYS_IN_MONTH",_e="LAST_DAY_IN_MONTH",le=[{label:a.select_days_in_month,value:Me},{label:a.select_day_last_month,value:_e}];We(le,"value");const pn=We(de,"value");We(H,"value");const hn=n=>{var y;const{id:o,SystemId:e,startDate:s,endDate:r,name:c,repeat:u,interval:l,byDays:p,byMonthDays:f,isEndOfMonth:g}=n;return{id:o,SystemId:e,name:c??"",repeat:u??"",repeatFormat:u?(y=pn[u])==null?void 0:y.label:"",interval:l??"",byDays:p??null,byMonthDays:f??null,isEndOfMonth:g??!1,startDate:s??null,endDate:r??null,startDateFormat:`${s?I(s).format(Y):""}`,endDateFormat:`${r?I(r).format(Y):""}`}},Pe=async(n,o)=>{const e=await on(n,o),s=e.data.map(c=>hn(c)),r=(e==null?void 0:e.totalRecord)??0;return{records:s,totalRecord:r}},gn=()=>{const{idBuilding:n,systemSelected:o,groupSystemSelected:e,setSystemSelected:s,setMaintenanceScheduleSelected:r,getListSystemStatus:c,listSystem:u,setListMaintenanceSchedule:l,setGroupSystemSelected:p,maintenanceScheduleSelected:f,maintenancePlanPermissionWrite:g}=v.useContext(q),{deleteSystemStatus:y,setDeleteSystemStatus:h,modalAddSystem:m,showModalAddSystem:M,modalUpdateSystem:L,showModalUpdateSystem:E}=v.useContext(Ie);v.useEffect(()=>{(async()=>{if(o){const d=await Pe(o==null?void 0:o.id,n),C=(d==null?void 0:d.records)??[];r(C==null?void 0:C[0]),l(C??[])}})()},[o]);const i=()=>{M()},S=d=>{E({...d})},w=d=>{s(d),r(f)};oe(y.code,y.codeLanguage,{message:a.success,description:a.delete_data_success});const k=async d=>{h({loading:!0,code:void 0,codeLanguage:void 0});const C=await mn(n,d);if(h({loading:!1,code:C.code,codeLanguage:C.codeLanguage}),ne.includes(C.code)){const{result:U}=await me(n),ae=U.findIndex(ve=>ve.id===(e==null?void 0:e.id));p(U[ae])}};return{isFetchingSystem:c.loading,isFetchingDeleteSystem:y.loading,systemSelected:o,handleShowModalAddSystem:i,handleShowModalUpdateSystem:S,onChangeSystem:w,modalAddSystem:m,modalUpdateSystem:L,handleDeleteSystem:k,isEnLanguage:Re()==="en",listSystem:u,isAddSystem:!e,maintenancePlanPermissionWrite:g}},yn=async(n,o,e,s)=>{const r={...s,groupSystemId:e};try{const c=await sn(n,o,r);return{code:c.code,codeLanguage:c.codeLanguage}}catch(c){return{code:c.code,codeLanguage:c.codeLanguage}}},Sn=()=>{var m,M;const{idBuilding:n,setGetListGroupSystemStatus:o,groupSystemSelected:e,setGroupSystemSelected:s}=v.useContext(q),{hideModalUpdateSystem:r,modalUpdateSystem:c,systemPermissionWrite:u}=v.useContext(Ie),[l]=b.useForm(),[p,f]=v.useState({loading:!1,code:void 0,codeLanguage:void 0});oe(p.code,p.codeLanguage,{message:a.success,description:a.update_data_success});const g=async()=>{var E;const L=await l.validateFields();if(L){f({loading:!0,code:void 0,codeLanguage:void 0});const i=await yn(n,(E=c==null?void 0:c.data)==null?void 0:E.id,e==null?void 0:e.id,{...L});if(f({loading:!1,code:i==null?void 0:i.code,codeLanguage:i==null?void 0:i.codeLanguage}),ne.includes(i.code)){o({loading:!0});const{result:S}=await me(n),w=S.findIndex(k=>k.id===(e==null?void 0:e.id));s(S[w]),o({loading:!1}),r()}}},y={name:((m=c==null?void 0:c.data)==null?void 0:m.name)??void 0,note:((M=c==null?void 0:c.data)==null?void 0:M.note)??void 0};return{formUpdateSystem:l,onClose:()=>r(),onFinish:g,isFetching:p.loading,initialValues:y,systemPermissionWrite:u}},fn=()=>{const{formUpdateSystem:n,onClose:o,onFinish:e,isFetching:s,initialValues:r}=Sn();return t(J,{title:a.update_system,open:!0,onOk:e,onCancel:o,confirmLoading:s,okText:a.confirm,cancelText:a.cancel,footer:[t(ue,{onClick:o,children:a.cancel},"cancel"),t(ue,{onClick:e,type:"primary",children:a.confirm},"ok")],children:t(b,{layout:"vertical",name:"form_update_system",form:n,onFinish:e,initialValues:r,children:_(N,{gutter:16,children:[t(T,{span:24,children:t(b.Item,{name:"name",rules:[{required:!0},Ee],label:a.name,children:t(z,{placeholder:a.name})})}),t(T,{span:24,children:t(b.Item,{name:"note",label:a.description,children:t(z.TextArea,{maxLength:"1000",placeholder:a.description,rows:"4"})})})]})})})},Mn=()=>{const{isFetchingSystem:n,isFetchingDeleteSystem:o,systemSelected:e,handleShowModalAddSystem:s,handleShowModalUpdateSystem:r,onChangeSystem:c,modalAddSystem:u,modalUpdateSystem:l,handleDeleteSystem:p,isEnLanguage:f,listSystem:g,isAddSystem:y,maintenancePlanPermissionWrite:h}=gn(),m=async M=>{J.confirm({title:a.confirm,content:`${a.confirm_delete} ${M.name}?`,okText:a.confirm,okType:"danger",cancelText:a.cancel,confirmLoading:o,okBtnProps:{disabled:o,loading:o},onOk:async()=>(await p(M==null?void 0:M.id),Promise.resolve())})};return _(A,{children:[_(Ye,{span:8,title:a.system,onClickButton:s,disabled:y,isHavePermissionCreate:h,children:[n&&t(He,{children:t(qe,{})}),!n&&(g!=null&&g.length)?g==null?void 0:g.map(M=>t(st,{data:M,selected:(e==null?void 0:e.id)===M.id,title:M.name,isFetching:o,onClick:c,onClickEdit:r,onClickDelete:m,isShowIconArrowRight:!0,isHavePermissionWrite:h},M.id)):t(fe,{image:fe.PRESENTED_IMAGE_SIMPLE})]}),u!=null&&u.isShow?t(un,{}):null,l!=null&&l.isShow?t(fn,{}):null]})},_n=()=>t(je,{children:t(Mn,{})}),vn=W("div",{target:"e1ln8wu70"})(n=>{const o=`
      cursor: pointer;
      padding: ${n.theme.padding.sm}px ${n.theme.padding.xs}px;
      display: flex;
      justify-content: space-between;
      border-bottom: 1px solid ${n.theme.borderColor};
      font-size: ${n.theme.fontSize.md}px;
    `;return n.selected?`
        ${o}
        background-color: ${n.theme.backgroundContent};
        font-weight: ${n.theme.fontWeight.bold};
      `:o},";"),Ke=({selected:n,title:o,data:e,onClick:s,onClickEdit:r,onClickDelete:c,isHavePermissionWrite:u})=>{var y,h;const l=()=>{s(e)},p=m=>{m.stopPropagation(),c(e)},f=m=>{m.stopPropagation(),r(e)},g=[u?t(ce,{title:a.update,css:m=>({fontSize:m.iconSize+"px",marginRight:m.margin.xs+"px"}),name:"icon-edit-outlined",onClick:f}):null];return u&&g.push(t(ce,{title:a.delete,css:m=>({fontSize:m.iconSize+"px",marginRight:m.margin.xs+"px"}),name:"icon-minus-circle-outlined",onClick:p})),t(A,{children:_(vn,{selected:n,onClick:l,children:[_("div",{children:[_(N,{children:[_($.Text,{style:{marginRight:5},children:[e!=null&&e.endDate?a.time:a.start_time,":"]}),t($.Text,{children:e!=null&&e.endDate?` ${e.startDateFormat} - ${e.endDateFormat}`:` ${e.startDateFormat}`})]}),_(N,{children:[_($.Text,{style:{marginRight:5},children:[a.frequency,":"]}),_($.Text,{strong:e==null?void 0:e.repeatFormat,children:[" ",e==null?void 0:e.repeatFormat]})]}),e.repeat===j&&e.byDays?_(N,{children:[_($.Text,{style:{marginRight:5},children:[a.date,":"]}),_($.Text,{strong:!0,children:[" ",(y=e==null?void 0:e.byDays)==null?void 0:y.map((m,M)=>{var E,i;const L=(E=H.find(S=>S.value===m))==null?void 0:E.label;return M===((i=e==null?void 0:e.byDays)==null?void 0:i.length)-1?L:`${L}, `})]})]}):null,e.repeat===re?_(N,{children:[_($.Text,{style:{marginRight:5},children:[a.date,":"]}),e.byMonthDays?_($.Text,{strong:!0,children:[" ",(h=e==null?void 0:e.byMonthDays)==null?void 0:h.map((m,M)=>M===e.byMonthDays.length-1?m:`${m}, `)]}):null,e.isEndOfMonth?t($.Text,{strong:!0,children:a.on_last_day_of_month}):null]}):null,_(N,{children:[_($.Text,{style:{marginRight:5},children:[a.interval,":"]}),_($.Text,{children:[" ",e==null?void 0:e.interval]})]})]}),t("div",{children:g.map(m=>m)})]})})};Ke.propTypes={data:ye.objectOf(ye.any)};Ke.defaultProps={data:{}};const Ae=v.createContext({deleteMaintenanceScheduleStatus:{loading:!1,code:void 0,codeLanguage:void 0},setDeleteMaintenanceScheduleStatus:()=>{},modalAddMaintenanceSchedule:void 0,showModalAddMaintenanceSchedule:()=>{},hideModalAddMaintenanceSchedule:()=>{},modalUpdateMaintenanceSchedule:void 0,showModalUpdateMaintenanceSchedule:()=>{},hideModalUpdateMaintenanceSchedule:()=>{},repeatMaintenance:"",setRepeatMaintenance:()=>{},selectedDaysInWeek:"",setSelectedDaysInWeek:()=>{},showDaysInMonth:"",setShowDaysInMonth:()=>{},selectedDaysInMonth:"",setSelectedDaysInMonth:()=>{},selectedLastDayInMonth:"",setSelectedLastDayInMonth:()=>{},intervalMaintenanceValue:"",setIntervalMaintenanceValue:()=>{}}),Xe=({children:n})=>{const[o,e]=v.useState({loading:!1}),[s,r]=v.useState(""),[c,u]=v.useState(""),[l,p]=v.useState([]),[f,g]=v.useState(!1),[y,h]=v.useState([]),[m,M]=v.useState(""),[L,E,i]=Se(),[S,w,k]=Se(),d={deleteMaintenanceScheduleStatus:o,setDeleteMaintenanceScheduleStatus:e,modalAddMaintenanceSchedule:L,showModalAddMaintenanceSchedule:E,hideModalAddMaintenanceSchedule:i,modalUpdateMaintenanceSchedule:S,showModalUpdateMaintenanceSchedule:w,hideModalUpdateMaintenanceSchedule:k,repeatMaintenance:c,setRepeatMaintenance:u,selectedDaysInWeek:l,setSelectedDaysInWeek:p,showDaysInMonth:f,setShowDaysInMonth:g,selectedDaysInMonth:y,setSelectedDaysInMonth:h,intervalMaintenanceValue:s,setIntervalMaintenanceValue:r,selectedLastDayInMonth:m,setSelectedLastDayInMonth:M};return t(Ae.Provider,{value:d,children:n})};Xe.propTypes={children:ye.node};Xe.defaultProps={children:t("div",{})};const wn=async(n,o)=>{try{const e=await _t(n,o);return{code:e.code,codeLanguage:e.codeLanguage}}catch(e){return{code:e.code,codeLanguage:e.codeLanguage}}},Ln=()=>{const{idBuilding:n,maintenanceScheduleSelected:o,systemSelected:e,setMaintenanceScheduleSelected:s,getListGroupSystemStatus:r,listMaintenanceSchedule:c,setListMaintenanceSchedule:u,maintenancePlanPermissionWrite:l}=v.useContext(q),{deleteMaintenanceScheduleStatus:p,setDeleteMaintenanceScheduleStatus:f,modalAddMaintenanceSchedule:g,showModalAddMaintenanceSchedule:y,modalUpdateMaintenanceSchedule:h,showModalUpdateMaintenanceSchedule:m}=v.useContext(Ae),M=()=>{y()},L=S=>{m({...S})},E=S=>{s(S)};oe(p.code,p.codeLanguage,{message:a.success,description:a.delete_data_success});const i=async S=>{f({loading:!0,code:void 0,codeLanguage:void 0});const w=await wn(n,S);if(f({loading:!1,code:w.code,codeLanguage:w.codeLanguage}),ne.includes(w.code)){const k=await Pe(e==null?void 0:e.id,n),d=(k==null?void 0:k.records)??[];s(d==null?void 0:d[0]),u(d??[])}};return{isFetchingMaintenanceSchedule:r.loading,isFetchingDeleteMaintenanceSchedule:p.loading,maintenanceScheduleSelected:o,handleShowModalAddMaintenanceSchedule:M,handleShowModalUpdateMaintenanceSchedule:L,onChangeMaintenanceSchedule:E,modalAddMaintenanceSchedule:g,modalUpdateMaintenanceSchedule:h,handleDeleteScheduleMaintenance:i,isEnLanguage:Re()==="en",listMaintenanceSchedule:c,isAddMaintenanceSchedule:!e,maintenancePlanPermissionWrite:l}},bn=(n,o)=>{const{startDate:e,endDate:s,repeat:r,interval:c,byDays:u,byMonthDays:l,systemId:p}=n,f={startDate:e?I(e).endOf("day").toDate():void 0,endDate:s?I(s).endOf("day").toDate():void 0,repeat:r,interval:c,systemId:p};if(r===j)return{...f,byDays:u??[]};if(r===re){if(o===Me)return{...f,byMonthDays:l??[],dayInMonth:o,isEndOfMonth:!1};if(o===_e)return{...f,isEndOfMonth:!0}}return f},Dn=async({idBuilding:n,maintenanceScheduleData:o})=>{const e=bn(o,o.dayInMonth);try{const s=await vt({idBuilding:n,newMaintenanceScheduleData:e});return{code:s.code,codeLanguage:s.codeLanguage}}catch(s){return{code:s.code,codeLanguage:s.codeLanguage}}},Cn=()=>{const{idBuilding:n,setGetListGroupSystemStatus:o,setListMaintenanceSchedule:e,setMaintenanceScheduleSelected:s,systemSelected:r}=v.useContext(q),{hideModalAddMaintenanceSchedule:c,repeatMaintenance:u,setRepeatMaintenance:l,selectedDaysInWeek:p,setSelectedDaysInWeek:f,showDaysInMonth:g,setShowDaysInMonth:y,selectedDaysInMonth:h,setSelectedDaysInMonth:m,intervalMaintenanceValue:M,setIntervalMaintenanceValue:L,selectedLastDayInMonth:E,setSelectedLastDayInMonth:i}=v.useContext(Ae),[S]=b.useForm(),[w,k]=v.useState({loading:!1,code:void 0,codeLanguage:void 0}),d={startDate:void 0,endDate:void 0,repeat:void 0,interval:void 0,byDays:void 0,byMonthDays:void 0,isEndOfMonth:void 0};oe(w.code,w.codeLanguage,{message:a.success,description:a.add_data_success});const C=(G,D)=>{G.repeat&&(l(G.repeat),S.setFieldsValue({byDays:void 0,dayInMonth:void 0,byMonthDays:void 0}),f([]),y(!1),m([]),i("")),G.interval&&(/^\d+$/.test(D.interval)?L(D.interval):L("")),G.byDays&&f(G.byDays),G.dayInMonth===Me&&(y(!0),i(!1)),G.byMonthDays&&m(G.byMonthDays),G.dayInMonth===_e&&(S.setFieldsValue({byMonthDay:void 0}),y(!1),m([]),i(!0))},U=Array.from({length:31},(G,D)=>D+1);p==null||p.sort((G,D)=>xe.indexOf(G)-xe.indexOf(D));const ae=()=>p==null?void 0:p.map(G=>{var D;return(D=H.find(F=>F.value===G))==null?void 0:D.label}),ve=()=>{const G=h==null?void 0:h.sort((D,F)=>D-F);return G==null?void 0:G.map(D=>D)},ke=async()=>{const G=await S.validateFields();if(G){k({loading:!0,code:void 0,codeLanguage:void 0});const D=await Dn({idBuilding:n,maintenanceScheduleData:{...G,systemId:(r==null?void 0:r.id)??null}});if(k({loading:!1,code:D==null?void 0:D.code,codeLanguage:D==null?void 0:D.codeLanguage}),ne.includes(D.code)){S.resetFields(),o({loading:!0});const F=await Pe(r==null?void 0:r.id,n),se=(F==null?void 0:F.records)??[];s(se==null?void 0:se[0]),e(se??[]),o({loading:!1}),l(""),L(""),c()}}},Fe=()=>{l(""),f([]),L(""),c()};function R(G=""){return t("strong",{children:G})}const we=(G,D,F,se)=>{const $e=_(A,{children:[a.maintenance_will_take_place," ",a.each.toLowerCase()," ",R(D)]});let K="";const x=a.date.toLowerCase(),P=a.week.toLowerCase(),O=a.month.toLowerCase(),X=a.on_the_day.toLowerCase(),Ne=a.on_the_last_day.toLowerCase(),V=F==null?void 0:F.join(", "),pe=G===j?P:O,ie=` ${a.one_time.toLowerCase()} `;return G===be&&(K=_(A,{children:[R(x),ie]})),G===j&&((F==null?void 0:F.length)>0?K=_(A,{children:[R(pe)," ",ie," ",X," ",R(V)]}):K=_(A,{children:[R(pe)," ",ie]})),G===re&&(se?K=_(A,{children:[R(pe)," ",ie,Ne]}):(F==null?void 0:F.length)>0?K=_(A,{children:[R(O),ie,X," ",R(V)]}):K=_(A,{children:[R(pe),ie]})),_(A,{children:[$e," ",K]})},Oe=we(u,M,[]),Be=we(u,M,ae()),Ue=we(u,M,ve(),E);return{formAddMaintenanceSchedule:S,onClose:Fe,onFinish:ke,isFetching:w.loading,initialValues:d,systemSelected:r,onValuesChange:C,repeatMaintenance:u,intervalMaintenanceValue:M,showDaysInMonth:g,daysInMonth:U,maintenanceMessageByDay:Oe,maintenanceMessageByWeek:Be,maintenanceMessageByMonth:Ue}},xn=W("button",{target:"enja9gk0"})({name:"eivff4",styles:"display:none"}),En=()=>{const{formAddMaintenanceSchedule:n,onClose:o,onFinish:e,isFetching:s,initialValues:r,systemSelected:c,onValuesChange:u,repeatMaintenance:l,intervalMaintenanceValue:p,showDaysInMonth:f,daysInMonth:g,maintenanceMessageByDay:y,maintenanceMessageByWeek:h,maintenanceMessageByMonth:m}=Cn(),M=l===be,L=l===j,E=l===re;return t(J,{title:`${a.add_maintenance_schedule_in} ${a.system} ${c==null?void 0:c.name}`,open:!0,onOk:e,onCancel:o,confirmLoading:s,okText:a.confirm,cancelText:a.cancel,width:"50%",children:_(b,{onValuesChange:u,layout:"vertical",name:"form_add_maintenance_schedule",form:n,onFinish:e,initialValues:r,children:[_(N,{gutter:16,children:[t(T,{span:12,children:t(b.Item,{dependencies:["endDate"],rules:[{required:!0},({getFieldValue:i})=>({validator(S,w){return w&&I(w).startOf("day").isBefore(I().startOf("day"))?Promise.reject(a.incoming_at_must_greater_or_equal_than_current_date):w&&i("endDate")&&I(w).isAfter(i("endDate"))?Promise.reject(a.incoming_at_must_lower_or_equal_than_leaving_at):Promise.resolve()}})],label:a.start_time,name:"startDate",children:t(Ce,{fluid:"true",placeholder:Y,format:Y,allowClear:!0,disabledDate:i=>I(i).isBefore(I().subtract(1,"day"))})})}),t(T,{span:12,children:t(b.Item,{dependencies:["startDate"],rules:[({getFieldValue:i})=>({validator(S,w){return w&&I(w).startOf("day").isBefore(I().startOf("day"))?Promise.reject(a.incoming_end_must_greater_or_equal_than_current_date):w&&i("startDate")&&I(w).isBefore(i("startDate"))?Promise.reject(a.incoming_at_must_lower_or_equal_than_leaving_at):Promise.resolve()}})],label:a.end_time,name:"endDate",children:t(Ce,{fluid:"true",placeholder:Y,format:Y,allowClear:!0,disabledDate:i=>I(i).isBefore(I().subtract(1,"day"))})})}),t(T,{span:24,css:i=>({marginBottom:i.margin.sm}),children:_($.Text,{strong:a.cycle_select,children:[a.cycle_select," * "]})}),t(T,{span:12,children:t(b.Item,{rules:[{required:!0}],label:`${a.frequency} (${a.repeat})`,name:"repeat",children:t(B,{placeholder:a.frequency,fluid:"true",getPopupContainer:i=>i.parentNode,children:de==null?void 0:de.map(({label:i,value:S})=>t(B.Option,{value:S,children:i},S))})})}),t(T,{span:12,children:t(b.Item,{children:t(b.Item,{label:a.interval,className:"site-input-group-wrapper",name:"interval",rules:[{required:!0}],children:_(z.Group,{compact:!0,children:[t(b.Item,{name:"interval",noStyle:!0,children:t(nt,{style:{width:"calc(100% - 50px)"},value:p,min:"1",formatter:i=>at(i),placeholder:a.interval})}),t(z,{style:{width:50,pointerEvents:"none",backgroundColor:"#fafafa",textAlign:"center"},value:a.times})]})})})}),L?t(T,{span:24,children:t(b.Item,{name:"byDays",label:a.select_day_in_week,rules:[{required:!0}],children:t(B,{mode:"multiple",allowClear:!0,fluid:"true",optionFilterProp:"children",placeholder:a.select_day_in_week,getPopupContainer:i=>i.parentNode,children:H==null?void 0:H.map(({label:i,value:S})=>t(B.Option,{value:S,children:i},S))})})}):null,E?_(A,{children:[t(T,{span:12,children:t(b.Item,{name:"dayInMonth",label:a.select_date_time,rules:[{required:!0}],children:t(B,{allowClear:!0,fluid:"true",placeholder:a.select_date_time,getPopupContainer:i=>i.parentNode,children:le==null?void 0:le.map(({label:i,value:S})=>t(B.Option,{value:S,children:i},S))})})}),f?t(T,{span:12,children:t(b.Item,{name:"byMonthDays",label:a.select_day_in_month,rules:[{required:!0}],children:t(B,{mode:"multiple",allowClear:!0,fluid:"true",placeholder:a.select_day_in_month,getPopupContainer:i=>i.parentNode,children:g.map(i=>t(B.Option,{value:i,children:i},i))})})}):null]}):null,p&&M?t(T,{span:24,css:i=>({marginTop:i.margin.sm}),children:t(ge,{message:y,type:"warning",showIcon:!0,closable:!0})}):null,p&&L?t(T,{span:24,css:i=>({marginTop:i.margin.sm}),children:t(ge,{message:h,type:"warning",showIcon:!0,closable:!0})}):null,p&&E?t(T,{span:24,css:i=>({marginTop:i.margin.sm}),children:t(ge,{message:m,type:"warning",showIcon:!0,closable:!0})}):null]}),t(xn,{type:"submit"})]})})},Gn=(n,o)=>{const{startDate:e,endDate:s,repeat:r,interval:c,byDays:u,byMonthDays:l,systemId:p}=n,f=I().startOf("day"),g={startDate:e?I(e).endOf("day").toDate():void 0,endDate:s?I(s).endOf("day").toDate():void 0,repeat:r,interval:c,systemId:p};if(e&&I(e).startOf("day")<=f)return{...g,byDays:u??[],byMonthDays:l??[]};if(e&&I(e).startOf("day")>f){if(r===j)return{...g,byDays:u??[]};if(r===re){if(o===Me)return{...g,byMonthDays:l??[],dayInMonth:o,isEndOfMonth:!1};if(o===_e)return{...g,isEndOfMonth:!0}}}return g},Tn=async(n,o,e)=>{const s=Gn(e,e.dayInMonth);try{const r=await wt(n,o,s);return{code:r.code,codeLanguage:r.codeLanguage}}catch(r){return{code:r.code,codeLanguage:r.codeLanguage}}},In=()=>{const{idBuilding:n,setGetListGroupSystemStatus:o,groupSystemSelected:e,systemSelected:s,setMaintenanceScheduleSelected:r,setListMaintenanceSchedule:c}=v.useContext(q),{hideModalUpdateMaintenanceSchedule:u,modalUpdateMaintenanceSchedule:l,maintenanceSchedulePermissionWrite:p,setRepeatMaintenance:f,selectedDaysInWeek:g,setSelectedDaysInWeek:y,setShowDaysInMonth:h,setSelectedDaysInMonth:m,setIntervalMaintenanceValue:M,intervalMaintenanceValue:L,repeatMaintenance:E,selectedLastDayInMonth:i,setSelectedLastDayInMonth:S,showDaysInMonth:w,selectedDaysInMonth:k}=v.useContext(Ae),d=l==null?void 0:l.data,[C]=b.useForm(),[U,ae]=v.useState({loading:!1,code:void 0,codeLanguage:void 0}),[ve,ke]=v.useState(!1),Fe=v.useMemo(()=>({startDate:d!=null&&d.startDate?I(d==null?void 0:d.startDate):"",endDate:d!=null&&d.endDate?I(d==null?void 0:d.endDate):"",repeat:(d==null?void 0:d.repeat)??"",interval:(d==null?void 0:d.interval)??"",byDays:(d==null?void 0:d.byDays)??[],byMonthDays:(d==null?void 0:d.byMonthDays)??[],isEndOfMonth:(d==null?void 0:d.isEndOfMonth)??!1,dayInMonth:d!=null&&d.byMonthDays?Me:_e}),[d]);v.useEffect(()=>{f(d==null?void 0:d.repeat),M(d==null?void 0:d.interval),h(d==null?void 0:d.byMonthDays),y(d.byDays),m(d==null?void 0:d.byMonthDays),S(d==null?void 0:d.isEndOfMonth)},[d]),v.useEffect(()=>{const x=I().startOf("day"),P=I(d.startDate).startOf("day");ke(P<=x)},[d.startDate]);const R=(x,P)=>{x.repeat&&(f(x.repeat),C.setFieldsValue({byDays:void 0,dayInMonth:void 0,byMonthDays:void 0}),y([]),h(!1),m([]),S("")),x.interval&&(/^\d+$/.test(P.interval)?M(P.interval):M("")),x.byDays&&y(x.byDays),x.dayInMonth===Me&&(h(!0),S(!1)),x.byMonthDays&&m(x.byMonthDays),x.dayInMonth===_e&&(C.setFieldsValue({byMonthDays:void 0}),h(!1),m([]),S(!0))},we=Array.from({length:31},(x,P)=>P+1);g==null||g.sort((x,P)=>xe.indexOf(x)-xe.indexOf(P));const Oe=()=>g!=null&&g.length?g==null?void 0:g.map(x=>{var P;return(P=H.find(O=>O.value===x))==null?void 0:P.label}):[],Be=()=>{const x=k==null?void 0:k.sort((P,O)=>P-O);return x==null?void 0:x.map(P=>P)};oe(U.code,U.codeLanguage,{message:a.success,description:a.update_data_success});const Ue=async()=>{const x=await C.getFieldValue();if(x){ae({loading:!0,code:void 0,codeLanguage:void 0});const P=await Tn(n,d.id,{...x,groupSystemId:e==null?void 0:e.id,systemId:s==null?void 0:s.id});if(ae({loading:!1,code:P==null?void 0:P.code,codeLanguage:P==null?void 0:P.codeLanguage}),ne.includes(P.code)){C.resetFields(),o({loading:!0});const O=await Pe(s==null?void 0:s.id,n),X=(O==null?void 0:O.records)??[];r(X==null?void 0:X[0]),c(X??[]),o({loading:!1}),u()}}},G=()=>{f(""),y([]),M(""),u()};function D(x=""){return t("strong",{children:x})}const F=(x,P,O,X)=>{const Ne=_(A,{children:[a.maintenance_will_take_place," ",a.each.toLowerCase()," ",D(P)]});let V="";const pe=a.date.toLowerCase(),ie=a.week.toLowerCase(),Je=a.month.toLowerCase(),Ze=a.on_the_day.toLowerCase(),pt=a.on_the_last_day.toLowerCase(),Qe=O==null?void 0:O.join(", "),De=x===j?ie:Je,he=` ${a.one_time.toLowerCase()} `;return x===be&&(V=_(A,{children:[D(pe),he]})),x===j&&(O.length>0?V=_(A,{children:[D(De),he," ",Ze," ",D(Qe)]}):V=_(A,{children:[D(De),he]})),x===re&&(X?V=_(A,{children:[D(De),he,pt]}):O.length>0?V=_(A,{children:[D(Je),he,Ze," ",D(Qe)]}):V=_(A,{children:[D(De),he]})),_(A,{children:[Ne," ",V]})},se=F(E,L,[]),$e=F(E,L,Oe()??[]),K=F(E,L,Be()??[],i);return{formUpdateMaintenanceSchedule:C,onClose:G,onFinish:Ue,isFetching:U.loading,initialValues:Fe,maintenanceSchedulePermissionWrite:p,onValuesChange:R,repeatMaintenance:E,intervalMaintenanceValue:L,showDaysInMonth:w,daysInMonth:we,maintenanceMessageByDay:se,maintenanceMessageByWeek:$e,maintenanceMessageByMonth:K,isEditingEnabled:ve}},Pn=()=>{const{formUpdateMaintenanceSchedule:n,onClose:o,onFinish:e,isFetching:s,initialValues:r,repeatMaintenance:c,onValuesChange:u,intervalMaintenanceValue:l,showDaysInMonth:p,daysInMonth:f,maintenanceMessageByDay:g,maintenanceMessageByWeek:y,maintenanceMessageByMonth:h,isEditingEnabled:m}=In(),M=c===be,L=c===j,E=c===re;return t(J,{title:a.update_maintenance_schedule,open:!0,onOk:e,onCancel:o,confirmLoading:s,okText:a.confirm,cancelText:a.cancel,width:"50%",footer:[t(ue,{onClick:o,children:a.cancel},"cancel"),t(ue,{onClick:e,type:"primary",children:a.confirm},"ok")],children:t(b,{onValuesChange:u,layout:"vertical",name:"form_update_maintenance_schedule",form:n,onFinish:e,initialValues:r,children:_(N,{gutter:16,children:[t(T,{span:12,children:t(b.Item,{dependencies:["endDate"],rules:[{required:!0},({getFieldValue:i})=>({validator(S,w){return w&&i("endDate")&&I(w).isAfter(i("endDate"))?Promise.reject(a.incoming_at_must_lower_or_equal_than_leaving_at):Promise.resolve()}})],label:a.start_time,name:"startDate",children:t(Ce,{fluid:"true",placeholder:Y,format:Y,allowClear:!0,disabled:m,disabledDate:i=>I(i).isBefore(I().subtract(1,"day"))})})}),t(T,{span:12,children:t(b.Item,{dependencies:["startDate"],rules:[({getFieldValue:i})=>({validator(S,w){return w&&i("startDate")&&I(w).isBefore(i("startDate"))?Promise.reject(a.incoming_at_must_lower_or_equal_than_leaving_at):Promise.resolve()}})],label:a.end_time,name:"endDate",children:t(Ce,{fluid:"true",placeholder:Y,format:Y,allowClear:!0,disabledDate:i=>I(i).isBefore(I().subtract(1,"day"))})})}),t(T,{span:24,css:i=>({marginBottom:i.margin.sm}),children:_($.Text,{disabled:m,strong:a.cycle_select,children:[a.cycle_select," *"," "]})}),t(T,{span:12,children:t(b.Item,{rules:[{required:!0}],label:`${a.frequency} (${a.repeat})`,name:"repeat",children:t(B,{disabled:m,placeholder:a.frequency,fluid:"true",getPopupContainer:i=>i.parentNode,children:de==null?void 0:de.map(({label:i,value:S})=>t(B.Option,{value:S,children:i},S))})})}),t(T,{span:12,children:t(b.Item,{children:t(b.Item,{label:a.interval,className:"site-input-group-wrapper",name:"interval",rules:[{required:!0}],children:_(z.Group,{compact:!0,children:[t(b.Item,{name:"interval",noStyle:!0,children:t(nt,{style:{width:"calc(100% - 50px)"},value:l,min:"1",formatter:i=>at(i),placeholder:a.interval,disabled:m})}),t(z,{style:{width:50,pointerEvents:"none",backgroundColor:"#fafafa",textAlign:"center"},value:a.times})]})})})}),L?t(T,{span:24,children:t(b.Item,{name:"byDays",label:a.select_day_in_week,rules:[{required:!0}],children:t(B,{disabled:m,mode:"multiple",allowClear:!0,fluid:"true",placeholder:a.select_day_in_week,getPopupContainer:i=>i.parentNode,children:H==null?void 0:H.map(({label:i,value:S})=>t(B.Option,{value:S,children:i},S))})})}):null,E?_(A,{children:[t(T,{span:12,children:t(b.Item,{name:"dayInMonth",label:a.select_date_time,rules:[{required:!0}],children:t(B,{disabled:m,allowClear:!0,fluid:"true",placeholder:a.select_date_time,getPopupContainer:i=>i.parentNode,children:le==null?void 0:le.map(({label:i,value:S})=>t(B.Option,{value:S,children:i},S))})})}),p?t(T,{span:12,children:t(b.Item,{rules:[{required:!0}],name:"byMonthDays",label:a.select_day_in_month,children:t(B,{disabled:m,mode:"multiple",allowClear:!0,fluid:"true",placeholder:a.select_day_in_month,getPopupContainer:i=>i.parentNode,children:f.map(i=>t(B.Option,{value:i,children:i},i))})})}):null]}):null,l&&M?t(T,{span:24,css:i=>({marginTop:i.margin.sm}),children:t(ge,{message:g,type:"warning",showIcon:!0,closable:!0})}):null,l&&L?t(T,{span:24,css:i=>({marginTop:i.margin.sm}),children:t(ge,{message:y,type:"warning",showIcon:!0,closable:!0})}):null,l&&E?t(T,{span:24,css:i=>({marginTop:i.margin.sm}),children:t(ge,{message:h,type:"warning",showIcon:!0,closable:!0})}):null]})})})},An=()=>{const{isFetchingMaintenanceSchedule:n,isFetchingDeleteMaintenanceSchedule:o,maintenanceScheduleSelected:e,handleShowModalAddMaintenanceSchedule:s,handleShowModalUpdateMaintenanceSchedule:r,onChangeMaintenanceSchedule:c,isEnLanguage:u,listMaintenanceSchedule:l,maintenancePlanPermissionWrite:p,isAddMaintenanceSchedule:f,modalAddMaintenanceSchedule:g,modalUpdateMaintenanceSchedule:y,handleDeleteScheduleMaintenance:h}=Ln(),m=async M=>{J.confirm({title:a.confirm,content:`${a.confirm_delete_maintenance_schedule}`,okText:a.confirm,okType:"danger",cancelText:a.cancel,confirmLoading:o,okBtnProps:{disabled:o,loading:o},onOk:async()=>(await h(M==null?void 0:M.id),Promise.resolve())})};return _(A,{children:[_(Ye,{span:8,title:a.maintenance_schedule,onClickButton:s,disabled:f,isHavePermissionCreate:p,children:[n&&t(He,{children:t(qe,{})}),!n&&(l.length>0?l.map(M=>t(Ke,{data:M,selected:(e==null?void 0:e.id)===M.id,title:M.repeat,isFetching:o,onClick:c,onClickEdit:r,onClickDelete:m,isShowIconArrowRight:!1,isHavePermissionWrite:p},M.id)):t(fe,{image:fe.PRESENTED_IMAGE_SIMPLE}))]}),g!=null&&g.isShow?t(En,{}):null,y!=null&&y.isShow?t(Pn,{}):null]})},kn=()=>t(Xe,{children:t(An,{})}),Fn=()=>{const{setTitlePage:n,setVisibleFilterBox:o,setVisibleSearchBox:e}=v.useContext(St),{idBuilding:s,setListGroupSystem:r,setGetListGroupSystemStatus:c,setGroupSystemSelected:u}=v.useContext(q);return v.useEffect(()=>(n(a.maintenance_plan),e(!1),(async()=>{var p;c({loading:!0});const l=await me(s);r((l==null?void 0:l.result)??[]),u((p=l==null?void 0:l.result)==null?void 0:p[0]),c({loading:!1})})(),()=>{n(""),e(!1),o(!1)}),[]),{}},On=()=>(Fn(),t(et.Wrapper,{children:t(et.Container,{children:_(N,{style:{flex:1},gutter:[0,0],children:[t(Zt,{}),t(_n,{}),t(kn,{})]})})})),Sa=()=>t(Lt,{children:t(On,{})});export{Sa as default};
