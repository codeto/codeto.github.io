import{j as t,u as Ue,a as P,b as fe,F as ee,c as xe}from"./@emotion-63839449.js";import{a as ce,l as G,N as B,w as Fe,P as M,D as te,d as St,O as we,e as vt,T as bt}from"./index-b17d22e5.js";import{F as y,u as pe}from"./index-687ba9e6.js";import{l as i,by as Be,a9 as V,s as z,cP as Ee,b0 as Ft,K as de,cf as Me,aL as Re,at as wt,bv as Ct,ax as xt,f_ as Et,I as Y,f$ as Tt,g0 as It,g1 as Nt,g2 as Pt,g3 as Ot,g4 as Rt,a1 as Lt,a0 as Te,S as Ie,g5 as kt,a3 as Ze,dq as Dt,a5 as re,bG as Ut,a as et,g6 as Bt,g7 as Qe,g8 as Yt,g9 as Vt,ga as jt,dk as Gt,gb as tt,gc as it,h as Pe,gd as zt}from"./index-c2ded735.js";import"./lodash-88fe09e6.js";import{h as m}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import{P as Ye}from"./index-d2c5b7c0.js";import{r as E}from"./react-4fd50329.js";import{P as J}from"./prop-types-1172f4d5.js";import"./react-redux-896b353b.js";import"./@firebase-43527ee1.js";import{u as Ht,a as $t}from"./react-router-a4308f7b.js";import{V as le,u as Qt,g as qt}from"./registrationFromSetting-8b4f2e37.js";import{F as Wt}from"./file-8888dc2a.js";import{R as q,b as x,a as ue,w as nt,T as me,I as Kt,B as W,c as qe,D as Jt,A as Xt,S as ot}from"./antd-f9eae174.js";import{I as $,S as se}from"./index-43183512.js";import{g as Mt}from"./getPageByTotalAndLimit-7f60b558.js";import{u as Zt}from"./useQuery-d54d310a.js";import{B as be}from"./index-881eef42.js";import{d as ei}from"./downloadFileFromUrl-79614833.js";import{c as Ve}from"./compareObject-7b349d22.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./classnames-4ba1ba1a.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";const ti="GUEST_OF_THE_RESIDENT",ii="WALK_IN",at=[{label:i.guest_of_resident,value:ti,color:"green"},{label:i.walk_in_guest,value:ii,color:"default"}],Le=Be(at,"value"),X="WAITING_FOR_APPROVED",K="APPROVED",rt="IN_PROGRESS",ni="COMPLETED",ie="CANCELLED",je="ALL",ke=[{label:i.waiting_for_approved,value:X},{label:i.approved,value:K},{label:i.in_progress,value:rt},{label:i.completed,value:ni},{label:i.canceled,value:ie},{label:i.all,value:je}],oi=Be(ke,"value"),ne={code:"",unitName:"",fullName:"",expectedIncomingAt:[],incomingAt:[],type:""},We="EMPLOYEE",Ke="EMPLOYEE",Oe={[We]:{label:i.employee,value:We},[Ke]:{label:i.resident,value:Ke}},_e="APPROVE",Ae="REJECT",ye="CHECK_IN",Se="CHECK_OUT",Ce="REMOVE",ai="create",ri="update",si="approved",li="in_progress",ci="completed",di="cancelled",ui=[{label:i.add,value:ai},{label:i.update,value:ri},{label:i.approve,value:si},{label:i.in_progress,value:li},{label:i.complete,value:ci},{label:i.button.cancel,value:di}],mi=Be(ui,"value"),H=E.createContext({idBuilding:0,tableData:{records:[],totalRecord:0},setTableData:()=>{},getsStatus:{isFetching:!1},setGetsStatus:()=>{},filter:{...ne},setFilter:()=>{},tablePagination:{current:V,limit:z},setTablePagination:()=>{},tableSelection:()=>{},settingRegistrationForms:[],setSettingRegistrationForm:()=>{},visitorSetting:{autoApprove:!1,status:Ee},formDetailData:{isShow:!1,data:{}},showFormAdd:()=>{},showFormDetail:()=>{},showFormUpdateStatus:()=>{},formUpdateStatusData:{isShow:!1,data:{}},hideFormDetail:()=>{},hideFormUpdateStatus:()=>{},hideFormAdd:()=>{},status:X,setStatus:()=>{},accessControlPermissionWrite:!1,accessControlPermissionExport:!1,accessControlPermissionApprove:!1,accessControlPermissionUpdateStatus:!1,formFilter:void 0,formUpdateEmployeeNote:{isShow:!1,data:{}},showFormUpdateEmployeeNote:()=>{},hideFormUpdateEmployeeNote:()=>{},formUpdateAccessManagement:{isShow:!1,data:{}},showFormUpdateAccessManagement:()=>{},hideFormUpdateAccessManagement:()=>{},formHistoryAccessManagement:{isShow:!1,data:{}},showFormHistoryAccessManagement:()=>{},hideFormHistoryAccessManagement:()=>{},dataHistory:[],setDataHistory:()=>{},formConfirmExit:!1,setFormConfirmExit:()=>{}}),Ge=({children:a})=>{const{getPermissionByModuleCode:l}=Ft(),e=Ht(),{idBuilding:o}=e,[n]=y.useForm(),[r,c]=E.useState({isFetching:!1}),[u,d]=E.useState([]),[f,b]=E.useState({...ne}),[v,g]=E.useState({current:V,limit:z}),[p,s]=E.useState({records:[],totalRecord:0}),[h,S]=E.useState(X),[w,C,A]=de(),[_,R,L]=de(),[D,N,F]=de(),[T,O,I]=de(),[k,U,j]=de(),[ae,ve,lt]=de(),[ct,dt]=E.useState([]),[ut,mt]=E.useState(!1),pt=E.useMemo(()=>(u==null?void 0:u.find(yt=>yt.type===le))??{autoApprove:!1,status:Me},[u]),Q=l(Re),ht=(Q==null?void 0:Q[wt])??!1,gt=(Q==null?void 0:Q[Ct])??!1,ft=(Q==null?void 0:Q[xt])??!1,_t=(Q==null?void 0:Q[Et])??!1,At={idBuilding:o,tableData:p,setTableData:s,getsStatus:r,setGetsStatus:c,filter:f,setFilter:b,tablePagination:v,setTablePagination:g,settingRegistrationForms:u,setSettingRegistrationForm:d,visitorSetting:pt,formDetailData:_,showFormDetail:R,hideFormDetail:L,formUpdateStatusData:D,showFormUpdateStatus:N,hideFormUpdateStatus:F,status:h,setStatus:S,formAddData:w,showFormAdd:C,hideFormAdd:A,accessControlPermissionWrite:ht,accessControlPermissionExport:gt,accessControlPermissionApprove:ft,accessControlPermissionUpdateStatus:_t,formFilter:n,formUpdateEmployeeNote:T,showFormUpdateEmployeeNote:O,hideFormUpdateEmployeeNote:I,formUpdateAccessManagement:k,showFormUpdateAccessManagement:U,hideFormUpdateAccessManagement:j,formHistoryAccessManagement:ae,showFormHistoryAccessManagement:ve,hideFormHistoryAccessManagement:lt,dataHistory:ct,setDataHistory:dt,formConfirmExit:ut,setFormConfirmExit:mt};return t(H.Provider,{value:At,children:a})};Ge.propTypes={children:J.node};Ge.defaultProps={children:t("div",{})};const pi=Ge,hi=()=>{var u;const{formDetailData:a,hideFormDetail:l}=E.useContext(H),[e]=y.useForm(),o=(u=a==null?void 0:a.data)==null?void 0:u.accessManagement,{images:n}=o,c=(d=>d==null?void 0:d.map(({image:f})=>{var v;return{url:f,fileName:f.substring((f==null?void 0:f.lastIndexOf("/"))+1),fileType:f.split(".").pop().toLowerCase(),icon:((v=Wt)==null?void 0:v[f.split(".").pop().toLowerCase()])??f}}))(n);return[l,e,(a==null?void 0:a.data.accessManagement)??{},c]},gi=()=>{var c,u;const[a,l,e,o]=hi(),n=(e==null?void 0:e.status)===ie,r=Ue();return t(ce,{open:!0,title:i.detail,onCancel:a,footer:null,width:"70%",children:P(y,{form:l,layout:"vertical",name:"detail",children:[P(q,{gutter:[r.margin.md,r.margin.md],style:{background:"#f7f7f7",padding:"10px 10px 0 10px",marginBottom:"15px"},children:[t(x,{span:"24",css:fe({marginBottom:r.margin.sm},"",""),children:t(ue.Text,{strong:i.visitor_information,children:i.visitor_information})}),t(x,{span:"8",children:t(y.Item,{label:i.registration_code,children:(e==null?void 0:e.code)??"-"})}),t(x,{span:"8",children:t(y.Item,{label:i.guest_full_name,children:(e==null?void 0:e.guestFullName)??"-"})}),t(x,{span:"8",children:t(y.Item,{label:i.id_card_or_pass_port,children:e!=null&&e.cardId?e==null?void 0:e.cardId:"-"})}),t(x,{span:"8",children:t(y.Item,{label:i.label.birthday,children:e!=null&&e.birthday?e==null?void 0:e.birthday:"-"})}),t(x,{span:"8",children:t(y.Item,{label:i.phone,children:(e==null?void 0:e.phone)??"-"})}),t(x,{span:"8",children:t(y.Item,{label:i.guest_type,children:t(nt,{color:e==null?void 0:e.guestTypeColor,children:(e==null?void 0:e.type)??"-"})})}),t(x,{span:"8",children:t(y.Item,{label:i.expected_incoming_leaving,children:e.expectedAt})}),t(x,{span:"8",children:t(y.Item,{label:i.incoming_leaving,children:e.realtime?e.realtime:"-"})}),t(x,{span:"8",children:t(y.Item,{label:i.relation_with_householder,children:(e==null?void 0:e.relationship)??"-"})})]}),P(q,{gutter:[r.margin.md,r.margin.md],style:{background:"#f7f7f7",padding:"10px 10px 0 10px",marginBottom:"15px"},children:[t(x,{span:"24",css:fe({marginBottom:r.margin.sm},"",""),children:t(ue.Text,{strong:n?i.inviter_information:i.unit_information,children:n?i.inviter_information:i.unit_information})}),t(x,{span:"8",children:t(y.Item,{label:i.unit,children:(e==null?void 0:e.unitName)??"-"})}),t(x,{span:"8",children:t(y.Item,{label:i.inviter_full_name,children:(e==null?void 0:e.inviterFullName)??"-"})})]}),P(q,{gutter:[r.margin.md,r.margin.md],style:{background:"#f7f7f7",padding:"10px 10px 0 10px"},children:[t(x,{span:"24",css:fe({marginBottom:r.margin.sm},"",""),children:t(ue.Text,{strong:i.registration_information,children:i.registration_information})}),t(x,{span:"8",children:t(y.Item,{label:i.creator,children:(e==null?void 0:e.employeeName)??"-"})}),t(x,{span:"8",children:t(y.Item,{label:i.created_time,children:e.createdAt})}),t(x,{span:"8",children:t(y.Item,{label:i.status1,children:((c=oi[(e==null?void 0:e.status)??""])==null?void 0:c.label)??"-"})}),t(x,{span:"8",children:t(y.Item,{label:i.approved_at,children:e.approvedAt})}),t(x,{span:"8",children:t(y.Item,{label:i.note,children:e!=null&&e.description?e==null?void 0:e.description:"-"})}),(e==null?void 0:e.status)===ie?P(ee,{children:[t(x,{span:"8",children:t(y.Item,{label:i.cancel_by,children:e.cancelBy||"-"})}),t(x,{span:"8",children:t(y.Item,{label:i.canceler,children:e.canceler||"-"})}),t(x,{span:"8",children:t(y.Item,{label:i.cancel_at,children:e.canceledAt})}),t(x,{span:"8",children:t(y.Item,{label:i.reason,children:(e==null?void 0:e.reason)??"-"})})]}):null,((u=e==null?void 0:e.images)==null?void 0:u.length)>0?P(x,{span:"24",children:[t(ue,{children:i.attached_files}),t(q,{gutter:[r.margin.md,r.margin.md],children:o==null?void 0:o.map((d,f)=>t(x,{style:{width:"10%"},children:t(me,{title:d.fileName,children:P("figure",{className:"upload__item",style:{margin:"15px 0px"},children:[t(Kt,{title:d.fileName,src:d.icon,width:"100%",height:"80px",preview:!1,alt:d.fileName,style:{cursor:"pointer",objectFit:"cover",borderRadius:"5px"}}),t("div",{className:"upload__item__action",style:{zIndex:1e6,width:"100%"},children:t(Y,{name:"icon-eye-outlined",style:{fontSize:"20px"},onClick:()=>{Ye.open({url:d.url})}})})]})})},f))})]}):null]})]})})},oe=()=>{const{getAllQuery:a,setQuery:l}=Zt(),{setTablePagination:e,setStatus:o,setFilter:n,formFilter:r}=E.useContext(H);return{getQueryParamsAccessManagement:d=>{var L,D,N,F;const{limit:f,page:b,status:v,code:g,unitName:p,fullName:s,type:h,expectedIncomingFrom:S,expectedIncomingTo:w,incomingFrom:C,incomingTo:A}=a(),_={pagination:{limit:f&&+f||z,page:b&&+b||V},status:v||X,filter:{code:g||"",unitName:p||"",fullName:s||"",expectedIncomingAt:S&&w&&m(S,"DD/MM/YYYY",!0).isValid()&&m(w,"DD/MM/YYYY",!0).isValid()?[m(S,"DD/MM/YYYY",!0),m(w,"DD/MM/YYYY",!0)]:[],incomingAt:C&&A&&m(C,"DD/MM/YYYY",!0).isValid()&&m(A,"DD/MM/YYYY",!0).isValid()?[m(C,"DD/MM/YYYY",!0),m(A,"DD/MM/YYYY",!0)]:[],type:h||""}};d&&_.status===X&&(_.status=K),e({limit:_.pagination.limit,current:_.pagination.page}),o(_.status),n({..._.filter}),r.setFieldsValue({..._.filter});const R={limit:_.pagination.limit,page:_.pagination.page,status:_.status,code:(L=_.filter)==null?void 0:L.code,unitName:(D=_.filter)==null?void 0:D.unitName,fullName:(N=_.filter)==null?void 0:N.fullName,type:(F=_.filter)==null?void 0:F.type,expectedIncomingFrom:"",expectedIncomingTo:"",incomingFrom:"",incomingTo:""};return Array.isArray(_.filter.expectedIncomingAt)&&_.filter.expectedIncomingAt.length&&(R.expectedIncomingFrom=m(_.filter.expectedIncomingAt[0]).format("DD/MM/YYYY"),R.expectedIncomingTo=m(_.filter.expectedIncomingAt[1]).format("DD/MM/YYYY")),Array.isArray(_.filter.incomingAt)&&_.filter.incomingAt.length&&(R.incomingFrom=m(_.filter.incomingAt[0]).format("DD/MM/YYYY"),R.incomingTo=m(_.filter.incomingAt[1]).format("DD/MM/YYYY")),l(R),_},setQueryParamsAccessManagement:({limit:d=z,page:f=V,status:b=X,filter:v=ne})=>{const{code:g="",unitName:p="",fullName:s="",expectedIncomingAt:h=null,incomingAt:S=null,type:w=""}=v,C={limit:d,page:f,status:b,code:g,unitName:p,fullName:s,type:w,expectedIncomingFrom:"",expectedIncomingTo:"",incomingFrom:"",incomingTo:""};Array.isArray(h)&&h.length&&(C.expectedIncomingFrom=m(h[0]).format("DD/MM/YYYY"),C.expectedIncomingTo=m(h[1]).format("DD/MM/YYYY")),Array.isArray(S)&&S.length&&(C.incomingFrom=m(S[0]).format("DD/MM/YYYY"),C.incomingTo=m(S[1]).format("DD/MM/YYYY")),l(C)}}},ge=async({id:a,body:l={},type:e,idBuilding:o})=>{try{let n=null;switch(e){case _e:n=await Ot(a,l,o);break;case Ae:n=await Pt(a,l,o);break;case ye:n=await Nt(a,l,o);break;case Se:n=await It(a,l,o);break;case Ce:n=await Tt(a,l,o);break;default:break}return n}catch(n){return n}},fi=(a,l)=>a.map(e=>{var s,h,S,w,C,A,_,R,L,D,N,F,T,O,I,k,U,j;const o=e==null?void 0:e.expectedIncomingAt,n=e==null?void 0:e.expectedLeavingAt,r=e==null?void 0:e.incomingAt,c=e==null?void 0:e.leavingAt,{createdAt:u}=e,d=(h=(s=e==null?void 0:e.changeStatusBy)==null?void 0:s[K])==null?void 0:h.time,f=(w=(S=e==null?void 0:e.changeStatusBy)==null?void 0:S[ie])==null?void 0:w.time,b=(_=Oe==null?void 0:Oe[(A=(C=e==null?void 0:e.changeStatusBy)==null?void 0:C[ie])==null?void 0:A.type])==null?void 0:_.label,v=l?"***":(L=(R=e==null?void 0:e.changeStatusBy)==null?void 0:R[ie])==null?void 0:L.name,g=e!=null&&e.birthday?m(e==null?void 0:e.birthday).format(G):"",p=(D=e==null?void 0:e.changeStatusBy)!=null&&D[K]?(F=(N=e==null?void 0:e.changeStatusBy)==null?void 0:N[K])==null?void 0:F.name:"";return{key:e.id,id:e.id,code:e==null?void 0:e.code,status:e.status,apartment:(T=e==null?void 0:e.unit)==null?void 0:T.name,guestFullName:l?"***":e.name,phone:l?"***":e.phone,cardId:l?"***":e.cardId,type:(O=Le[e==null?void 0:e.type])==null?void 0:O.label,guestTypeColor:(I=Le[e==null?void 0:e.type])==null?void 0:I.color,inviterFullName:l?"***":(k=e==null?void 0:e.resident)==null?void 0:k.fullName,relation:e.relationship,description:e.description,expectedAt:`${o?m(o).format(B):""}${n?` - ${m(n).format(B)}`:""}`,realtime:`${r?m(r).format(B):""}${c?` - ${m(c).format(B)}`:""}`,expectedIncomingAt:o?m(o):"",expectedLeavingAt:n?m(n):"",createdAt:u?m(u).format(B):"-",approvedAt:d?m(d).format(B):"-",canceledAt:f?m(f).format(B):"-",cancelBy:b,canceler:v,reason:(e==null?void 0:e.reason)??"-",unitName:((U=e==null?void 0:e.unit)==null?void 0:U.name)??"-",relationship:(e==null?void 0:e.relationship)??"-",employeeName:l?"***":((j=e==null?void 0:e.employee)==null?void 0:j.fullName)??"-",employeeId:(e==null?void 0:e.employeeId)??"",unitId:(e==null?void 0:e.unitId)??null,confirmer:p,images:(e==null?void 0:e.images)??[],birthday:l?"***":g,birthdayOrigin:(e==null?void 0:e.birthday)??"",residentId:(e==null?void 0:e.residentId)??null}}),_i=async({filter:a,limit:l,page:e,idBuilding:o,isUserCs:n})=>{const{expectedIncomingAt:r=void 0,incomingAt:c=void 0,unitName:u,code:d,fullName:f,type:b,status:v}=a,g=(r==null?void 0:r.length)>1?m(r[0]).startOf("day").toDate():void 0,p=(r==null?void 0:r.length)>1?m(r[1]).endOf("day").toDate():void 0,s=(c==null?void 0:c.length)>1?m(c[0]).startOf("day").toDate():void 0,h=(c==null?void 0:c.length)>1?m(c[1]).endOf("day").toDate():void 0,w=await Rt({filter:{expectedIncomingAtFrom:g,expectedIncomingAtTo:p,incomingAtFrom:s,incomingAtTo:h,unitName:u||void 0,code:d||void 0,name:f||void 0,type:b||void 0,status:v===je?void 0:v},limit:l,page:e,idBuilding:o}),C=fi((w==null?void 0:w.data)??[],n),A=(w==null?void 0:w.totalRecord)??0;return[C,A]},he=()=>{const{setTableData:a,idBuilding:l,setGetsStatus:e}=E.useContext(H),{isUserCs:o}=Lt();return[async({filter:r,limit:c,page:u})=>{e({isFetching:!0});const[d,f]=await _i({filter:r,limit:c,page:u,idBuilding:l,isUserCs:o});a({records:d,totalRecord:f}),e({isFetching:!1})}]},Ai=()=>{const{formUpdateStatusData:a,hideFormUpdateStatus:l,idBuilding:e,filter:o,status:n,tablePagination:r,tableData:c}=E.useContext(H),{setQueryParamsAccessManagement:u}=oe(),[d,f]=E.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),{getAccessManagementBadges:b}=Te(),[v]=y.useForm(),[g]=he(),p={id:a.data.accessManagement.id,idBuilding:e};pe(d.code,d.codeLanguage,{message:i.success,description:i.update_data_success});const s=async()=>(p.type=_e,p.body={},await ge(p)),h=async()=>{if(await v.validateFields())return p.type=Ae,p.body={reason:v.getFieldValue("reason")},await ge(p)},S=async()=>{var D,N;const R=((D=v.getFieldValue("images"))==null?void 0:D.fileList)??[],L=((N=R.map(F=>{var T,O;return((O=(T=F==null?void 0:F.response)==null?void 0:T.data)==null?void 0:O.url)??void 0}))==null?void 0:N.filter(Boolean))??[];if(R.length===0||L.length>0&&L.length===R.length)return p.type=ye,p.body={note:v.getFieldValue("note"),images:L},await ge(p)},w=async()=>{var D,N;const R=((D=v.getFieldValue("images"))==null?void 0:D.fileList)??[],L=((N=R.map(F=>{var T,O;return((O=(T=F==null?void 0:F.response)==null?void 0:T.data)==null?void 0:O.url)??void 0}))==null?void 0:N.filter(Boolean))??[];if(R.length===0||L.length>0&&L.length===R.length)return p.type=Se,p.body={note:v.getFieldValue("note"),images:L},await ge(p)},C=async()=>(p.type=Ce,p.body={},await ge(p)),A={[_e]:s,[Ae]:h,[ye]:S,[Se]:w,[Ce]:C};return[async()=>{if(await v.validateFields()){f({code:void 0,codeLanguage:void 0,isFetching:!0});const L=await A[a.data.type]();if(f({code:L.code||void 0,codeLanguage:L.codeLanguage||void 0,isFetching:!1}),Ie.includes(L.code)){const D=Mt(c.totalRecord-1,r.limit,r.current),N=r.current===D;N&&await g({limit:r.limit,page:r.current,filter:{...o,status:n}}),N||u({limit:r.limit,page:D,status:n,filter:{...o}}),await b(e),l()}}},v,d.isFetching,a.data.type]};var yi={name:"1kevbid",styles:"& .ant-upload{width:100%;}"},Si={name:"1kevbid",styles:"& .ant-upload{width:100%;}"};const vi=()=>{const[a,l,e,o]=Ai(),{hideFormUpdateStatus:n}=E.useContext(H);return P(ce,{title:i.confirm,open:!0,loading:e,okText:i.confirm,cancelText:i.cancel,onOk:a,onCancel:n,okButtonProps:{disabled:e,loading:e},children:[o===_e&&P("p",{children:[i.do_you_want_to_approve_this_registration_form,"?"]}),o===Ae&&P(y,{initialValues:{reason:""},form:l,name:"formUpdate",layout:"vertical",children:[t("div",{style:{marginBottom:12},children:P("span",{children:[i.do_you_want_to_reject_this_registration_form,"?"]})}),t(y.Item,{rules:[{required:!0}],name:"reason",label:i.reason,children:t($.TextArea,{maxLength:"255",placeholder:i.reason,rows:"2"})})]}),o===ye&&P(y,{initialValues:{note:"",images:[]},form:l,name:"formUpdate",layout:"vertical",children:[t("div",{style:{marginBottom:12},children:P("span",{children:[i.guest_incoming,"?"]})}),t(x,{span:"24",children:t(y.Item,{name:"images",label:i.image_attach,children:t(Fe,{maxCount:5,accept:"image/*",listType:"picture",multiple:!0,module:Re,css:Si,children:t(W,{block:!0,icon:t(Y,{name:"icon-upload-outlined",css:r=>({marginRight:r.marginSm,fontSize:"16px"})}),children:i.image_attach})})})})]}),o===Se&&P(y,{initialValues:{note:"",images:[]},form:l,name:"formUpdate",layout:"vertical",children:[t("div",{style:{marginBottom:12},children:P("span",{children:[i.guest_leaving,"?"]})}),t(x,{span:"24",children:t(y.Item,{name:"images",label:i.image_attach,children:t(Fe,{maxCount:5,accept:"image/*",listType:"picture",multiple:!0,module:Re,css:yi,children:t(W,{block:!0,icon:t(Y,{name:"icon-upload-outlined",css:r=>({marginRight:r.marginSm,fontSize:"16px"})}),children:i.image_attach})})})})]}),o===Ce&&P("p",{children:[i.do_you_want_to_remove_this_access_history,"?"]})]})},st=async(a,l,e)=>{var u;const n={formConfigs:[...((u=a==null?void 0:a.filter(d=>d.type!==le))==null?void 0:u.map(d=>({type:d.type,status:d.status})))??[],{type:le,status:l.status?Ee:Me,autoApprove:l.autoApprove}]},{code:r,codeLanguage:c}=await Qt(n,e);return[r,c]},ze=({setVisibleSettingOverlay:a})=>{const[l]=y.useForm(),{idBuilding:e,visitorSetting:o,settingRegistrationForms:n,setSettingRegistrationForm:r,filter:c,status:u}=E.useContext(H),{setQueryParamsAccessManagement:d}=oe(),[f,b]=E.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),{getAccessManagementBadges:v}=Te();return pe(f.code,f.codeLanguage,{message:i.success,description:i.update_data_success}),[async()=>{b({code:void 0,codeLanguage:void 0,isFetching:!0});try{const p={autoApprove:l.getFieldValue("autoApprove"),status:l.getFieldValue("status")},[s,h]=await st(n,p,e);a(!1),b({code:s,codeLanguage:h,isFetching:!1});const S=[...n.filter(w=>w.type!==le),{...o,...p}];r(S),u===X&&p.autoApprove&&d({current:V,limit:z,filter:{...c},status:K}),await v(e)}catch(p){b({code:p.code,codeLanguage:p.codeLanguage,isFetching:!1})}},{autoApprove:o.autoApprove,status:o.status===Ee},f,l]};ze.propTypes={setVisibleSettingOverlay:J.func};ze.defaultProps={setVisibleSettingOverlay:()=>{}};const He=({setVisibleSettingOverlay:a})=>{const[l,e,o,n]=ze({setVisibleSettingOverlay:a});return t(be,{rise:!0,children:P(y,{initialValues:e,layout:"vertical",form:n,name:"formSetting",children:[t(be.Header,{}),P(be.Content,{children:[t(y.Item,{name:"status",valuePropName:"checked",children:t(qe,{children:i.active})}),t(y.Item,{name:"autoApprove",valuePropName:"checked",children:t(qe,{children:i.auto_approve_registration_form_of_resident})})]}),t(be.Footer,{borderTop:!0,style:{textAlign:"right"},children:t(W,{loading:o.isFetching,htmlType:"submit",onClick:l,children:i.confirm})})]})})};He.propTypes={setVisibleSettingOverlay:J.func};He.defaultProps={setVisibleSettingOverlay:()=>{}};const bi=async(a,l)=>{const{expectedIncomingAt:e=void 0,incomingAt:o=void 0,unitName:n,code:r,fullName:c,type:u,status:d}=a,f=e&&e.length>1?m(e[0]).startOf("day").toDate():void 0,b=e&&e.length>1?m(e[1]).endOf("day").toDate():void 0,v=o&&o.length>1?m(o[0]).startOf("day").toDate():void 0,g=o&&o.length>1?m(o[1]).endOf("day").toDate():void 0,s=await kt({expectedIncomingAtFrom:f,expectedIncomingAtTo:b,incomingAtFrom:v,incomingAtTo:g,unitName:n||void 0,code:r||void 0,name:c||void 0,type:u||void 0,status:d===je?void 0:d},l);return{data:s.data,code:s.code}},Fi=()=>{const{filter:a,idBuilding:l,tableData:e,status:o,showFormAdd:n,accessControlPermissionExport:r,accessControlPermissionWrite:c,accessControlPermissionApprove:u}=E.useContext(H),[d,f]=E.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),[b,v]=E.useState(!1);pe(d.code,d.codeLanguage,{message:i.success,description:i.export_data_success});const g=async()=>{f({code:void 0,codeLanguage:void 0,isFetching:!0});const S=await bi({...a,status:o},l);S.data&&ei(S.data,document,"thong-tin-lich-su-ra-vao.xlsx"),f({code:S.code,codeLanguage:S.codeLanguage,isFetching:!1})},{totalRecord:p}=e;return{visibleSettingOverlay:b,setVisibleSettingOverlay:v,onClickBtnExportDataAccessManagements:g,totalRecord:p,onVisibleSettingOverlayChange:S=>{v(S)},accessManagementExportState:d,onClickBtnAdd:()=>{n()},accessControlPermissionExport:r,accessControlPermissionWrite:c,accessControlPermissionApprove:u}},wi=()=>{const{visibleSettingOverlay:a,setVisibleSettingOverlay:l,onClickBtnExportDataAccessManagements:e,totalRecord:o,onVisibleSettingOverlayChange:n,accessManagementExportState:r,onClickBtnAdd:c,accessControlPermissionExport:u,accessControlPermissionWrite:d,accessControlPermissionApprove:f}=Fi(),b=Ze(),v=[f?t(Jt,{open:a,onOpenChange:n,trigger:["click"],dropdownRender:()=>t(He,{setVisibleSettingOverlay:l}),css:g=>({marginRight:g.margin.xs}),children:t(W,{type:"primary",ghost:!0,icon:t(Y,{name:"icon-setting-outlined"}),children:i.setting})},"setting"):null,u?t(W,{type:"primary",ghost:!0,loading:r.isFetching,icon:t(Y,{name:"icon-download-outlined"}),onClick:()=>{b({action:Dt,label:re}),e()},css:g=>({marginRight:g.margin.xs}),children:i.export},"export"):null,d?t(W,{onClick:()=>{b({action:Ut,label:re}),c()},type:"primary",icon:t(Y,{name:"icon-plus-circle-outlined"}),children:i.add},"add"):null].filter(Boolean);return t(M.ActionBox,{total:t(ee,{children:o}),actions:v})},Ci=()=>{const{status:a,formFilter:l,filter:e,tablePagination:o}=E.useContext(H),{setQueryParamsAccessManagement:n}=oe(),[r]=he();return[async u=>{const d=Ve(u,e);d&&await r({filter:{...u,status:a},limit:o.limit,page:o.current}),d||n({limit:z,page:V,filter:{...u},status:a})},ne,l]},xi=()=>{const[a,l,e]=Ci(),o=E.useMemo(()=>[{label:i.registration_code,key:"code",component:t($,{placeholder:i.registration_code}),visible:!0},{label:i.unit,key:"unitName",component:t($,{placeholder:i.unit}),visible:!0},{label:i.full_name,key:"fullName",component:t($,{placeholder:i.full_name}),visible:!0},{label:i.guest_type,key:"type",component:P(se,{fluid:"true",placeholder:i.guest_type,getPopupContainer:n=>n.parentNode,children:[t(se.Option,{value:"",children:i.all_guest},"guest_type_0"),at.map(n=>t(se.Option,{value:n.value,children:n.label},n.value))]}),visible:!0},{label:i.expected_incoming_at,key:"expectedIncomingAt",component:t(te.RangePicker,{fluid:!0,placeholder:[G,G],format:[G,G],getPopupContainer:n=>n.parentNode}),visible:!0},{label:i.incoming_at,key:"incomingAt",component:t(te.RangePicker,{fluid:!0,placeholder:[G,G],format:[G,G],getPopupContainer:n=>n.parentNode}),visible:!0}],[]);return t(M.FilterBox,{defaultFilter:l,filters:o,onSearch:a,formData:e})},Ei=()=>{const{setTablePagination:a,filter:l,visitorSetting:e,setStatus:o,status:n}=E.useContext(H),{setQueryParamsAccessManagement:r}=oe(),c=async d=>{d!==n&&(o(d),a({current:V,limit:z}),r({limit:z,page:V,status:d,filter:l}))};E.useEffect(()=>{n===X&&(e!=null&&e.autoApprove)&&o(K)},[e,n]);const u=E.useMemo(()=>e!=null&&e.autoApprove?ke.filter(d=>d.value!==X):ke,[e]);return[c,u,n]},Ti=()=>{const[a,l,e]=Ei();return t(M.Tabs,{activeKey:e,onTabChange:a,tabs:l})},Ii=()=>{const{status:a,getsStatus:l,tablePagination:e,setTablePagination:o,tableData:n,filter:r,showFormDetail:c,showFormUpdateStatus:u,accessControlPermissionApprove:d,accessControlPermissionUpdateStatus:f,showFormUpdateEmployeeNote:b,accessControlPermissionWrite:v,showFormUpdateAccessManagement:g,showFormHistoryAccessManagement:p}=E.useContext(H),{layoutScrollRef:s}=E.useContext(et),h=Ue(),{setQueryParamsAccessManagement:S}=oe(),w=async(I,k)=>{let{current:U,limit:j}=e;I!==U&&(U=I),k!==j&&(j=k,U=V),S({limit:j,page:U,status:a,filter:r}),o({current:U,limit:j})},C=I=>{c({accessManagement:I})},A=I=>{u({accessManagement:I,type:_e})},_=I=>{u({accessManagement:I,type:Ae})},R=I=>{u({accessManagement:I,type:ye})},L=I=>{u({accessManagement:I,type:Se})},D=I=>{b({accessManagement:I})},N=I=>{g({accessManagement:I})},F=I=>{p({accessManagement:I})},T={pageSize:e.limit,defaultCurrent:V,current:e.current,total:n.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:w},O={offsetScroll:h.offsetScrollX,getContainer:()=>s.current};return{onClickBtnDetail:C,onClickBtnApprove:A,onClickBtnReject:_,onClickBtnCheckIn:R,onClickBtnCheckOut:L,sticky:O,dataSource:n.records,accessManagementTablePagination:T,loading:l.isFetching,accessControlPermissionApprove:d,accessControlPermissionUpdateStatus:f,accessControlPermissionWrite:v,onClickUpdateEmployeeNote:D,onClickBtnUpdate:N,onClickBtnHistory:F}},Je=xe("div",{target:"e1dndca60"})({name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"}),Ni=()=>{const{onClickBtnDetail:a,onClickBtnApprove:l,onClickBtnReject:e,onClickBtnCheckIn:o,onClickBtnCheckOut:n,sticky:r,dataSource:c,accessManagementTablePagination:u,loading:d,accessControlPermissionApprove:f,accessControlPermissionUpdateStatus:b,accessControlPermissionWrite:v,onClickUpdateEmployeeNote:g,onClickBtnUpdate:p,onClickBtnHistory:s}=Ii(),h=Ze(),S=[{title:i.registration_code,key:"code",dataIndex:"code",width:150,fixed:"left"},{title:i.unit,key:"apartment",dataIndex:"apartment",width:120,fixed:"left"},{title:i.inviter_full_name,key:"inviterFullName",dataIndex:"inviterFullName",width:150},{title:i.guest_full_name,key:"guestFullName",dataIndex:"guestFullName",width:150},{title:i.label.birthday,key:"birthday",dataIndex:"birthday",width:150},{title:i.id_card_or_pass_port,key:"cardId",dataIndex:"cardId",width:170},{title:i.phone,key:"phone",dataIndex:"phone",width:150},{title:i.guest_type,key:"type",dataIndex:"type",width:120,render:(C,A)=>C?t(nt,{color:A==null?void 0:A.guestTypeColor,children:C}):null},{title:i.expected_incoming_leaving,key:"expectedAt",dataIndex:"expectedAt",width:250},{title:i.incoming_leaving,key:"realtime",dataIndex:"realtime",width:250},{title:i.relation_with_householder,key:"relation",dataIndex:"relation",width:200},{title:i.note,key:"description",dataIndex:"description",width:200,render:(C,A)=>(C==null?void 0:C.length)>20?t(me,{title:C,placement:"topLeft",children:t(Je,{children:C})}):t(Je,{children:C})},{title:i.action,key:"action",dataIndex:"action",width:180,align:"center",fixed:"right",render:(C,A)=>P(ee,{children:[t(Y,{onClick:()=>a(A),name:"icon-eye-outlined",css:_=>({fontSize:_.iconSize}),title:i.detail}),v&&(A==null?void 0:A.residentId)!==null&&(A==null?void 0:A.status)!==ie?t(Y,{title:i.update_note,onClick:()=>g(A),name:"icon-edit-outlined",css:_=>({marginLeft:_.margin.xs,fontSize:_.iconSize})}):null,v&&(A==null?void 0:A.residentId)===null&&![ie].includes(A==null?void 0:A.status)?t(Y,{title:i.update_visitor,onClick:()=>{p(A)},name:"icon-edit-outlined",css:_=>({fontSize:_.iconSize,marginLeft:_.margin.xs,marginRight:_.marginXs})}):null,t(Y,{title:i.history,css:_=>({fontSize:_.iconSize,marginLeft:_.margin.xs,marginRight:_.marginXs}),name:"icon-history-filled",onClick:()=>s(A)}),(A==null?void 0:A.status)===X&&f?P(ee,{children:[t(Y,{css:_=>({marginLeft:_.margin.xs,fontSize:_.iconSize}),onClick:()=>{h({action:Bt,label:re}),l(A)},name:"icon-check-outlined",title:i.confirm}),t(Y,{onClick:()=>{h({action:Qe,label:re}),e(A)},name:"icon-close-circle-outlined",css:_=>({marginLeft:_.margin.xs,fontSize:_.iconSize}),title:i.reject})]}):null,(A==null?void 0:A.status)===K&&b?t(ee,{children:t(Y,{css:_=>({marginLeft:_.margin.xs,fontSize:_.iconSize}),onClick:()=>{h({action:Yt,label:re}),o(A)},name:"icon-exit-to-app-outlined",title:i.guest_incoming})}):null,(A==null?void 0:A.status)===K&&f?t(ee,{children:t(Y,{onClick:()=>{h({action:Qe,label:re}),e(A)},name:"icon-close-circle-outlined",css:_=>({marginLeft:_.margin.xs,fontSize:_.iconSize}),title:i.reject})}):null,(A==null?void 0:A.status)===rt&&b?t(ee,{children:t(Y,{css:_=>({marginLeft:_.margin.xs,fontSize:_.iconSize}),onClick:()=>{h({action:Vt,label:re}),n(A)},name:"icon-export-outlined",title:i.guest_leaving})}):null]})}].filter(Boolean),w={x:S.reduce((C,A)=>A+C.width,0),scrollToFirstRowOnChange:!0};return t(M.Table,{sticky:r,scroll:w,columns:S,dataSource:c,loading:d,pagination:u})};var Pi={name:"99halj",styles:"color:#2424f3"};const Oi=xe("span",{target:"e11snra90"})("cursor:pointer;width:85%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;",a=>a.isUploaded&&Pi,";"),$e=({file:a,handlePreviewAttachment:l})=>t(Oi,{title:a.name,onClick:()=>l(a),children:a.name});$e.propTypes={file:J.objectOf(J.any),handlePreviewAttachment:J.func};$e.defaultProps={file:{},handlePreviewAttachment:()=>{}};const Ri=xe("div",{target:"e8ahjgw0"})({name:"seoft9",styles:"display:flex;justify-content:space-between;margin:10px;&:hover{background:#f7f7f7;}"}),Ne=({file:a,handlePreviewAttachment:l,handleRemoveFile:e})=>{const o=Ue();return P(Ri,{children:[P(q,{style:{flexFlow:"row"},children:[t(Y,{name:"icon-attachment-outlined",css:fe({fontsize:o.iconSize,marginRight:o.margin.xs},"","")}),t($e,{file:a,handlePreviewAttachment:l})]}),t(Y,{name:"icon-delete-outlined",css:fe({fontsize:o.iconSize,marginLeft:o.margin.xs},"",""),onClick:()=>{e(a==null?void 0:a.uid)}})]},a)};Ne.propTypes={file:J.objectOf(J.any),handlePreviewAttachment:J.func,handleRemoveFile:J.func};Ne.defaultProps={file:{},handlePreviewAttachment:()=>{},handleRemoveFile:()=>{}};const Li=async(a,l)=>{try{const{expectedIncomingAt:e,expectedLeavingAt:o,incomingAt:n,phone:r,relationship:c,files:u,unit:d,description:f,birthday:b}=a,v={name:(a==null?void 0:a.guestFullName)??"",cardId:(a==null?void 0:a.cardId)??"",phone:`${r.countryCode}${r.phoneNumber}`,expectedIncomingAt:e?m(e).toDate():void 0,expectedLeavingAt:o?m(o).toDate():void 0,incomingAt:n?m(n).toDate():void 0,relationship:c||null,images:u||[],unitId:d||null,description:f||null,isSave:!1,birthday:b?m(b).toDate():void 0};return await jt(v,l)}catch(e){return e}},De=async({filter:a,limit:l,page:e,idBuilding:o})=>{try{return await Gt({filter:a,limit:l,page:e,idBuilding:o})}catch(n){return n}},ki=()=>{const[a]=y.useForm(),{getAccessManagementBadges:l}=Te(),{setQueryParamsAccessManagement:e}=oe(),{hideFormAdd:o,idBuilding:n,tablePagination:r,filter:c,status:u,formConfirmExit:d,setFormConfirmExit:f}=E.useContext(H),[b]=he(),[v,g]=E.useState({data:[],isFetching:!1}),[p,s]=E.useState([]),[h,S]=E.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),w=({file:F,fileList:T})=>{let O=T;F.status==="removed"&&(O=T),(F.status==="done"||F.status==="uploading")&&(O=T),F.status||(O=T.filter(I=>I.uid!==F.uid)),s(O.filter(I=>["done","uploading"].includes(I.status)))};E.useEffect(()=>{(async()=>{g({data:[],isFetching:!0});const F=await De({idBuilding:n,limit:z,page:V,filter:{name:void 0}});g({data:F.data,isFetching:!1})})()},[]);const C=F=>{var T,O;Ye.open({url:(O=(T=F==null?void 0:F.response)==null?void 0:T.data)==null?void 0:O.url})},A=F=>{const T=p.filter(O=>O.uid!==F);s(T)},_=(F,T)=>{f(!0)},R=async F=>{g({...v,isFetching:!0});const T=await De({idBuilding:n,limit:z,page:V,filter:{name:F||void 0}});g({data:T.data,isFetching:!1})};pe(h.code,h.codeLanguage,{message:i.success,description:i.add_data_success});const L=async()=>{var I;const F=await a.validateFields(),T=a.getFieldValue("visitorAttachFiles");let O=[];if(p!=null&&p.length?O=(p==null?void 0:p.map(k=>{var U,j;return((j=(U=k==null?void 0:k.response)==null?void 0:U.data)==null?void 0:j.url)??(k==null?void 0:k.url)}))??[]:O=((I=T==null?void 0:T.map(k=>(k==null?void 0:k.url)??null))==null?void 0:I.filter(Boolean))??[],F){S({code:void 0,codeLanguage:void 0,isFetching:!0});const k=a.getFieldsValue(),U=await Li({...k,files:O},n);if(S({code:U.code,codeLanguage:U.codeLanguage,isFetching:!1}),Ie.includes(U.code)){const j={limit:r.limit,page:r.current,filter:{...c},status:u},ae={limit:z,page:V,filter:{...ne},status:K},ve=Ve(ae,j);ve&&await b({limit:z,page:V,filter:{...ne,status:K}}),ve||e({...ae}),await l(n),o()}}},D=()=>{d?ce.confirm({cancelText:i.cancel,okText:i.confirm,title:i.confirm,content:i.the_content_you_enter_has_not_been_saved_are_you_sure_you_want_to_exit_this_screen,onOk:()=>{f(!1),o()}}):o()},N={guestFullName:"",cardId:"",phone:"",unit:void 0,relationship:void 0,note:"",images:[]};return{onCancelCreateAccessManagement:D,handleAddAccessManagement:L,formAdd:a,isFetchingAdd:h.isFetching,isFetchingApartment:v.isFetching,apartmentData:v.data,handleSearchApartment:R,fileList:p,handlePreviewAttachment:C,handleChange:w,handleRemoveFile:A,initialValues:N,onValuesChange:_}};var Di={name:"1kevbid",styles:"& .ant-upload{width:100%;}"};const Ui=()=>{const{onCancelCreateAccessManagement:a,handleAddAccessManagement:l,formAdd:e,isFetchingAdd:o,isFetchingApartment:n,apartmentData:r,handleSearchApartment:c,fileList:u,handlePreviewAttachment:d,handleChange:f,handleRemoveFile:b,initialValues:v,onValuesChange:g}=ki(),p=P(q,{style:{justifyContent:"space-between",alignItems:"center"},children:[t(ue.Text,{children:i.add_access_history}),P(q,{children:[t(W,{onClick:a,style:{marginRight:10},children:i.cancel}),t(W,{type:"primary",onClick:l,disabled:o,loading:o,children:i.add})]})]}),s=t(x,{span:"24",style:{textAlign:"left"},children:t(Xt,{message:i.after_create_access_management_will_show_in_tab_approved,type:"warning",showIcon:!0,closable:!0})});return t(ce,{title:p,onCancel:a,open:!0,width:"55%",bodyStyle:{maxHeight:"450px",overflowY:"scroll"},footer:s,closable:!1,closeIcon:null,children:t(y,{initialValues:v,form:e,name:"formAdd",layout:"vertical",onValuesChange:g,children:P(q,{gutter:[12,12],children:[t(x,{span:"12",children:t(y.Item,{rules:[{required:!0}],label:i.guest_full_name,name:"guestFullName",children:t($,{fluid:"true",placeholder:i.guest_full_name})})}),t(x,{span:"12",children:t(y.Item,{label:i.label.birthday,name:"birthday",children:t(te,{fluid:"true",format:G,placeholder:G})})}),t(x,{span:"12",children:t(y.Item,{rules:[{validator:async(h,S)=>{if(S){if(S.length<9)return Promise.reject(i.id_card_or_pass_port_has_at_least_nine_character);if(S.length>12)return Promise.reject(i.id_card_or_pass_port_has_most_twelve_character);if(Number.isNaN(Number(S))||Number(S)<0)return Promise.reject(i.id_card_or_pass_port_invalid)}return Promise.resolve()}}],label:i.id_card_or_pass_port,name:"cardId",children:t($,{fluid:"true",placeholder:i.id_card_or_pass_port})})}),t(x,{span:"12",children:t(y.Item,{name:"phone",label:i.label.phone,rules:[{required:!0},{validator:async(h,S)=>S&&S.phoneNumber&&!tt(S.phoneNumber)?Promise.reject(i.status.phone_invalid):Promise.resolve()}],children:t($.PhoneInput,{placeholder:i.label.phone})})}),t(x,{span:"12",children:t(y.Item,{label:i.unit,name:"unit",children:t(se,{allowClear:!0,showSearch:!0,placeholder:i.label.select_apartment,filterOption:!1,loading:n,onSearch:St(c),style:{width:"100%"},dropdownRender:h=>n?t("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:t(ot,{})}):h,children:r==null?void 0:r.map(({id:h,name:S})=>t(se.Option,{value:h,children:S},h))})})}),t(x,{span:"12",children:t(y.Item,{shouldUpdate:(h,S)=>h.unit!==S.unit,noStyle:!0,children:({getFieldValue:h})=>t(y.Item,{label:i.relation_with_householder,name:"relationship",children:t($,{disabled:!h("unit"),fluid:"true",placeholder:i.relation_with_householder})})})}),t(x,{span:"12",children:t(y.Item,{dependencies:["expectedLeavingAt"],rules:[{required:!0},({getFieldValue:h})=>({validator(S,w){const C=h("expectedLeavingAt");return w&&m(w).startOf("day").isBefore(m().startOf("day"))?Promise.reject(i.expected_incoming_at_must_greater_or_equal_than_current_date):C&&w&&m(w).isAfter(C)?Promise.reject(i.expected_incoming_at_must_lower_or_equal_than_expected_leaving_at):w&&m(w).isBefore(m().subtract(1,"day"))?Promise.reject(new Error(`${i.min_estimated_date_access}: ${m().format(G)}`)):w&&m(w).isBefore(m(),"minutes")?Promise.reject(new Error(`${i.min_estimated_date_access}: ${m().format(B)}`)):Promise.resolve()}})],label:i.expected_incoming_at,name:"expectedIncomingAt",children:t(te,{fluid:"true",showTime:{format:we},format:B,placeholder:B})})}),t(x,{span:"12",children:t(y.Item,{dependencies:["expectedIncomingAt"],rules:[({getFieldValue:h})=>({validator(S,w){const C=h("expectedIncomingAt");return C&&w&&m(w).isBefore(C)?Promise.reject(i.expected_incoming_at_must_lower_or_equal_than_expected_leaving_at):w&&m(w).isBefore(m().subtract(1,"day"))?Promise.reject(new Error(`${i.min_estimated_date_access}: ${m().format(G)}`)):w&&m(w).isBefore(m(),"minutes")?Promise.reject(new Error(`${i.min_estimated_date_access}: ${m().format(B)}`)):Promise.resolve()}})],label:i.expected_leaving_at,name:"expectedLeavingAt",children:t(te,{fluid:"true",showTime:{format:we},format:B,placeholder:B})})}),t(x,{span:"24",children:t(y.Item,{label:i.note,name:"description",children:t($.TextArea,{maxLength:"255",fluid:"true",placeholder:i.note,rows:"3"})})}),P(x,{span:"24",children:[t(y.Item,{name:"visitorAttachFiles",label:i.attached_files,children:t(Fe,{multiple:!0,maxCount:"10",css:Di,onPreview:d,limitSizeFile:5,isUploadAllFile:!0,fileList:u,onChange:f,showUploadList:!1,children:t(W,{icon:t(Y,{name:"icon-attachment-outlined",css:h=>({fontsize:h.iconSize})}),type:"primary",ghost:!0,block:!0,size:"default",children:i.attachments})})}),u.map(h=>t(Ne,{file:h,handlePreviewAttachment:d,handleRemoveFile:b})),P("i",{css:h=>({fontSize:h.fontSize.sm,color:h.labelColor}),children:["* ",i.file_format]})]})]})})})},Bi=async(a,l,e)=>{try{const{note:o}=a;return await it({note:o||null},l,e)}catch(o){return o}},Yi=()=>{var s;const{idBuilding:a,formUpdateEmployeeNote:l,hideFormUpdateEmployeeNote:e,tablePagination:o,filter:n,status:r}=E.useContext(H),[c]=y.useForm(),[u]=he(),[d,f]=E.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),b=(s=l==null?void 0:l.data)==null?void 0:s.accessManagement,v=b==null?void 0:b.id;pe(d.code,d.codeLanguage,{message:i.success,description:i.update_success});const g=async()=>{const h=await c.validateFields(),S=c.getFieldsValue();if(h){f({code:void 0,codeLanguage:void 0,isFetching:!0});const w={note:S==null?void 0:S.note},C=await Bi(w,v,a);f({code:C.code,codeLanguage:C.codeLanguage,isFetching:!1}),Ie.includes(C.code)&&(await u({limit:o.limit,page:o.current,filter:{...n,status:r}}),e())}},p={employeeNote:b==null?void 0:b.employeeNote};return{hideFormUpdateEmployeeNote:e,formUpdate:c,initialValues:p,handleUpdate:g,updateNoteLoading:d==null?void 0:d.isFetching}},Vi=()=>{const{hideFormUpdateEmployeeNote:a,formUpdate:l,initialValues:e,handleUpdate:o,updateNoteLoading:n}=Yi();return t(ce,{open:!0,title:i.update_note,onOk:o,onCancel:a,width:"50%",okText:i.update,cancelText:i.cancel,okButtonProps:{disabled:n,loading:n},children:t(y,{form:l,layout:"vertical",name:"updateEmployeeNote",initialValues:e,children:t(q,{children:t(x,{span:"24",children:t(y.Item,{label:i.management_note,name:"note",children:t($.TextArea,{maxLength:"255",fluid:"true",placeholder:i.management_note,rows:"3"})})})})})})},ji=async(a,l,e,o)=>{try{const{expectedIncomingAt:n,expectedLeavingAt:r,relationship:c,incomingAt:u,phone:d,email:f,guestFullName:b,cardId:v,files:g,description:p}=a,s={name:b??"",cardId:v??"",phone:d!=null&&d.phoneNumber?`${d.countryCode}${d.phoneNumber}`:null,expectedIncomingAt:n?m(n).toDate():void 0,expectedLeavingAt:r?m(r).toDate():void 0,incomingAt:u?m(u).toDate():void 0,images:g||[],description:p,email:f||null,unitId:l,relationship:c||null};return await it(s,e,o)}catch(n){return n}},Gi=()=>{var L,D;const[a]=y.useForm(),{getAccessManagementBadges:l}=Te(),{setQueryParamsAccessManagement:e}=oe(),{formUpdateAccessManagement:o,hideFormUpdateAccessManagement:n,idBuilding:r,tablePagination:c,filter:u,status:d}=E.useContext(H),[f]=he(),[b,v]=E.useState({data:[],isFetching:!1}),[g,p]=E.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),s=(L=o==null?void 0:o.data)==null?void 0:L.accessManagement,[h,S]=E.useState(((D=s==null?void 0:s.images)==null?void 0:D.map(({image:N})=>({url:N,status:"done",name:N,isUploaded:!0})))??[]),w=({file:N,fileList:F})=>{let T=F;N.status==="removed"&&(T=F),(N.status==="done"||N.status==="uploading")&&(T=F),N.status||(T=F.filter(O=>O.uid!==N.uid)),S(T.filter(O=>["done","uploading"].includes(O.status)))};E.useEffect(()=>{(async()=>{v({data:[],isFetching:!0});const N=await De({idBuilding:r,limit:z,page:V,filter:{name:void 0}});v({data:N.data,isFetching:!1})})()},[]);const C=N=>{var T,O;const F=((O=(T=N==null?void 0:N.response)==null?void 0:T.data)==null?void 0:O.url)||(N==null?void 0:N.url);Ye.open(F?{url:F}:"")},A=N=>{const F=h.filter(T=>T.uid!==N);S(F)};pe(g.code,g.codeLanguage,{message:i.success,description:i.update_data_success});const _=async()=>{var O;const N=await a.validateFields(),F=a.getFieldValue("visitorAttachFiles");let T=[];if(h!=null&&h.length?T=(h==null?void 0:h.map(I=>{var k,U;return((U=(k=I==null?void 0:I.response)==null?void 0:k.data)==null?void 0:U.url)??(I==null?void 0:I.url)}))??[]:T=((O=F==null?void 0:F.map(I=>(I==null?void 0:I.url)??null))==null?void 0:O.filter(Boolean))??[],N){p({code:void 0,codeLanguage:void 0,isFetching:!0});const I=a.getFieldsValue(),k=await ji({...I,files:T},s==null?void 0:s.unitId,s==null?void 0:s.id,r);if(p({code:k.code,codeLanguage:k.codeLanguage,isFetching:!1}),Ie.includes(k.code)){const U={limit:c.limit,page:c.current,filter:{...u},status:d},j={limit:z,page:V,filter:{...ne},status:d},ae=Ve(j,U);ae&&await f({limit:z,page:V,filter:{...ne,status:d}}),ae||e({...j}),await l(r),n()}}},R={guestFullName:s==null?void 0:s.guestFullName,birthday:s!=null&&s.birthdayOrigin?m(s==null?void 0:s.birthdayOrigin):"",cardId:s==null?void 0:s.cardId,phone:{countryCode:(s==null?void 0:s.countryCode)??Pe,phoneCode:(s==null?void 0:s.phoneCode)??Pe,phoneNumber:vt(s==null?void 0:s.phone,Pe)},unit:s==null?void 0:s.unitName,images:s==null?void 0:s.images,email:s==null?void 0:s.email,relationship:s==null?void 0:s.relationship,description:s==null?void 0:s.description,expectedIncomingAt:s.expectedIncomingAt?m(s.expectedIncomingAt):void 0,expectedLeavingAt:s.expectedLeavingAt?m(s.expectedLeavingAt):void 0};return{hideFormUpdateAccessManagement:n,handleUpdateAccessManagement:_,formUpdate:a,isFetchingUpdate:g.isFetching,isFetchingApartment:b.isFetching,apartmentData:b.data,handlePreviewAttachment:C,fileList:h,handleChange:w,handleRemoveFile:A,initialValues:R}};var zi={name:"1kevbid",styles:"& .ant-upload{width:100%;}"};const Hi=()=>{const{hideFormUpdateAccessManagement:a,handleUpdateAccessManagement:l,formUpdate:e,isFetchingUpdate:o,isFetchingApartment:n,apartmentData:r,handlePreviewAttachment:c,fileList:u,handleChange:d,handleRemoveFile:f,initialValues:b}=Gi(),v=P(q,{style:{justifyContent:"space-between",alignItems:"center"},children:[t(ue.Text,{children:i.update_registration_visitor}),P(q,{children:[t(W,{onClick:a,style:{marginRight:10},children:i.cancel}),t(W,{type:"primary",onClick:l,disabled:o,loading:o,children:i.confirm})]})]});return t(ce,{title:v,onCancel:a,open:!0,width:"55%",bodyStyle:{maxHeight:"450px",overflowY:"scroll"},footer:null,closable:!1,closeIcon:null,children:t(y,{initialValues:b,form:e,name:"formUpdate",layout:"vertical",children:P(q,{gutter:[12,12],children:[t(x,{span:"12",children:t(y.Item,{rules:[{required:!0}],label:i.guest_full_name,name:"guestFullName",children:t($,{fluid:"true",placeholder:i.guest_full_name})})}),t(x,{span:"12",children:t(y.Item,{label:i.label.birthday,name:"birthday",children:t(te,{fluid:"true",format:G,placeholder:G})})}),t(x,{span:"12",children:t(y.Item,{rules:[{validator:async(g,p)=>{if(p){if(p.length<9)return Promise.reject(i.id_card_or_pass_port_has_at_least_nine_character);if(p.length>12)return Promise.reject(i.id_card_or_pass_port_has_most_twelve_character);if(Number.isNaN(Number(p))||Number(p)<0)return Promise.reject(i.id_card_or_pass_port_invalid)}return Promise.resolve()}}],label:i.id_card_or_pass_port,name:"cardId",children:t($,{fluid:"true",placeholder:i.id_card_or_pass_port})})}),t(x,{span:"12",children:t(y.Item,{name:"phone",label:i.label.phone,rules:[{required:!0},{validator:async(g,p)=>p&&p.phoneNumber&&!tt(p.phoneNumber)?Promise.reject(i.status.phone_invalid):Promise.resolve()}],children:t($.PhoneInput,{placeholder:i.label.phone})})}),t(x,{span:"12",children:t(y.Item,{label:i.unit,name:"unit",children:t(se,{allowClear:!0,disabled:!0,showSearch:!0,placeholder:i.label.select_apartment,filterOption:!1,loading:n,style:{width:"100%"},dropdownRender:g=>n?t("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:t(ot,{})}):g,children:r==null?void 0:r.map(({id:g,name:p})=>t(se.Option,{value:g,children:p},g))})})}),t(x,{span:"12",children:t(y.Item,{shouldUpdate:(g,p)=>g.unit!==p.unit,noStyle:!0,children:({getFieldValue:g})=>t(y.Item,{label:i.relation_with_householder,name:"relationship",children:t($,{disabled:!g("unit"),fluid:"true",placeholder:i.relation_with_householder})})})}),t(x,{span:"12",children:t(y.Item,{dependencies:["expectedLeavingAt"],rules:[{required:!0},({getFieldValue:g})=>({validator(p,s){const h=g("expectedLeavingAt");return s&&m(s).startOf("day").isBefore(m().startOf("day"))?Promise.reject(i.expected_incoming_at_must_greater_or_equal_than_current_date):h&&s&&m(s).isAfter(h)?Promise.reject(i.expected_incoming_at_must_lower_or_equal_than_expected_leaving_at):s&&m(s).isBefore(m().subtract(1,"day"))?Promise.reject(new Error(`${i.min_estimated_date_access}: ${m().format(G)}`)):s&&m(s).isBefore(m(),"minutes")?Promise.reject(new Error(`${i.min_estimated_date_access}: ${m().format(B)}`)):Promise.resolve()}})],label:i.expected_incoming_at,name:"expectedIncomingAt",children:t(te,{fluid:"true",showTime:{format:we},format:B,placeholder:B})})}),t(x,{span:"12",children:t(y.Item,{dependencies:["expectedIncomingAt"],rules:[({getFieldValue:g})=>({validator(p,s){const h=g("expectedIncomingAt");return h&&s&&m(s).isBefore(h)?Promise.reject(i.expected_incoming_at_must_lower_or_equal_than_expected_leaving_at):s&&m(s).isBefore(m().subtract(1,"day"))?Promise.reject(new Error(`${i.min_estimated_date_access}: ${m().format(G)}`)):s&&m(s).isBefore(m(),"minutes")?Promise.reject(new Error(`${i.min_estimated_date_access}: ${m().format(B)}`)):Promise.resolve()}})],label:i.expected_leaving_at,name:"expectedLeavingAt",children:t(te,{fluid:"true",showTime:{format:we},format:B,placeholder:B})})}),t(x,{span:"24",children:t(y.Item,{label:i.note,name:"description",children:t($.TextArea,{maxLength:"255",fluid:"true",placeholder:i.note,rows:"3"})})}),P(x,{span:"24",children:[t(y.Item,{name:"visitorAttachFiles",label:i.attached_files,children:t(Fe,{multiple:!0,maxCount:"10",css:zi,onPreview:c,limitSizeFile:5,isUploadAllFile:!0,fileList:u,onChange:d,showUploadList:!1,children:t(W,{icon:t(Y,{name:"icon-attachment-outlined",css:g=>({fontsize:g.iconSize})}),type:"primary",ghost:!0,block:!0,size:"default",children:i.attachments})})}),u.map(g=>t(Ne,{file:g,handlePreviewAttachment:c,handleRemoveFile:f})),P("i",{css:g=>({fontSize:g.fontSize.sm,color:g.labelColor}),children:["* ",i.file_format]})]})]})})})},$i=a=>{var u,d,f;const{id:l,employee:e,action:o,currentData:n,actionDate:r}=a;return{...a,id:l??"",creator:(e==null?void 0:e.fullName)??"",email:(n==null?void 0:n.email)??"",phone:(n==null?void 0:n.phone)??"",fullName:(n==null?void 0:n.name)??"",passport:(n==null?void 0:n.cardId)??"",actionName:o!=null&&o.toLowerCase()?(u=mi[o==null?void 0:o.toLowerCase()])==null?void 0:u.label:"",time:r?(d=m(r))==null?void 0:d.format(B):"",guestType:n!=null&&n.guestType?(f=Le[n==null?void 0:n.guestType])==null?void 0:f.label:"",accessCard:(n==null?void 0:n.accessCard)??""}},Qi=async({idBuilding:a,visitorId:l,filter:e,limit:o,page:n})=>{try{const{code:r,data:c,codeLanguage:u}=await zt({idBuilding:a,visitorId:l,filter:e,limit:o,page:n});return{code:r,codeLanguage:u,data:c==null?void 0:c.map(d=>$i(d))}}catch({code:r,codeLanguage:c}){return{code:r,codeLanguage:c,data:[]}}},qi=()=>{var v;const{formHistoryAccessManagement:a,hideFormHistoryAccessManagement:l,idBuilding:e,dataHistory:o,setDataHistory:n}=E.useContext(H),[r,c]=E.useState({current:V,limit:z}),[u,d]=E.useState({code:void 0,codeLanguage:void 0,isFetching:!1}),f=(v=a==null?void 0:a.data)==null?void 0:v.accessManagement;E.useEffect(()=>{(async()=>{d({code:void 0,codeLanguage:void 0,isFetching:!0});const g=await Qi({idBuilding:e,visitorId:f==null?void 0:f.id,limit:r.limit,page:r.current});n((g==null?void 0:g.data)??[]),c({current:V,limit:z}),d({code:g.code,codeLanguage:g.codeLanguage,isFetching:!1})})()},[]);const b={scrollToFirstRowOnChange:!0};return{dataSource:o,totalRecord:o==null?void 0:o.length,hideFormHistoryAccessManagement:l,loading:u.isFetching,scroll:b}},Z=xe("div",{target:"e1r8c3850"})({name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"}),Wi=()=>{const{hideFormHistoryAccessManagement:a,dataSource:l,loading:e,totalRecord:o,scroll:n}=qi(),r=[{title:i.the_operator,key:"creator",dataIndex:"creator",width:180,align:"left",fixed:"left",render:(c,u)=>(c==null?void 0:c.length)>20?t(me,{title:c,placement:"topLeft",children:t(Z,{children:c})}):t(Z,{children:c})},{title:i.operation,key:"actionName",dataIndex:"actionName",width:100,align:"left"},{title:i.time,key:"time",dataIndex:"time",width:150,align:"left"},{title:i.full_name,key:"fullName",dataIndex:"fullName",width:180,align:"left",render:(c,u)=>(c==null?void 0:c.length)>20?t(me,{title:c,placement:"topLeft",children:t(Z,{children:c})}):t(Z,{children:c})},{title:i.id_card_or_pass_port,key:"passport",dataIndex:"passport",width:170,align:"left",render:(c,u)=>(c==null?void 0:c.length)>15?t(me,{title:c,placement:"topLeft",children:t(Z,{children:c})}):t(Z,{children:c})},{title:i.phone,key:"phone",dataIndex:"phone",width:120,align:"left"},{title:i.email,key:"email",dataIndex:"email",width:150,align:"left",render:(c,u)=>(c==null?void 0:c.length)>12?t(me,{title:c,placement:"topLeft",children:t(Z,{children:c})}):t(Z,{children:c})}];return P(ce,{title:i.history_registration_visitor,footer:null,open:!0,onCancel:a,width:"80%",children:[t(M.ActionBox,{total:o}),t(bt,{loading:e,columns:r,dataSource:l,bordered:!0,pagination:!1,scroll:{...n,x:r.reduce((c,u)=>c+ +((u==null?void 0:u.width)??0),0)}})]})},Xe=async a=>(await qt(a,{type:le})).data,Ki=()=>{const{idBuilding:a,setSettingRegistrationForm:l}=E.useContext(H);return[async()=>{let o=await Xe(a);return(o==null?void 0:o.find(r=>r.type===le))||(await st(o,{autoApprove:!0,status:!0},a),o=await Xe(a)),l(o),o}]},Ji=()=>{const{setTitlePage:a,setVisibleFilterBox:l,setVisibleSearchBox:e}=E.useContext(et),{formUpdateStatusData:o,formDetailData:n,formAddData:r,idBuilding:c,visitorSetting:u,formUpdateEmployeeNote:d,formUpdateAccessManagement:f,formHistoryAccessManagement:b}=E.useContext(H),{getQueryParamsAccessManagement:v}=oe(),[g]=Ki(),[p]=he(),{search:s}=$t();return E.useEffect(()=>(a(i.access_management),e(!0),()=>{a(""),l(!1),e(!1)}),[]),E.useEffect(()=>{(async()=>{if(c){let h={...u};if(!h.id){const A=await g();h=(A==null?void 0:A.find(R=>R.type===le))??{autoApprove:!1,status:Ee}}const{pagination:S,filter:w,status:C}=v(h.autoApprove);s&&await p({filter:{...w,status:C},limit:S.limit,page:S.page})}})()},[s]),[o,n,r,d,f,b]},Xi=()=>{const[a,l,e,o,n,r]=Ji();return P(ee,{children:[P(M.Wrapper,{children:[t(xi,{}),P(M.Container,{children:[t(M.Header,{children:t(wi,{})}),P(M.Content,{children:[t(Ti,{}),t(Ni,{})]})]})]}),a.isShow&&t(vi,{}),l.isShow&&t(gi,{}),e.isShow&&t(Ui,{}),o.isShow&&t(Vi,{}),n.isShow&&t(Hi,{}),r.isShow&&t(Wi,{})]})},Bo=()=>t(pi,{children:t(Xi,{})});export{Bo as default};
