import{j as t,u as ce,a as M,F as rt,c as ct,b as H}from"./@emotion-63839449.js";import{P as Y,l as st,F as lt,u as _t,b as me,a as ne,r as dt,d as ut,n as ee,k as je,D as et,o as It}from"./index-b17d22e5.js";import{r as T}from"./react-4fd50329.js";import{P as We}from"./prop-types-1172f4d5.js";import{F as y,u as De}from"./index-687ba9e6.js";import{l as o,by as ht,a9 as k,s as $,K as Z,b0 as mt,aD as fe,at as Ve,bv as xt,fJ as Ft,fK as Dt,I as q,Y as Rt,i as se,A as Se,M as le,ea as Et,X as de,e4 as Pt,j as Ge,a as Ce,c6 as j,w as Mt,eC as Nt,eF as Lt,dk as Ut,fL as Bt,fM as Ot,S as pt,f1 as kt,eZ as $t,ep as Ht}from"./index-c2ded735.js";import"./react-redux-896b353b.js";import"./lodash-88fe09e6.js";import{h as ye}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import{u as Ye}from"./useService-37d60dc0.js";import"./@firebase-43527ee1.js";import{u as Be}from"./react-router-a4308f7b.js";import{B as be,c as zt,T as Fe,a as V,w as Ne,b as v,R as K,S as Vt,k as tt,P as gt,n as jt}from"./antd-f9eae174.js";import{I as Re,S as W}from"./index-43183512.js";import{u as ft}from"./useQuery-d54d310a.js";import{I as bt}from"./index-0335a746.js";import{u as Wt}from"./useTableCheckbox-753d19b2.js";import{t as Gt,v as Yt}from"./bill-d9d0423c.js";import{e as qt}from"./exportExcel-837be6ed.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./index-881eef42.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./classnames-4ba1ba1a.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./downloadFileFromUrl-79614833.js";import"./regex-deefadac.js";import"./xlsx-0fb7ed70.js";import"./uuid-4a60fe23.js";const Te={unitName:void 0,serviceIds:[],status:!1},ie={serviceId:"",status:["CREATED"]},Xt="EMPTY",Tt="REDUNDANCY";o.apartment_out_of_money,o.apartment_has_money;const Le="EXPENSE",Ue="REVENUE",Kt=[{value:Le,label:o.expense,color:"red"},{value:Ue,label:o.revenue,color:"green"}],nt=ht(Kt,"value"),Jt="CREATED",Qt="CANCELED",yt=[{value:Jt,label:o.created},{value:Qt,label:o.label.canceled}];ht(yt,"value");const vt="balance-desc",ve="createdAt-desc",Zt="Chuyển đổi tiền từ tài khoản căn hộ sang thu trước dịch vụ",J=T.createContext({idBuilding:0,getListUnitAccountStatus:{isFetching:!1},setGetListUnitAccountStatus:()=>{},filter:{...Te},setFilter:()=>{},tableData:{services:[],records:[],totalRecord:0},setTableData:()=>{},tableDataTotalRow:{},setTableDataTotalRow:()=>{},tablePagination:{current:k,limit:$},setTablePagination:()=>{},modalHistory:void 0,showModalHistory:()=>{},hideModalHistory:()=>{},modalImport:void 0,showModalImport:()=>{},hideModalImport:()=>{},services:[],getServices:async()=>{},modalExport:void 0,showModalExport:()=>{},hideModalExport:()=>{},modalAdd:void 0,showModalAdd:()=>{},hideModalAdd:()=>{},modalTransferMoney:void 0,showModalTransferMoney:()=>{},hideModalTransferMoney:()=>{},modalDeduction:void 0,showModalDeduction:()=>{},hideModalDeduction:()=>{},sortString:vt,setSortString:()=>{},formFilter:void 0,unitAccountPermissionWrite:!1,unitAccountPermissionCreate:!1,unitAccountPermissionExport:!1,unitAccountPermissionDeduction:!1,unitAccountPermissionTransfer:!1}),qe=({children:i})=>{var Ie,xe,Je,Qe,Ze;const{idBuilding:r}=Be(),[e,n]=T.useState({isFetching:!1}),[a,s]=T.useState({...Te}),[c,h]=T.useState({services:[],records:[],totalRecord:0}),[d,p]=T.useState(),[f,g]=T.useState({current:k,limit:$}),{services:m,getServices:u}=Ye(),[l,b,S]=Z(),[w,D,R]=Z(),[C,B,O]=Z(),[z,_,I]=Z(),[x,U,F]=Z(),[E,A,N]=Z(),[G,L]=T.useState(vt),[X]=y.useForm(),{getPermissionByModuleCode:P}=mt(),ae=((Ie=P(fe))==null?void 0:Ie[Ve])??!1,_e=((xe=P(fe))==null?void 0:xe[xt])??!1,$e=((Je=P(fe))==null?void 0:Je[Ve])??!1,te=((Qe=P(fe))==null?void 0:Qe[Ft])??!1,Ee=((Ze=P(fe))==null?void 0:Ze[Dt])??!1,Q={idBuilding:r,getListUnitAccountStatus:e,setGetListUnitAccountStatus:n,filter:a,setFilter:s,tableData:c,setTableData:h,tableDataTotalRow:d,setTableDataTotalRow:p,tablePagination:f,setTablePagination:g,modalHistory:l,showModalHistory:b,hideModalHistory:S,modalImport:w,showModalImport:D,hideModalImport:R,services:m,getServices:u,modalExport:C,showModalExport:B,hideModalExport:O,modalAdd:z,showModalAdd:_,hideModalAdd:I,modalTransferMoney:E,showModalTransferMoney:A,hideModalTransferMoney:N,modalDeduction:x,showModalDeduction:U,hideModalDeduction:F,sortString:G,setSortString:L,formFilter:X,unitAccountPermissionWrite:ae,unitAccountPermissionCreate:$e,unitAccountPermissionExport:_e,unitAccountPermissionDeduction:te,unitAccountPermissionTransfer:Ee};return t(J.Provider,{value:Q,children:i})};qe.propTypes={children:We.node};qe.defaultProps={children:t("div",{})};const en=qe,tn=()=>{const{tableData:i,showModalImport:r,showModalAdd:e,unitAccountPermissionCreate:n,unitAccountPermissionWrite:a,unitAccountPermissionExport:s,showModalDeduction:c,showModalExport:h,unitAccountPermissionDeduction:d}=T.useContext(J),p=()=>{e()},f=()=>{r()},g=()=>{h()},m=()=>c();return{totalRecord:i.totalRecord,onClickBtnImport:f,handleAdd:p,unitAccountPermissionCreate:n,handleDeduction:m,unitAccountPermissionWrite:a,onClickBtnExport:g,unitAccountPermissionDeduction:d,unitAccountPermissionExport:s}},nn=()=>{const{totalRecord:i,onClickBtnImport:r,handleAdd:e,unitAccountPermissionCreate:n,handleDeduction:a,unitAccountPermissionDeduction:s,onClickBtnExport:c,unitAccountPermissionExport:h}=tn(),[d]=Rt(),p=[h?t(be,{type:"primary",icon:t(q,{name:"icon-download-outlined"}),onClick:()=>{c()},style:{marginRight:d.marginXs},ghost:!0,children:o.export},"export"):null,n?t(be,{icon:t(q,{name:"icon-upload-outlined"}),onClick:()=>{r()},style:{marginRight:d.marginXs},type:"primary",children:o.import},"import"):null,n?t(be,{type:"primary",icon:t(q,{name:"icon-plus-circle-outlined"}),onClick:()=>{e()},style:{marginRight:d.marginXs},children:o.add},"add"):null,s?t(be,{type:"primary",icon:t(q,{name:"icon-minus-circle-outlined"}),onClick:()=>{a()},children:o.deduction_of_prepayment},"deduction"):null].filter(Boolean);return t(Y.ActionBox,{actions:p,total:i})},Ae=`${Ge}/unit-account`,on=i=>`${Ge}/unit/${i}/unit-account-history`,an=`${Ae}/import-data`,rn=`${Ae}/sum-total`,cn=`${Ae}`,sn=`${Ae}/transfer`,ln=(i,r)=>`${Ge}/unit/${i}/unit-account-history/${r}`,dn=`${Ae}/export-data`;async function un({filter:i,idBuilding:r,page:e,limit:n}){const a={[de]:r},s={...i,page:e,limit:n};return se({type:Se,payload:{apiUrl:Ae,method:le.GET,options:{params:s,headers:a}}})}async function hn(i,r){const e={[de]:r},n={...i};return se({type:Se,payload:{apiUrl:rn,method:le.GET,options:{params:n,headers:e}}})}async function mn({filter:i,idBuilding:r,idUnit:e,page:n,limit:a}){const s={[de]:r},c={...i,page:n,limit:a};return se({type:Se,payload:{apiUrl:on(e),method:le.GET,options:{params:c,headers:s}}})}async function pn({dataAttach:i,idBuilding:r,file:e}){return await se({type:Et,payload:{apiUrl:an,file:e,method:le.POST,options:{headers:{[de]:r},dataAttach:i}}})}const gn=async(i,r)=>{const e={[de]:r};return await se({type:Se,payload:{apiUrl:cn,method:le.POST,body:i,options:{headers:e}}})},fn=async(i,r)=>{const e={[de]:r};return await se({type:Se,payload:{apiUrl:sn,method:le.POST,body:i,options:{headers:e}}})},bn=async({reason:i,unitAccountHistoryId:r,idBuilding:e,unitId:n})=>{const a={[de]:e};return await se({type:Se,payload:{apiUrl:ln(n,r),method:le.DELETE,body:{...i},options:{headers:a}}})};async function Tn({idBuilding:i,filter:r}){return await se({type:Pt,payload:{apiUrl:dn,method:le.GET,options:{params:{...r},headers:{[de]:i}}}})}const yn=i=>{const{id:r,serviceId:e,balance:n}=i;return{id:r,serviceId:e,balance:n}},vn=i=>{const{id:r,name:e,unitAccounts:n}=i,a=n?n.reduce((c,h)=>c+Number(h.balance||0),0):0,s={id:r,key:r,name:e,totalOrigin:a??0,total:a,unitAccounts:n==null?void 0:n.map(c=>yn(c))};return n.forEach(c=>{s[`unitAccount-${c.serviceId}`]=(c==null?void 0:c.balance)||0}),s},St=async({pagination:i,filter:r,idBuilding:e})=>{const{current:n,limit:a}=i,{unitName:s,serviceIds:c,status:h}=r,p=await un({filter:{unitName:s||void 0,serviceIds:c||void 0,status:h?Tt:void 0},idBuilding:e,limit:a,page:n}),{services:f,units:g}=p==null?void 0:p.data,m=g==null?void 0:g.map(u=>vn(u));return[f,m,p==null?void 0:p.totalRecord]},Ct=async({filter:i,idBuilding:r})=>{const{unitName:e,customerIdentifier:n,serviceIds:a}=i;return(await hn({unitName:e||void 0,customerIdentifier:n||void 0,serviceIds:a||void 0},r)).data},ue=()=>{const{idBuilding:i,setTablePagination:r,setTableData:e,setTableDataTotalRow:n,setGetListUnitAccountStatus:a}=T.useContext(J);return[async({filter:c,pagination:h,isChangeTotalRow:d})=>{const{current:p,limit:f}=h;a({isFetching:!0}),r({current:p,limit:f});const[g,m,u]=await St({filter:c,idBuilding:i,pagination:h});if(e({services:g,records:m,totalRecord:u}),d){const l=await Ct({filter:c,idBuilding:i});n(l)}a({isFetching:!1})}]},Sn=()=>{const{setFilter:i,services:r,sortString:e,formFilter:n}=T.useContext(J),[a]=ue();return{onSearch:async c=>{i(c),await a({filter:c,isChangeTotalRow:!0,pagination:{current:k,limit:$},sort:e})},services:r,formFilter:n}},Cn=()=>{const{onSearch:i,services:r,formFilter:e}=Sn(),n=T.useMemo(()=>[{label:o.unit,key:"unitName",component:t(Re,{placeholder:o.unit}),visible:!0},{label:o.service,key:"serviceIds",component:t(W,{mode:"multiple",allowClear:!0,placeholder:o.service,showSearch:!0,fluid:"true",maxTagCount:"responsive",showArrow:!0,getPopupContainer:a=>a.parentNode,children:r==null?void 0:r.map(({id:a,name:s})=>t(W.Option,{value:a,children:s},a))}),visible:!0},{label:o.status1,key:"status",component:t(zt,{children:o.apartment_has_money}),visible:!0,isCheckBox:!0}],[r]);return t(Y.FilterBox,{formData:e,filters:n,onSearch:i})},An=()=>{const{filter:i,getListUnitAccountStatus:r,tableData:e,tablePagination:n,tableDataTotalRow:a,showModalHistory:s,showModalTransferMoney:c,unitAccountPermissionTransfer:h}=T.useContext(J),{layoutScrollRef:d}=T.useContext(Ce),[p]=ue(),f=ce(),g=e.records,m=async(D,R)=>{const{current:C,limit:B}=n;C!==D?await p({filter:i,isChangeTableDataTotal:!1,pagination:{current:D,limit:B}}):B!==R&&await p({filter:i,isChangeTableDataTotal:!1,pagination:{current:C,limit:R}})},u=T.useMemo(()=>({defaultPageSize:$,defaultCurrent:k,pageSize:n.limit,current:n.current,total:e.totalRecord,showQuickJumper:!0,showSizeChanger:!0,onChange:m}),[n,e.totalRecord]),l=D=>{c(D)},b=D=>{s(D)},S={scrollToFirstRowOnChange:!0,x:"max-content"},w={offsetScroll:f.offsetScrollX,getContainer:()=>d.current};return{loading:r.isFetching,totalPayment:a,dataSource:g,pagination:u,sticky:w,scroll:S,handleHistoryUnitAccount:b,services:e.services,handleTransferMoney:l,unitAccountPermissionTransfer:h}},Pe=ct("div",{target:"e9dsi0h0"})({name:"1g7g7c1",styles:"max-width:300px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis"}),wn=()=>{const{loading:i,totalPayment:r,dataSource:e,pagination:n,sticky:a,scroll:s,handleHistoryUnitAccount:c,services:h,handleTransferMoney:d,unitAccountPermissionTransfer:p}=An(),f=T.useMemo(()=>[{title:o.unit,key:"unit",width:150,children:[{title:o.total,dataIndex:"name",key:"name",width:150,fixed:"left",render:(g,m)=>(g==null?void 0:g.length)>30?t(Fe,{title:g,placement:"topLeft",children:t(Pe,{children:g})}):t(Pe,{children:g})}]},...(h==null?void 0:h.map(({id:g,name:m})=>m?{title:(m==null?void 0:m.length)>25?t(Fe,{title:m,placement:"topLeft",children:t(Pe,{style:{width:"150px",float:"right"},children:m})}):t(Pe,{children:m}),key:g,dataIndex:g,align:"right",width:150,children:[{title:r?j(Math.round(r[g]??0)):0,key:g,dataIndex:`unitAccount-${g}`,width:150,align:"right",render:(u,l)=>t(V.NegativeNumber,{children:u||0})}]}:null))??[],{title:o.total,key:"total",align:"right",fixed:"right",width:150,children:[{title:t(V.NegativeNumber,{children:(r==null?void 0:r.totalBalance)||0}),key:"total",dataIndex:"total",align:"right",fixed:"right",width:150,render:(g,m)=>t(V.NegativeNumber,{children:g||0})}]},{title:o.actions,key:"actions",align:"center",width:80,fixed:"right",render:(g,m)=>M(rt,{children:[t(q,{title:o.service_advanced_payment_history,name:"icon-history-outlined",css:u=>({fontSize:u.iconSize,marginRight:u.margin.xs}),onClick:()=>{c(m)}}),p?t(q,{title:o.transfer_money,onClick:()=>d(m),name:"icon-swap-horiz-outlined",css:u=>({fontSize:u.iconSize+5})}):null]})}],[h,r]);return t(Y.Table,{columns:f,dataSource:e,loading:i,pagination:n,sticky:a,scroll:s})},_n=i=>{var m,u,l,b,S;const{code:r,user:e,method:n,content:a,createdAt:s,unitAccount:c,receipt:h,payslip:d,totalPayment:p,deletedAt:f,redundancy:g}=i;return{...i,key:i==null?void 0:i.id,code:r,type:n?(m=nt[n])==null?void 0:m.label:"",ballotTypeColor:n?(u=nt[n])==null?void 0:u.color:"",status:f?o.deletedAt:o.createdAt,detail:a,createdAt:s?(l=ye(s))==null?void 0:l.format(st):"",fundName:((b=c==null?void 0:c.fund)==null?void 0:b.name)??"",serviceName:((S=c==null?void 0:c.service)==null?void 0:S.name)??"",receiptFormat:n===Ue?j(p):0,payslipFormat:n===Le?j(p):0,totalPayment:p?j(p):0,receipt:h,payslip:d,nameCreatedBy:(e==null?void 0:e.fullName)??"",redundancy:g}},In=async({filter:i,pagination:r,idBuilding:e,idUnit:n})=>{const{serviceId:a,status:s,sort:c}=i,d=await mn({filter:{serviceId:a||void 0,status:s||void 0,sort:c||void 0},idBuilding:e,idUnit:n,page:r.current,limit:r.limit}),{unitAccountHistories:p,totalBalance:f}=d==null?void 0:d.data,g=c===ve?p:p==null?void 0:p.reverse();let m=Number(f)||f;const u=[];g==null||g.forEach((b,S)=>{if(S!==0){const w=g[S-1],{deletedAt:D,method:R,totalPayment:C}=w;!(b!=null&&b.deletedAt)&&!D&&(R===Ue?m-=Number(C):R===Le&&(m+=Number(C))),b!=null&&b.deletedAt&&!D&&(R===Ue?m-=Number(C):R===Le&&(m+=Number(C)))}u==null||u.push({...b,redundancy:m})});const l=u==null?void 0:u.map(b=>_n(b));return{records:c===ve?l:l==null?void 0:l.reverse(),totalRecord:d.totalRecord,totalBalance:f}},oe=T.createContext({idBuilding:0,getListUnitAccountHistoryStatus:{isFetching:!1},setGetListUnitAccountHistoryStatus:()=>{},sortString:ve,setSortString:()=>{},filter:{...ie},setFilter:()=>{},tableData:{records:[],totalRecord:0,totalBalance:0},setTableData:()=>{},tablePagination:{current:k,limit:$},setTablePagination:()=>{},hideModalHistory:()=>{},modalHistory:void 0,services:[],getServices:async()=>{},formDetailReceipt:void 0,showFormDetailReceipt:()=>{},hideFormDetailReceipt:()=>{},formDetailPayslip:void 0,showFormDetailPayslip:()=>{},hideFormDetailPayslip:()=>{},formDetailHistory:void 0,showFormDetailHistory:()=>{},hideFormDetailHistory:()=>{},formCancelHistory:void 0,showFormCancelHistory:()=>{},hideFormCancelHistory:()=>{},listApartmentAccounts:[],formFilter:void 0}),Xe=({children:i})=>{const{hideModalHistory:r,modalHistory:e,tableData:n}=T.useContext(J),{idBuilding:a}=Be(),[s]=y.useForm(),[c,h]=T.useState({isFetching:!1}),[d,p]=T.useState(ve),[f,g]=T.useState({...ie}),[m,u]=T.useState({records:[],totalRecord:0,totalBalance:0}),[l,b]=T.useState({current:k,limit:$}),[S,w,D]=Z(),[R,C,B]=Z(),[O,z,_]=Z(),[I,x,U]=Z(),{services:F,getServices:E}=Ye(),A={idBuilding:a,getListUnitAccountHistoryStatus:c,setGetListUnitAccountHistoryStatus:h,sortString:d,setSortString:p,filter:f,setFilter:g,tableData:m,setTableData:u,tablePagination:l,setTablePagination:b,hideModalHistory:r,modalHistory:e,services:F,getServices:E,formDetailReceipt:S,showFormDetailReceipt:w,hideFormDetailReceipt:D,formDetailPayslip:R,showFormDetailPayslip:C,hideFormDetailPayslip:B,formDetailHistory:O,showFormDetailHistory:z,hideFormDetailHistory:_,formCancelHistory:I,showFormCancelHistory:x,hideFormCancelHistory:U,listApartmentAccounts:n,formFilter:s};return t(oe.Provider,{value:A,children:i})};Xe.propTypes={children:We.node};Xe.defaultProps={children:t("div",{})};const Oe=()=>{const{idBuilding:i,setTablePagination:r,setTableData:e,setGetListUnitAccountHistoryStatus:n,modalHistory:a}=T.useContext(oe),{id:s}=a==null?void 0:a.data;return[async({filter:h,pagination:d,sort:p=ve})=>{const{current:f,limit:g}=d;n({isFetching:!0}),r({current:f,limit:g});const m=await In({filter:{...h,sort:p},idBuilding:i,pagination:d,idUnit:s,sort:p});e({records:m==null?void 0:m.records,totalRecord:m.totalRecord,totalBalance:m==null?void 0:m.totalBalance}),n({isFetching:!1})}]},xn=()=>{const{setFilter:i,services:r,formFilter:e}=T.useContext(oe),[n]=Oe();return{onSearch:async s=>{i(s),await n({filter:{...s},pagination:{current:k,limit:$}})},services:r,formFilter:e}},Fn=()=>{const{onSearch:i,services:r,formFilter:e}=xn(),n=T.useMemo(()=>[{label:o.service,key:"serviceId",component:M(W,{fluid:"true",placeholder:o.service,getPopupContainer:a=>a.parentNode,children:[t(W.Option,{value:"",children:o.all_service},"service_0"),r==null?void 0:r.map(({id:a,name:s})=>t(W.Option,{value:a,children:s},a))]}),visible:!0},{label:o.label.status1,key:"status",component:t(W,{mode:"multiple",maxTagCount:"responsive",fluid:"true",showArrow:!0,placeholder:o.label.status1,getPopupContainer:a=>a.parentNode,children:yt.map(({value:a,label:s})=>t(W.Option,{value:a,children:s},a))}),visible:!0}],[r]);return t(lt,{formData:e,initialValues:ie,filters:n,onSearch:i,visibleFilterBox:!0,size:"small"})},Dn=()=>{const{filter:i,getListUnitAccountHistoryStatus:r,tableData:e,tablePagination:n,showFormDetailReceipt:a,showFormDetailPayslip:s,showFormDetailHistory:c,showFormCancelHistory:h,setSortString:d}=T.useContext(oe),{unitAccountPermissionWrite:p}=T.useContext(J),{layoutScrollRef:f}=T.useContext(Ce),[g]=Oe(),m=ce(),{currentBuilding:u}=_t(),{lockDataAt:l}=u,b=async(x,U,F)=>{let{current:E,limit:A}=n;x!==E&&(E=x),U!==A&&(A=U),await g({filter:i,pagination:{current:E,limit:U},sort:F})},S=x=>{const{receipt:U,payslip:F}=x;U&&a(U),F&&s(F)},w=x=>{c(x)},D=x=>{h(x)},R=T.useMemo(()=>({defaultPageSize:$,defaultCurrent:k,pageSize:n.limit,current:n.current,total:e.totalRecord,showQuickJumper:!0,showSizeChanger:!0}),[n,e.totalRecord]),C={scrollToFirstRowOnChange:!0,x:"max-content"},B={offsetScroll:m.offsetScrollX,getContainer:()=>f.current},O=e.records,z=async(x,U,F)=>{const{field:E,order:A}=F,{current:N,pageSize:G}=x;let L=ve;E&&A&&(L=E&&A?`${E}-${A==="ascend"?"asc":"desc"}`:void 0,d(L)),b(N,G,L)},_=x=>!!(l&&x&&ye(x,st).isBefore(l)),I=x=>x!=null&&x.deletedAt?"disabled":"";return{loading:r.isFetching,dataSource:O,pagination:R,handleViewDetailReceiptAndPayslip:S,handleDetailHistory:w,handleCancelHistory:D,scroll:C,sticky:B,isHaveUpdateAction:p,onTableChange:z,isLockData:_,rowClassName:I}},pe=ct("div",{target:"e1kj6awp0"})({name:"11lcztc",styles:"width:120px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis"});var Rn={name:"1hcx8jb",styles:"padding:0"};const En=()=>{const{loading:i,dataSource:r,pagination:e,handleViewDetailReceiptAndPayslip:n,handleDetailHistory:a,handleCancelHistory:s,scroll:c,sticky:h,isHaveUpdateAction:d,onTableChange:p,isLockData:f,rowClassName:g}=Dn(),m=[{title:o.receipt_pay_slip_code,dataIndex:"code",key:"code",width:150,fixed:"left",render:(u,l)=>t(be,{css:Rn,onClick:()=>n(l),type:"link",title:l!=null&&l.receipt?o.receipt_code:o.label.pay_slip_code,children:(u==null?void 0:u.length)>15?`${u==null?void 0:u.slice(0,15)}...`:u})},{title:o.type,dataIndex:"type",key:"type",width:80,render:(u,l)=>l!=null&&l.ballotTypeColor?t(Ne,{color:l==null?void 0:l.ballotTypeColor,children:u}):null},{title:o.status1,dataIndex:"status",key:"status",width:100,render:(u,l)=>l!=null&&l.deletedAt?t(Ne,{color:"error",children:o.deletedAt}):t(Ne,{color:"success",children:o.createdAt})},{title:o.service,dataIndex:"serviceName",key:"serviceName",width:200,render:(u,l)=>(u==null?void 0:u.length)>15?t(Fe,{title:u,placement:"topLeft",children:t(pe,{children:u})}):t(pe,{children:u})},{title:o.content,dataIndex:"content",key:"content",width:150,render:(u,l)=>(u==null?void 0:u.length)>15?t(Fe,{title:u,placement:"topLeft",children:t(pe,{children:u})}):t(pe,{children:u})},{title:o.fund,dataIndex:"fundName",key:"fundName",width:180,render:(u,l)=>(u==null?void 0:u.length)>15?t(Fe,{title:u,placement:"topLeft",children:t(pe,{children:u})}):t(pe,{children:u})},{title:`${o.revenue} (${o.vnd})`,dataIndex:"receiptFormat",key:"receiptFormat",width:120,align:"right"},{title:`${o.expense} (${o.vnd})`,dataIndex:"payslipFormat",key:"payslipFormat",width:120,align:"right"},{title:`${o.label.redundancy} (${o.vnd})`,dataIndex:"redundancy",key:"redundancy",width:120,align:"right",render:(u,l)=>j(u)},{title:o.the_operator,dataIndex:"nameCreatedBy",key:"nameCreatedBy",width:150},{title:o.created_at,dataIndex:"createdAt",key:"createdAt",width:120,sorter:!0},{title:o.actions,key:"actions",align:"center",width:100,fixed:"right",render:(u,l)=>M(rt,{children:[t(q,{title:o.detail_history_unit_account,name:"icon-eye-outlined",css:b=>({fontSize:b.iconSize,marginRight:b.margin.xs}),onClick:()=>{a(l)}}),!f(l==null?void 0:l.createdAt)&&d&&!(l!=null&&l.deletedAt)&&(l==null?void 0:l.content)!==Zt?t(q,{title:o.cancel_history_transactions,onClick:()=>s(l),name:"icon-minus-circle-outlined",css:b=>({fontSize:b.iconSize})}):null]})}].filter(Boolean);return t(Y.Table,{columns:m,dataSource:r,loading:i,pagination:e,sticky:h,scroll:c,onChange:p,rowClassName:g,locale:{triggerAsc:o.click_to_sort,triggerDesc:o.ascending_order,cancelSort:o.descending_order}})},Pn=()=>{const{formDetailReceipt:i,hideFormDetailReceipt:r}=T.useContext(oe),[e]=y.useForm(),n=i==null?void 0:i.data;return{hideFormDetailReceipt:r,formDetail:e,detailReceipt:n}},Mn=()=>{const{hideFormDetailReceipt:i,formDetail:r,detailReceipt:e}=Pn(),n=ce();return t(ne,{open:!0,title:o.detail_receipt,onCancel:i,footer:null,width:"80%",children:t(y,{form:r,layout:"vertical",name:"detail",children:M(K,{gutter:[n.margin.md,n.margin.md],style:{background:"#f7f7f7",padding:"0px 10px 0 10px",marginBottom:"15px"},children:[M(v,{span:"24",css:H({marginTop:n.margin.md},"",""),children:[t(q,{name:"icon-info-circle-filled",css:H({fontSize:n.iconSize,marginRight:n.margin.xs,color:n.color.primary},"","")}),t(me,{css:H({color:n.color.primary,fontWeight:n.fontWeight.bold,fontSize:n.fontSize.md},"",""),children:o.info_receipt})]}),t(v,{span:"12",children:t(y.Item,{label:o.receipt_code,children:t(V.Text,{strong:e==null?void 0:e.code,children:(e==null?void 0:e.code)??"-"})})}),t(v,{span:"12",children:t(y.Item,{label:o.cashier,children:(e==null?void 0:e.cashier)??"-"})}),t(v,{span:"12",children:t(y.Item,{label:o.label.payer,children:(e==null?void 0:e.payer)??"-"})}),t(v,{span:"12",children:t(y.Item,{label:`${o.total_money} (${o.vnd})`,children:j(e==null?void 0:e.totalPayment)??"-"})}),t(v,{span:"12",children:t(y.Item,{label:o.content,children:e!=null&&e.content?e==null?void 0:e.content:"-"})}),t(v,{span:"12",children:t(y.Item,{label:o.address,children:e!=null&&e.address?e==null?void 0:e.address:"-"})}),t(v,{span:"12",children:t(y.Item,{label:o.note,children:e!=null&&e.note?e==null?void 0:e.note:"-"})}),t(v,{span:"12",children:t(y.Item,{label:o.description,children:e!=null&&e.description?e==null?void 0:e.description:"-"})})]})})})},Nn=()=>{const{formDetailPayslip:i,hideFormDetailPayslip:r}=T.useContext(oe),[e]=y.useForm(),n=i==null?void 0:i.data;return{hideFormDetailPayslip:r,formDetail:e,detailPayslip:n}},Ln=()=>{const{hideFormDetailPayslip:i,formDetail:r,detailPayslip:e}=Nn(),n=ce();return t(ne,{open:!0,title:o.detail_payslip,onCancel:i,footer:null,width:"80%",children:t(y,{form:r,layout:"vertical",name:"detail",children:M(K,{gutter:[n.margin.md,n.margin.md],style:{background:"#f7f7f7",padding:"0px 10px 0 10px",marginBottom:"15px"},children:[M(v,{span:"24",css:H({marginTop:n.margin.md},"",""),children:[t(q,{name:"icon-info-circle-filled",css:H({fontSize:n.iconSize,marginRight:n.margin.xs,color:n.color.primary},"","")}),t(me,{css:H({color:n.color.primary,fontWeight:n.fontWeight.bold,fontSize:n.fontSize.md},"",""),children:o.info_payslip})]}),t(v,{span:"12",children:t(y.Item,{label:o.label.pay_slip_code,children:t(V.Text,{strong:e==null?void 0:e.code,children:(e==null?void 0:e.code)??"-"})})}),t(v,{span:"12",children:t(y.Item,{label:o.cashier,children:(e==null?void 0:e.cashier)??"-"})}),t(v,{span:"12",children:t(y.Item,{label:o.label.payer,children:(e==null?void 0:e.payer)??"-"})}),t(v,{span:"12",children:t(y.Item,{label:`${o.total_money} (${o.vnd})`,children:j(e==null?void 0:e.totalPayment)??"-"})}),t(v,{span:"12",children:t(y.Item,{label:o.content,children:e!=null&&e.content?e==null?void 0:e.content:"-"})}),t(v,{span:"12",children:t(y.Item,{label:o.address,children:e!=null&&e.address?e==null?void 0:e.address:"-"})}),t(v,{span:"12",children:t(y.Item,{label:o.note,children:e!=null&&e.note?e==null?void 0:e.note:"-"})}),t(v,{span:"12",children:t(y.Item,{label:o.description,children:e!=null&&e.description?e==null?void 0:e.description:"-"})})]})})})},Un=()=>{const{formDetailHistory:i,hideFormDetailHistory:r}=T.useContext(oe),[e]=y.useForm(),n=i==null?void 0:i.data,{receipt:a,payslip:s}=n;return{hideFormDetailHistory:r,formDetail:e,detailHistory:n,receiptData:a??null,payslipData:s??null}},Bn=()=>{const{hideFormDetailHistory:i,formDetail:r,detailHistory:e,receiptData:n,payslipData:a}=Un(),s=ce();return t(ne,{open:!0,title:o.detail_history_unit_account,onCancel:i,footer:null,width:"80%",children:M(y,{form:r,layout:"vertical",name:"detail",children:[M(K,{gutter:[s.margin.md,s.margin.md],style:{background:"#f7f7f7",padding:"0px 10px 0 10px",marginBottom:"15px"},children:[M(v,{span:"24",css:H({marginTop:s.margin.md},"",""),children:[t(q,{name:"icon-info-circle-filled",css:H({fontSize:s.iconSize,marginRight:s.margin.xs,color:s.color.primary},"","")}),t(me,{css:H({color:s.color.primary,fontWeight:s.fontWeight.bold,fontSize:s.fontSize.md},"",""),children:o.label.general_information})]}),t(v,{span:"8",children:t(y.Item,{label:o.type,children:t(Ne,{color:e==null?void 0:e.ballotTypeColor,children:e==null?void 0:e.type})})}),t(v,{span:"8",children:t(y.Item,{label:o.status1,children:(e==null?void 0:e.status)??"-"})}),t(v,{span:"8",children:t(y.Item,{label:o.the_operator,children:e!=null&&e.nameCreatedBy?e==null?void 0:e.nameCreatedBy:"-"})}),t(v,{span:"8",children:t(y.Item,{label:o.services,children:(e==null?void 0:e.serviceName)??"-"})}),t(v,{span:"8",children:t(y.Item,{label:`${o.label.redundancy} (${o.vnd})`,children:(e==null?void 0:e.redundancy)??"-"})})]}),n?M(K,{gutter:[s.margin.md,s.margin.md],style:{background:"#f7f7f7",padding:"0px 10px 0 10px",marginBottom:"15px"},children:[M(v,{span:"24",css:H({marginTop:s.margin.md},"",""),children:[t(q,{name:"icon-info-circle-filled",css:H({fontSize:s.iconSize,marginRight:s.margin.xs,color:s.color.primary},"","")}),t(me,{css:H({color:s.color.primary,fontWeight:s.fontWeight.bold,fontSize:s.fontSize.md},"",""),children:o.info_receipt})]}),t(v,{span:"8",children:t(y.Item,{label:o.receipt_code,children:M(V.Text,{strong:n==null?void 0:n.code,children:[(n==null?void 0:n.code)??"-"," "]})})}),t(v,{span:"8",children:t(y.Item,{label:o.cashier,children:(n==null?void 0:n.cashier)??"-"})}),t(v,{span:"8",children:t(y.Item,{label:o.label.payer,children:(n==null?void 0:n.payer)??"-"})}),t(v,{span:"8",children:t(y.Item,{label:`${o.total_money} (${o.vnd})`,children:(e==null?void 0:e.totalPayment)??"-"})}),t(v,{span:"8",children:t(y.Item,{label:o.fund,children:e!=null&&e.fundName?e==null?void 0:e.fundName:"-"})}),t(v,{span:"8",children:t(y.Item,{label:o.created_at,children:(e==null?void 0:e.createdAt)??"-"})}),t(v,{span:"16",children:t(y.Item,{label:o.content,children:e!=null&&e.content?e==null?void 0:e.content:"-"})}),t(v,{span:"16",children:t(y.Item,{label:o.address,children:n!=null&&n.address?n==null?void 0:n.address:"-"})}),t(v,{span:"24",children:t(y.Item,{label:o.note,children:n!=null&&n.note?n==null?void 0:n.note:"-"})}),t(v,{span:"24",children:t(y.Item,{label:o.description,children:n!=null&&n.description?n==null?void 0:n.description:"-"})})]}):null,a?M(K,{gutter:[s.margin.md,s.margin.md],style:{background:"#f7f7f7",padding:"0px 10px 0 10px",marginBottom:"15px"},children:[M(v,{span:"24",css:H({marginTop:s.margin.md},"",""),children:[t(q,{name:"icon-info-circle-filled",css:H({fontSize:s.iconSize,marginRight:s.margin.xs,color:s.color.primary},"","")}),t(me,{css:H({color:s.color.primary,fontWeight:s.fontWeight.bold,fontSize:s.fontSize.md},"",""),children:o.info_payslip})]}),t(v,{span:"8",children:t(y.Item,{label:o.label.pay_slip_code,children:M(V.Text,{strong:a==null?void 0:a.code,children:[(a==null?void 0:a.code)??"-"," "]})})}),t(v,{span:"8",children:t(y.Item,{label:o.cashier,children:(a==null?void 0:a.cashier)??"-"})}),t(v,{span:"8",children:t(y.Item,{label:o.label.payer,children:(a==null?void 0:a.payer)??"-"})}),t(v,{span:"8",children:t(y.Item,{label:`${o.total_money} (${o.vnd})`,children:(e==null?void 0:e.totalPayment)??"-"})}),t(v,{span:"8",children:t(y.Item,{label:o.fund,children:e!=null&&e.fundName?e==null?void 0:e.fundName:"-"})}),t(v,{span:"8",children:t(y.Item,{label:o.created_at,children:(e==null?void 0:e.createdAt)??"-"})}),t(v,{span:"16",children:t(y.Item,{label:o.content,children:e!=null&&e.content?e==null?void 0:e.content:"-"})}),t(v,{span:"16",children:t(y.Item,{label:o.address,children:a!=null&&a.address?a==null?void 0:a.address:"-"})}),t(v,{span:"24",children:t(y.Item,{label:o.note,children:a!=null&&a.note?a==null?void 0:a.note:"-"})}),t(v,{span:"24",children:t(y.Item,{label:o.description,children:a!=null&&a.description?a==null?void 0:a.description:"-"})})]}):null]})})},On=async({reason:i,historyTransactionId:r,idBuilding:e,unitId:n})=>{try{return await bn({reason:i,unitAccountHistoryId:r,idBuilding:e,unitId:n})}catch(a){return a}},kn=()=>{const{idBuilding:i,hideFormCancelHistory:r,formCancelHistory:e,setFilter:n,formFilter:a}=T.useContext(oe),[s]=y.useForm(),[c]=Oe(),[h]=ue(),[d,p]=T.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),{id:f,unitId:g}=e==null?void 0:e.data;return De(d.code,d.codeLanguage,{message:o.success,description:o.delete_data_success}),{hideFormCancelHistory:r,formCancel:s,handleCancelHistory:async()=>{const u=s.getFieldsValue();p({isFetching:!0,code:void 0,codeLanguage:void 0});try{const{code:l,codeLanguage:b}=await On({reason:u,historyTransactionId:f,idBuilding:i,unitId:g});p({isFetching:!1,code:l,codeLanguage:b}),n({...ie}),a==null||a.setFieldsValue({...ie}),await Promise.all([c({filter:{...ie},pagination:{current:k,limit:$},isChangeTotalRow:!0}),h({filter:{...Te},pagination:{current:k,limit:$},isChangeTotalRow:!0})]),r()}catch(l){p({isFetching:!1,code:l.code,codeLanguage:l.codeLanguage})}},cancelHistoryStatus:d}},$n=()=>{const{hideFormCancelHistory:i,formCancel:r,handleCancelHistory:e,cancelHistoryStatus:n}=kn(),a=ce();return t(ne,{open:!0,title:o.cancel_history_transactions,onCancel:i,onOk:e,width:"50%",okText:o.confirm,okButtonProps:{disabled:n.isFetching,loading:n.isFetching},children:t(y,{onSubmit:e,form:r,layout:"vertical",name:"forCancel",children:M(K,{gutter:[a.margin.md,a.margin.md],children:[t(v,{span:24,children:t(V.Text,{children:o.do_you_want_cancel_history_transaction})}),t(v,{span:24,children:t(y.Item,{label:o.reason,name:"reason",children:t(Re.TextArea,{maxLength:"255",fluid:"true",placeholder:o.reason,rows:"3"})})})]})})})},Hn=()=>{var S;const{idBuilding:i,hideModalHistory:r,getServices:e,tableData:n,formDetailReceipt:a,formDetailPayslip:s,formDetailHistory:c,formCancelHistory:h,modalHistory:d}=T.useContext(oe),[p]=Oe(),[f]=y.useForm(),{removeQuery:g}=ft(),{name:m}=d==null?void 0:d.data,u=n!=null&&n.totalBalance?j(n==null?void 0:n.totalBalance):0;T.useEffect(()=>{(async()=>await Promise.all([e({idBuilding:i}),p({filter:{...ie},pagination:{current:k,limit:$}})]))()},[]);const l=()=>{g("unitId"),r()},b={unitId:(S=n==null?void 0:n.result)==null?void 0:S.id};return{hideModalHistory:l,totalRecord:n==null?void 0:n.totalRecord,formDetailReceipt:a,formDetailPayslip:s,formHistory:f,initialValues:b,formDetailHistory:c,formCancelHistory:h,unitName:m,total:u}},zn=()=>{const{hideModalHistory:i,totalRecord:r,formDetailReceipt:e,formDetailPayslip:n,formHistory:a,initialValues:s,formDetailHistory:c,formCancelHistory:h,unitName:d,total:p}=Hn();return M(ne,{width:"100%",title:o.history_unit_account,open:!0,onCancel:i,footer:null,children:[M(y,{form:a,layout:"vertical",name:"formHistory",initialValues:s,children:[M(K,{css:()=>({justifyContent:"flex-end",alignItems:"baseline"}),children:[t(y.Item,{name:"unitId",children:M(V,{css:f=>({marginRight:f.margin.lg}),children:[o.unit,": ",t(V.Text,{strong:!0,children:d})]})}),M(V.Text,{children:[o.total,": ",M(V.Text,{strong:!0,children:[" ",p]})]})]}),t(Y.ActionBox,{total:r}),t(Fn,{}),t(En,{})]}),e.isShow?t(Mn,{}):null,n.isShow?t(Ln,{}):null,c.isShow?t(Bn,{}):null,h.isShow?t($n,{}):null]})},Vn=()=>t(Xe,{children:t(zn,{})}),jn=()=>{const{idBuilding:i,hideModalImport:r,filter:e,setFilter:n}=T.useContext(J),{rules:a}=bt,[s]=ue(),[c,h]=T.useState({isFetching:!1,code:void 0,codeLanguage:void 0,success:0,failed:0,errors:[],data:void 0});De(c.code,c.codeLanguage,{message:o.success,description:o.import_data_success});const{dateImportRule:d}=a;return{headers:[{name:"#",rules:{type:"number",required:!0}},{name:o.apartments,rules:{type:"string",required:!0,max:255}},{name:o.service,rules:{type:"string",required:!0,max:255}},{name:o.amount_number,rules:{type:"number",required:!0,min:1}},{name:o.fund,rules:{type:"string",required:!0,max:255}},{name:o.label.date_of_payment,rules:{required:!0,...d}},{name:o.label.voucher_day,rules:d},{name:o.content,rules:{type:"string",required:!1,max:255}}],onOk:async m=>{var u,l,b,S;h({isFetching:!0,code:void 0,codeLanguage:void 0,success:0,failed:0,errors:[],data:void 0});try{const w=await pn({idBuilding:i,file:m}),D=((l=(u=w==null?void 0:w.data)==null?void 0:u.errors)==null?void 0:l.map(R=>({index:R==null?void 0:R.index,code:(R==null?void 0:R.code)??500,message:R.message})))??[];n({...e}),await s({filter:{...e},pagination:{current:k,limit:$},isChangeTotalRow:!0}),h({isFetching:!1,code:w.code,codeLanguage:w.codeLanguage,success:((b=w==null?void 0:w.data)==null?void 0:b.success)??0,failed:D.length,errors:D,data:((S=w==null?void 0:w.data)==null?void 0:S.data)??void 0})}catch(w){h({isFetching:!1,code:w.code,codeLanguage:w.codeLanguage,success:0,failed:0,errors:[],data:void 0})}},onHide:async()=>{r()},importUnitAccountState:c}},Wn=()=>{const{headers:i,onOk:r,onHide:e,importUnitAccountState:n}=jn(),{code:a,codeLanguage:s,isFetching:c,success:h,failed:d,errors:p,data:f}=n;return t(bt,{headers:i,onClose:e,onOk:r,visible:!0,fileNameTemplate:o.template_service_advanced_payment,templateUrl:Mt.document.mau_thong_tin_tai_khoan_can_ho,code:a,codeLanguage:s,loading:c,numberSuccess:h,numberFail:d,problemResponseServerDataSource:p,errorFile:f})},Gn=async({dataCreate:i,idBuilding:r})=>{var e,n;try{const{voucherDay:a,createdAt:s}=i,c={...i,voucherDay:a?(e=ye(a))==null?void 0:e.toISOString():void 0,createdAt:s?(n=ye(s))==null?void 0:n.toISOString():void 0};return await gn(c,r)}catch(a){return a}},{useForm:Yn}=y,qn=()=>{const{idBuilding:i,hideModalAdd:r,services:e,filter:n,setFilter:a}=T.useContext(J),{currentUser:s}=T.useContext(Ce),[c]=ue(),[h]=Yn(),[d,p]=T.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),{fundData:f}=dt(),[g,m]=T.useState({isFetching:!1}),[u,l]=T.useState([]),[b,S]=T.useState([]);De(d.code,d.codeLanguage,{message:o.success,description:o.add_data_success});const w=async _=>{m({isFetching:!0});const I=await Ut({idBuilding:i,page:k,limit:$,filter:{name:_}});l(I.data),m({isFetching:!1})},D=ut(async _=>{await w(_)});T.useEffect(()=>{(async()=>await w())()},[]);const R=async()=>{if(!d.isFetching&&await h.validateFields()){p({isFetching:!0,code:void 0,codeLanguage:void 0});const I=h.getFieldsValue();try{const{code:x,codeLanguage:U}=await Gn({dataCreate:I,idBuilding:i});p({isFetching:!1,code:x,codeLanguage:U}),a({...n}),await c({filter:{...n},pagination:{current:k,limit:$},isChangeTotalRow:!0}),r()}catch(x){p({isFetching:!1,code:x.code,codeLanguage:x.codeLanguage})}}},C=()=>r(),B=(_,I)=>{const{fundId:x}=I;if(x){const U=f==null?void 0:f.find(F=>F.id===x);h.setFieldsValue({paymentMethod:U==null?void 0:U.method})}},O={unitId:void 0,cashier:(s==null?void 0:s.fullName)??void 0,payer:void 0,serviceId:void 0,balance:void 0,voucherDay:void 0,fundId:void 0,paymentMethod:void 0,content:void 0,createdAt:ye()},z=async _=>{h.setFieldsValue({payer:void 0}),u==null||u.forEach(I=>{(I==null?void 0:I.id)===_&&S(I.residents)})};return{addUnitAccountStatus:d,fundData:f.filter(_=>[Nt,Lt].includes(_.method)),formAddUnitAccount:h,currentUser:s,onValuesChange:B,handleAddUnitAccount:R,handleCancelAddUnitAccount:C,services:e,initialValues:O,getListUnitStatus:g,listUnit:u,handleSearchUnit:D,handleSelectApartment:z,listResidents:b}},{Item:he}=y,{Option:Me}=W,{TextArea:Xn}=Re,Kn=()=>{const{addUnitAccountStatus:i,fundData:r,formAddUnitAccount:e,onValuesChange:n,handleAddUnitAccount:a,handleCancelAddUnitAccount:s,services:c,initialValues:h,getListUnitStatus:d,listUnit:p,handleSearchUnit:f,handleSelectApartment:g,listResidents:m}=qn(),{isFetching:u}=i;return t(ne,{title:o.add_advanced_payment,open:!0,confirmLoading:u,okText:o.label.confirm,cancelText:o.label.cancel,onOk:a,okButtonProps:{disabled:u,loading:u},onCancel:s,width:"60%",children:M(y,{name:"AddFormUnitAccount",layout:"vertical",scrollToFirstError:!0,form:e,initialValues:h,onValuesChange:n,children:[M(K,{gutter:[24,0],children:[t(v,{span:12,children:t(y.Item,{name:"unitId",label:o.unit,rules:[{required:!0}],children:t(W,{allowClear:!0,showSearch:!0,placeholder:o.select_apartment,filterOption:!1,loading:d.isFetching,onSearch:ut(f),style:{width:"100%"},fluid:"true",dropdownRender:l=>d.isFetching?t("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:t(Vt,{})}):l,onChange:g,children:p==null?void 0:p.map(({id:l,name:b})=>t(Me,{value:l,children:b},l))})})}),t(v,{span:12,children:t(he,{name:"payer",label:o.label.payer,rules:[{required:!0}],children:t(tt,{filterOption:(l,b)=>{var S,w;return((w=(S=b==null?void 0:b.value)==null?void 0:S.toUpperCase())==null?void 0:w.indexOf(l.toUpperCase()))!==-1},placeholder:o.label.payer,children:m==null?void 0:m.map(({id:l,fullName:b})=>t(tt.Option,{value:b,children:b},`${b}-${l}`))})})})]}),M(K,{gutter:[24,0],children:[t(v,{span:12,children:t(y.Item,{name:"serviceId",label:o.services,rules:[{required:!0}],children:t(W,{placeholder:o.services,fluid:"true",showSearch:!0,allowClear:!0,filterOption:(l,b)=>ee(b.children).indexOf(ee(l))>=0,getPopupContainer:l=>l.parentNode,children:c==null?void 0:c.map(({id:l,name:b})=>t(Me,{value:l,children:b},l))})})}),t(v,{span:12,children:t(he,{name:"balance",label:o.amount_number,rules:[{required:!0},{validator:Bt}],children:t(je,{min:1,formatter:l=>j(l),placeholder:o.amount_number})})}),t(v,{span:12,children:t(he,{name:"cashier",label:o.label.cashier,rules:[{required:!0}],children:t(Re,{placeholder:o.label.cashier})})}),t(v,{span:6,children:t(he,{name:"createdAt",label:o.label.date_of_payment,required:!0,rules:[{required:!0}],children:t(et,{allowClear:!1,style:{width:"100%"},format:"DD/MM/YYYY",disabledDate:l=>!l||l.isAfter(ye(new Date))})})}),t(v,{span:6,children:t(he,{name:"voucherDay",label:o.label.voucher_day,children:t(et,{fluid:"true",format:"DD/MM/YYYY"})})})]}),M(K,{gutter:[24,0],children:[t(v,{span:12,children:t(he,{noStyle:!0,shouldUpdate:(l,b)=>l.paymentMethod!==b.paymentMethod,children:({getFieldValue:l})=>t(y.Item,{name:"fundId",label:o.label.fund,rules:[{required:!0}],children:t(W,{placeholder:o.label.select_fund,fluid:"true",showSearch:!0,allowClear:!0,filterOption:(b,S)=>ee(S.children).indexOf(ee(b))>=0,getPopupContainer:b=>b.parentNode,children:r==null?void 0:r.map(({id:b,name:S})=>t(Me,{value:b,children:S},b))})})})}),t(v,{span:12,children:t(y.Item,{name:"paymentMethod",label:o.label.payment_method,children:t(W,{disabled:!0,placeholder:o.label.select_payment_method,fluid:"true",children:Ot.map(({id:l,name:b})=>t(Me,{value:l,children:b},l))})})})]}),t(K,{gutter:[24,0],children:t(v,{span:24,children:t(he,{name:"content",label:o.label.content,children:t(Xn,{maxLength:255,placeholder:o.label.content,rows:"3"})})})})]})})},Jn=async({unitAccountData:i,unitId:r,idBuilding:e})=>{try{const{serviceIdTransfer:n,balanceTransfer:a,serviceIdReceive:s}=i;return await fn({serviceIdTransfer:n??null,balanceTransfer:a??null,serviceIdReceive:s??null,unitId:r??null},e)}catch(n){return n}},{useForm:Qn}=y,Zn=()=>{const{idBuilding:i,modalTransferMoney:r,hideModalTransferMoney:e,services:n,filter:a,setFilter:s}=T.useContext(J),{currentUser:c}=T.useContext(Ce),[h]=ue(),[d]=Qn(),[p,f]=T.useState({isFetching:!1,code:void 0,codeLanguage:void 0}),[g,m]=T.useState(!0),{fundData:u}=dt(),l=r==null?void 0:r.data,[b,S]=T.useState({unitName:l==null?void 0:l.name,currentBalanceTransfer:0,currentBalanceReceipt:0,balanceAfterTransfer:0,balanceAfterReceipt:0});return De(p.code,p.codeLanguage,{message:o.success,description:o.update_data_success}),{transferMoneyUnitAccountStatus:p,fundData:u,formTransferMoneyUnitAccount:d,currentUser:c,onValuesChange:(C,B)=>{var x,U,F,E;const{serviceIdTransfer:O,serviceIdReceive:z,balanceTransfer:_}=B;let I=_||0;if(((C==null?void 0:C.balanceTransfer)===null||(C==null?void 0:C.balanceTransfer)!==null&&!Number.isInteger(C==null?void 0:C.balanceTransfer)&&((U=(x=C==null?void 0:C.balanceTransfer)==null?void 0:x.toString())!=null&&U.includes(".")))&&d.setFieldsValue({balanceTransfer:I==null?void 0:I.toString().split(".")[0]}),C!=null&&C.serviceIdTransfer&&(I=void 0,d.setFieldsValue({balanceTransfer:void 0}),S(A=>({...A,balanceAfterTransfer:0}))),O){const A=(F=l==null?void 0:l.unitAccounts)==null?void 0:F.find(L=>L.serviceId===O),N=A?Number(A==null?void 0:A.balance):0;m(!N);const G=N-I;S(L=>({...L,currentBalanceTransfer:N,balanceAfterTransfer:G}))}else(!O||!z)&&S(A=>({...A,currentBalanceTransfer:0,currentBalanceReceipt:0,balanceAfterTransfer:0,balanceAfterReceipt:0}));if((b==null?void 0:b.currentBalanceTransfer)<I&&(I=b==null?void 0:b.currentBalanceTransfer,d.setFieldsValue({balanceTransfer:I}),S(A=>({...A,balanceAfterTransfer:0}))),z){const A=(E=l==null?void 0:l.unitAccounts)==null?void 0:E.find(L=>L.serviceId===z),N=A?Number(A==null?void 0:A.balance):0,G=N+(I||0);S(L=>({...L,currentBalanceReceipt:N,balanceAfterReceipt:G,balanceReceipt:I}))}else z||S(A=>({...A,currentBalanceReceipt:0,balanceAfterReceipt:0}))},handleTransferMoneyUnitAccount:async()=>{if(await d.validateFields()){f({isFetching:!0,code:void 0,codeLanguage:void 0});const B=d.getFieldsValue(),{code:O,codeLanguage:z}=await Jn({unitAccountData:B,unitId:l==null?void 0:l.id,idBuilding:i});s({...a}),f({isFetching:!1,code:O,codeLanguage:z}),pt.includes(O)&&(await h({filter:{...a},pagination:{current:k,limit:$},isChangeTotalRow:!0}),e())}},handleCancelTransferMoneyUnitAccount:()=>e(),services:n,disabledBalanceTransfer:g,transferInfo:b}},{Item:ge}=y,{Option:ot}=W,eo=()=>{const{transferMoneyUnitAccountStatus:i,formTransferMoneyUnitAccount:r,onValuesChange:e,handleTransferMoneyUnitAccount:n,handleCancelTransferMoneyUnitAccount:a,services:s,transferInfo:c,disabledBalanceTransfer:h}=Zn(),d=ce(),{isFetching:p}=i;return t(ne,{title:o.transfer_money_unit_account,open:!0,confirmLoading:p,okText:o.label.confirm,cancelText:o.label.cancel,onOk:n,okButtonProps:{disabled:p,loading:p},onCancel:a,width:"65%",children:M(y,{name:"FormTransferMoneyUnitAccount",layout:"vertical",scrollToFirstError:!0,form:r,onValuesChange:e,children:[M(K,{gutter:[24,0],children:[t(v,{span:24,children:t(y.Item,{label:o.unit,children:t(V.Text,{strong:!0,children:c==null?void 0:c.unitName})})}),M(v,{span:24,children:[t(q,{name:"icon-info-circle-filled",css:H({fontSize:d.iconSize,marginRight:d.margin.xs,color:d.color.primary},"","")}),t(me,{css:H({color:d.color.primary,fontWeight:d.fontWeight.bold,fontSize:d.fontSize.md},"",""),children:o.info_service_transfer})]}),t(v,{span:24,children:t(y.Item,{name:"serviceIdTransfer",label:o.service_transfer,dependencies:["serviceIdReceive"],rules:[{required:!0},({getFieldValue:f})=>({validator(g,m){const u=f("serviceIdReceive");return m&&u!==""&&m===u?Promise.reject(o.the_transfer_service_must_be_different_from_the_receiving_service):Promise.resolve()}})],children:t(W,{placeholder:o.service_transfer,allowClear:!0,fluid:"true",filterOption:(f,g)=>ee(g.children).indexOf(ee(f))>=0,getPopupContainer:f=>f.parentNode,showSearch:!0,children:s==null?void 0:s.map(({id:f,name:g})=>t(ot,{value:f,children:g},f))})})}),t(v,{span:8,children:t(ge,{label:o.money_current,children:t(V.Text,{strong:!0,children:c!=null&&c.currentBalanceTransfer?j(c==null?void 0:c.currentBalanceTransfer):0})})}),t(v,{span:8,children:t(ge,{name:"balanceTransfer",label:o.transfer_amount,rules:[{required:!0}],children:t(je,{min:1,disabled:h,formatter:f=>j(f),placeholder:o.transfer_amount})})}),t(v,{span:8,children:t(ge,{label:o.amount_after_transfer,children:t(V.Text,{strong:!0,children:c!=null&&c.balanceAfterTransfer?j(c==null?void 0:c.balanceAfterTransfer):0})})})]}),M(K,{gutter:[24,0],children:[M(v,{span:"24",css:H({marginTop:d.margin.md},"",""),children:[t(q,{name:"icon-info-circle-filled",css:H({fontSize:d.iconSize,marginRight:d.margin.xs,color:d.color.primary},"","")}),t(me,{css:H({color:d.color.primary,fontWeight:d.fontWeight.bold,fontSize:d.fontSize.md},"",""),children:o.info_service_receipt})]}),t(v,{span:24,children:t(y.Item,{name:"serviceIdReceive",label:o.service_receipt,dependencies:["serviceIdTransfer"],rules:[{required:!0},({getFieldValue:f})=>({validator(g,m){const u=f("serviceIdTransfer");return m&&u!==""&&m===u?Promise.reject(o.the_receive_service_must_be_different_from_the_transfer_service):Promise.resolve()}})],children:t(W,{placeholder:o.service_receipt,allowClear:!0,fluid:"true",showSearch:!0,filterOption:(f,g)=>ee(g.children).indexOf(ee(f))>=0,getPopupContainer:f=>f.parentNode,children:s==null?void 0:s.map(({id:f,name:g})=>t(ot,{value:f,children:g},f))})})}),t(v,{span:8,children:t(ge,{label:o.money_current,children:t(V.Text,{strong:!0,children:c!=null&&c.currentBalanceReceipt?j(c==null?void 0:c.currentBalanceReceipt):0})})}),t(v,{span:8,children:t(ge,{label:o.transfer_amount,children:t(V.Text,{strong:!0,children:c!=null&&c.balanceReceipt?j(c==null?void 0:c.balanceReceipt):0})})}),t(v,{span:8,children:t(ge,{label:o.amount_after_transfer,children:t(V.Text,{strong:!0,children:c!=null&&c.balanceAfterReceipt?j(c==null?void 0:c.balanceAfterReceipt):0})})})]})]})})},re={unitName:void 0,serviceIds:[]},we=T.createContext({idBuilding:0,getListUnitAccountStatus:{isFetching:!1},setGetListDeductionStatus:()=>{},filter:{...re},setFilter:()=>{},tableData:{services:[],records:[],totalRecord:0},setTableData:()=>{},tableDataTotalRow:{},setTableDataTotalRow:()=>{},tablePagination:{current:k,limit:$},setTablePagination:()=>{},services:[],getServices:()=>{},unitAccountPermissionCreate:!1,onSelectRow:()=>{},onSelectAllRowOfPage:()=>{},tableSelection:()=>{},selectAllRowComponent:()=>{},resetDataTableSelection:()=>{},setFormDeduct:()=>{},formDeduct:void 0,formFilter:void 0,deductObj:{},setDeductObj:()=>{},deductServiceProgress:0,setDeductServiceProgress:()=>{}}),Ke=({children:i})=>{var F;const{idBuilding:r}=Be(),{getPermissionByModuleCode:e}=mt(),[n]=y.useForm(),[a]=y.useForm(),[s,c]=T.useState({isFetching:!1}),[h,d]=T.useState({...re}),[p,f]=T.useState({services:[],records:[],totalRecord:0}),[g,m]=T.useState(),[u,l]=T.useState({}),[b,S]=T.useState(0),[w,D]=T.useState({current:k,limit:$}),[R,C,B,O,z]=Wt({dataRows:p.records,rowKey:"id",totalRows:p.totalRecord}),{services:_,getServices:I}=Ye(),x=((F=e(fe))==null?void 0:F[Ve])??!1,U={idBuilding:r,formDeduct:n,getListUnitAccountStatus:s,setGetListDeductionStatus:c,filter:h,setFilter:d,tableData:p,setTableData:f,tableDataTotalRow:g,setTableDataTotalRow:m,tablePagination:w,setTablePagination:D,services:_,getServices:I,unitAccountPermissionCreate:x,tableSelection:R,resetDataTableSelection:C,onSelectRow:B,onSelectAllRowOfPage:O,selectAllRowComponent:z,deductObj:u,setDeductObj:l,deductServiceProgress:b,setDeductServiceProgress:S,formFilter:a};return t(we.Provider,{value:U,children:i})};Ke.propTypes={children:We.node};Ke.defaultProps={children:t("div",{})};const At=i=>{var n,a,s;const r={};(n=i==null?void 0:i.accounts)!=null&&n.length&&((a=i==null?void 0:i.accounts)==null||a.forEach(c=>{const{serviceId:h,balance:d}=c;r[h]||(r[h]={serviceId:h,balance:0}),r[h].balance+=Number(d)}));const e={};return(s=i==null?void 0:i.bills)!=null&&s.length&&i.bills.forEach(c=>{var g;const{serviceId:h,service:d,totalPayment:p,netRevenue:f}=c;e[h]||(e[h]={serviceName:d==null?void 0:d.name,serviceId:h,debt:0,balance:((g=r[h])==null?void 0:g.balance)??0,unitId:i==null?void 0:i.id}),e[h].debt+=(p??0)-(f??0)}),e},to=(i,r)=>{const{id:e}=r,{serviceId:n,debt:a,serviceName:s,balance:c}=i;return{typeRow:"SERVICE",id:`service-${e}-${n}`,key:`service-${e}-${n}`,debt:a??0,apartment:s,paidBefore:c??0,maxValue:a<=c?a:c,unitId:e,serviceId:n}},no=i=>{var s;const r=At(i),e=((s=Object.values(r))==null?void 0:s.map(c=>to(c,i)))??[],{id:n,name:a}=i;return{id:n,key:n,typeRow:"APARTMENT",apartment:a??"",children:e}},wt=async({idBuilding:i,filter:r,page:e,limit:n})=>{try{const{serviceIds:a,unitName:s}=r,{code:c,codeLanguage:h,data:d,totalRecord:p}=await Gt({filterObject:{unitName:s||void 0,serviceIds:a||void 0,state:[kt,$t],status:[Ht]},page:e,limit:n,idBuilding:i}),f={};return d==null||d.forEach(g=>{var u;const m=At(g);(u=Object.values(m))==null||u.forEach(l=>{const{id:b}=g,{serviceId:S,debt:w,balance:D}=l;f[`service-${b}-${S}`]||(f[`service-${b}-${S}`]={...l,deduct:0}),f[`service-${b}-${S}`].deduct=w<=D?w:D})}),{code:c,codeLanguage:h,data:d==null?void 0:d.map(g=>no(g)),totalRecord:p,deductObj:f}}catch({code:a,codeLanguage:s}){return{code:a,codeLanguage:s,data:[],totalRecord:0,deductObj:{}}}},ke=()=>{const{setTablePagination:i,setTableData:r,setGetListDeductionStatus:e,setDeductObj:n}=T.useContext(we),{idBuilding:a}=Be();return{changeDataTable:async({filter:c,limit:h,page:d,isPagination:p=!1})=>{e({isFetching:!0}),i({current:d,limit:h});const{data:f,totalRecord:g,deductObj:m}=await wt({idBuilding:a,filter:c,limit:h,page:d});n(u=>p?{...m,...u}:{...u,...m}),r({records:f,totalRecord:g}),e({isFetching:!1})}}},oo=()=>{const{idBuilding:i,setFilter:r,services:e,resetDataTableSelection:n,formFilter:a}=T.useContext(we),{changeDataTable:s}=ke(),c=async d=>{n(),r(d),await s({idBuilding:i,filter:d,page:k,limit:$})},h=T.useMemo(()=>({...re,serviceIds:e==null?void 0:e.map(d=>d==null?void 0:d.id)}),[e]);return T.useEffect(()=>{a==null||a.setFieldsValue({...re,serviceIds:e==null?void 0:e.map(d=>d==null?void 0:d.id)})},[e]),{onSearch:c,services:e,initialValues:h,formFilter:a}},ao=()=>{const{onSearch:i,services:r,initialValues:e,formFilter:n}=oo(),a=`
  .ant-input-number-handler-wrap {
    opacity: 1;
  }
  .ant-input-number-input-wrap {
    padding-right: 20px;
  }
  .ant-input-number-input {
    text-align: right;
  }
  .ant-select-selection-overflow-item {
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 180px;
  }
`,s=T.useMemo(()=>[{label:o.service,key:"serviceIds",component:t(W,{mode:"multiple",placeholder:o.service,showSearch:!0,fluid:"true",maxTagCount:"responsive",showArrow:!0,allowClear:!0,optionFilterProp:"children",filterOption:(c,h)=>ee(h.children).indexOf(ee(c))>=0,getPopupContainer:c=>c.parentNode,css:H(a,";",""),children:r==null?void 0:r.map(({id:c,name:h})=>t(W.Option,{value:c,children:h},c))}),visible:!0},{label:o.label.apartment,key:"unitName",component:t(Re,{placeholder:o.label.apartment}),visible:!0}],[r,e==null?void 0:e.serviceIds]);return t(lt,{formData:n,initialValues:e,filters:s,onSearch:i,visibleFilterBox:!0,size:"small"})},at=async({idBuilding:i,units:r})=>{try{const{code:e,codeLanguage:n}=await Yt(i,r);return{code:e,codeLanguage:n}}catch({code:e,codeLanguage:n}){return{code:e,codeLanguage:n}}},it=(i=[])=>{const r=[];return i==null||i.forEach(e=>{let n=!1;e.services.forEach(a=>{a.paidBefore>0&&(n=!0)}),n&&r.push(e)}),r},He=20,io=()=>{const{tableSelection:i,idBuilding:r,selectAllRowComponent:e,deductObj:n,tableData:a,filter:s,setDeductServiceProgress:c,resetDataTableSelection:h,unitAccountPermissionCreate:d,setFilter:p,formFilter:f}=T.useContext(we),{isSelectAllItem:g,selectedRowKeysCache:m,byId:u,selectedRowsCache:l}=i,{changeDataTable:b}=ke(),[S]=ue(),[w,D]=T.useState({isFetching:!1,code:void 0,codeLanguage:void 0});De(w.code,w.codeLanguage,{message:o.success,description:o.status.deduct_success});const R=async()=>{var I,x,U,F,E,A;D({isFetching:!0,code:void 0,codeLanguage:void 0});const _={code:500,codeLanguage:null};if(g){const N=a==null?void 0:a.totalRecord,G=Math.ceil(N/He);let L=1;for(;L<=G;){const X=await wt({idBuilding:r,filter:s,limit:He,page:L});if(((I=X==null?void 0:X.data)==null?void 0:I.length)>0){const P={};(x=X==null?void 0:X.data)==null||x.forEach(te=>{var Ee;(Ee=te==null?void 0:te.children)==null||Ee.forEach(Q=>{var Ie,xe;P[te.id]||(P[te.id]={unitId:te.id,services:[]}),(xe=P[te.id])==null||xe.services.push({id:Q==null?void 0:Q.serviceId,paidBefore:((Ie=n[Q==null?void 0:Q.id])==null?void 0:Ie.deduct)||(Q==null?void 0:Q.maxValue)})})});const ae=(U=Object.values(P))!=null&&U.length?it(Object.values(P)):[],{code:_e,codeLanguage:$e}=await at({idBuilding:r,units:ae});_.code=_e,_.codeLanguage=$e}c(Math.floor(L*100/G)),L+=1}}if(!g){const N={};l==null||l.forEach(P=>{var ae;P.children||(N[P==null?void 0:P.unitId]||(N[P==null?void 0:P.unitId]={unitId:P==null?void 0:P.unitId,services:[]}),N[P.unitId].services.push({id:P==null?void 0:P.serviceId,paidBefore:((ae=n[P==null?void 0:P.id])==null?void 0:ae.deduct)||P.maxValue}))});let G=0;const L=(F=Object.values(N))!=null&&F.length?it(Object.values(N)):[];let X=[];for(let P=0;P<(L==null?void 0:L.length);P+=1)if(X.push({unitId:(E=L[P])==null?void 0:E.unitId,services:(A=L[P])==null?void 0:A.services}),X.length===He||P===L.length-1){G+=X.length;const{code:ae,codeLanguage:_e}=await at({idBuilding:r,units:X??[]});_.code=ae,_.codeLanguage=_e,X=[],c(Math.floor(G*100/L.length))}}return D({isFetching:!1,code:_==null?void 0:_.code,codeLanguage:_==null?void 0:_.codeLanguage}),c(0),pt.includes(_==null?void 0:_.code)?(h(),p({...re}),f==null||f.setFieldsValue({...re}),await Promise.all([b({filter:{...re},page:k,limit:$}),await S({filter:{...ie},pagination:{current:k,limit:$}})]),Promise.resolve()):Promise.reject()},C=m==null?void 0:m.map(_=>u==null?void 0:u[_]),B=()=>{var _;It({onCancel:()=>{D({isFetching:!1,code:void 0,codeLanguage:void 0})},isAll:g,loading:w.isFetching,onOk:()=>R(),questionText:o.do_you_want_to_deduction_unit_account,totalItem:(_=C==null?void 0:C.filter(I=>(I==null?void 0:I.typeRow)!=="APARTMENT"))==null?void 0:_.length})},O=()=>{var _;return e({totalItemSelected:(_=C==null?void 0:C.filter(I=>(I==null?void 0:I.typeRow)==="APARTMENT"))==null?void 0:_.length,textSelectRow:o.you_selected_rows,textSelectAllRow:o.select_all_rows})},z=!g&&(m==null?void 0:m.length)===0;return{totalRecord:O,isDisabledActionMenu:z,onClickBtnDeduction:B,loading:w.isFetching,unitAccountPermissionCreate:d}},ro=()=>{const{totalRecord:i,isDisabledActionMenu:r,onClickBtnDeduction:e,loading:n,unitAccountPermissionCreate:a}=io(),s=[a?t(be,{type:"primary",onClick:()=>{e()},loading:n,disabled:r,children:o.deduct},"deduct"):null].filter(Boolean);return t(Y.ActionBox,{actions:s,total:i()})},co=()=>{const{filter:i,getListUnitAccountStatus:r,tableData:e,tablePagination:n,tableSelection:a,onSelectRow:s,onSelectAllRowOfPage:c,setTablePagination:h,setDeductObj:d,deductObj:p}=T.useContext(we),{layoutScrollRef:f}=T.useContext(Ce),{selectedRowKeys:g}=a,{changeDataTable:m}=ke(),u=ce(),[l,b]=T.useState({}),[S,w]=T.useState([]),D=(F,E)=>{b(A=>({...A,[F]:E}))},R=async(F,E)=>{let{limit:A,current:N}=n;N!==F?N=F:A!==E&&(N=k,A=E),h({limit:A,current:N}),await m({filter:{...i},limit:A,page:N,isPagination:!0})},C=T.useMemo(()=>({defaultPageSize:$,defaultCurrent:k,pageSize:n.limit,current:n.current,total:e==null?void 0:e.totalRecord,showSizeChanger:!0,onChange:R}),[n,e.totalRecord]),B={offsetScroll:u.offsetScrollX,getContainer:()=>f.current},O={scrollToFirstRowOnChange:!0},z={selectedRowKeys:g,onSelect:s,onSelectAll:c,fixed:!0};T.useEffect(()=>{var E;const F=(E=e==null?void 0:e.records)==null?void 0:E.flatMap(A=>[A.key,...A.children.map(N=>N.key)]);w(F)},[e==null?void 0:e.records]);const _=(F,E)=>{const A=[...S],N=A.indexOf(E.key);N>-1?A.splice(N,1):A.push(E.key),w(A)},I=(F,E)=>{if(!F)return;const A={...p};A[E.id]={...A[E.id],deduct:F},d(N=>({...N,...A}))},x=T.useMemo(()=>{var E;const F=[];return(E=e.records)==null||E.forEach(A=>{const N=[];A.children.forEach(G=>{const L=p[G.id];N.push({...G,...L})}),F.push({...A,children:N})}),F},[p,e.records]),U=F=>{const E=F.currentTarget.value.length;F.currentTarget.focus(),setTimeout(()=>{F.target.setSelectionRange(E,E)},0)};return{loading:r.isFetching,dataSource:x,pagination:C,sticky:B,scroll:O,rowSelection:z,deductValues:l,handleDeductChange:D,onExpand:_,expandedKeys:S,onChangeValueDeduct:I,handleFocusEndText:U}},so=()=>{const{loading:i,dataSource:r,pagination:e,sticky:n,scroll:a,rowSelection:s,onExpand:c,expandedKeys:h,onChangeValueDeduct:d,handleFocusEndText:p}=co(),f=`
  .ant-input-number-handler-wrap {
    opacity: 1;
  }
  .ant-input-number-input-wrap {
    padding-right: 20px;
  }
  .ant-input-number-input {
    text-align: right;
  }
`,g=[{title:o.label.apartment,key:"apartment",dataIndex:"apartment",width:250,fixed:"left"},{title:o.label.debt,key:"debt",dataIndex:"debt",width:150,align:"right",render:(m,u)=>t(V.Text,{children:j(m)})},{title:o.advance_payment,key:"paidBefore",dataIndex:"paidBefore",width:150,align:"right",render:(m,u)=>t(V.Text,{children:j(m)})},{title:o.deduction_of_prepayment,key:"deduct",dataIndex:"deduct",width:150,align:"right",render:(m,u)=>u.children?null:t(je,{size:"small",style:{textAlign:"right"},onFocus:p,formatter:l=>j(l),min:"1",onChange:l=>d(l,u),max:(u==null?void 0:u.maxValue)||0,value:u==null?void 0:u.deduct,css:H(f,";","")})}];return t(Y.Table,{columns:g,dataSource:r,loading:i,pagination:e,sticky:n,scroll:a,rowSelection:s,onExpand:c,expandedRowKeys:h,expandable:{defaultExpandAllRows:!0}})},lo=()=>{const{hideModalDeduction:i}=T.useContext(J),{formDeduct:r,getServices:e,deductServiceProgress:n,idBuilding:a}=T.useContext(we),{changeDataTable:s}=ke();return T.useEffect(()=>{(async()=>{var d;const h=await e({idBuilding:a});await s({filter:{...re,serviceIds:(d=h==null?void 0:h.data)==null?void 0:d.map(p=>p==null?void 0:p.id)},page:k,limit:$})})()},[]),{formDeduct:r,initialValues:{deduct:void 0},hideModalDeduction:i,percent:n}};var uo={name:"11k3kmz",styles:"display:flex;flex-direction:column;flex:1;height:100%"};const ho=()=>{const{formDeduct:i,initialValues:r,hideModalDeduction:e,percent:n}=lo();return t(ne,{title:o.deduction_of_prepayment,open:!0,width:"80%",onCancel:e,footer:null,children:t(Y.Wrapper,{children:M(y,{name:"formDeduct",layout:"vertical",form:i,initialValues:r,css:uo,children:[t(ao,{}),n?t(gt,{strokeColor:{from:"#108ee9",to:"#87d068"},percent:n,status:"active",css:a=>({marginTop:a.margin.xs,marginBottom:a.margin.xs})}):null,M(Y.Container,{children:[t(Y.Header,{children:t(ro,{})}),t(Y.Content,{children:t(so,{})})]})]})})})},mo=()=>t(Ke,{children:t(ho,{})}),ze=100,po=()=>{const{hideModalExport:i,tableData:r,idBuilding:e,filter:n}=T.useContext(J),[a,s]=T.useState(0),c=async()=>{s(0);const h=[];let d=1;const p=r==null?void 0:r.totalRecord,f=Math.floor(p/ze)+1;let g=0,m=[];for(await Tn({idBuilding:e,filter:{...n}});d<=f;){const[b,S]=await St({filter:n,idBuilding:e,pagination:{current:d,limit:ze}});if(m.length||(m=b),(S==null?void 0:S.length)>0){const w=h.length;for(let R=0;R<(S==null?void 0:S.length);R+=1){const C=S[R],B=[w+R+1,C==null?void 0:C.name];m==null||m.forEach(O=>{B==null||B.push(C[`unitAccount-${O==null?void 0:O.id}`]||0)}),B.push(C==null?void 0:C.total),h.push(B)}d+=1;const D=ze/p*100;g+=D,s(Math.round(g))}else{d=0;break}}const u=await Ct({filter:n,idBuilding:e}),l=["",o.total];m.forEach(b=>{l.push(u[b.id]||0)}),l.push(u.totalBalance||0),h.unshift(l),h.unshift(["#",o.unit,...m==null?void 0:m.map(b=>b.name),o.total]),qt(h,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8","Thong-tin-thu-truoc-dich-vu",".xlsx"),jt.success({message:o.success,description:o.export_data_success}),i()};return T.useEffect(()=>{c()},[]),{percent:a}},go=()=>{const{percent:i}=po();return t(ne,{open:!0,footer:null,closable:!1,children:t(gt,{strokeColor:{from:"#108ee9",to:"#87d068"},percent:i,status:"active"})})},fo=()=>{const{setTitlePage:i,setVisibleFilterBox:r,setVisibleSearchBox:e}=T.useContext(Ce),{modalHistory:n,showModalHistory:a,modalImport:s,idBuilding:c,getServices:h,modalAdd:d,modalTransferMoney:p,modalDeduction:f,modalExport:g,formFilter:m,setFilter:u,setGetListUnitAccountStatus:l}=T.useContext(J),[b]=ue(),{queryParams:S}=ft();return T.useEffect(()=>(i(o.label.service_advance_payment),e(!0),(async()=>{var R;l({isFetching:!0});const{data:w}=await h({idBuilding:c}),D=((R=w==null?void 0:w.filter(C=>C.unitGroupId))==null?void 0:R.map(C=>C.id))??[];u({...Te,serviceIds:D}),m.setFieldsValue({...Te,serviceIds:D}),await b({filter:{...Te,serviceIds:D},pagination:{current:k,limit:$},isChangeTotalRow:!0})})(),()=>{i(""),e(!1),r(!1)}),[]),T.useEffect(()=>{S.get("unitId")&&a({idUnit:S.get("unitId")})},[...S]),{modalHistory:n,modalImport:s,modalAdd:d,modalTransferMoney:p,modalDeduction:f,modalExport:g}},bo=()=>{const{modalHistory:i,modalImport:r,modalAdd:e,modalTransferMoney:n,modalDeduction:a,modalExport:s}=fo();return M(Y.Wrapper,{children:[t(Cn,{}),M(Y.Container,{children:[t(Y.Header,{children:t(nn,{})}),t(Y.Content,{children:t(wn,{})})]}),i.isShow?t(Vn,{}):null,r.isShow?t(Wn,{}):null,e.isShow?t(Kn,{}):null,n.isShow?t(eo,{}):null,a.isShow?t(mo,{}):null,s.isShow?t(go,{}):null]})},ii=()=>t(en,{children:t(bo,{})});export{ii as default};
