import{j as n,u as U,a as A,c as me,F as le}from"./@emotion-63839449.js";import{B as _}from"./index-881eef42.js";import{r as ee,j as te,b as ne,D as Z,l as j,d as ue,T as Y,C as b,a as oe,p as M,q as E}from"./index-b17d22e5.js";import{F,u as pe}from"./index-687ba9e6.js";import{b0 as he,K as q,aC as fe,at as ye,eS as re,eR as ae,eC as ie,cr as se,I as O,l as c,fG as ge,fH as W,f1 as Ae,eZ as Ie,ep as ve,a9 as Pe,s as Se,c6 as k,a as Ce,a1 as we,S as Fe,fI as xe}from"./index-c2ded735.js";import{S as x}from"./index-43183512.js";import"./lodash-88fe09e6.js";import{h as T}from"./moment-a468e1f9.js";import"./file-saver-40cf32a9.js";import{r as v}from"./react-4fd50329.js";import"./react-redux-896b353b.js";import{u as _e}from"./useService-37d60dc0.js";import"./@firebase-43527ee1.js";import{P as Be}from"./prop-types-1172f4d5.js";import{u as de}from"./react-router-a4308f7b.js";import{R as G,b as w,T as $,B as J,S as De,A as Te,a as Re,y as Le}from"./antd-f9eae174.js";import{o as Ne,r as je}from"./bill-d9d0423c.js";import{b as Oe}from"./buildDetailBills-28b155ef.js";import{b as ke,g as Me}from"./receipt-01489128.js";import{F as Ee}from"./index-a492c353.js";import"./hoist-non-react-statics-23d96a9a.js";import"./react-is-e8e5dbb3.js";import"./@babel-b64fd0f9.js";import"./stylis-79144faa.js";import"./react-router-dom-2a8f5f6d.js";import"./history-a1882333.js";import"./resolve-pathname-e210f2ac.js";import"./tiny-invariant-dd7d57d2.js";import"./account-86ffff50.js";import"./libphonenumber-js-0d5a9c92.js";import"./react-infinite-scroll-component-e33646cb.js";import"./redux-10bbab4c.js";import"./react-dom-40621ea0.js";import"./classnames-4ba1ba1a.js";import"./scheduler-765c72db.js";import"./@redux-saga-8bafe09b.js";import"./redux-logger-e1c9ca90.js";import"./dompurify-8e338605.js";import"./query-string-f5cca1e7.js";import"./decode-uri-component-4138e85d.js";import"./split-on-first-4f1167c8.js";import"./filter-obj-2ed190f4.js";import"./oidc-client-7da0eaf7.js";import"./firebase-878887a2.js";import"./rc-pagination-c1e6a0ac.js";import"./rc-picker-2e3d5fe5.js";import"./rc-util-0bc219f3.js";import"./rc-trigger-570b13ec.js";import"./rc-motion-ae889c42.js";import"./rc-align-e5d7b12e.js";import"./dom-align-ecb06dd6.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-resize-observer-b9ad4e29.js";import"./@ant-design-cba9d434.js";import"./@ctrl-fb5a5473.js";import"./rc-tabs-dfd19a56.js";import"./rc-dropdown-5378dd0a.js";import"./rc-menu-b15ebfe9.js";import"./rc-overflow-6be96612.js";import"./rc-select-564caf01.js";import"./rc-virtual-list-8a7b82a6.js";import"./rc-collapse-11b7d3c4.js";import"./shallowequal-4542d6f7.js";import"./rc-drawer-317f0b4d.js";import"./@rc-component-5a112e55.js";import"./rc-field-form-ef5549aa.js";import"./async-validator-dee29e8b.js";import"./scroll-into-view-if-needed-6b992d05.js";import"./compute-scroll-into-view-183f845a.js";import"./rc-image-e0357917.js";import"./rc-dialog-b1d1f07b.js";import"./rc-input-number-8bc068f7.js";import"./rc-rate-c64cf0d5.js";import"./rc-steps-2d1924c7.js";import"./rc-switch-b4e96de7.js";import"./rc-table-191ecc42.js";import"./rc-checkbox-018e8052.js";import"./rc-tree-67773537.js";import"./rc-tree-select-cb7eccc3.js";import"./copy-to-clipboard-64585c8c.js";import"./toggle-selection-93f4ad84.js";import"./rc-textarea-d01adcbb.js";import"./rc-input-02c2c2ba.js";import"./rc-upload-3ab0f08a.js";import"./rc-notification-d13dc43b.js";import"./rc-progress-4f1a7096.js";import"./rc-tooltip-08fa4217.js";import"./use-sync-external-store-5d1b6592.js";import"./idb-cdd1a92f.js";import"./path-to-regexp-ef8d5544.js";import"./index-6a3b7dc6.js";import"./index-f7aef2cc.js";import"./printHtml-6274ec45.js";const R=v.createContext({idBuilding:0,paymentPermissionWrite:!1,apartments:[],setApartments:()=>{},paymentInfo:{paymentAt:void 0,voucherDay:void 0,labelId:void 0,method:void 0,fundId:void 0},setPaymentInfo:()=>{},formPaymentInfo:void 0,formBills:void 0,showFormBills:()=>{},hideFormBills:()=>{},formConfirmPayment:void 0,showFormConfirmPayment:()=>{},hideFormConfirmPayment:()=>{},formReceipt:void 0,showFormReceipt:()=>{},hideFormReceipt:()=>{},refreshInvoiceBox:()=>{},isResetListApartmentFilter:!1,setIsResetListApartmentFilter:()=>{},servicesSelected:[],setServicesSelected:()=>{}}),K=({children:e})=>{var D;const{getPermissionByModuleCode:o}=he(),r=de(),{idBuilding:a}=r,[d,s]=v.useState([]),[m,t]=v.useState({paymentAt:void 0,voucherDay:void 0,labelId:void 0,method:void 0,fundId:void 0}),[i,u]=v.useState([]),[p]=F.useForm(),[h,l,y]=q(),[f,g,I]=q(),[S,C,L]=q(),[N,P]=v.useState(!1),B=((D=o(fe))==null?void 0:D[ye])??!1,H={idBuilding:a,paymentPermissionWrite:B,apartments:d,setApartments:s,paymentInfo:m,setPaymentInfo:t,formPaymentInfo:p,formBills:h,showFormBills:l,hideFormBills:y,formConfirmPayment:f,showFormConfirmPayment:g,hideFormConfirmPayment:I,formReceipt:S,showFormReceipt:C,hideFormReceipt:L,isResetListApartmentFilter:N,setIsResetListApartmentFilter:P,servicesSelected:i,setServicesSelected:u};return n(R.Provider,{value:H,children:e})};K.propTypes={children:Be.node};K.defaultProps={children:n("div",{})};const We=K,Ue=()=>{const{formPaymentInfo:e,idBuilding:o,setApartments:r,setServicesSelected:a}=v.useContext(R),{fundData:d}=ee(),{labelsAccountingData:s}=te(),{serviceInUses:m,getServiceInUses:t,loading:i}=_e();return v.useEffect(()=>{(async()=>await t({idBuilding:o}))()},[]),[(p,h)=>{var l,y;if(p.method){const f=d.filter(g=>{let{method:I}=p;return[re,ae].includes(p.method)&&(I=se),g.method===I});p.method===ie?e.setFieldsValue({paymentAt:T(),fundId:(l=f[0])==null?void 0:l.id}):e.setFieldsValue({fundId:(y=f[0])==null?void 0:y.id})}p!=null&&p.serviceIds&&(r([]),a((p==null?void 0:p.serviceIds)??[]))},e,s,d,m,i]},Ve=me(x,{target:"e5l6ux10"})({name:"1l3htcl",styles:".ant-select-selection-item{width:0;}"}),ze=()=>{const e=U(),[o,r,a,d,s,m]=Ue();return A(_,{children:[A(_.Header,{style:{display:"flex",flexDirection:"row",alignItems:"center"},size:"small",borderBottom:!0,children:[n(O,{style:{fontSize:e.iconSize,marginRight:e.margin.xs},name:"icon-apartment-outlined"}),n(ne,{children:c.payment_info})]}),n(_.Content,{children:n(F,{onValuesChange:o,initialValues:{paymentAt:T(),voucherDay:T()},layout:"vertical",form:r,name:"formPaymentInfo",requiredMark:!1,children:A(G,{gutter:[16,0],children:[n(w,{span:"8",children:n(F.Item,{noStyle:!0,shouldUpdate:(t,i)=>t.paymentAt!==i.paymentAt||i.method!==t.method,children:({getFieldValue:t})=>n(F.Item,{name:"paymentAt",label:`${c.payment_at} *`,rules:[{required:!0}],children:n(Z,{disabled:t("method")===ie,fluid:"true",placeholder:j,format:j})})})}),n(w,{span:"8",children:n(F.Item,{name:"voucherDay",label:c.voucher_day,children:n(Z,{fluid:"true",placeholder:j,format:j})})}),n(w,{span:8,children:n(F.Item,{name:"labelId",label:c.label1,children:n(Ve,{fluid:"true",placeholder:c.choose_label,allowClear:!0,children:a.map(t=>n(x.Option,{value:t.id,children:t.title},t.id))})})}),n(w,{span:"8",children:n(F.Item,{name:"method",label:`${c.payment_method} *`,rules:[{required:!0}],children:n(x,{fluid:"true",placeholder:c.choose_method,children:ge.map(t=>n(x.Option,{value:t.id,children:t.name},t.id))})})}),n(w,{span:8,children:n(F.Item,{noStyle:!0,shouldUpdate:(t,i)=>t.method!==i.method,children:({getFieldValue:t})=>n(F.Item,{name:"fundId",label:c.label.fund,rules:[{required:!0}],children:n(x,{fluid:"true",placeholder:c.label.choose_fund,children:d.filter(i=>{const u=t("method");return[ae,re].includes(u)?i.method===se:i.method===u}).map(i=>n(x.Option,{value:i.id,children:i.name},i.id))})})})}),n(w,{span:8,children:n(F.Item,{name:"serviceIds",label:c.service,children:n(x,{fluid:"true",mode:"multiple",maxTagCount:"responsive",placeholder:c.service,showSearch:!0,filterOption:(t,i)=>i.children.toLowerCase().indexOf(t.toLowerCase())>=0,getPopupContainer:t=>t.parentNode,disabled:m,loading:m,children:s==null?void 0:s.map(t=>n(x.Option,{value:t.id,children:t.name},t.id))})})})]})})})]})},ce=e=>{var o,r,a,d,s,m,t,i,u,p,h,l,y;return{id:e==null?void 0:e.id,key:e==null?void 0:e.id,type:(e==null?void 0:e.type)??"",content:(s=Oe({createdFor:e.createdFor,serviceName:(o=e==null?void 0:e.service)==null?void 0:o.name,contractTemplateName:(a=(r=e==null?void 0:e.contract)==null?void 0:r.contractTemplate)==null?void 0:a.name,totalNumberUse:e.totalNumberUse,parentId:e.parentId,registrationPlate:(d=e==null?void 0:e.contract)==null?void 0:d.registrationPlate,type:e.type,adjustmentCreatedFor:e==null?void 0:e.adjustmentCreatedFor}))==null?void 0:s.content,account:{id:(m=e==null?void 0:e.account)==null?void 0:m.id,balance:((t=e==null?void 0:e.account)==null?void 0:t.balance)??0},contract:{id:(i=e==null?void 0:e.contract)==null?void 0:i.id,registrationPlate:((u=e==null?void 0:e.contract)==null?void 0:u.registrationPlate)??"",contractTemplateName:((h=(p=e==null?void 0:e.contract)==null?void 0:p.contractTemplate)==null?void 0:h.name)??""},service:{id:e==null?void 0:e.serviceId,name:((l=e==null?void 0:e.service)==null?void 0:l.name)??"",measureUnit:((y=e==null?void 0:e.service)==null?void 0:y.measureUnit)??"",type:(e==null?void 0:e.serviceType)??""},createdAt:e==null?void 0:e.createdAt,createdFor:e==null?void 0:e.createdFor,adjustmentCreatedFor:e==null?void 0:e.adjustmentCreatedFor,incurredCreatedFor:e==null?void 0:e.incurredCreatedFor,subTotal:+((e==null?void 0:e.subTotal)??0),totalPromotion:+((e==null?void 0:e.totalPromotion)??0),totalSurcharge:+((e==null?void 0:e.totalSurcharge)??0),totalSurchargeTax:+((e==null?void 0:e.totalSurchargeTax)??0),totalTax:+((e==null?void 0:e.totalTax)??0),totalPayment:+((e==null?void 0:e.totalPayment)??0),total:((e==null?void 0:e.totalPaymentAfterAdjust)??0)-((e==null?void 0:e.netRevenue)??0),totalPaymentAfterAdjust:+((e==null?void 0:e.totalPaymentAfterAdjust)??0),netRevenue:+((e==null?void 0:e.netRevenue)??0)}},$e=async(e,o,r)=>{try{const{code:a,codeLanguage:d,data:s}=await Ne(e,o,r);return{code:a,codeLanguage:d,data:s.map(m=>ce(m))}}catch({code:a,codeLanguage:d}){return{code:a,codeLanguage:d,data:[]}}},He=e=>{var d,s,m;const o=((e==null?void 0:e.bills)??[]).sort((t,i)=>t.incurredCreatedFor<i.incurredCreatedFor?-1:t.incurredCreatedFor>i.incurredCreatedFor?1:T(t.createdAt).isAfter(i.createdAt)?-1:T(t.createdAt).isBefore(i.createdAt)?1:0),r=[],a=[];for(let t=0;t<o.length;t+=1){const i=ce(o[t]);i.status!==W?r.push(i):i.status===W&&a.push(i)}return{id:e==null?void 0:e.id,name:(e==null?void 0:e.name)??"",accountBalance:((d=e==null?void 0:e.account)==null?void 0:d.balance)??0,listBill:r,listBillInProcess:a,householder:((m=(s=e==null?void 0:e.residents)==null?void 0:s[0])==null?void 0:m.fullName)??(e==null?void 0:e.name)??""}},qe=async(e,o)=>{try{const{name:r,serviceIds:a}=o,{code:d,codeLanguage:s,data:m}=await je({filterObject:{unitName:r||void 0,state:[Ae,Ie],status:[ve,W],serviceIds:a!=null&&a.length?a:void 0},page:Pe,limit:Se,idBuilding:e});return{code:d,codeLanguage:s,data:m.map(t=>He(t))}}catch({code:r,codeLanguage:a}){return{code:r,codeLanguage:a,data:[]}}},Ye=({isUseApartmentAccount:e,apartmentAccountBalance:o,actuallyPaid:r=0,listBillSelected:a,listAdjustmentDown:d})=>{const s={},m=[...d];let t=0;for(let l=0;l<a.length;l+=1){const y={...a[l]};for(let f=0;f<m.length;f+=1){const g={...m[f]};if(y.service.id===g.service.id&&g.total<0&&y.total>0){s[g.id]||(s[g.id]={...g});const I=y.total;y.total+=+g.total,g.total+=I,y.total<0&&(y.total=0),g.total>0&&(g.total=0),t+=I-y.total,m[f]=g}}}const i=a.reduce((l,y)=>l+ +y.total,0);let u=(e?i-o:i)-t;const p=r||u;u<=0&&(u=0);const h=u?u-p:0;return[Object.values(s),i,u,t,h]},Ge=()=>{const{idBuilding:e,apartments:o,setApartments:r,showFormBills:a,isResetListApartmentFilter:d,setIsResetListApartmentFilter:s,servicesSelected:m}=v.useContext(R),[t,i]=v.useState({isFetching:!1,records:[]}),u=async(f,g)=>{var I;if(g==="select"){if(o.length<20){const S=((I=t==null?void 0:t.records)==null?void 0:I.find(C=>C.id===f))??void 0;if(S){const C=await $e(e,S.id,m),[L,,N,,]=Ye({listBillSelected:S.listBill,listAdjustmentDown:(C==null?void 0:C.data)??[]});r([...o,{...S,listAdjustmentDown:L,totalPayment:N}])}}}else g==="deselect"?r([...o.filter(S=>S.id!==f)]):g==="clear"&&r([])},p=async f=>{i({...t,isFetching:!0});const g=await qe(e,{name:f,serviceIds:m});i({records:g.data,isFetching:!1})},h=(f,g,I)=>{a({listBill:f,listAdjustmentDown:g,listBillInProcess:I})},l=v.useMemo(()=>o.map(f=>{var g,I,S;return{key:f.id,apartment:f.name,payer:((I=(g=f==null?void 0:f.residents)==null?void 0:g[0])==null?void 0:I.fullName)??f.name,amountFee:(S=f==null?void 0:f.listBill)==null?void 0:S.length,totalPayment:k(f.totalPayment),listBill:f.listBill,listAdjustmentDown:f.listAdjustmentDown,listBillInProcess:f.listBillInProcess}}),[o]);v.useEffect(()=>{(async()=>d&&(await p(),s(!1)))()},[d]);const y=f=>{const{listBill:g,listBillInProcess:I}=f;return I!=null&&I.length||g.find(C=>Number(C.totalPayment)>Number(C.totalPaymentAfterAdjust)&&!C.parentId)?"disabled":""};return{onClickBtnShowListBill:h,loadingApartment:t.isFetching,listApartmentSelected:o,listApartment:t.records,handleSearchApartment:p,handleApartmentSelectedChange:u,dataSource:l,rowClassName:y}},Je=()=>{const{layoutScrollRef:e}=v.useContext(Ce),o=U(),{onClickBtnShowListBill:r,loadingApartment:a,listApartmentSelected:d,listApartment:s,handleSearchApartment:m,handleApartmentSelectedChange:t,dataSource:i,rowClassName:u}=Ge(),p=[{title:c.unit,key:"apartment",dataIndex:"apartment",render:(h,l)=>{const{listBillInProcess:y,listBill:f}=l;return y!=null&&y.length?n("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:A($,{title:c.bill_of_apartment_is_processing,children:[n("span",{style:{marginRight:o.margin.xs},children:h}),n(O,{name:"icon-exclamation-circle-outlined"})]})}):f.find(I=>Number(I.totalPayment)>Number(I.totalPaymentAfterAdjust)&&!I.parentId)?n("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:A($,{title:c.bill_of_apartment_has_been_adjusted_down,children:[n("span",{style:{marginRight:o.margin.xs},children:h}),n(O,{name:"icon-exclamation-circle-outlined"})]})}):h}},{title:c.payer,key:"payer",dataIndex:"payer"},{title:c.amount_service_fee,key:"amountFee",dataIndex:"amountFee",render:(h,l)=>n(J,{style:{padding:0},type:"link",onClick:()=>r(l.listBill,l.listAdjustmentDown,l.listBillInProcess),children:h})},{title:`${c.total_payment} (VND)`,key:"totalPayment",dataIndex:"totalPayment",align:"right"}];return A(_,{style:{height:"100%"},children:[A(_.Header,{style:{display:"flex",flexDirection:"row",alignItems:"center"},size:"small",borderBottom:!0,children:[n(O,{style:{fontSize:o.iconSize,marginRight:o.margin.xs},name:"icon-list-alt-outlined"}),n(ne,{children:c.unit_list})]}),A(_.Content,{children:[n(x,{mode:"multiple",allowClear:!0,showSearch:!0,placeholder:c.select_apartment,filterOption:!1,loading:a,onSearch:ue(m),fluid:"true",dropdownRender:h=>a?n("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"},children:n(De,{})}):h,value:d.map(h=>h.id),maxTagCount:"responsive",onDropdownVisibleChange:h=>h&&m(""),onSelect:h=>t(h,"select"),onDeselect:h=>t(h,"deselect"),onClear:h=>t(h,"clear"),children:s.map(({id:h,name:l})=>n(x.Option,{value:h,children:l},h))}),n("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",margin:`${o.margin.sm}px 0`},children:A("span",{style:{fontWeight:o.fontWeight.normal,color:o.labelColor},children:[c.total," ",n("span",{style:{fontWeight:o.fontWeight.bold,verticalAlign:"middle"},children:d.length})]})}),n(Y,{columns:p,dataSource:i,pagination:!1,bordered:!0,sticky:{offsetScroll:o.offsetScrollX,getContainer:()=>e.current},rowClassName:u})]})]})},Ke=()=>{const{apartments:e,showFormConfirmPayment:o,formPaymentInfo:r,paymentPermissionWrite:a}=v.useContext(R),{currentUser:d}=we(),s=e.reduce((u,p)=>u+Number(p.totalPayment),0),m=e.find(u=>{const{listBillInProcess:p,listBill:h}=u;return!!(p!=null&&p.length||h.find(y=>Number(y.totalPayment)>Number(y.totalPaymentAfterAdjust)&&!y.parentId))}),t=e.length===0||m;return{apartmentError:m,total:s,paymentPermissionWrite:a,disabled:t,onClickBtnPayment:async(u,p)=>{if(await r.validateFields()&&u&&u.length>0){const l={paymentAt:r.getFieldValue("paymentAt"),voucherDay:r.getFieldValue("voucherDay"),labelId:r.getFieldValue("labelId"),method:r.getFieldValue("method"),fundId:r.getFieldValue("fundId"),apartments:u,total:p,cashier:d.fullName};o({...l})}},apartments:e}},Qe=()=>{const e=U(),{apartmentError:o,total:r,paymentPermissionWrite:a,disabled:d,onClickBtnPayment:s,apartments:m}=Ke();return n(_,{rise:!0,borderTop:!0,children:n(_.Content,{children:A(G,{gutter:[32,0],children:[n(b,{centerVertical:!0,style:{borderRight:`1px solid ${e.borderColor}`,width:"100%"},flex:"1 0 0",children:o&&n(Te,{type:"warning",showIcon:!0,message:c.bill_of_apartment_is_processing_or_has_been_adjusted_down})}),A(b,{centerVertical:!0,style:{paddingTop:e.padding.xs,paddingBottom:e.padding.xs},children:[A("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",marginRight:e.margin.md},children:[A("span",{style:{fontWeight:e.fontWeight.bold,fontSize:e.fontSize.lg},children:[c.total," (VND)"]}),n("span",{style:{fontWeight:e.fontWeight.bold,fontSize:e.fontSize.lg,color:e.backgroundSidebar},children:k(r)})]}),a?n(J,{onClick:()=>!d&&s(m,r),disabled:d,type:"primary",size:"large",children:c.payment}):null]})]})})})};function Xe(){const{hideFormBills:e,formBills:o}=v.useContext(R),{data:r}=o,{listBill:a,listAdjustmentDown:d}=r,s=()=>e(),m=v.useMemo(()=>[...a,...d].map(i=>({...i,key:i.id})),[a]);return[s,m,i=>i.status===W?"disabled":""]}function Ze(){const[e,o,r]=Xe(),a=U(),d=v.useMemo(()=>[{title:c.content,key:"content",dataIndex:"content",render:(s,m)=>A(le,{children:[n("span",{children:s}),m.totalPayment!==m.totalPaymentAfterAdjust?A("span",{style:{color:a.color.warning},children:["(",c.label.there_are_adjust_down,")"]}):null]})},{title:`${c.total_payment} (VND)`,key:"total",align:"right",width:140,dataIndex:"total",render:s=>n(Re.Text,{style:{color:s<0?a.color.error:a.textColor},children:s<0?`(${k(s*-1)})`:k(s)})}],[]);return n(oe,{title:c.detail,open:!0,onCancel:e,footer:null,children:n(Y,{bordered:!0,columns:d,dataSource:o,pagination:!1,rowClassName:r})})}const be=async(e,o)=>{try{const{method:r,payer:a,cashier:d,labelId:s,fundId:m,apartmentIds:t,paymentAt:i,voucherAt:u,serviceIds:p}=o,{code:h,codeLanguage:l,data:y}=await ke(e,{paymentMethod:r,payer:a,cashier:d,labelId:s,fundId:m,createdAt:i,voucherDay:u,unitIds:t,serviceIds:p!=null&&p.length?p:void 0});return{code:h,codeLanguage:l,data:y}}catch({code:r,codeLanguage:a}){return{code:r,codeLanguage:a,data:void 0}}},et=async(e,o)=>{try{const{code:r,codeLanguage:a,data:d}=await Me({idBuilding:e,idReceipt:o});return{code:r,codeLanguage:a,data:d}}catch({code:r,codeLanguage:a}){return{code:r,codeLanguage:a,data:void 0}}},tt=()=>{var L,N;const{idBuilding:e}=de(),{showFormReceipt:o,hideFormConfirmPayment:r,formConfirmPayment:a,formPaymentInfo:d,setPaymentInfo:s,setApartments:m,setIsResetListApartmentFilter:t,servicesSelected:i}=v.useContext(R),{data:u}=a,{fundData:p}=ee(),{labelsAccountingData:h}=te(),[l,y]=v.useState({isFetching:!1,code:void 0,codeLanguage:void 0});pe(l.code,l.codeLanguage,{message:c.label.success,description:c.status.payment_success});const f=v.useMemo(()=>u.apartments.map(P=>{var B;return{key:P.id,apartment:P.name,payer:P.householder,amountFee:(B=P==null?void 0:P.listBill)==null?void 0:B.length,totalPayment:k(P.totalPayment),bills:P.listBill}}),[u]),g=((L=p.find(P=>P.id===u.fundId))==null?void 0:L.name)??"",I=((N=h.find(P=>P.id===u.labelId))==null?void 0:N.title)??"",S=async()=>{y({isFetching:!0,code:void 0,codeLanguage:void 0});const P={...u,apartmentIds:u.apartments.map(V=>V.id),serviceIds:i!=null&&i.length?i:void 0},{code:B,codeLanguage:H,data:D=[]}=await be(e,P);if(Fe.includes(B)){if(D&&D.length){let V="",Q="";for(let z=0;z<D.length;z+=1){const{data:X=""}=await et(e,D[z].id);z===0&&(V=X),Q+=X}o({htmlPreview:V,htmlPrint:Q})}d.resetFields(),s({paymentAt:void 0,voucherDay:void 0,labelId:void 0,method:void 0,fundId:void 0}),m([]),t(!0),r()}y({isFetching:!1,code:B,codeLanguage:H})},C=()=>r();return{loadingPayment:l.isFetching,paymentData:{...u,fundName:g,labelName:I},handlePayment:S,handleCancelPayment:C,dataSource:f}},nt=()=>{var m;const{loadingPayment:e,paymentData:o,handlePayment:r,handleCancelPayment:a,dataSource:d}=tt(),s=[{title:c.unit,key:"apartment",dataIndex:"apartment",render:(t,i)=>{const{bills:u}=i;return u.find(l=>l.status===W)?n("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:A($,{title:c.bill_of_apartment_is_processing,children:[n("span",{css:l=>({marginRight:l.margin.sm}),children:t}),n(O,{name:"icon-exclamation-circle-outlined"})]})}):u.find(l=>Number(l.totalPayment)>Number(l.totalPaymentAfterAdjust)&&!l.parentId)?n("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:A($,{title:c.bill_of_apartment_has_been_adjusted_down,children:[n("span",{css:l=>({marginRight:l.margin.sm}),children:t}),n(O,{name:"icon-exclamation-circle-outlined"})]})}):t}},{title:c.payer,key:"payer",dataIndex:"payer"},{title:c.amount_service_fee,key:"amountFee",dataIndex:"amountFee",render:(t,i)=>n(J,{style:{padding:0},type:"link",children:t})},{title:`${c.total_payment} (VND)`,key:"totalPayment",dataIndex:"totalPayment",align:"right"}];return A(oe,{okButtonProps:{disabled:e,loading:e},open:!0,title:c.confirm,okText:c.confirm,cancelText:c.cancel,onOk:r,onCancel:a,children:[A(G,{css:t=>({flex:1,marginBottom:t.margin.sm}),gutter:[0,18],children:[A(w,{span:8,children:[n(M,{children:c.payment_at}),n(E,{children:o.paymentAt?T(o.paymentAt).format(j):"-"})]}),A(w,{span:8,children:[n(M,{children:c.voucher_day}),n(E,{children:o.voucherDay?T(o.voucherDay).format(j):"-"})]}),A(w,{span:8,children:[n(M,{children:c.label1}),n(E,{children:(o==null?void 0:o.labelName)??"-"})]}),A(w,{span:8,children:[n(M,{children:c.payment_method}),n(E,{children:((m=xe[o.method])==null?void 0:m.name)??"-"})]}),A(w,{span:8,children:[n(M,{children:c.fund}),n(E,{children:(o==null?void 0:o.fundName)??"-"})]})]}),n("div",{css:t=>({borderTop:`1px solid ${t.borderColor}`,borderBottom:`1px solid ${t.borderColor}`,padding:`${t.padding.sm}px 0`}),children:n(Y,{columns:s,dataSource:d,pagination:!1,bordered:!0})}),A("div",{css:t=>({display:"flex",flexDirection:"row",alignItems:"center",background:t.backgroundContent,padding:t.padding.sm,borderRadius:t.borderRadius,marginTop:t.margin.sm,justifyContent:"space-between"}),children:[A("span",{css:t=>({fontWeight:t.fontWeight.normal,fontSize:t.fontSize.md}),children:[c.total," (VND)"]}),n("span",{css:t=>({fontWeight:t.fontWeight.normal,fontSize:t.fontSize.md}),children:k(o.total)})]})]})},ot=()=>{const{formBills:e,formConfirmPayment:o,formReceipt:r,hideFormReceipt:a}=v.useContext(R);return[e.isShow,o.isShow,r.isShow,r,a]},rt=()=>{const e=U(),[o,r,a,d,s]=ot();return A("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[n(ze,{}),n("div",{style:{marginTop:e.margin.md,flex:1},children:n(Je,{})}),n(Le,{offsetBottom:"0",children:n(Qe,{})}),o&&n(Ze,{}),r&&n(nt,{}),a?n(Ee,{formReceipt:d,hideFormReceipt:s}):null]})},qn=()=>n(We,{children:n(rt,{})});export{qn as default};
